<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	<meta charset="utf-8">
	<title class="Registrationsidebar">securityThreatGroup</title>
	<div th:replace="~{fragments/head :: head}"></div>

	<body class="mod-bg-1 mod-nav-link">
		
		<!-- BEGIN Page Wrapper --> 
			<!-- BEGIN Page Header --> 
					<div th:replace="~{fragments/header :: header}"></div>
					<div th:replace="~{fragments/navmenus :: navmenus}"></div>
			<!-- 		<div th:replace="~{fragments/navmenus :: navmenus}"></div> -->
					<!-- END Page Header -->
		<div class="page-wrapper">
			<div class="page-inner">
				<!-- BEGIN Left Aside -->
			 <div th:replace="~{fragments/sidebar :: sidebar}"></div>  
				<!-- END Left Aside --> 
				<div class="page-content-wrapper">
				
					<!-- BEGIN Page Content -->
					<!-- the #js-page-content id is needed for some plugins to initialize -->
					<main id="js-page-content" role="main" class="page-content">
						<!-- <ol class="breadcrumb page-breadcrumb">
                            <li class="breadcrumb-item"><a href="javascript:void(0);">SmartAdmin</a></li>
                            <li class="breadcrumb-item">category_1</li>
                            <li class="breadcrumb-item">category_2</li>
                            <li class="breadcrumb-item active">Page Titile</li>
                            <li class="position-absolute pos-top pos-right d-none d-sm-block"><span class="js-get-date"></span></li>
						</ol> -->
						<div class="subheader mb-3">
							<h1 class="subheader-title">
							<div th:replace="~{fragments/toggleMenu :: toggleMenu}"></div>
							<i class='subheader-icon fal fa-'></i> <span  id="screenNameHolder" th:data-name="${screenCode}" th:text="${screenName}"></span></span> 
						</h1>						
					
						<div class="frame-wrap bg-transparent">
							<div class="btn-group">
							<div class="col-12 pr-0">
								<div class="js-get-date">[your date here]</div>
							</div> 
								<div class="mr-2">
									<div class="input-append date position-relative w-100">
										
										<span class="add-on"></span>
									</div>
								</div>
							</div>
							<a href="javascript:void(0);"
							class="btn btn-primary btn-sm btn-icon waves-effect waves-themed "
							data-toggle="tooltip" data-placement="top" data-original-title="Add" id="add-on"> <i
								class="fal fa-plus"></i>
							</a> <a href="javascript:void(0);"
							class="btn btn-warning btn-sm btn-icon waves-effect waves-themed "
							data-toggle="tooltip" data-placement="top" data-original-title="Print"> <i
								class="fal fa-print"></i>
							</a> <a href="javascript:void(0);"
							class="btn btn-secondary btn-sm btn-icon waves-effect waves-themed"
							data-toggle="tooltip" data-placement="top" id='clear-btn' data-original-title="Clear"> <i
								class="fal fa-times"></i>
							</a> <a href="javascript:void(0);"
							class="btn btn-success btn-sm btn-icon waves-effect waves-themed"   id="saveRowBtn" data-toggle="tooltip"
							data-placement="top" data-original-title="OK/Save"> <i class="fal fa-save"></i>
							</a> <a href="javascript:void(0);"
							class="btn btn-danger btn-sm btn-icon waves-effect waves-themed" data-toggle="tooltip"
							data-placement="top" data-original-title="Cancel/Exit" onclick="history.back()"> <i class="fal fa-sign-out"></i>
							</a>
						</div>
						
					</div>
					
					<div class="row">
						<div class="col-lg-12">						
							<div th:replace="~{fragments/formheader :: formheader}"></div>
							<div class="row">
								<div class="col-lg-12">
									<div id="panel-1" class="panel mb-0">
                                    	<div class="panel-hdr d-flex justify-content-end"> </div>
	                                    <div class="panel-container show">
	                                        <div class="panel-content mb-0 p-1">
	                                            <div id="js-checkbox-toggles">
	                                                <div id="security-table"></div>
													<div id="security-table1"></div>
												
													<div class="m-1">
														<div class="custom-control custom-checkbox custom-control-inline mb-2">
															<input type="checkbox" class="custom-control-input rawField" id="assaultcheckbox" data-fld="PriorAssaultscheckbox" data-lbl="Prior Assaults To Staff">
															<label class="custom-control-label text-nowrap" for="assaultcheckbox">Prior Assaults To Staff</label>
														</div>
														<div class="col-12 col-lg-12 floatingFieldsTextarea mt-3 px-0"  value="">
														    <textarea class="form-control rawField floatingLabletextarea" id="Comments" data-fld="Commentsarea" data-lbl="Comments" placeholder="" rows="6" name="Comments" aria-label="Comments" value=""></textarea>
														     <label for="Comments" class="form-label mb-0 ml-2 text-nowrap">Comments</label>
														    <div id="charCount">0/2000 characters</div>														
														</div>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
								</div>
								<div class="modal fade" id="securityThreatGroup" tabindex="-1" role="dialog" >
									<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
										<div class="modal-content">
											<div class="modal-header pt-3 pb-2">
												<h6 class="modal-title">DOC - Security Threat Groups</h6>
												<button type="button" class="close" data-dismiss="modal" aria-label="Close">
													<span aria-hidden="true"><i class="fal fa-times"></i></span>
												</button>
											</div>
											<div class="modal-body py-0">
												<div class="d-flex align-items-center mb-2">
													<label for="dob" class="form-label mb-0 mr-2 text-nowrap">Find</label>
													<input type="text" class="form-control" aria-label="dob" name="Findgang" id="Findgang" value="">
												</div>
												<div id="securityThreat-table"></div>
											</div>
											<div class="modal-footer">
											<!-- 	<button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" >Find</button> -->
												<button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-dismiss="modal">Ok</button>
												<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
											</div>
										</div> 
										
									</div>			
								</div>
							</div>
						</div>
					</div>
				</main>
				<!-- this overlay is activated only when mobile menu is triggered -->
				<div class="page-content-overlay" data-action="toggle" data-class="mobile-nav-on"></div>
				<!-- END Page Content -->
				
				<!-- Modal Large -->
				<div class="modal fade" id="default-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
					<div class="modal-dialog modal-lg" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title">Staff Name</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true"><i class="fal fa-times"></i></span>
								</button>
							</div>
							<div class="modal-body">
								<div class="form-group row">
									<label for="staffSearch"
									class="col-form-label col-12 col-lg-1 form-label">Search</label>
									<div class="col-12 col-lg-11">
										<input type="text" class="form-control" aria-label="staffSearch"
										name="staffSearch" id="staffSearch" value="">
									</div>
									
								</div>
								<div class="table-responsive-lg">
									<table class="table table-bordered m-0">
										<thead>
											<tr>
												<th>Last Name</th>
												<th>First Name</th>
												<th>MI</th>
												<th>Suffix</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											
										</tbody>
									</table>
								</div>
							</div>
							
						</div>
					</div>
				</div>
				<!-- BEGIN Shortcuts -->
				<!-- modal shortcut -->
				<div class="modal fade modal-backdrop-transparent" id="modal-shortcut" tabindex="-1" role="dialog"
				aria-labelledby="modal-shortcut" aria-hidden="true">
					<div class="modal-dialog modal-dialog-top modal-transparent" role="document">
						<div class="modal-content">
							<div class="modal-body">
								<ul class="app-list w-auto h-auto p-0 text-left">
									<li>
										<a href="intel_introduction.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-3x opacity-100 color-primary-500 "></i>
												<i class="base base-7 icon-stack-2x opacity-100 color-primary-300 "></i>
												<i class="fal fa-home icon-stack-1x opacity-100 color-white"></i>
											</div>
											<span class="app-list-name">
												Home
											</span>
										</a>
									</li>
									<li>
										<a href="page_inbox_general.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-3x opacity-100 color-success-500 "></i>
												<i class="base base-7 icon-stack-2x opacity-100 color-success-300 "></i>
												<i class="ni ni-envelope icon-stack-1x text-white"></i>
											</div>
											<span class="app-list-name">
												Inbox
											</span>
										</a>
									</li>
									<li>
										<a href="intel_introduction.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-2x opacity-100 color-primary-300 "></i>
												<i class="fal fa-plus icon-stack-1x opacity-100 color-white"></i>
											</div>
											<span class="app-list-name">
												Add More
											</span>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div> <!-- END Shortcuts -->
			</div>
		</div>
	</div>
	<!-- END Page Wrapper -->
	<!-- BEGIN Quick Menu -->
	<!-- to add more items, please make sure to change the variable '$menu-items: number;' in your _page-components-shortcut.scss -->
<nav class="shortcut-menu d-none d-sm-block"> <input
		type="checkbox" class="menu-open" name="menu-open" id="menu_open" />
	<label for="menu_open" class="menu-open-button "> <span
		class="app-shortcut-icon d-block"></span>
	</label> <a href="#" class="menu-item btn" data-toggle="tooltip"
		data-placement="left" title="Scroll Top"> <i
		class="fal fa-arrow-up"></i>
	</a> <a href="page_login-alt.html" class="menu-item btn"
		data-toggle="tooltip" data-placement="left" title="Logout"> <i
		class="fal fa-sign-out"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-fullscreen"
		data-toggle="tooltip" data-placement="left" title="Full Screen"> <i
		class="fal fa-expand"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-print"
		data-toggle="tooltip" data-placement="left" title="Print page"> <i
		class="fal fa-print"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-voice"
		data-toggle="tooltip" data-placement="left" title="Voice command">
		<i class="fal fa-microphone"></i>
	</a> </nav>
	<!-- END Quick Menu -->
	<!-- BEGIN Messenger -->
	<div class="modal fade js-modal-messenger modal-backdrop-transparent" tabindex="-1" role="dialog"
	aria-hidden="true">
		<div class="modal-dialog modal-dialog-right">
			<div class="modal-content h-100">
				<div class="dropdown-header bg-trans-gradient d-flex align-items-center w-100">
					<div class="d-flex flex-row align-items-center mt-1 mb-1 color-white">
						<span class="mr-2">
							<span class="rounded-circle profile-image d-block"
							style="background-image:url('img/demo/avatars/avatar-d.png'); background-size: cover;"></span>
						</span>
						<div class="info-card-text">
							<a href="javascript:void(0);" class="fs-lg text-truncate text-truncate-lg text-white"
							data-toggle="dropdown" aria-expanded="false">
								Tracey Chang
								<i class="fal fa-angle-down d-inline-block ml-1 text-white fs-md"></i>
							</a>
							<div class="dropdown-menu">
								<a class="dropdown-item" href="#">Send Email</a>
								<a class="dropdown-item" href="#">Create Appointment</a>
								<a class="dropdown-item" href="#">Block User</a>
							</div>
							<span class="text-truncate text-truncate-md opacity-80">IT Director</span>
						</div>
					</div>
					<button type="button" class="close text-white position-absolute pos-top pos-right p-2 m-1 mr-2"
					data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true"><i class="fal fa-times"></i></span>
					</button>
				</div>
				<div class="modal-body p-0 h-100 d-flex">
					<!-- BEGIN msgr-list -->
					<div
					class="msgr-list d-flex flex-column bg-faded border-faded border-top-0 border-right-0 border-bottom-0 position-absolute pos-top pos-bottom">
						<div>
							<div
							class="height-4 width-3 h3 m-0 d-flex justify-content-center flex-column color-primary-500 pl-3 mt-2">
								<i class="fal fa-search"></i>
							</div>
							<input type="text" class="form-control bg-white" id="msgr_listfilter_input"
							name="msgr_listfilter_input" placeholder="Filter contacts" aria-label="FilterSearch"
							value="" data-listfilter="#js-msgr-listfilter">
						</div>
						<div class="flex-1 h-100 custom-scroll">
							<div class="w-100">
								<ul id="js-msgr-listfilter" class="list-unstyled m-0">
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="tracey chang online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-d.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Tracey Chang
													<small class="d-block font-italic text-success fs-xs">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="oliver kopyuv online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-b.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Oliver Kopyuv
													<small class="d-block font-italic text-success fs-xs">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="dr john cook phd away">
											<div class="d-table-cell align-middle status status-warning status-sm ">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-e.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Dr. John Cook PhD
													<small class="d-block font-italic fs-xs">
														Away
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="ali amdaney online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-g.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Ali Amdaney
													<small class="d-block font-italic fs-xs text-success">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="sarah mcbrook online">
											<div class="d-table-cell align-middle status status-success status-sm">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-h.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Sarah McBrook
													<small class="d-block font-italic fs-xs text-success">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="ali amdaney offline">
											<div class="d-table-cell align-middle status status-sm">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-a.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs">
														Offline
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="ali amdaney busy">
											<div class="d-table-cell align-middle status status-danger status-sm">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-j.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs text-danger">
														Busy
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="ali amdaney offline">
											<div class="d-table-cell align-middle status status-sm">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-c.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs">
														Offline
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
										data-filter-tags="ali amdaney inactive">
											<div class="d-table-cell align-middle">
												<span class="profile-image-md rounded-circle d-block"
												style="background-image:url('img/demo/avatars/avatar-m.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													+714651347790
													<small class="d-block font-italic fs-xs opacity-50">
														Missed Call
													</small>
												</div>
											</div>
										</a>
									</li>
								</ul>
								<div class="filter-message js-filter-message"></div>
							</div>
						</div>
						<div>
							<a class="fs-xl d-flex align-items-center p-3">
								<i class="fal fa-cogs"></i>
							</a>
						</div>
					</div>
					<!-- END msgr-list -->
					<!-- BEGIN msgr -->
					<div class="msgr d-flex h-100 flex-column bg-white">
						<!-- BEGIN custom-scroll -->
						<div class="custom-scroll flex-1 h-100">
							<div id="chat_container" class="w-100 p-4">
								<!-- start .chat-segment -->
								<div class="chat-segment">
									<div class="time-stamp text-center mb-2 fw-400">
										Jun 19
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent">
									<div class="chat-message">
										<p>
											Hey Ching, did you get my files?
										</p>
									</div>
									<div class="text-right fw-300 text-muted mt-1 fs-xs">
										3:00 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get">
									<div class="chat-message">
										<p>
											Hi
										</p>
										<p>
											Sorry going through a busy time in office. Yes I analyzed the solution.
										</p>
										<p>
											It will require some resource, which I could not manage.
										</p>
									</div>
									<div class="fw-300 text-muted mt-1 fs-xs">
										3:24 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent chat-start">
									<div class="chat-message">
										<p>
											Okay
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent chat-end">
									<div class="chat-message">
										<p>
											Sending you some dough today, you can allocate the resources to this
											project.
										</p>
									</div>
									<div class="text-right fw-300 text-muted mt-1 fs-xs">
										3:26 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get chat-start">
									<div class="chat-message">
										<p>
											Perfect. Thanks a lot!
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get">
									<div class="chat-message">
										<p>
											I will have them ready by tonight.
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get chat-end">
									<div class="chat-message">
										<p>
											Cheers
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment for timestamp -->
								<div class="chat-segment">
									<div class="time-stamp text-center mb-2 fw-400">
										Jun 20
									</div>
								</div>
								<!--  end .chat-segment for timestamp -->
							</div>
						</div>
						<!-- END custom-scroll  -->
						<!-- BEGIN msgr__chatinput -->
						<div class="d-flex flex-column">
							<div
							class="border-faded border-right-0 border-bottom-0 border-left-0 flex-1 mr-3 ml-3 position-relative shadow-top">
								<div class="pt-3 pb-1 pr-0 pl-0 rounded-0" tabindex="-1">
									<div id="msgr_input" contenteditable="true"
									data-placeholder="Type your message here..."
									class="height-10 form-content-editable"></div>
								</div>
							</div>
							<div class="height-8 px-3 d-flex flex-row align-items-center flex-wrap flex-shrink-0">
								<a href="javascript:void(0);" class="btn btn-icon fs-xl width-1 mr-1"
								data-toggle="tooltip" data-original-title="More options" data-placement="top">
									<i class="fal fa-ellipsis-v-alt color-fusion-300"></i>
								</a>
								<a href="javascript:void(0);" class="btn btn-icon fs-xl mr-1" data-toggle="tooltip"
								data-original-title="Attach files" data-placement="top">
									<i class="fal fa-paperclip color-fusion-300"></i>
								</a>
								<a href="javascript:void(0);" class="btn btn-icon fs-xl mr-1" data-toggle="tooltip"
								data-original-title="Insert photo" data-placement="top">
									<i class="fal fa-camera color-fusion-300"></i>
								</a>
								<div class="ml-auto">
									<a href="javascript:void(0);" class="btn btn-info">Send</a>
								</div>
							</div>
						</div>
						<!-- END msgr__chatinput -->
					</div>
					<!-- END msgr -->
				</div>
			</div>
		</div>
	</div>
	<!-- END Messenger -->
	<!-- BEGIN Page Settings -->
	<div class="modal fade js-modal-settings modal-backdrop-transparent" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog modal-dialog-right modal-md">
			<div class="modal-content">
				<div class="dropdown-header bg-trans-gradient d-flex justify-content-center align-items-center w-100">
					<h4 class="m-0 text-center color-white">
						Layout Settings
						<small class="mb-0 opacity-80">User Interface Settings</small>
					</h4>
					<button type="button" class="close text-white position-absolute pos-top pos-right p-2 m-1 mr-2"
					data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true"><i class="fal fa-times"></i></span>
					</button>
				</div>
				<div class="modal-body p-0">
					<div class="settings-panel">
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									App Layout
								</h5>
							</div>
						</div>
						<div class="list" id="fh">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="header-function-fixed"></a>
							<span class="onoffswitch-title">Fixed Header</span>
							<span class="onoffswitch-title-desc">header is in a fixed at all times</span>
						</div>
						<div class="list" id="nff">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="nav-function-fixed"></a>
							<span class="onoffswitch-title">Fixed Navigation</span>
							<span class="onoffswitch-title-desc">left panel is fixed</span>
						</div>
						<div class="list" id="nfm">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="nav-function-minify"></a>
							<span class="onoffswitch-title">Minify Navigation</span>
							<span class="onoffswitch-title-desc">Skew nav to maximize space</span>
						</div>
						<div class="list" id="nfh">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="nav-function-hidden"></a>
							<span class="onoffswitch-title">Hide Navigation</span>
							<span class="onoffswitch-title-desc">roll mouse on edge to reveal</span>
						</div>
						<div class="list" id="nft">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="nav-function-top"></a>
							<span class="onoffswitch-title">Top Navigation</span>
							<span class="onoffswitch-title-desc">Relocate left pane to top</span>
						</div>
						<div class="list" id="mmb">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-main-boxed"></a>
							<span class="onoffswitch-title">Boxed Layout</span>
							<span class="onoffswitch-title-desc">Encapsulates to a container</span>
						</div>
						<div class="expanded">
							<ul class="">
								<li>
									<div class="bg-fusion-50" data-action="toggle" data-class="mod-bg-1"></div>
								</li>
								<li>
									<div class="bg-warning-200" data-action="toggle" data-class="mod-bg-2"></div>
								</li>
								<li>
									<div class="bg-primary-200" data-action="toggle" data-class="mod-bg-3"></div>
								</li>
								<li>
									<div class="bg-success-300" data-action="toggle" data-class="mod-bg-4"></div>
								</li>
							</ul>
							<div class="list" id="mbgf">
								<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-fixed-bg"></a>
								<span class="onoffswitch-title">Fixed Background</span>
							</div>
						</div>
						<!-- <div class="mt-4 d-table w-100 px-5">
                            <div class="d-table-cell align-middle">
							<h5 class="p-0">
							Mobile Menu
							</h5>
                            </div>
							</div>
							<div class="list" id="nmp">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="nav-mobile-push"></a>
                            <span class="onoffswitch-title">Push Content</span>
                            <span class="onoffswitch-title-desc">Content pushed on menu reveal</span>
							</div>
							<div class="list" id="nmno">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="nav-mobile-no-overlay"></a>
                            <span class="onoffswitch-title">No Overlay</span>
                            <span class="onoffswitch-title-desc">Removes mesh on menu reveal</span>
							</div>
							<div class="list" id="sldo">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="nav-mobile-slide-out"></a>
                            <span class="onoffswitch-title">Off-Canvas <sup>(beta)</sup></span>
                            <span class="onoffswitch-title-desc">Content overlaps menu</span>
						</div> -->
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Accessibility
								</h5>
							</div>
						</div>
						<div class="list" id="mbf">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-bigger-font"></a>
							<span class="onoffswitch-title">Bigger Content Font</span>
							<span class="onoffswitch-title-desc">content fonts are bigger for readability</span>
						</div>
						<div class="list" id="mhc">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-high-contrast"></a>
							<span class="onoffswitch-title">High Contrast Text (WCAG 2 AA)</span>
							<span class="onoffswitch-title-desc">4.5:1 text contrast ratio</span>
						</div>
						<div class="list" id="mcb">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-color-blind"></a>
							<span class="onoffswitch-title">Daltonism <sup>(beta)</sup> </span>
							<span class="onoffswitch-title-desc">color vision deficiency</span>
						</div>
						<div class="list" id="mpc">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-pace-custom"></a>
							<span class="onoffswitch-title">Preloader Inside</span>
							<span class="onoffswitch-title-desc">preloader will be inside content</span>
						</div>
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Global Modifications
								</h5>
							</div>
						</div>
						<div class="list" id="mcbg">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-clean-page-bg"></a>
							<span class="onoffswitch-title">Clean Page Background</span>
							<span class="onoffswitch-title-desc">adds more whitespace</span>
						</div>
						<div class="list" id="mhni">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-hide-nav-icons"></a>
							<span class="onoffswitch-title">Hide Navigation Icons</span>
							<span class="onoffswitch-title-desc">invisible navigation icons</span>
						</div>
						<div class="list" id="dan">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-disable-animation"></a>
							<span class="onoffswitch-title">Disable CSS Animation</span>
							<span class="onoffswitch-title-desc">Disables CSS based animations</span>
						</div>
						<div class="list" id="mhic">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-hide-info-card"></a>
							<span class="onoffswitch-title">Hide Info Card</span>
							<span class="onoffswitch-title-desc">Hides info card from left panel</span>
						</div>
						<div class="list" id="mlph">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-lean-subheader"></a>
							<span class="onoffswitch-title">Lean Subheader</span>
							<span class="onoffswitch-title-desc">distinguished page header</span>
						</div>
						<div class="list" id="mnl">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
							data-class="mod-nav-link"></a>
							<span class="onoffswitch-title">Hierarchical Navigation</span>
							<span class="onoffswitch-title-desc">Clear breakdown of nav links</span>
						</div>
						<div class="list mt-1">
							<span class="onoffswitch-title">Global Font Size <small>(RESETS ON REFRESH)</small> </span>
							<div class="btn-group btn-group-sm btn-group-toggle my-2" data-toggle="buttons">
								<label for="smRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
								data-class="root-text-sm" data-target="html">
									<input type="radio" aria-label="smRadio" name="smRadio" id="smRadio" value=""> SM
								</label>
								<label for="mdRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
								data-class="root-text" data-target="html">
									<input type="radio" aria-label="mdRadio" name="mdRadio" id="mdRadio" value=""
									checked=""> MD
								</label>
								<label for="lgRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
								data-class="root-text-lg" data-target="html">
									<input type="radio" aria-label="lgRadio" name="lgRadio" id="lgRadio" value=""> LG
								</label>
								<label for="xlRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
								data-class="root-text-xl" data-target="html">
									<input type="radio" aria-label="xlRadio" name="xlRadio" id="xlRadio" value=""> XL
								</label>
							</div>
							<span class="onoffswitch-title-desc d-block mb-g">Change <strong>root</strong> font size to
							effect rem values</span>
						</div>
						<div class="mt-2 d-table w-100 pl-5 pr-3">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Theme colors <small>(overlays base css)</small>
								</h5>
								<!-- <div class="fs-xs text-muted p-2 alert alert-warning mt-3 mb-0">
                                    <i class="fal fa-exclamation-triangle text-warning mr-2"></i>Due to network latency
                                    and CPU utilization, you may experience a brief flickering effect on page load which
                                    may show the intial applied theme for a split second. Setting the prefered
                                    style/theme in the header will prevent this from happening.
								</div> -->
							</div>
						</div>
						<div class="expanded theme-colors pl-5 pr-3">
							<ul class="m-0">
								<li><a href="#" id="myapp-0" data-action="theme-update" data-themesave data-theme=""
									data-toggle="tooltip" data-placement="top" title="Wisteria (base css)"
								data-original-title="Wisteria (base css)"></a></li>
								<li><a href="#" id="myapp-1" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-1.css" data-toggle="tooltip"
								data-placement="top" title="Tapestry" data-original-title="Tapestry"></a></li>
								<li><a href="#" id="myapp-2" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-2.css" data-toggle="tooltip"
								data-placement="top" title="Atlantis" data-original-title="Atlantis"></a></li>
								<li><a href="#" id="myapp-3" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-3.css" data-toggle="tooltip"
								data-placement="top" title="Indigo" data-original-title="Indigo"></a></li>
								<li><a href="#" id="myapp-4" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-4.css" data-toggle="tooltip"
									data-placement="top" title="Dodger Blue" data-original-title="Dodger Blue"></a>
								</li>
								<li><a href="#" id="myapp-5" data-action="theme-update" data-themesave 
									data-theme="css/themes/cust-theme-5.css" data-toggle="tooltip"
								data-placement="top" title="Tradewind" data-original-title="Tradewind"></a></li>
								<li><a href="#" id="myapp-6" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-6.css" data-toggle="tooltip"
								data-placement="top" title="Cranberry" data-original-title="Cranberry"></a></li>
								<li><a href="#" id="myapp-7" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-7.css" data-toggle="tooltip"
								data-placement="top" title="Oslo Gray" data-original-title="Oslo Gray"></a></li>
								<li><a href="#" id="myapp-8" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-8.css" data-toggle="tooltip"
									data-placement="top" title="Chetwode Blue"
								data-original-title="Chetwode Blue"></a></li>
								<li><a href="#" id="myapp-9" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-9.css" data-toggle="tooltip"
								data-placement="top" title="Apricot" data-original-title="Apricot"></a></li>
								<li><a href="#" id="myapp-10" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-10.css" data-toggle="tooltip"
									data-placement="top" title="Blue Smoke" data-original-title="Blue Smoke"></a>
								</li>
								<li><a href="#" id="myapp-11" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-11.css" data-toggle="tooltip"
									data-placement="top" title="Green Smoke" data-original-title="Green Smoke"></a>
								</li>
								<li><a href="#" id="myapp-12" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-12.css" data-toggle="tooltip"
									data-placement="top" title="Wild Blue Yonder"
								data-original-title="Wild Blue Yonder"></a></li>
								<li><a href="#" id="myapp-13" data-action="theme-update" data-themesave
									data-theme="css/themes/cust-theme-13.css" data-toggle="tooltip"
								data-placement="top" title="Emerald" data-original-title="Emerald"></a></li>
							</ul>
						</div>
						<hr class="mb-0 mt-4">
						<div class="pl-5 pr-3 py-3 bg-faded">
							<div class="row no-gutters">
								<div class="col-6 pr-1">
									<a href="#" class="btn btn-outline-danger fw-500 btn-block"
									data-action="app-reset">Reset Settings</a>
								</div>
								<div class="col-6 pl-1">
									<a href="#" class="btn btn-danger fw-500 btn-block"
									data-action="factory-reset">Factory Reset</a>
								</div>
							</div>
						</div>
					</div>
					<span id="saving"></span>
				</div>
			</div>
		</div>
	</div>
	<!-- END Page Settings -->
	
	<div style="display:none">
		<form id="entryform">
		<input type="hidden" name="screenCode" id="screenCode" value="CBI_STG"> 
			
			<label forx="1" for="level_radio">Level</label>
			<input type="text" id="level_radio" name="level_radio" data-typ="Radio">	
			
			<label forx="1" for="no_V">V</label>
			<input type="text" id="no_V" name="no_V" data-typ="Checkbox">
			
			<label forx="1" for="no_II">II</label>
			<input type="text" id="no_II" name="no_II" data-typ="Checkbox">
			
			<label forx="1" for="no_IV">IV</label>
			<input type="text" id="no_IV" name="no_IV" data-typ="Checkbox">
			
			<label forx="1" for="no_I">I</label>
			<input type="text" id="no_I" name="no_I" data-typ="Checkbox" >
			
			<label forx="1" for="no_HC">4 HC</label>
			<input type="text" id="no_HC" name="no_HC" data-typ="Checkbox">
			
			<label forx="1" for="no_IR">IR</label>
			<input type="text" id="no_IR" name="no_IR" data-typ="Checkbox">
			
			<label forx="1" for="no_III">III</label>
			<input type="text" id="no_III" name="no_III" data-typ="Checkbox">
			
			<label forx="1" for="no_detentioner">Detentioner</label>
			<input type="text" id="no_detentioner" name="no_detentioner" data-typ="Checkbox">
			
			<label forx="1" for="current_sts">Current Status</label>
			<input type="text" id="current_sts" name="current_sts" data-typ="Checkbox">
			
			<label forx="1" for="complete_sts">Complete Status</label>
			<input type="text" id="complete_sts" name="complete_sts" data-typ="Checkbox">
			
			<label forx="1" for="future_sts">Future Status</label>
			<input type="text" id="future_sts" name="future_sts" data-typ="Checkbox">
			
			<label forx="1" for="case_radio">Case</label>
			<input type="text" id="case_radio" name="case_radio" data-typ="Radio">
			
			<label forx="1" for="case_num">Case Num</label>
			<input type="text" id="case_num" name="case_num" data-typ="Text">
			
			<label forx="1" for="charge_num">Charge Num</label>
			<input type="text" id="charge_num" name="charge_num" data-typ="Text">
			
			<label forx="1" for="level">Level Num</label>
			<input type="text" id="level" name="level" data-typ="Text">
			
			<label forx="1" for="restitution_only">Restitution Only</label>
			<input type="text" id="restitution_only" name="restitution_only" data-typ="Checkbox">
			
			<label forx="1" for="current_serving">Current Serving</label>
			<input type="text" id="current_serving" name="current_serving" data-typ="Checkbox">
			
			<label forx="1" for="complete">Complete</label>
			<input type="text" id="complete" name="complete" data-typ="Checkbox">
			
			<label forx="1" for="include">Include</label>
			<input type="text" id="include" name="include" data-typ="Checkbox">
			
		</form>
	</div>
	
	<style>
	#security-table{
	display: none; /* initially hidden */
	}

		label{
		font-weight: 500;
		}
		.checkboxBlock .custom-checkbox{
		width: 70px;
		
		}
			.selected > .tabulator-cell {
			   background:  #9b7cca !important; 
     color: #000 !important; 
}
		
		.hovered-row {
   background-color: #c9d3ff!important;
  cursor: pointer;
}
.clicked-row{
 background:   #9abcea !important; 
  cursor: pointer;
}

		/* .tabulator-selected > .tabulator-cell {
        	background-color: #7a59ad!important;
        	    width: 10px;
         } */
		.levelStatusCheckbox .custom-checkbox{
		width: 95px;
		
		}
		.dataTables_info{
		position: absolute;
		}
		#PrintStatusSheetCase_wrapper .row:first-child{
		margin-bottom: 0!important;
		}
		.dataTable tbody td, .table td {
		line-height:1;
		}
		
		.panelContentBlock{
border: 1px solid #7a58ac;
border-radius: 5px!important;
}

.no-pointer-events {
    pointer-events: none;
    opacity: 0.6; /* optional to make it look disabled */
}

#search-form #errorNAME {
    position: absolute;
    top: -25px;
    left: 14px;
    white-space: nowrap;
}
.custom-focus-highlight {
    outline: 2px solid #007bff;
    background-color: #e0f0ff;
}
 #stgpopup{
 position:relative;
 z-index:9999
 } 
	.selected-gang {
    background:  #9abcea !important; 
     color: #000 !important; 
}

.selectedRows{
background: #9abcea !important; 
     color: #000 !important; 
}
	.tabulator .tabulator-cell.cell-focused {
    outline: 2px solid #007bff;        /* Blue outline */
    background-color: #e6f2ff !important; /* Light blue background */
}

.tabulator-cell input[type="checkbox"] {
    display: block;
    margin: auto;
}
	.mydisabled {
			background-color: #ddd;
			/* Light gray background for disabled rows */
			/*color: #a0a0a0;*/
			/* Gray text color */
			pointer-events: none;
			/* Disable pointer events */
		}
		
		tabulator.tabulator-block-select, .tabulator.tabulator-ranges .tabulator-cell:not(.tabulator-editing){
	           display: inline-flex;
          /*  justify-content: center; */
           }

           .tabulator-row .tabulator-cell.tabulator-editing {
             display: inline-flex;
         /*      justify-content: center; */
              
            }

           .leader-editor-checkbox::before{
               content: '';
               display: inline-block;
                width: 14px;
                   height: 14px;
                border: 2px solid #0075ff;
            }

	</style>
	
	<div th:replace="~{fragments/script :: script}"></div>
	<script src="js/script.js"></script> 
	<script  th:inline="javascript">
		/*<![CDATA[*/
		var contextPath = /*[[@{/}]]*/'';
		/*]]>*/
		
	  var  gangOptionsArray = {};
	  let suppressLoader = false;
	  const statusOptions = {
			    "ACTIVE": "ACTIVE",
			    "INACTIVE": "INACTIVE",
			    "ASSOCIATE": "ASSOCIATE"
			};

	 $(document).ready(function () {
		  updatedData = [];
		     while (updatedData.length < 10) {
		        updatedData.push({
		            id: updatedData.length + 1,
		            checkbox: '',
		            rowremove: '',
		            stggangname: '',
		            nickname: '',
		            stggangcode: '',
		            checkbox1: '',
		            stgStatus: '',
		            selfReported: '',
		            disabled: true,
                    editor:false,
                   rowClass: 'no-pointer-events' 
		        });
		    }

		    table123.setData(updatedData);
		 $('#sbiNumberInput').focus();
		 
		 
		 $.ajax({
			    url: contextPath + 'gangDetails',
			    type: 'GET',
			    success: function (response) {
			        gangOptionsArray = {};

			        const formattedData = response.map(item => ({
			            gangCode: item[0],
			            gangName: item[1],
			            status: item[2]
			        }));

			        // Sort alphabetically by gangName
			        formattedData.sort((a, b) => a.gangName.localeCompare(b.gangName));

			        // Optional: build mapping
			        formattedData.forEach(item => {
			            gangOptionsArray[item.gangCode] = item.gangName;
			        });

			        // Set table with sorted data
			        table1.setData(formattedData);
			    }
			});

		
		 
		 if (window.tablehistory) {			
		        tablehistory.on("rowClick", function (e, row) {			          
		        	 fetchGangDataByCommitNo();
		        });
		 }
    
		 
	
		 
		 
		 $('#searchButton').on('click', function () {
			    let sbiNumberInput = $('#sbiNumberInput').val();
			    if (!suppressLoader) {
			        loader(1);  // start loader only if not suppressed
			    }
			    if(sbiNumberInput==null){
			    	message('W01', 0);
					
			    }
			    var screenName = document.getElementById('screenNameHolder').textContent;
			    var screenCode = document.getElementById('screenNameHolder').dataset.name;  
			    insertSBISearch(screenCode, screenName, sbiNumberInput); 
			   /*  loader(1); */
			 
			    $.ajax({
			        url: contextPath + 'callSpStgQuery',
			        type: 'GET',
			        data: { sbiNo: sbiNumberInput },
			        success: function (response) {
			            enableMouseEnter = true;

			            if (response.mapResult.length === 0) {
			                message('CUW','No record found',0);
			                let updatedData = [];
			                while (updatedData.length == 0) {  
			                    updatedData.push({
			                        id: updatedData.length + 1,
			                        checkbox: '',
			                        rowremove: '',
			                        stggangname: '',
			                        nickname: '',
			                        stggangcode: '',
			                        checkbox1: '',
			                        stgStatus: '',
			                        selfReported: '',
			                        disabled: true,
				                    editor:false,
				                   rowClass: 'no-pointer-events' 
			                    });
			                }

			                table1.setData(updatedData); 
			                $('#security-table').css('display', 'block');  
			                $('#security-table1').css('display', 'none'); 
			               
			            }

			            if (response.inmateData && response.inmateData.length > 0) {
			                const flag = response.inmateData[0].selfRepStaffAssaultFlag;
			                const assaultCheckbox = document.getElementById("assaultcheckbox");
			                if (assaultCheckbox) {
			                    assaultCheckbox.checked = (flag === "Y");
			                }
			                sessionStorage.setItem("inmateRowId", response.inmateData[0].inmateRowId);
			            }
			            let updatedData = [];

			            if (response.mapResult && response.mapResult.length > 0) {
			                updatedData = response.mapResult.map((item, index) => ({
			                    id: index + 2,
			                    checkbox: false,
			                    rowremove: item.iga_rowid || "",
			                    stggangname: item.gang_name || "",
			                    nickname: item.gang_position || "",
			                    stggangcode: item.gang_code || "",
			                    checkbox1: item.gang_leader === "Y",
			                    stgStatus:
			                        item.gang_ai_ind === "A" ? "ACTIVE" :
			                        item.gang_ai_ind === "I" ? "INACTIVE" :
			                        item.gang_ai_ind === "S" ? "ASSOCIATE" : "",
			                    selfReported:
			                        item.stg_sef_repd_status === "A" ? "ACTIVE" :
			                        item.stg_sef_repd_status === "I" ? "INACTIVE" :
			                        item.stg_sef_repd_status === "S" ? "ASSOCIATE" : "",
			                    gangComments: item.gang_comments || "",
			                }));
			            }
			            while (updatedData.length < 10) {
			                updatedData.push({
			                    id: updatedData.length + 2,
			                    checkbox: '',
			                    rowremove: '',
			                    stggangname: '',
			                    nickname: '',
			                    stggangcode: '',
			                    checkbox1: '',
			                    stgStatus: '',
			                    selfReported: '',
			                    gangComments: '',
			                    disabled: true,
			                    editor:false,
			                   rowClass: 'no-pointer-events' 
			                });
			            }
			           
			            const selectedRows = JSON.parse(localStorage.getItem("selectedRows") || "[]");
			            const rowsToRemove = JSON.parse(localStorage.getItem("rowsToRemove") || "[]");
			            const updatedRows = JSON.parse(localStorage.getItem("updatedRows") || "[]");
			            const commentUpdatedRows = JSON.parse(localStorage.getItem("commentUpdatedRows") || "[]");

			            const allUpdatedIds = [
			                ...selectedRows.map(r => r.id),
			                ...rowsToRemove.map(r => r.id),
			                ...updatedRows.map(r => r.id),
			                ...commentUpdatedRows.map(r => r.id)
			            ];

			            const uniqueRowIds = [...new Set(allUpdatedIds)];
			            $('#security-table').css('display', 'block');

			            table1.setData(updatedData).then(() => {
			                // Get all rows after data is loaded
			                const allRows = table1.getRows();

			                if (allRows.length > 0) {
			                    const firstRow = allRows[0]; // first row
			                    
			                    // Add the class to highlight it
			                    firstRow.getElement().classList.add('clicked-row');

			                    // Get the cell in the first row for the "id" field (or any field you want)
			                    const cell = firstRow.getCell("id");

			                    if (cell) {
			                        Activerow1(cell);  // call your function here with the first row's cell
			                    } 
			                }

			               
			                // clear localStorage after applying classes
			                localStorage.removeItem("selectedRows");
			                localStorage.removeItem("rowsToRemove");
			                localStorage.removeItem("updatedRows");
			                localStorage.removeItem("commentUpdatedRows");
			            });
			            table1.redraw(true);
		                $('#security-table1').css('display', 'none');
		                
			        },
			        complete: function (response){
	   		        	setTimeout(function (){
	   		        		loader(0);
	   		        	},1500)

	   		        },
			        error: function (xhr, status, error) {
			            console.error('Error fetching SBI details:', error);
			            console.error('Status:', status);
			            console.error('Response:', xhr.responseText);
			            loader(0);
			        }
			    });
			});
	 });
	 
		/* function Activerow1(cell){
			 let rowData = cell.getRow().getData();
			 localStorage.setItem('activeRowData', JSON.stringify(rowData));			
		}
		 */
		 function Activerow1(cell) {
			    let rowData = cell.getRow().getData();
			    localStorage.setItem('activeRowData', JSON.stringify(rowData));

			    // Optional: remove existing highlight
			    $('.StgTableVal').removeClass('clicked-row').removeClass('hovered-row');

			    // Add class to the matching row (based on data-id)
			    if (rowData.id) {
			        const $target = $(`.StgTableVal[data-id="${rowData.id}"]`);
			         $target.addClass('clicked-row'); 

			        // Optional: update comment and char count
			        if (rowData.gangComments) {
			            $('#Comments').val(rowData.gangComments);
			            const maxLength = 2000;
			            $('#charCount').text(`${rowData.gangComments.length}/${maxLength} characters`);
			        }
			    }
			}
	 function fetchGangDataByCommitNo() {
		 
		 let sbiNumberInput = $('#sbiNumberInput').val();
		 if (!suppressLoader) {
		        loader(1);  // start loader only if not suppressed
		    }
	        var screenName = document.getElementById('screenNameHolder').textContent;
	        var screenCode = document.getElementById('screenNameHolder').dataset.name;  
	       insertSBISearch(screenCode,screenName,sbiNumberInput); 
		    var selectedCommit = localStorage.getItem('selectedCommitNo');			    
		  /*   loader(1); */
		  		
		    $.ajax({
		        url: contextPath + 'callSpStgQuerHistory',
		        type: 'GET',
		        data: { commitNo: selectedCommit }, // using commitNo here
		        success: function (response) {
		            enableMouseEnter = true;

		            if (response.mapResult.length === 0) {
		                message('CUW','No record found',0);
		                let updatedData = [];
		                while (updatedData.length == 0) {  
		                    updatedData.push({
		                        id: updatedData.length + 1,
		                        checkbox: '',
		                        rowremove: '',
		                        stggangname: '',
		                        nickname: '',
		                        stggangcode: '',
		                        checkbox1: '',
		                        stgStatus: '',
		                        selfReported: '',
		                        disabled: true,
			                    editor:false,
			                   rowClass: 'no-pointer-events' 
		                    });
		                }

		                table1.setData(updatedData); 
		                $('#security-table').css('display', 'block');  
		                $('#security-table1').css('display', 'none'); 
		               
		            }

		            if (response.inmateData && response.inmateData.length > 0) {
		                const flag = response.inmateData[0].selfRepStaffAssaultFlag;
		                const assaultCheckbox = document.getElementById("assaultcheckbox");
		                if (assaultCheckbox) {
		                    assaultCheckbox.checked = (flag === "Y");
		                }
		                sessionStorage.setItem("inmateRowId", response.inmateData[0].inmateRowId);
		            }
		            let updatedData = [];

		            if (response.mapResult && response.mapResult.length > 0) {
		                updatedData = response.mapResult.map((item, index) => ({
		                    id: index + 2,
		                    checkbox: false,
		                    rowremove: item.iga_rowid || "",
		                    stggangname: item.gang_name || "",
		                    nickname: item.gang_position || "",
		                    stggangcode: item.gang_code || "",
		                    checkbox1: item.gang_leader === "Y",
		                    stgStatus:
		                        item.gang_ai_ind === "A" ? "ACTIVE" :
		                        item.gang_ai_ind === "I" ? "INACTIVE" :
		                        item.gang_ai_ind === "S" ? "ASSOCIATE" : "",
		                    selfReported:
		                        item.stg_sef_repd_status === "A" ? "ACTIVE" :
		                        item.stg_sef_repd_status === "I" ? "INACTIVE" :
		                        item.stg_sef_repd_status === "S" ? "ASSOCIATE" : "",
		                    gangComments: item.gang_comments || "",
		                }));
		            }
		            while (updatedData.length < 10) {
		                updatedData.push({
		                    id: updatedData.length + 1,
		                    checkbox: '',
		                    rowremove: '',
		                    stggangname: '',
		                    nickname: '',
		                    stggangcode: '',
		                    checkbox1: '',
		                    stgStatus: '',
		                    selfReported: '',
		                    gangComments: '',
		                    disabled: true,
		                    editor:false,
		                   rowClass: 'no-pointer-events' 
		                });
		            }
		           
		            const selectedRows = JSON.parse(localStorage.getItem("selectedRows") || "[]");
		            const rowsToRemove = JSON.parse(localStorage.getItem("rowsToRemove") || "[]");
		            const updatedRows = JSON.parse(localStorage.getItem("updatedRows") || "[]");
		            const commentUpdatedRows = JSON.parse(localStorage.getItem("commentUpdatedRows") || "[]");

		            const allUpdatedIds = [
		                ...selectedRows.map(r => r.id),
		                ...rowsToRemove.map(r => r.id),
		                ...updatedRows.map(r => r.id),
		                ...commentUpdatedRows.map(r => r.id)
		            ];

		            const uniqueRowIds = [...new Set(allUpdatedIds)];
		            $('#security-table').css('display', 'block');

		            table1.setData(updatedData).then(() => {
		                // Get all rows after data is loaded
		                const allRows = table1.getRows();

		                if (allRows.length > 0) {
		                    const firstRow = allRows[0]; // first row
		                    
		                    // Add the class to highlight it
		                    firstRow.getElement().classList.add('clicked-row');

		                    // Get the cell in the first row for the "id" field (or any field you want)
		                    const cell = firstRow.getCell("id");

		                    if (cell) {
		                        Activerow1(cell);  // call your function here with the first row's cell
		                    } 
		                }

		               
		                // clear localStorage after applying classes
		                localStorage.removeItem("selectedRows");
		                localStorage.removeItem("rowsToRemove");
		                localStorage.removeItem("updatedRows");
		                localStorage.removeItem("commentUpdatedRows");
		            });
		            table1.redraw(true);
	                $('#security-table1').css('display', 'none');
	               
		        },
		        complete: function (response){
   		        	setTimeout(function (){
   		        		loader(0);
   		        	},1500)
   		        },
		        error: function (xhr, status, error) {
		            console.error('Error fetching SBI details:', error);
		            console.error('Status:', status);
		            console.error('Response:', xhr.responseText);
		            loader(0);
		        }
		    });
		}

	 
	 
	 
	 
	 
		
	 $('#clear-btn').on('click', function () {
		    $('#Comments').val('');
		    clearTextarea('Comments', 'charCount');  // ✅ Call the function here
		    updatedData = [];
		     while (updatedData.length < 10) {
		        updatedData.push({
		            id: updatedData.length + 1,
		            checkbox: '',
		            rowremove: '',
		            stggangname: '',
		            nickname: '',
		            stggangcode: '',
		            checkbox1: '',
		            stgStatus: '',
		            selfReported: '',
		            disabled: true // add this property
		        });
		    }
		     $('#security-table1').css('display', 'block');
		     table123.redraw(true);
             $('#security-table').css('display', 'none');
		    table1.setData(updatedData);
		    clearFormHeaderData();
		});

		// Move this function OUTSIDE the click handler
		function clearTextarea(textareaId, counterId, maxLength = 2000) {
		    const textarea = document.getElementById(textareaId);
		    const charCount = document.getElementById(counterId);
		    textarea.value = "";
		    charCount.textContent = `0/${maxLength} characters`;
		}

//----------------------------------------------------------------------------------------------------------------------------------------//			
			function AllowOnlyNumbers(e) {
				e = (e) ? e : window.event;
				
				var clipboardData = e.clipboardData ? e.clipboardData : window.clipboardData;
				var key = e.keyCode ? e.keyCode : e.which ? e.which : e.charCode;
				var str = (e.type && e.type == "paste") ? clipboardData.getData('Text') : String.fromCharCode(key);
				
				return (/^\d+$/.test(str));
			}
			
			$(document.body).on('keypress', '.num', function (e) {
				return AllowOnlyNumbers(e);
			});
			
			$(document.body).on('keypress keyup keydown focus', '.mail', function (e) {
				
				if ($(this).val() != '') {
					
					if (validateEmail($(this).val())) {
						$(this).removeClass('error_fld');
						} else {
						$(this).addClass('error_fld');
					}
					
					} else {
					$(this).removeClass('error_fld');
				}
				
				
			});
			
			function validateEmail(email) {
				var re = /\S+@\S+\.\S+/;
				return re.test(email);
			}
			
		
			
			function setOption(vals, field, label) {
				$.ajax({
					url: contextPath + 'getVals',
					method: 'POST',
					dataType: "json",
					data: {vals: vals},
					success: function (response) {
						var content = '<option value="">Select ' + label + '</option>';
						for (var i = 0; i < response.length; i++) {
							content += '<option value="' + response[i]['VAL'] + '">' + response[i]['VAL'] + '</option>';
						}
						$('.' + field).html(content);
					},
					error: function (error) {
						//console.error("Error getting table names:", error);
					}
				});
			}
			
			function applyRange(min, max, ddates, cls) {
				
				if (min == '') {
					min = null;
				}
				
				if (max == '') {
					max = null;
				}
				
				$("." + cls).datepicker({
					dateFormat: "mm/dd/yy",
					minDate: min,
					maxDate: max,
					beforeShowDay: function (date) {
						var string = jQuery.datepicker.formatDate('mm/dd/yy', date);
						return [ddates.indexOf(string) == -1];
					}
				});
				
			}
			
			function chkToday(str) {
				if (str == 'today') {
					const d = new Date();
					let year = d.getFullYear();
					let month = d.getMonth() + 1;
					let date = d.getDate();
					str = padDigits(month, 2) + "/" + padDigits(date, 2) + "/" + padDigits(year, 4);
				}
				
				console.log('str check ' + str);
				
				return str;
			}
			
			function padDigits(number, digits) {
				return Array(Math.max(digits - String(number).length + 1, 0)).join(0) + number;
			}
			
			function differDay(dt, diff) {
				var day = new Date(dt);
				
				var nd = new Date(day);
				if (diff == 'N') {
					nd.setDate(day.getDate() + 1);
					} else {
					nd.setDate(day.getDate() - 1);
				}
				
				let year = nd.getFullYear();
				let month = nd.getMonth() + 1;
				let date = nd.getDate();
				var str = padDigits(month, 2) + "/" + padDigits(date, 2) + "/" + padDigits(year, 4);
				return str;
			}
			
			$(document).on('blur', '.hasDatepicker', function () {
				var fld = $(this).attr('data-field');
				if ($(this).val() != '') {
					var mydate = $(this).val();
					if (!valDate(mydate)) {
						$(this).val('');
						//alert("Invalid Date");
						Swal.fire('Alert', 'Invalid Date Given', 'warning');
						} else {
						var newdt = padDigits(mydate.split("/")[0], 2) + "/" + padDigits(mydate.split("/")[1], 2) + "/" + mydate.split("/")[2];
						if (checkAvailable(newdt, fld)) {
							$(this).val(newdt);
							} else {
							$(this).val('');
							//alert("Disabled Date Not Allowed");
							Swal.fire('Alert', 'Disabled Date Not Allowed', 'warning');
						}
						
					}
				}
			});
			
			function checkAvailable(dt, fld) {
				var valid_dt = $('#' + fld).attr('data-valid');
				var mindt = valid_dt.split('::')[0];
				var maxdt = valid_dt.split('::')[1];
				var ddates = valid_dt.split('::')[2].split(',');
				
				if (mindt != '') {
					var d1 = new Date(dt.split('/')[2], dt.split('/')[0] - 1, dt.split('/')[1]);
					var d2 = new Date(mindt.split('/')[2], mindt.split('/')[0] - 1, mindt.split('/')[1]);
					
					if (d1 < d2) {
						return false;
					}
					
				}
				
				if (maxdt != '') {
					var d1 = new Date(dt.split('/')[2], dt.split('/')[0] - 1, dt.split('/')[1]);
					var d2 = new Date(maxdt.split('/')[2], maxdt.split('/')[0] - 1, maxdt.split('/')[1]);
					
					if (d1 > d2) {
						return false;
					}
					
				}
				
				for (var i = 0; i < ddates.length; i++) {
					if (dt == ddates[i]) {
						return false;
					}
				}
				
				return true;
				
			}
			
			function valDate(mydate) {
				var valid = true;
				if (mydate.indexOf("/") == -1) {
					valid = false;
				}
				if (mydate.split('/').length != 3) {
					valid = false;
				}
				var mn = parseInt(mydate.split('/')[0]);
				var dt = parseInt(mydate.split('/')[1]);
				var yr = parseInt(mydate.split('/')[2]);
				if (mn > 12 || mn < 1) {
					valid = false;
				}
				if (mn == 1 || mn == 3 || mn == 5 || mn == 7 || mn == 8 || mn == 10 || mn == 12) {
					if (dt > 31 || dt < 1) {
						valid = false;
					}
				}
				if (mn == 4 || mn == 6 || mn == 9 || mn == 11) {
					if (dt > 30 || dt < 1) {
						valid = false;
					}
				}
				if (mn == 2) {
					if (yr % 4 == 0) {
						if (dt > 29 || dt < 1) {
							valid = false;
						}
						} else {
						if (dt > 28 || dt < 1) {
							valid = false;
						}
					}
				}
				if (yr > 2100 || yr < 2000) {
					valid = false;
				}
				return valid;
			}
			
			
			
			
			
			$(function () {
				$('.select2').select2();
				
				$(".select2-placeholder-multiple").select2(
				{
					placeholder: "Select State"
				});
				$(".js-hide-search").select2(
				{
					minimumResultsForSearch: 1 / 0
				});
				$(".js-max-length").select2(
				{
					maximumSelectionLength: 2,
					placeholder: "Select maximum 2 items"
				});
				$(".select2-placeholder").select2(
				{
					placeholder: "Select a state",
					allowClear: true
				});
				
				
				
				$(".js-select2-icons").select2(
				{
					minimumResultsForSearch: 1 / 0,
					templateResult: icon,
					templateSelection: icon,
					escapeMarkup: function (elm) {
						return elm
					}
				});
				
				function icon(elm) {
					elm.element;
					return elm.id ? "<i class='" + $(elm.element).data("icon") + " mr-2'></i>" + elm.text : elm.text
				}
				
				$(".js-data-example-ajax").select2(
				{
					ajax:
					{
						url: "https://api.github.com/search/repositories",
						dataType: 'json',
						delay: 250,
						data: function (params) {
							return {
								q: params.term, // search term
								page: params.page
							};
						},
						processResults: function (data, params) {
							// parse the results into the format expected by Select2
							// since we are using custom formatting functions we do not need to
							// alter the remote JSON data, except to indicate that infinite
							// scrolling can be used
							params.page = params.page || 1;
							
							return {
								results: data.items,
								pagination:
								{
									more: (params.page * 30) < data.total_count
								}
							};
						},
						cache: true
					},
					placeholder: 'Search for a repository',
					escapeMarkup: function (markup) {
						return markup;
					}, // let our custom formatter work
					minimumInputLength: 1,
					templateResult: formatRepo,
					templateSelection: formatRepoSelection
				});
				
				function formatRepo(repo) {
					if (repo.loading) {
						return repo.text;
					}
					
					var markup = "<div class='select2-result-repository clearfix d-flex'>" +
					"<div class='select2-result-repository__avatar mr-2'><img src='" + repo.owner.avatar_url + "' class='width-2 height-2 mt-1 rounded' /></div>" +
					"<div class='select2-result-repository__meta'>" +
					"<div class='select2-result-repository__title fs-lg fw-500'>" + repo.full_name + "</div>";
					
					if (repo.description) {
						markup += "<div class='select2-result-repository__description fs-xs opacity-80 mb-1'>" + repo.description + "</div>";
					}
					
					markup += "<div class='select2-result-repository__statistics d-flex fs-sm'>" +
					"<div class='select2-result-repository__forks mr-2'><i class='fal fa-lightbulb'></i> " + repo.forks_count + " Forks</div>" +
					"<div class='select2-result-repository__stargazers mr-2'><i class='fal fa-star'></i> " + repo.stargazers_count + " Stars</div>" +
					"<div class='select2-result-repository__watchers mr-2'><i class='fal fa-eye'></i> " + repo.watchers_count + " Watchers</div>" +
					"</div>" +
					"</div></div>";
					
					return markup;
				}
				
				function formatRepoSelection(repo) {
					return repo.full_name || repo.text;
				}
				
			});
		
		

		// function for checkbox editor
		/* var checkboxEditor = function(cell, onRendered, success, cancel) {
			var input = document.createElement("input");
			input.type = "checkbox";
			input.checked = !!cell.getValue(); 
			input.classList.add("leader-editor-checkbox");
			input.addEventListener("change", function () {
			success(input.checked);
			});
			input.addEventListener("keydown", function (e) {
			if (e.key === "Enter") {
			input.checked = !input.checked;
			success(input.checked);
			} else if (e.key === "Escape") {
			cancel();
			}
			});
			onRendered(function () {
			setTimeout(() => input.focus(), 20); 
			});
			return input;
			};

			// function for formatting checkbox 
			function checkboxFormatter(cell, formatterParams, onRendered) {
			const value = !!cell.getValue();
			const checkbox = document.createElement("input");
			checkbox.type = "checkbox";
			checkbox.checked = value;		
			return checkbox;
			} */
			
			var checkboxEditor = function(cell, onRendered, success, cancel) {
		    var input = document.createElement("input");
			    input.type = "checkbox";
			    input.checked = !!cell.getValue();
			    input.classList.add("leader-editor-checkbox");
			    input.addEventListener("change", function () {
			      success(input.checked);
			    });
				 input.addEventListener("keydown", function (e) {
			      if (e.key === "Enter") {
			        e.preventDefault();
			        input.checked = !input.checked;
			        success(input.checked);
			      } else if (e.key === "Escape") {
			        cancel();
			      }
			    });
			    onRendered(function () {
			      input.focus({ preventScroll: true });
			    });	 
			    return input;
			  };
        
			  
			  function checkboxFormatter(cell) {
				 	const checked = !!cell.getValue();
			    return `<input  type="checkbox" ${checked ? "checked" : ""} />`; 
			  }
			 
	// global variables	
		let activeRowId = null;  
		var tabledatasecurity = [

		];
		let selectedRows = [];
		let editedRows = [];
		var selectedrow=[];
		let previouslySelectedRow = null;
		let focusMovedToComments = false;
		let enableMouseEnter = true;	
		
		let updatedData = tabledatasecurity || [];
		let nicknameMaxLengthReached = false;
		
		
		var table1 = new Tabulator("#security-table", {
		    layout: "fitColumns",
		    data: tabledatasecurity,
		    index: "id",	
		    cellNavigation:true, 
		    selectableRange:true, 
		    clipboard: false,
		    tabNavigation: true,
		    printAsHtml: true,
		    printStyled: true,		
		     clipboard:true,
		    clipboardCopyStyled:false,
		    columnDefaults:{		      
		        editor:"input",
		        resizable: false,
		      /*   headerHozAlign: "center", */
		    },		
	    columns: [
	    	{
				title: "id",
				field: "id",
				visible: false,
			},
			{
				title: 'upd',
				visible: false,
       			field: "upd",
			},
			{
				title: 'rowid',
				visible: false,
				field: "rowid",
			},
		    	{
		    	    title: "Remove", 
		    	    titleFormatter: (column) => setTitleDesc(column, 'Re_move', 'Remove'),
		    	    headerSort: false,
		    	    field: "checkbox", 
		    	    hozAlign: "center",
		    	    headersorter: false,
		    		  formatter: checkboxFormatter, 
		              editor: checkboxEditor, 
		              editTriggerEvent:"click", 
		        	  width:95,		        	  
		        	  cellEdited: function (cell) {
		        		    let rowData = cell.getRow().getData();
		        		    if (cell.getValue() === true) {
		        		        rowData.isRemove = true;
		        		        removeRowsMap[rowData.id] = rowData;
		        		        console.log("Marked for removal:", rowData.id);
		        		    } else {
		        		        rowData.isRemove = false;
		        		        delete removeRowsMap[rowData.id];
		        		        console.log("Unmarked for removal:", rowData.id);
		        		    }
		        		},		    	   
		    	},
		    	 { title: "rowremove",
		        	field: "rowremove", 
		        	visible: false 
		        	}, 
		        	{
		        		 title: "STG/Gang Name", 
		        		 titleFormatter: (column) => setTitleDesc(column, 'Gang_Name', 'STG/Gang Name'),
		        		field: "stggangname",
		        		sorter: customSorter,
		        		cellMouseOver: function (e, cell) {
					          const data = cell.getRow().getData();
					          console.log("data",data);
					          if (data.stggangname) {
					              showCustomTooltip(e, cell, `${data.stggangname}`);
					            }
					        },
					        cellMouseMove: moveCustomTooltip,
					        cellMouseOut: hideCustomTooltip,
		        		editor: "list",
		        		editable: true,
		        		  width:300,
		        		editorParams: function(cell) {
		        			  const values = Object.values(gangOptionsArray || {}).sort((a, b) => a.localeCompare(b)); // <-- sort alphabetically
		        		return {
		        		autocomplete: true,
		        		listOnEmpty: true,
	        		allowEmpty: true,
	        		values: values,
		        		elementAttributes: {
		        		tabindex: 1
		        		}
		        		};
		        		},
		        		cellEdited: function (cell) {
		        		const inputValue = cell.getValue(); 
		        		const gangCode = Object.keys(gangOptionsArray).find(key => gangOptionsArray[key] === inputValue) || "";
		        		cell.getRow().update({ stggangcode: gangCode });
		        		localStorage.setItem("gangcode", gangCode);
		        	    const now = new Date();
		        	    const formattedDateTime = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
		        	    console.log(formattedDateTime);
		        	    cell.getRow().update({ gangSelectDateTime: formattedDateTime });
		        		markasupdated(cell);
		        		
		        		}
		        		},
		        		{
		        		    title: "Gang Select DateTime", 
		        		    field: "gangSelectDateTime",
		        		    visible: false  // <-- hides it from UI, but value still exists in row data
		        		},
		        		
		        { title: "",
		        	field: "stggangcode", 
		        	visible: false 
		        	} ,
		   
		        	{
		        	    title: "Nickname",
		        	    field: "nickname",
		        	    sorter: customSorter,
		        	    width: 300,
		        	    cellMouseOver: function (e, cell) {
					          const data = cell.getRow().getData();
					          console.log("data",data);
					          if (data.nickname) {
					              showCustomTooltip(e, cell, `${data.nickname}`);
					            }
					        },
					        cellMouseMove: moveCustomTooltip,
					        cellMouseOut: hideCustomTooltip,
		        	    editable: true,
		        	    cellClick: function (e, cell) {
		        	        cell.edit();
		        	    },
		        	    editor: function (cell, onRendered, success, cancel) {
		        	        var input = document.createElement("input");
		        	        input.setAttribute("type", "text");
		        	        input.setAttribute("maxlength", "20");
		        	        input.value = cell.getValue();

		        	        onRendered(function () {
		        	            input.focus();
		        	            input.select();
		        	        });

		        	        input.addEventListener("input", function () {
		        	            if (input.value.length === 20 && !nicknameMaxLengthReached) {
		        	                nicknameMaxLengthReached = true;
		        	                setTimeout(function () {
		        	              /*       alert("Maximum character limit reached. You cannot paste or type additional text"); */
		        	                    message('CUE', "Maximum character limit reached. You cannot paste or type additional text", 0);
		        	                    setTimeout(() => {
		        	                        if (activeElement && typeof activeElement.focus === 'function') {
		        	                            activeElement.focus();
		        	                        }
		        	                    }, 100);
		        	                }, 10);
		        	            }
		        	        });


		        	        input.addEventListener("blur", function () {
		        	            success(input.value);
		        	        });

		        	        input.addEventListener("keydown", function (e) {
		        	            if (e.key === "Enter") {
		        	                success(input.value);
		        	            } else if (e.key === "Escape") {
		        	                nicknameMaxLengthReached = false;
		        	                cancel();
		        	            }
		        	        });

		        	        return input;
		        	    }
		        	},



		        {
		        	   title: "Leader", 
		        	    titleFormatter: (column) => setTitleDesc(column, 'Le_ader', 'Leader'),
		        	  field: "checkbox1",
		        	  hozAlign: "center",
		        	  width:100,
		        	  headerSort: false,
		        	  formatter: checkboxFormatter,
		              editor: checkboxEditor,
		             
		        	  width:85,
		        	  cellClick: function (e, cell) {	        		
		        		    markasupdated(cell);
		        		   
		        		   
		        		  }
		        		},
		        		{
		        			 title: "STG Status", 
		        			titleFormatter: (column) => setTitleDesc(column, 'STG_Status', 'STG Status'),
		        			field: "stgStatus",
		        			editor: 'list',
		        			sorter: customSorter,
		        			editable: true,
		        		    cellMouseOver: function (e, cell) {
						          const data = cell.getRow().getData();
						         
						          if (data.stgStatus) {
						              showCustomTooltip(e, cell, `${data.stgStatus}`);
						            }
						        },
						        cellMouseMove: moveCustomTooltip,
						        cellMouseOut: hideCustomTooltip,
		        			editorParams: function(cell) {
		        			let values = Object.values(statusOptions || {});
		        			return {
		        			autocomplete: true,
		        			listOnEmpty: true,
		        			allowEmpty: true,
		        			values: values,
		        			elementAttributes: {
		        			tabindex: 1
		        			}
		        			};
		        			},
		        			cellEdited: function (cell) {
		        			markasupdated(cell);
		        			
		        			}
		        			},
		        			{

		        				title: "Self-Reported STG Status",
		        				titleFormatter: (column) => setTitleDesc(column, 'Self-Reported', 'Self-Reported STG Status'),
		        				field: "selfReported",
		        				sorter: customSorter,
		        				editor: 'list',
		        				editable: true,
		        				   cellMouseOver: function (e, cell) {
								          const data = cell.getRow().getData();
								         
								          if (data.selfReported) {
								              showCustomTooltip(e, cell, `${data.selfReported}`);
								            }
								        },
								        cellMouseMove: moveCustomTooltip,
								        cellMouseOut: hideCustomTooltip,
		        				editorParams: function(cell) {
		        				let values = Object.values(statusOptions || {});
		        				return {
		        				autocomplete: true,
		        				listOnEmpty: true,
		        				allowEmpty: true,
		        				values: values,
		        				elementAttributes: {
		        				tabindex: 1
		        				}
		        				};
		        				},
		        				cellEdited: function (cell) {
		        				markasupdated(cell);
		        				 
		        				}
		        				},
		         { title: "Gang Comments",
		        	field: "gangComments", 
		        	visible: false 
		        	} 
		    ],
		    selectable: 1,
		   
		  rowFormatter: function(row) {
		         var rowData = row.getData();		   
		        gangname = rowData.gangname || "";
		         gangcode = localStorage.getItem('gangcode') || "";
		         comments = rowData.gangComments||"";
		        var eventclass  = 'StgTableVal'; 
		        var rowElement = row.getElement();
		        rowElement.classList.add(eventclass);
		        rowElement.setAttribute('data-id', rowData.id);
		        rowElement.setAttribute('data-gangname-type', gangname);
		        rowElement.setAttribute('data-gangcode', gangcode);
		        rowElement.setAttribute('data-comments',  comments);		      
		        if (rowData.disabled) {
		            rowElement.classList.add('no-pointer-events');
		        }		        
		         rowElement.addEventListener('click', function (event) {
		            let rowData = row.getData();
		            activeRow = rowData;
		            localStorage.setItem('activeRowData', JSON.stringify(rowData));		       
		        }); 		         		         
		     },		     
		  });
	
		
		
/* 	// displaying the comments while hover
		$(document).on('mouseenter', '.StgTableVal', function (e) {
		    if (!enableMouseEnter) return;
		    var $div = $(this);
		    var comments = $div.attr('data-comments');
		    $('#Comments').val(comments);
		    $('.StgTableVal').removeClass('hovered-row'); 
		    $div.addClass('hovered-row');
		    const maxLength = 2000;
		    $('#charCount').text(`${comments.length}/${maxLength} characters`);
		}); */
		
		
  //making the row as active while click
		$(document).on('click', '.StgTableVal', function (e) {		
		    var $div = $(this);
		    var rowId = $div.attr('data-id');		
		    var comments = $div.attr('data-comments');		   
		    $('.StgTableVal').removeClass('clicked-row');
		    $('.StgTableVal').removeClass('hovered-row');
		    $div.addClass('clicked-row');		  
		    enableMouseEnter = false;
		    $('#Comments').val(comments);
		    const maxLength = 2000;
		    $('#charCount').text(`${comments.length}/${maxLength} characters`);
		    activeRowId = localStorage.getItem('activeRowData'); 
		});

     //changing the comments 
	 $('#Comments').on('change', function () {
		    const storedRow = JSON.parse(localStorage.getItem('activeRowData'));
		    if (!storedRow) return;
		    const newComment = $(this).val();
		    const rowId = storedRow.id;
		    const $row = $('.StgTableVal[data-id="' + rowId + '"]');
		    $row.attr('data-comments', newComment);
		    const actualRow = table1.getRow(rowId);
		    if (actualRow) {
		        let actualData = actualRow.getData();
		        actualData.gangComments = newComment;
		        actualData.isupdatedComments = true;
		        actualRow.update(actualData);
		    }
		    markasupdatedrowww(storedRow);
		    
		});

     
     //removing the comments if we are not hovering
		$(document).on('mouseleave', '.StgTableVal', function (e) {
		    $(this).removeClass('hovered-row');
		
		}); 

     
     
		function handleSecurityRowClick(row) {
			table1.getRows().forEach(r => {
			    r.getElement().classList.remove('hovered-row');
			    r.getElement().querySelectorAll('.hovered-row').forEach(el => {
			        el.classList.remove('hovered-row');
			    });
			});
			
		    table1.getRows().forEach(r => {
		    	 r.getElement().classList.remove('activeRowData', 'clicked-row', 'hovered-row');
		    });
		    const rowElement = row.getElement();
		    rowElement.classList.add('activeRowData', 'clicked-row');		    
		    window.lastClickedRow = row;

		    const rowData = row.getData();
		    localStorage.setItem('activeRowData', JSON.stringify(rowData));
		    $('#Comments').val(rowData.gangComments || '');
		   
		    $('#charCount').text(`${(rowData.gangComments || '').length}/2000 characters`);			  
		}


			
		let editedRowsMap = {};		
		let updatedrows={};		
		function markasupdated(cell) {		
		    let rowData = cell.getRow().getData();
		    rowData.isupdated = true;
		    let comment = $('#Comments').val(); // or: document.getElementById("Comments").value;
		    rowData.gangComments = comment;

		    updatedrows[rowData.id] = rowData;			  
		     localStorage.setItem('activeRowData', JSON.stringify(rowData));
		     enableMouseEnter = false;	  
		}
		
		
		
		if (window.table1) {
		    table1.on("cellEdited", function(cell) {
		        const columnTitle = cell.getColumn().getDefinition().title;

		        if (columnTitle !== "Remove") {
		            markasupdated(cell);
		        }
		    });
		}
		
		let removeRowsMap={};
		function rowremove(cell) {
		    let rowData = cell.getRow().getData();
		    rowData.isRemove = true;
		    console.log("rowData rowremove"+rowData);
		    removeRowsMap[rowData.id] = rowData;
		}
		
		function markasupdatedrowww(rowData) {
		    if (!rowData || !rowData.id) return;
		    updatedrows[rowData.id] = rowData;		
		    enableMouseEnter = false;
		}

	
		document.addEventListener('DOMContentLoaded', function () {
			 console.log("✅ DOM loaded");
		    initializeCharCountLimiter('Comments', 'charCount');		
		});

		
	
		
		
 		function initializeCharCountLimiter(textareaId, counterId, maxLength = 2000) {
		    const textarea = document.getElementById(textareaId);
		    const charCount = document.getElementById(counterId);
		    let previousLength = 0;
		    console.log("Char limiter initialized"); // ✅ Confirmation
		    function updateCharCount() {
		        const currentLength = textarea.value.length;
		        if (currentLength > maxLength) {
		            textarea.value = textarea.value.substring(0, maxLength);
		            window.charLimitReached = true;			    
		            $('#myModal').one('hidden.bs.modal', function () {
		            	  const comments = document.getElementById('Comments');
		            	  if (comments) {
		            	    comments.focus();
		            	  }
		            	});
		                message('CUE', "Maximum character limit reached. You cannot paste or type additional text", 0);
		              
		        
		        } else {
		            window.charLimitReached = false; // Reset flag if user deletes characters
		        }
		        charCount.textContent = `${textarea.value.length}/${maxLength} characters`;
		     
		    }
		    textarea.addEventListener('input', updateCharCount);
		    textarea.addEventListener('paste', function (e) {
		        const pastedText = e.clipboardData.getData('text');
		        if (pastedText.length + textarea.value.length > maxLength) {
		            e.preventDefault();
		            window.charLimitReached = true;	
		            $('#myModal').one('hidden.bs.modal', function () {
		            	  const comments = document.getElementById('Comments');
		            	  if (comments) {
		            	    comments.focus();
		            	  }
		            	});
		            
		            message('CUE', "Maximum character limit reached. You cannot paste or type additional text", 0);
		               
		          
		        
		        } else {
		            window.charLimitReached = false;
		        }
		    });
		    updateCharCount();
		} 



		
		let prevCell = null;
	     $(document).on('keydown', function(e) {
	         if (['ArrowDown', 'ArrowUp', 'ArrowRight', 'ArrowLeft'].includes(e.key)) {

	             if (window.table1) {
	                 const ranges = window.table1.getRanges();
                 if (ranges.length > 0) {
	                     const range = ranges[0];
	                     const structuredCells = range.getStructuredCells();
	                     if (structuredCells.length > 0 && structuredCells[0].length > 0) {
	                         const firstCell = structuredCells[0][0];
	                         const row = firstCell.getRow();
	                         handleSecurityRowClick(row); 
	                     }
	                 }

	             } 
	            else {
	                 console.warn("Arrow key handler: offenderTable not yet available in window scope.");
	             }
	         }
	        
	         else if (e.key === 'Tab' && document.activeElement.id === "Comments") {	        	   
	             e.preventDefault();        
	             const allRows =table1.getRows();
	             const currentRow = window.lastClickedRow;
	             if (!currentRow) return;
	             
	             const commentVal = $('#Comments').val();
	           
	             if (commentVal !== undefined) {
	                 const rowData = currentRow.getData();
	                 rowData.gangComments = commentVal;
	                 currentRow.update(rowData); 
	             }
	             
	             
	             const currentIndex = allRows.findIndex(r => r === currentRow);
	             if (currentIndex !== -1 && currentIndex < allRows.length - 1) {
                 const nextRow = allRows[currentIndex + 1];
                 handleSecurityRowClick(nextRow);            
	                focusCell(table1, nextRow.getData().id, "checkbox"); 	       
	             } else {
	                 console.log("Reached the last row or no next row found.");
	             }
	             return;
	         }
	         
	         else if (e.key === 'Tab') {
	             console.log("--- Tab key pressed (Global Handler) ---");		        
	             const ranges = table1.getRanges();
	             let matched = false;
	             if (ranges.length > 0) {
	                 const range = ranges[0];
	                 const structuredCells = range.getStructuredCells();
	                 for (let rowCells of structuredCells) {
	                     for (let cell of rowCells) {
	                         const columnTitle = cell.getColumn().getDefinition().title;
	                         // ✅ If Nickname was full and alert shown, jump to checkbox1
	                          if (columnTitle === "Nickname" && nicknameMaxLengthReached) {
	                             const row = cell.getRow();
	                           
	                             handleSecurityRowClick(row); 
	                             dynamicFocus("cell", table1, row.getIndex(), "checkbox1");
	                                
	                                 nicknameMaxLengthReached = false;
	                                 matched = true;
	                                 e.preventDefault();
	                                 return;
	                             
	                         } 
	                         if (columnTitle === prevCell) {
	                        	
                             const row = cell.getRow();
	                             const rowData = row.getData();
	                             handleSecurityRowClick(row); 
	                             /*  $('#Comments').val(row.gangComments|| '');  */
	                             document.getElementById("Comments").focus();
	                             prevCell = null;
	                             e.preventDefault();
	                             matched = true;
	                             return;
	                         }
	                         prevCell = columnTitle;
	                     }
	                 }
	             }
	         }
	     });
  
		 let assaultCheckboxChanged = false;
			document.getElementById("assaultcheckbox").addEventListener("change", () => {
			    const checkbox = document.getElementById("assaultcheckbox");
			    const assaultFlag = checkbox.checked ? "Y" : "N";

			    // Set the flag to true if user changed the checkbox
			    assaultCheckboxChanged = true;

			    // Optional: store value if needed later
			    sessionStorage.setItem("assaultFlag", assaultFlag);
			});
	     
	     function dynamicFocus(target, table = table1, rowId = null, columnField = "checkbox") {
	    	    if (target === "comments") {
	    	        alert("focuss");
	    	        const commentsField = document.getElementById('Comments');
	    	        alert("commentsField");
	    	        if (commentsField) {
	    	            commentsField.focus();
	    	            alert("focuss");
	    	        }
	    	    } else if (target === "cell") {
	    	        let row = rowId ? table.getRow(rowId) : table.getRows().find(r => !r.getData().disabled);
	    	        if (!row) return;

	    	        table.getRows().forEach(r => r.getElement().classList.remove('clicked-row'));
	    	        row.getElement().classList.add('clicked-row');

	    	        const cell = row.getCell(columnField);
	    	        if (cell) {
	    	          
	    	            cell.edit();
	    	            setTimeout(() => {
	    	                const input = cell.getElement().querySelector('input, select, textarea');
	    	                if (input) input.focus();
	    	            }, 50);
	    	        } else {
	    	            console.warn("Cell not found:", columnField);
	    	        }
	    	    } else if (target instanceof HTMLElement) {	    	    
	    	        target.focus();
	    	    }
	    	}


	   
	     function focusCell(table, rowId, columnField) {
	    	    const row = table.getRow(rowId);
	    	    if (!row) return;
	    	    table.getRows().forEach(r => {
	    	        r.getElement().classList.remove('clicked-row');
	    	    });
	    	    const rowEl = row.getElement();
	    	    rowEl.classList.add('clicked-row');
	    	    const cell = row.getCell(columnField);
	    	    if (cell) {
	    	        cell.edit();
	    	    } else {
	    	        console.warn("Cell not found:", columnField);
	    	    }
	    	}

	     let isSaving = false;
	     var rowsToRemove = [];
	     document.getElementById('saveRowBtn').addEventListener('click', function (e) {
	    	    e.preventDefault(); 
	    	    if (!checkMandatory()) return;
	    	  
	    	    let allRows = table1.getData().filter(row => !row.disabled);
	    	    let selectedRows = allRows.filter(row => row.isEdited);
	    	    let rowsToRemove = allRows.filter(row => row.isRemove);
	    	    let updated = allRows.filter(row => row.isupdated);
	    	    let commentUpdatedRows = allRows.filter(row => row.isupdatedComments);
	    	 
	    	
	    	    let noChangesMade = 
	    	        selectedRows.length === 0 &&
	    	        rowsToRemove.length === 0 &&
	    	        updated.length === 0 &&
	    	        commentUpdatedRows.length === 0 &&
	    	        !assaultCheckboxChanged; // <-- also check if assault checkbox wasn't changed
	    	    if (noChangesMade) {
	    	        $('#myModal').one('hidden.bs.modal', function () {
	    	            setTimeout(() => {
	    	                dynamicFocus("cell", table1, null, "checkbox");
	    	            }, 100);
	    	        }).modal('hide');
	    	        message('CUE', 'No changes made', 0);
	    	        loader(0);
	    	        return;
	    	    }

	    	    const hasMissingGangName = selectedRows.some(row => !row.stggangname || row.stggangname.trim() === '');
	    	    if (hasMissingGangName) {
	    	        $('#myModal').one('hidden.bs.modal', function () {
	    	            setTimeout(() => {
	    	                dynamicFocus("cell", table1, null, "checkbox");
	    	            }, 100);
	    	        }).modal('hide');
	    	        loader(0);
	    	        message('CUE', 'Please enter Gangname', 0);
	    	        return;
	    	    }

	    	    loader(1);

	    	    let promises = [];
	    	    if (selectedRows.length > 0) promises.push(callStgSaveValueAPI(selectedRows));
	    	    if (rowsToRemove.length > 0) promises.push(saveSelectedRowsToAPI(rowsToRemove));
	    	    if (updated.length > 0) promises.push(saveModifiedData(updated));
	    	    if (commentUpdatedRows.length > 0) promises.push(saveModifiedData(commentUpdatedRows));
	    	 
	    	    // ✅ Add checkbox save if changed
	    	    if (assaultCheckboxChanged) {
	    	        promises.push(
	    	            saveAssaultCheckbox().then(() => {
	    	                assaultCheckboxChanged = false; // reset after save
	    	            })
	    	        );
	    	    }

	    	    Promise.all(promises)
	    	        .then(() => {
	    	            loader(0);
	    	            message('S', 0, 0);

	    	            $('#myModal').one('hidden.bs.modal', function () {
	    	                setTimeout(() => {
	    	                    dynamicFocus("cell", table1, null, "checkbox");
	    	                }, 100);
	    	            }).modal('hide');

	    	            suppressLoader = true;
	    	            $('#searchButton').click();
	    	            suppressLoader = false;

	    	            $('#Comments').val('');
	    	            localStorage.removeItem('activeRowData');
	    	            
	    	        })
	    	        .catch(err => {
	    	            console.error("Save Error:", err);
	    	            loader(0);
	    	            message('CUE', 'Error while saving the data to the database ', 1);
	    	        });
	    	});


		

		  
 function saveSelectedRowsToAPI(rowsToRemove) {
	    return new Promise((resolve, reject) => {
	        let sbiNo = $('#sbiNumberInput').val(); 
	        if (!sbiNo) return reject("SBI Number is required");
	        $.ajax({
	            url: contextPath + 'vitalcommitNo',
	            type: 'GET',
	            data: { parameter: sbiNo },
	            success: function (response) {
	                let commitNo = response || null;
	                let dataToSend = rowsToRemove.map(row => ({
	                    igaRowid: row.rowremove, 
	                    gangName: row.stggangname,
	                    gangPosition: row.nickname || null,
	                    gangLeader: row.checkbox1 ? 'Y' : 'N',
	                    gangAiInd: row.gang_ai_ind || null,
	                    stgSefRepdStatus: row.selfReported || null,
	                    gangComments: $("#Comments").val() || null,
	                    gangCode: row.stggangcode,
	                    commitNo,
	                    gangDelFlg: 'Y'
	                }));
	                $.ajax({
	                    url: contextPath + 'updatestg',
	                    type: 'POST',
	                    contentType: 'application/json',
	                    data: JSON.stringify({ sbiNo, data: dataToSend }),
	                    success: resolve,
	                    error: function (xhr) {
	                        reject("Error updating STG data: " + xhr.responseText);
	                    },
	                    complete: () => loader(0)
	                });
	            },
	            error: function () {
	                loader(0);
	                reject("Error fetching commit number");
	            }
	        });
	    });
	}

		

		
 function saveModifiedData(updated) {
	    return new Promise((resolve, reject) => {
	        let sbiNo = $('#sbiNumberInput').val(); 
	        if (!sbiNo) return reject("SBI Number is required");

	        let hasInvalidGangPosition = updated.some(row => {
	            let encoder = new TextEncoder();
	            let bytes = encoder.encode(row.nickname || '');
	            return bytes.length > 20;
	        });

	        if (hasInvalidGangPosition) {
	            message('CUE', 'Gang Position must not exceed 20 characters', 0);
	            return reject("Gang Position too long");
	        }
	     
	        $.ajax({
	            url: contextPath + 'vitalcommitNo',
	            type: 'GET',
	            data: { parameter: sbiNo },
	            success: function (response) {
	                let commitNo = response || null;
	                let dataToSend = updated.map(row => ({
	                    igaRowid: row.rowremove, 
	                    gangName: row.stggangname,
	                    gangPosition: row.nickname || null,
	                    gangLeader: row.checkbox1 ? 'Y' : 'N',
	                    gangAiInd: convertAiStatus(row.stgStatus),
	                    stgSefRepdStatus: convertAiStatus(row.selfReported),
	                    gangComments: row.gangComments || null,
	                    gangCode: row.stggangcode,
	                    commitNo,
	                    gangDelFlg: 'N'
	                }));

	                $.ajax({
	                    url: contextPath + 'updatestg',
	                    type: 'POST',
	                    contentType: 'application/json',
	                    data: JSON.stringify({ sbiNo, data: dataToSend }),
	                    success: resolve,
	                    error: function (xhr) {
	                        reject("Error updating STG data: " + xhr.responseText);
	                    },
	                    complete: () => loader(0)
	                });
	            },
	            error: function () {
	                loader(0);
	                reject("Error fetching commit number");
	            }
	        });
	    });
	}

		
		function convertAiStatus(status) {
		    switch (status) {
		        case "ACTIVE": return "A";
		        case "INACTIVE": return "I";
		        case "ASSOCIATE": return "S";
		        default: return null;
		    }
		}
		
		function saveAssaultCheckbox() {
		    return new Promise((resolve, reject) => {
		        const inmateRowId = sessionStorage.getItem("inmateRowId"); // ⬅️ Retrieve from sessionStorage
		        const assaultFlag = document.getElementById("assaultcheckbox").checked ? "Y" : "N";
		        const sbiNo = $('#sbiNumberInput').val();

		        if (!sbiNo || !inmateRowId) {
		            console.warn("Missing SBI Number or Inmate Row ID");
		            return resolve();
		        }

		        // Step 1: Get commitNo
		        $.ajax({
		            url: contextPath + 'vitalcommitNo',
		            type: 'GET',
		            data: { parameter: sbiNo },
		            success: function (response) {
		                const commitNo = response || null;

		                if (!commitNo) {
		                    console.warn("❌ Commit number not found.");
		                    return resolve();
		                }

		                // Step 2: Post to save
		                $.ajax({
		                    url: contextPath + 'updateassaultscheckbox',
		                    method: 'POST',
		                    contentType: 'application/json',
		                    data: JSON.stringify([
		                        {
		                            commitNo: commitNo,
		                            inmateRowId: inmateRowId,
		                            selfRepStaffAssaultFlag: assaultFlag
		                        }
		                    ]),
		                    success: function (response) {
		                        console.log(`✅ Assault flag saved for inmateRowId ${inmateRowId}:`, assaultFlag);
		                        resolve(response);
		                    },
		                    error: function (xhr, status, error) {
		                        console.error("❌ Failed to save assault flag", error);
		                        reject(error);
		                    }
		                });
		            },
		            error: function (xhr, status, error) {
		                console.error("❌ Failed to fetch commit number", error);
		                reject(error);
		            }
		        });
		    });
		}



    // function for add a new inserting rows//	
    
function callStgSaveValueAPI(selectedRows) {
    return new Promise((resolve, reject) => {
        let sbiNo = $('#sbiNumberInput').val();		
        if (!sbiNo) return reject("SBI Number is required");

        let hasInvalidGangPosition = selectedRows.some(row => {
            let encoder = new TextEncoder();
            let bytes = encoder.encode(row.nickname || '');
            return bytes.length > 20;
        });

        if (hasInvalidGangPosition) {
            message('CUE', 'Gang Position must not exceed 20 characters', 0);
            return reject("Gang Position too long");
        }

        $.ajax({
            url: contextPath + 'vitalcommitNo',
            type: 'GET',
            data: { parameter: sbiNo },
            success: function (response) {
                let commitNo = response || null;
                let requests = selectedRows.map(row => {
                    return $.ajax({
                        url: contextPath + 'stgvaluesave',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            sbiNo,
                            gangSelectDateTime: row.gangSelectDateTime, 
                            data: [{
                                gangName: row.stggangname,
                                gangPosition: row.nickname || null,
                                gangLeader: row.checkbox1 ? 'Y' : 'N',
                                gangAiInd: convertAiStatus(row.stgStatus),
                                stgSefRepdStatus: convertAiStatus(row.selfReported),
                                gangComments: row.gangComments || null,
                                gangCode: row.stggangcode,                              
                                commitNo,
                                gangDelFlg: 'N'
                            }]
                        })
                    });
                });

                Promise.all(requests).then(resolve).catch(reject).finally(() => loader(0));
            },
            error: function () {
                loader(0);
                reject("Error fetching commit number");
            }
        });
    });
}


		
		
		
		
    //function for adding a new row 
		$('#add-on').on('click', function () {
			  let maxId = updatedData.length > 0 
			    ? Math.max(...updatedData.map(row => row.id || 0)) 
			    : 0;
			  let newId = maxId + 1;
			  let newRow = { id: newId, checkbox: '', stggangname: '', nickname: '', checkbox1: 'Y',
			                 stgStatus: '', selfReported: '', gangComments: '', isEdited: true };

			  updatedData.unshift(newRow);
			  if (table1) {
			    table1.addRow(newRow, true).then(row => {
			      const rowEl = row.getElement();
			      $('.StgTableVal').removeClass('clicked-row hovered-row');
			      $(rowEl).addClass('StgTableVal clicked-row');
			      $(rowEl).click();
			      const stgGangCell = row.getCell("stggangname");
			      if (stgGangCell) stgGangCell.edit();
			    });
			  }
			  $('#Comments').val('');
			  enableMouseEnter = false;
			});
		
		

   ///////----------------------------------------------------------------------------------------------------------------------//////////////////////////
		
		var table123 = new Tabulator("#security-table1", {
		    layout: "fitColumns",		  
		    index: "id",	
		    clipboard: false,
		    tabNavigation: true,
		    printAsHtml: true,
		    printStyled: true,		
		     clipboard:true,
		    clipboardCopyStyled:false,
		    columnDefaults:{		      
		        editor:false,
		        resizable: false,
		        /* headerHozAlign: "center", */
		    },		
	    columns: [
	    	{
				title: "id",
				field: "id",
				visible: false,
			},
			{
				title: 'upd',
				visible: false,
       			field: "upd",
			},
			{
				title: 'rowid',
				visible: false,
				field: "rowid",
			},
		    	{
		    	    title: "Remove", 
		    	    titleFormatter: (column) => setTitleDesc(column, 'Re_move', 'Remove'),
		    	    field: "checkbox", 
		    	    hozAlign: "center",	    		 
		    	    width:95,	        	    	   
		    	},
		    	 { title: "rowremove",
		        	field: "rowremove", 
		        	visible: false 
		        	}, 
		        	{
		        		 title: "STG/Gang Name", 
		        		 titleFormatter: (column) => setTitleDesc(column, 'Gang_Name', 'STG/Gang Name'),
		        		field: "stggangname",
		        		 width:300,
		        		}, 
		        		
		        { title: "",
		        	field: "stggangcode", 
		        	visible: false 
		        	} ,
		   
		        	{
		        	    title: "Nickname", 
		        	    titleFormatter: (column) => setTitleDesc(column, 'Nick_name', 'Nickname'),
		        	    field: "nickname",
		        	    width: 300,
		        	   
		        	},

		        {
		        	   title: "Leader", 
		        	    titleFormatter: (column) => setTitleDesc(column, 'Le_ader', 'Leader'),
		        	  field: "checkbox1",
		        	  hozAlign: "center",
		        	  width:100,
		        	 
		        		},
		        		{
		        			 title: "STG Status", 
		        			titleFormatter: (column) => setTitleDesc(column, 'STG_Status', 'STG Status'),
		        			field: "stgStatus",
		        		
		        			},
		        			{

		        				title: "Self-Reported STG Status",
		        				titleFormatter: (column) => setTitleDesc(column, 'Self-Reported', 'Self-Reported STG Status'),
		        				field: "selfReported",
		        		
		        				},
		         { title: "Gang Comments",
		        	field: "gangComments", 
		        	visible: false 
		        	} 
		    ],
		    		
			     
		  });
		const tabulatorTable = document.querySelector("#security-table1 .tabulator");
		if(tabulatorTable) {
		  tabulatorTable.classList.add("mydisabled");
		}
		
		tabulatorRegistry["security-table"] = {
				varName: "table1",
				instance: table1
			};
		tabulatorRegistry["security-table1"] = {
				varName: "table123",
				instance: table123
			};
	
		$(tabledatasecurity[0].checkbox).html("<input type='checkbox'>");		

	</script>
	<div th:replace="~{fragments/msgBox :: msgBox}"></div>
	<style>
		.tabulator-tableholder{
		    overflow-x: hidden !important;
		}
		.tabulator-cell label{
		width:10px;
		}
		#security-table .tabulator-tableholder{
    		height: 100%!important;
			max-height: calc(100vh - 545px);
		}
		#security-table1 .tabulator-tableholder{
    		height: 100%!important;
			max-height: calc(100vh - 545px);
		}
		.panel-fullscreen #security-table .tabulator-tableholder {
		    height: 100% !important;
		    max-height: calc(100vh - 350px);
		}
		.panel-fullscreen #security-table1 .tabulator-tableholder {
		    height: 100% !important;
		    max-height: calc(100vh - 350px);
		}
		@media screen and (max-width: 1024px) {
		    .page-content-wrapper {
		        margin-top: 0px !important;
		    }
		}
	</style>
	<script type="text/javascript">
		$('#js-page-content').smartPanel();
	</script>
</body>
<!-- BEGIN Page Footer -->
				<div th:replace="~{fragments/footer :: footer}"></div>
				<!-- END Page Footer -->
				
</html>