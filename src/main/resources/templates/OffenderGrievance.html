<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<title class="GrievanceSidebar">OffenderGrievance</title>
<div th:replace="~{fragments/head :: head}"></div>
<body class="mod-bg-1 mod-nav-link">
	
<div th:replace="~{fragments/header :: header}"></div>
<div th:replace="~{fragments/navmenus :: navmenus}"></div>
	<!-- BEGIN Page Wrapper -->
	<div class="page-wrapper">
		<div class="page-inner">
			<!-- BEGIN Left Aside -->
			<div th:replace="~{fragments/sidebar :: sidebar}"></div>
			<!-- END Left Aside --> 
			<div class="page-content-wrapper">
				<!-- BEGIN Page Header --> 
				
				<!-- END Page Header -->
				<!-- BEGIN Page Content -->
				<!-- the #js-page-content id is needed for some plugins to initialize -->
				<main id="js-page-content" role="main" class="page-content">
					<!-- <ol class="breadcrumb page-breadcrumb">
                            <li class="breadcrumb-item"><a href="javascript:void(0);">SmartAdmin</a></li>
                            <li class="breadcrumb-item">category_1</li>
                            <li class="breadcrumb-item">category_2</li>
                            <li class="breadcrumb-item active">Page Titile</li>
                            <li class="position-absolute pos-top pos-right d-none d-sm-block"><span class="js-get-date"></span></li>
                        </ol> -->
					<div class="subheader mb-1">
						<h1 class="subheader-title">
						<div th:replace="~{fragments/toggleMenu :: toggleMenu}"></div>
							<!--<i class='subheader-icon fal fa-'></i> Offender Grievance</span>-->
							<!--<i class='subheader-icon fal fa-'></i> <span th:text="${screenName}"></span></span>-->
							<i class='subheader-icon fal fa-'></i> <span id="screenNameHolder" th:data-name="${screenCode}" th:text="${screenName}"></span></span>
						</h1>
						<div class="btn-group headerBtnGroup mr-2 position-relative" style="top: 2px;">
						  <button type="button" class="btn btn-primary btn-sm dropdown-toggle position-relative" style="top: -3px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						    Go To
						  </button>
						  <div class="dropdown-menu"  style="z-index: 10000 !important;">
							<a class="dropdown-item" href="#" onclick="grievanceScroll()">GRIEVANCE</a>
						    <a class="dropdown-item" href="#" onclick="lsmeScroll()">LSME</a>
						    <a class="dropdown-item" href="#" onclick="igcScroll()">IGC</a>
						    <a class="dropdown-item" href="#" onclick="rgcScroll()">RGC/SME</a>
						    <a class="dropdown-item" href="#" onclick="mgcScroll()">MGC</a>
						    <a class="dropdown-item" href="#" onclick="referralScroll()">REFERRAL</a>
						    <a class="dropdown-item" href="#" onclick="wardenScroll()">WARDEN/BSME</a>
						    <a class="dropdown-item" href="#" onclick="appealScroll()">APPEAL</a>
						    <a class="dropdown-item" href="#" onclick="bgoScroll()">BGO</a>
						    <a class="dropdown-item" href="#" onclick="bureauScroll()">BUREAU CHIEF</a>
						  </div>
						</div>
						<div class="frame-wrap bg-transparent">
							<div class="btn-group">
							<div class="col-12 pr-0">
                            <div class="js-get-date">[your date here]</div>
                            </div>
								<div class="mr-2">
									<div class="input-append date position-relative w-100">
										
										<span class="add-on"></span>
									</div>
								</div>
							</div>
							<!--<span data-toggle="modal" data-target="#LSMEmemberModal">-->
								<a href="javascript:void(0);"
									class="btn btn-primary btn-sm btn-icon waves-effect waves-themed"
									data-toggle="tooltip" data-placement="top" data-original-title="Add" id="addNewGrievanceBtn" > <i
										class="fal fa-plus"></i>
								</a>
							<!--</span>-->
							 <a href="javascript:void(0);"
								class="btn btn-warning btn-sm btn-icon waves-effect waves-themed "
								data-toggle="tooltip" data-placement="top" data-original-title="Print" id="printBtn"> <i
									class="fal fa-print"></i>
							</a> <a href="javascript:void(0);"
								class="btn btn-secondary btn-sm btn-icon waves-effect waves-themed"
								data-toggle="tooltip" data-placement="top" data-original-title="Clear" id="clearButton" > <i
									class="fal fa-times"  ></i>
							</a> <a href="javascript:void(0);"
								class="btn btn-success btn-sm btn-icon waves-effect waves-themed" data-toggle="tooltip"
								data-placement="top" data-original-title="OK/Save" id="saveOffenderBtn" > <i class="fal fa-save"></i>
							</a> <a href="javascript:void(0);"
								class="btn btn-danger btn-sm btn-icon waves-effect waves-themed" data-toggle="tooltip"
								data-placement="top" data-original-title="Cancel/Exit" id="exitButton"> <i class="fal fa-sign-out"></i>
							</a>
						</div>
					</div>

					<div class="row">
						<div class="col-12 col-xl-12">
							<div th:replace="~{fragments/formheader :: formheader}"></div>
							<input type="hidden" name="screenCode" id="screenCode" value="GRV_INFO" />
							<div class="row">
								<div class="col-md-3 col-lg-3 col-xl-2 pr-0"> 
									<div class="panel" style="margin-bottom: 0!important;height: calc(100vh - 278px);">
										<div id="grievanceList-table"></div>
									</div>
								</div>      
								<div class="col-md-9 col-lg-9 col-xl-10 grievanceMainBlock pr-0">
									<!--<div id="panel-1" class="panel">-->
										<div id="GrievanceHeaderPanel" class="panel" style="position: sticky;top: 0;z-index: 10;">
												<div class="disabled-overlay" id="grievanceHeaderOverlay" style="display: none;"></div> <!--style="position: sticky; top: 0;  z-index:9999;"-->
	                                    <div class="panel-container show">
	                                        <div class="panel-content p-1">
	                                            <div id="js-checkbox-toggles" class="row mx-1">
                                                	<div class="d-flex align-items-center col-md-3 col-lg-3 col-xl-2 pl-0 floatingFields mt-2">
														<input type="text" class="form-control floatingLable rawField" aria-label="Security" placeholder="" name="" id="Group" data-fld = "Group_fld" data-lbl = "Grievance#" value="">
														<label for="Security" class="form-label mr-1 mb-0">Grievance#</label>
														<span data-toggle="modal" data-target="#groupSupplementaryModal" class="ml-2">
															<button class="btn btn-primary btn-sm" style="font-size: 20px; padding: 0 12px; padding-left: 9px;" data-toggle="tooltip" data-placement="top" data-original-title="Group/Supplementary Incident Details" data-action="toggle">G</button>
														</span>
													</div>
													<div class="d-flex align-items-center col-md-2 col-lg-2 col-xl-2 pl-0 floatingFields mt-2"> 
														<input type="text" class="form-control floatingLable rawField" aria-label="Security" placeholder="" name="" id="Group1" data-fld = "Group1_fld" data-lbl = "Group#" value="">
														<label for="Security" class="form-label mr-1 mb-0">Group#</label>
													</div>
													<div class="d-flex align-items-center col-md-3 col-lg-3 col-xl-2 text-nowrap mt-2 pl-0 datePickerFloat">
														<input class="form-control floatingLable rawField" type="date" aria-label="GrievanceDate" name="GrievanceDate" id="GrievanceDate" value="" data-fld = "GrievanceDate_fld" data-lbl = "Grievance Date">
														<label for="GrievanceDate" class="form-label mr-1">Grievance Date</label>
														<!--<label for="Security" class="form-label mb-0" style="margin-right: 5px;">Grievance Date</label>
														<div class="input-append date position-relative w-100"
															id="mdPicker">
															<input class="span2 form-control bg-light fromDate" size="16" type="date" value="" id="GrievanceDate"
																>
															<span class="add-on"></span>
														</div>-->
													</div>
													<div class="d-flex align-items-center col-md-4 pr-md-0 pl-md-0 col-lg-4 pl-lg-0 pr-lg-0 col-xl-2 pl-xl-0 pr-xl-2 floatingFields mt-2">
														<select class="custom-select form-control typecontact floatingLable rawField" id="Facility" data-fld = "Facility_fld" data-lbl = "Facility">
															
														</select>
														<label for="Security" class="form-label mr-1 mb-0">Facility</label>
													</div>
													<div class="d-flex align-items-center justify-content-between col-md-5 mt-md-3 col-lg-4 mt-lg-3 col-xl-4 pl-0 mt-xl-0 pr-0">														
														<div class="custom-control custom-checkbox custom-control-inline">
															<input type="checkbox"
																class="custom-control-input negativeCheckbox rawField"
																id="Emergencyf" data-fld = "Emergency_fld" data-lbl = "Emergency">
															<label class="custom-control-label"
																for="Emergencyf">Emergency</label>
														</div>
														<div class="custom-control custom-checkbox custom-control-inline">
															<input type="checkbox"
																class="custom-control-input negativeCheckbox rawField"
																id="Confidentialf" data-fld = "Confidential_fld" data-lbl = "Confidential">
															<label class="custom-control-label"
																for="Confidentialf">Confidential</label>
														</div>
													</div>
													<div class="d-flex align-items-center col-md-4 mt-md-3 pl-md-0 pr-md-2 col-lg-7 pl-lg-0 pr-lg-0 mt-lg-3 col-xl-2 mt-xl-3 pl-xl-0 pr-xl-2 floatingFields">
														<select class="custom-select form-control typecontact floatingLable rawField" id="Status" data-fld = "Status_fld" data-lbl = "Status">
															
														</select>
														<label for="Security" class="form-label mr-1 mb-0">Status</label>
															<span id="statusIcon" class="ml-2" style="display: none; cursor: pointer;" title="View Correspondence/Abandonment Details">
															        <a href="javascript:void(0);" class="btn btn-primary btn-sm p-1 btn js-waves-off d-flex align-items-center">
															            <i class="fas fa-clipboard-list" aria-hidden="true"></i>
															        </a>
															    </span>
													</div>
													<div class="d-flex align-items-center col-md-4 mt-md-3 pl-md-0 pr-md-0 col-lg-4 mt-lg-3 pl-lg-0 pr-lg-0 col-xl-2 mt-xl-3 pl-xl-0 levelresolution-pr-xl-2 text-nowrap floatingFields">
														<select class="custom-select form-control typecontact floatingLable rawField" id="LevelOfResolution" data-fld = "LevelOfResolution_fld" data-lbl = "Level of Resolution" disabled>
															<!--<option>select Menu</option>-->
															<option> </option>
															<option value="1">Level 1</option>
															<option value="2">Level 2</option>
															<option value="3">Level 3 </option>
														</select>
														<label for="Security" class="form-label mr-1 mb-0">Level of Resolution</label>
													</div>
													<div class="d-flex align-items-center col-md-4 col-lg-4 col-xl-4 pl-0 mt-3 floatingFields">
														<input type="text" class="form-control floatingLable rawField" placeholder="" name="Pattersonfname" id="Pattersonfname" data-fld = "Pattersonfname_fld" data-lbl = "IGC" value="">
														<label for="Security" class="form-label mr-1 pl-0 mb-0">IGC</label>
														<span class="d-flex" data-toggle="modal" data-target="#selectNameFromlist" title="Click to select staff">									
															<a href="#"  id="IGCbtn" class="btn btn-primary btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
																<i class="fa fa-users" aria-hidden="true"></i>
															</a>
														</span>
													</div>
													<div class="d-flex align-items-center col-md-4 mt-md-3 pl-md-0 pr-md-2 col-lg-4 pl-lg-0 pr-lg-0 mt-lg-3 col-xl-2 mt-xl-3 pl-xl-0 pr-xl-2 text-nowrap floatingFields">
														<select class="custom-select form-control typecontact floatingLable rawField" id="Location" data-fld = "Location_fld" data-lbl = "Location">
		
														</select>
														<label for="Security" class="form-label mr-1 mb-0">Location</label>
													</div>
													<div class="d-flex align-items-center col-md-4 mt-md-3 pl-md-0 pr-md-0 col-lg-4 mt-lg-3 pl-lg-0 pr-lg-2 col-xl-2 mt-xl-3 px-xl-0 text-nowrap floatingFields">
														<select class="custom-select form-control typecontact floatingLable rawField" id="Category" data-fld = "Category_fld" data-lbl = "Category">
															
															<option></option>
															<option value="EGY">Emergency</option>
															<option value="GRP">Group</option>
															<option value="IND">Individual</option>
															<option value="UNI">Universal</option>
														</select>
														<label for="Category" class="form-label mr-1 mb-0">Category</label> 
													</div>
													<div class="d-flex align-items-center col-md-3 col-lg-3 col-xl-2 text-nowrap mt-3 pl-0 datePickerFloat">
														<input class="form-control floatingLable rawField" type="date" aria-label="ResolDate" name="ResolDate" id="ResolDate" value="" data-fld = "ResolDate_fld" data-lbl = "Resolution Date" disabled>
														<label for="ResolDate" class="form-label mr-1">Resolution Date</label>
													</div>
													<div class="d-flex align-items-center col-md-3 col-lg-3 col-xl-2 text-nowrap mt-3 pl-0 datePickerFloat">
														<input class="form-control floatingLable rawField" type="date" aria-label="IncidentDate" name="IncidentDate" id="IncidentDate" data-fld = "IncidentDate_fld" data-lbl = "Incident Date" value="">
														<label for="IncidentDate" class="form-label mr-1">Incident Date</label>
													</div>
													<div class="d-flex align-items-center col-md-2 pl-md-0 pr-md-2 col-lg-2 pl-lg-0 pr-lg-0 col-xl-2 pl-xl-0 pr-xl-2 text-nowrap mt-3 floatingFields">
														<!--<input type="time" class="form-control floatingLable rawField" placeholder="" name="IncidentTime" id="IncidentTime" value="" data-fld = "IncidentTime_fld" data-lbl = "Incident Time">
														<label for="Security" class="form-label mr-1 mb-0">Incident Time</label>-->
														<input type="text" class="form-control floatingLable rawField" placeholder="" name="IncidentTime" id="IncidentTime" value="" data-fld="IncidentTime_fld" data-lbl="Incident Time" maxlength="5">
														<label for="IncidentTime" class="form-label mr-1 mb-0">Incident Time</label>
													</div>
													<div class="d-flex align-items-center col-md-4 mt-md-3 pl-md-0 pr-md-0 col-lg-5 mt-lg-3 pl-lg-0 pr-lg-2 col-xl-2 mt-xl-3 pl-xl-0 pr-xl-2 text-nowrap mt-3 floatingFields">
														<select class="custom-select form-control typecontact floatingLable rawField" id="GrievanceType" data-fld = "GrievanceType_fld" data-lbl = "Grievance Type">
		
														</select>
														<label for="Security" class="form-label mr-1 mb-0">Grievance Type</label>
													</div>
													<div class="d-flex align-items-center col-md-3 mt-md-3 pl-md-0 col-lg-3 mt-lg-3 pl-lg-0 col-xl-2 mt-xl-3 pl-xl-0 text-nowrap datePickerFloat">
														<input class="form-control floatingLable rawField" type="date" aria-label="IGCRecdDate" name="IGCRecdDate" id="IGCRecdDate" value="" data-fld = "IGCRecdDate_fld" data-lbl = "IGC Received Date"> 
														<label for="IGCRecdDate" class="form-label mr-1">IGC Received Date</label>
													</div>
													<div class="d-flex align-items-center col-md-3 mt-md-3 pl-md-0 col-lg-4 mt-lg-3 pl-lg-0 pr-lg-0 col-xl-2 mt-xl-3 px-xl-0 text-nowrap floatingFields">
														<input type="text" class="form-control floatingLable rawField" placeholder="" name="CurrentHousing" id="CurrentHousing" value="" data-fld = "CurrentHousing_fld" data-lbl = "Current Housing" disabled>
														<label for="Security" class="form-label mb-0">Current Housing</label>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
									<!--<div id="panel-1" class="panel">-->
										<div id="GrievanceBodyPanel" class="panel" style="position: relative;">
												<div class="disabled-overlay" id="grievanceBodyOverlay" style="display: none;"></div>
	                                    <div class="panel-hdr">
	                                        <h2>
	                                            Grievance
	                                        </h2>
	                                    </div>
	                                    <div class="panel-container show">
	                                        <div class="panel-content p-1">
	                                            <div id="js-checkbox-toggles">
	                                                <div class="row mx-1" id="GrievanceBlockMain">
														<div class="col-md-6 col-lg-6 pl-0 floatingFieldsTextarea mt-2">
															<textarea class="form-control rawField floatingLabletextarea" rows="2" name="Comments" placeholder="" aria-label="Comments" style="resize:none;" value="" id="DescriptionOfComplaint" data-fld = "DescriptionOfComplaint_fld" data-lbl = "Description of Complaint"></textarea>
															<label for="DescriptionOfComplaint" class="form-label mb-0">Description of Complaint</label>
														</div>
														<div class="col-md-6 col-lg-6 px-0 floatingFieldsTextarea mt-2">
															<textarea class="form-control rawField floatingLabletextarea" rows="2" name="Comments" placeholder="" aria-label="Comments" style="resize:none;" value="" id="RemedyRequested" data-fld = "RemedyRequested_fld" data-lbl = "Remedy Requested"></textarea>
															<label for="RemedyRequested" class="form-label mb-0">Remedy Requested</label>
														</div>
														<div class="col-lg-12 pl-0 my-2">
															<h6 class="headerBlock text-center m-0" style="font-weight: 600;">
																<div class="d-flex align-items-center">
																	<span class="w-100 text-center">Individuals Involved</span>
																	<span class="d-flex ml-2" id="addRow">								
								                                        <a href="#"   class="btn btn-success btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" title="Click to add row" data-class="nav-function-hidden">
																			<i class="fa fa-plus"  aria-hidden="true"></i>
																		</a>
																	</span>
																	<span class="d-flex ml-2" id="removeRow">								
								                                        <a href="#"  id="" class="btn btn-danger btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" title="Click to remove row" data-class="nav-function-hidden">
																			<i class="fa fa-times" aria-hidden="true"></i>
																		</a>
																	</span>
																</div>
															</h6>
														</div>
														<div class="col-lg-12 px-0">
															<div id="individualsinvolved-table"></div>
														</div>
														<div class="col-lg-12 my-2 px-0">
															<div class="row mx-5 mt-2">
																<div class="col-md-3 col-lg-3 col-xl-2 pl-0 custom-control custom-checkbox custom-control-inline mr-0">
																    <input type="checkbox" class="custom-control-input negativeCheckbox rawField" id="MedicalGrievance" data-fld = "MedicalGrievance_fld" data-lbl = "Medical Grievance">
																    <label class="custom-control-label" for="MedicalGrievance">Medical Grievance</label>
																</div>
																<div class="col-md-5 col-lg-5 col-xl-3 pl-0 d-flex align-items-center floatingFields">
																	<input type="text" class="form-control floatingLable rawField" aria-label="Security" placeholder="" name="Group" id="MedicalReceiptDate" value="" data-fld = "MedicalReceiptDate_fld" data-lbl = "Date Received By Medical Unit" >
																	<label for="Security" class="form-label mb-0">Date Received By Medical Unit</label>
																</div>
																<div class="col-md-4 col-lg-4 col-xl-3 pl-0 d-flex align-items-center floatingFields">
																	<input type="text" class="form-control floatingLable rawField" aria-label="Security" placeholder="" name="Group" id="GrievanceAmount" value="" data-fld = "GrievanceAmount_fld" data-lbl = "Grievance Amount" >
																	<label for="Security" class="form-label mb-0">Grievance Amount</label>
																</div> 
															</div>
														</div>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div id="LSMEMainBlock" class="panel">
										<div id="lsmeDisabledOverlay" class="disabled-overlay" style="display: none;"></div>
	                                    <div class="panel-hdr">
	                                        <h2>
	                                            LSME
	                                        </h2>
	                                        <span class="d-flex w-100 justify-content-end">																				
												<span class="d-flex ml-1" data-toggle="modal" data-target="#LSMEmemberModal" title="Click to open LSME member modal">								
			                                        <a href="#"  id="" class="btn btn-success btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
														<i class="fa fa-plus" aria-hidden="true"></i>
													</a>
												</span>
												<span class="d-flex ml-1" id="LSMEremoverow" title="Click to remove row">								
			                                        <a href="#" class="btn btn-danger btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center lsme-remove-row" data-class="nav-function-hidden">
														<i class="fa fa-times" aria-hidden="true"></i>
													</a>
												</span>
											</span>
	                                    </div>
	                                    <div class="panel-container show">
	                                        <div class="panel-content p-1">
	                                            <div id="js-checkbox-toggles">
	                                                <div class="row mx-1">
														<div class="col-md-12 col-lg-6 col-xl-5 px-0">
															<div id="lsme-table"></div>
														</div>
														<div class="col-md-12 pl-md-0 pr-md-0 col-lg-6 pl-lg-2 pr-lg-0 col-xl-7 pr-xl-0">
															<div class="d-flex align-items-center col-md-3 col-lg-5 col-xl-3 pl-0 text-nowrap mt-2 datePickerFloat">
																<input type="date" class="form-control floatingLable rawField" placeholder="" name="reportDate" id="reportDate" data-fld = "reportDate_fld" data-lbl = "Date of Report" value="">
																<label for="reportDate" class="form-label mr-1 mb-0">Date of Report</label>
															</div>
															<div class="floatingFieldsTextarea mt-3">
															    <textarea class="form-control rawField floatingLabletextarea" placeholder="" id="investigationReport" rows="5" name="investigationReport" aria-label="Investigation Report" style="resize: none;" data-fld = "investigationReport_fld" data-lbl = "Investigation Report"></textarea>
																<label for="investigationReport" class="form-label mb-0">Investigation Report</label>
															</div>
															<div class="floatingFieldsTextarea mt-3">
																<textarea class="form-control rawField floatingLabletextarea" placeholder="" id="referralReason" rows="5" name="referralReason" aria-label="Reason for Referral" style="resize: none;" data-fld = "referralReason_fld" data-lbl = "Reason for Referral"></textarea>
																<label for="referralReason" class="form-label mb-0">Reason for Referral</label>
															</div>
															<div class="row mx-1">
																<div class="col-md-5 col-lg-12 col-xl-5 floatingFields pl-0 mt-3">																	
																	<select class="custom-select form-control floatingLable rawField" id="informalResolution" name="informalResolution" data-fld = "informalResolution_fld" data-lbl = "Informal Resolution Accepted">
										                                <option value=""> </option>
										                                <option value="Y">Yes</option>
										                                <option value="N">No</option>
										                            </select>
																	<label for="informalResolution" class="form-label mr-2 mb-0 text-nowrap">Informal Resolution Accepted</label>
																</div>
																<div class="col-md-3 col-lg-5 col-xl-3 pr-2 custom-control mr-0 mt-3 custom-checkbox custom-control-inline align-items-center">
																	<input type="checkbox" class="custom-control-input rawField" id="forwardToIGC" name="forwardToIGC" data-fld = "forwardToIGC_fld" data-lbl = "Forward to IGC">
																	<label class="custom-control-label text-nowrap" for="forwardToIGC" style="font-weight: 500;">Forward to IGC</label>
			                                                     </div>
			                                                     <div class="col-md-4 col-lg-7 col-xl-4 mt-3 d-flex align-items-center col-lg-4 pl-0 text-nowrap datePickerFloat">
																	<input type="date" class="form-control floatingLable rawField" placeholder="" name="forwardToIGCDate" id="forwardToIGCDate" value="" data-fld = "forwardToIGCDate_fld" data-lbl = "Date Forwarded to IGC">
																	<label for="forwardToIGCDate" class="form-label mr-1 mb-0">Date Forwarded to IGC</label>
																</div> 
															</div>
														</div>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div id="IGCMainBlock" class="panel">
										<div class="disabled-overlay" id="igcDisabledOverlay" style="display: none;"></div>
	                                    <div class="panel-hdr">
	                                        <h2>
	                                            IGC
	                                        </h2>
	                                    </div>
	                                    <div class="panel-container show">
	                                        <div class="panel-content p-1">
	                                            <div id="js-checkbox-toggles">
	                                                <div class="row mx-1">
														<div class="col-lg-12 col-xl-5 pl-0">							
															<div class="floatingFieldsTextarea mt-2">
																<textarea class="form-control rawField floatingLabletextarea" id="comments" rows="6" data-fld="comments_fld" data-lbl="Comments" aria-label="" name="comments" placeholder="" style="resize:none;"></textarea>
																<label for="comments" class="form-label mb-0">Comments</label>
															</div>
															<div class="row mx-1">
																<div class="col-md-6 pl-md-3 col-lg-12 pl-lg-3 col-xl-6 pl-xl-1">
																	<div class="row mt-2">
																		<div class="col-md-12 col-lg-4 col-xl-12 mt-3 pl-0">
																			<div class="custom-control custom-checkbox custom-control-inline">
																				<input type="checkbox" class="custom-control-input rawField" id="forwardToMGCCheckbox" data-fld = "forwardToMGCCheckbox_fld" data-lbl = "Forward to MGC">
																				<label class="custom-control-label text-nowrap" for="forwardToMGCCheckbox" style="font-weight: 500;">Forward to MGC</label>
																			</div>
																		</div>
																		<div class="col-md-12 col-lg-4 col-xl-12  mt-3 pl-0">
																			<div class="custom-control custom-checkbox custom-control-inline">
																				<input type="checkbox" class="custom-control-input rawField" id="forwardToRGC_SMECheckbox" data-fld = "forwardToRGC_SMECheckbox_fld" data-lbl = "Forward to RGC/SME">
																				<label class="custom-control-label text-nowrap" for="forwardToRGC_SMECheckbox" style="font-weight: 500;">Forward to RGC/SME</label>
																			</div>
																		</div>
																		<div class="col-md-12 col-lg-4 col-xl-12 pr-0 mt-3 pl-0">
																			<div class="custom-control custom-checkbox custom-control-inline">
																				<input type="checkbox" class="custom-control-input rawField" id="offenderSignatureCheckbox" data-fld = "offenderSignatureCheckbox_fld" data-lbl = "Offender Signature Captured">
																				<label class="custom-control-label text-nowrap" for="offenderSignatureCheckbox" style="font-weight: 500;">Offender Signature Captured</label>
																			</div>
																		</div>
																	</div>
																</div> 
																<div class="col-md-6 col-lg-12 col-xl-6">
																	<div class="row">
																		<div class="d-flex align-items-center col-md-12 pr-md-0 col-lg-4 pr-lg-2 col-xl-12 pr-xl-0 pl-0 text-nowrap datePickerFloat mt-3">
																			<input type="date" class="form-control floatingLable rawField" placeholder="" name="dateForwardedToMGC" id="dateForwardedToMGC" data-fld = "dateForwardedToMGC_fld" data-lbl = "Date Forwarded to MGC" value="">
																			<label for="dateForwardedToMGC" class="form-label mr-1 mb-0">Date Forwarded to MGC</label>
																		</div>
																		<div class="d-flex align-items-center col-md-12 pr-md-0 col-lg-5 pr-lg-2 col-xl-12 pr-xl-0 pl-0 text-nowrap dateForwardedlg datePickerFloat mt-3">
																			<input type="date" class="form-control floatingLable rawField" placeholder="" name="dateForwardedToRGC_SME" id="dateForwardedToRGC_SME" data-fld = "dateForwardedToRGC_SME_fld" data-lbl = "Date Forwarded to RGC/SME" value="">
																			<label for="dateForwardedToRGC_SME" class="form-label mr-1 mb-0">Date Forwarded to RGC/SME</label>
																		</div>
																		<div class="d-flex align-items-center col-md-12 col-lg-3 col-xl-12 px-0 text-nowrap datePickerFloat mt-3">
																			<input type="date" class="form-control floatingLable rawField" placeholder="" name="dateOffenderSigned" id="dateOffenderSigned" value="" data-fld = "dateOffenderSigned_fld" data-lbl = "Date Offender Signed">
																			<label for="dateOffenderSigned" class="form-label mr-1 mb-0">Date Offender Signed</label>
																		</div>	
																	</div>
																</div> 								
															</div>
														</div>
														<div class="col-md-12 pl-md-0 col-lg-12 pl-lg-0 col-xl-7 pr-0">
															<h6 class="headerBlock text-center my-1 mx-0" style="font-weight: 600;">
																<div class="d-flex align-items-center">
																	<span class="text-center w-100">Additional Comments After Resolution</span>
																	<span class="d-flex justify-content-end">																				
																		<span class="d-flex ml-1">								
									                                        <a href="#"  id="IGCrowAddBtn" class="btn btn-success btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" title="Click to add staff" data-class="nav-function-hidden">
																				<i class="fa fa-plus" aria-hidden="true"></i>
																			</a>
																		</span>
																	</span>
																</div>
															</h6>
															<div id="igcselect-table"></div>
															<div class="floatingFieldsTextarea mt-3">
																<textarea class="form-control rawField floatingLabletextarea" id="resolutionComments" rows="3" name="resolutionComments" data-fld = "resolutionComments_fld" data-lbl = "Resolution Comments" placeholder="" style="resize:none;"></textarea>
																<label for="resolutionComments" class="form-label mb-0">Resolution Comments</label>
															</div>
														</div>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div id="RGCSMEMainBlock" class="panel">
										<div id="rgcDisabledOverlay" class="disabled-overlay" style="display: none;"></div>
	                                    <div class="panel-hdr">
	                                        <h2>
	                                            RGC/SME
	                                        </h2>
	                                    </div>
	                                    <div class="panel-container show">
	                                        <div class="panel-content p-1">
	                                            <div id="js-checkbox-toggles">
	                                                <div class="row mx-1">
														<div class="d-flex align-items-center col-md-3 col-lg-3 col-xl-2 pl-0 text-nowrap datePickerFloat mt-2">
															<input type="date" class="form-control floatingLable rawField" placeholder="" name="dateReceived" id="dateReceived" data-fld = "dateReceived_fld" data-lbl = "Date Received" value="">
															<label for="dateReceived" class="form-label mr-1 mb-0">Date Received</label>
														</div>
														<div class="d-flex align-items-center col-md-4 col-lg-4 col-xl-3 pl-0 text-nowrap datePickerFloat mt-2">
															<input type="date" class="form-control floatingLable rawField" placeholder="" name="dateRecommendation" id="dateRecommendation" value="" data-fld = "dateRecommendation_fld" data-lbl = "Date of Recommendation">
															<label for="dateRecommendation" class="form-label mr-1 mb-0">Date of Recommendation</label>
														</div>
														<div class="col-lg-12 px-0 floatingFieldsTextarea mt-3 mb-2">
															 <textarea class="form-control rawField floatingLabletextarea" id="recommendationComments" rows="2" name="recommendationComments" placeholder="" style="resize:none;" data-fld = "recommendationComments_fld" data-lbl = ""></textarea>
															 <label for="recommendationComments" class="form-label mb-0">Recommendation Comments</label>
														</div>
														<div class="col-lg-12 px-0">
															<h6 class="headerBlock text-center m-0" style="font-weight: 600;">
																<div class="d-flex align-items-center">
																	<span class="text-center w-100">Rgc Voting - Vote on Inmate Request</span>
																	<span class="d-flex justify-content-end">																				
																		<span class="d-flex ml-1" data-toggle="modal" data-target="#SelectRGCMember" title="Click to open RGC member modal">								
									                                        <a href="#"  id="" class="btn btn-success btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
																				<i class="fa fa-plus" aria-hidden="true"></i>
																			</a>
																		</span>
																		<span class="d-flex ml-1" id="RGCrowRemoveBtn" title="Click to remove RGC members">								
									                                        <a href="#"  id="" class="btn btn-danger btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
																				<i class="fa fa-times" aria-hidden="true"></i>
																			</a>
																		</span>
																	</span>
																</div>
															</h6> 
															<div id="rgcSme-Table" class="mt-1"></div>
														</div>
														<div class="col-lg-12 px-0 d-flex align-items-center mt-3">
															<h6 class="headerBlock text-center m-0 text-nowrap" style="font-weight: 600;">Total Votes</h6>
															<div class="row mx-3">
																<div class="d-flex align-items-center pl-0 col-md-2 col-lg-2 col-xl-3 floatingFields">
																	<input type="text" class="form-control floatingLable rawField" aria-label="totalUphold" name="totalUphold" id="totalUphold" data-fld = "totalUphold_fld" data-lbl = "Uphold" value="" placeholder="" >
																	<label for="totalUphold" class="form-label mr-2 mb-0 text-nowrap">Uphold</label>
																</div>
																<div class="d-flex align-items-center pl-0 col-md-3 col-lg-2 col-xl-3 floatingFields">
																	<input type="text" class="form-control floatingLable rawField" aria-label="totalDeny" name="totalDeny" id="totalDeny" data-fld = "totalDeny_fld" data-lbl = "Deny" value="" placeholder="" >
																	<label for="totalDeny" class="form-label mr-2 mb-0 text-nowrap">Deny</label>
																</div>
																<div class="d-flex align-items-center pl-0 col-md-3 col-lg-2 col-xl-3 floatingFields">
																	<input type="text" class="form-control floatingLable rawField" aria-label="totalAbstain" name="totalAbstain" id="totalAbstain" data-fld = "totalAbstain_fld" data-lbl = "Abstain" value="" placeholder="" >
																	<label for="totalAbstain" class="form-label mr-2 mb-0 text-nowrap">Abstain</label>
																</div>
																<div class="custom-control custom-checkbox custom-control-inline col-md-3 col-lg-3 col-xl-2">
																	<input type="checkbox" class="custom-control-input rawField" id="forwardToWarden" data-fld = "forwardToWarden_fld" data-lbl = "Forward to Warden/BSME">
																	<label class="custom-control-label text-nowrap" for="forwardToWarden" style="font-weight: 500;">Forward to Warden/BSME</label>
																</div>
															</div>
														</div>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div id="MGCSMEMainBlock" class="panel">
	                                    <div class="panel-hdr">
	                                        <h2>
	                                            MGC
	                                        </h2>
	                                    </div>
	                                    <div class="panel-container show">
	                                        <div class="panel-content p-1">
												<div id="mgcDisabledOverlay" class="disabled-overlay" style="display: none;"></div>
	                                            <div id="js-checkbox-toggles">
	                                                <div class="row mx-1">
														<div class="d-flex align-items-center col-md-3 col-lg-3 col-xl-2 pl-0 text-nowrap datePickerFloat mt-2">
																<input type="date" class="form-control floatingLable rawField" placeholder="" name="MGCdateReceived" id="MGCdateReceived" data-fld = "MGCdateReceived_fld" data-lbl = "Date Received" value="" >
																<label for="dateReceived" class="form-label mr-1 mb-0">Date Received</label>
															</div>
															<div class="d-flex align-items-center col-md-4 col-lg-4 col-xl-3 pl-0 text-nowrap datePickerFloat mt-2">
																<input type="date" class="form-control floatingLable rawField" placeholder="" name="MGCdateRecommendation" id="MGCdateRecommendation" data-fld = "MGCdateRecommendation_fld" data-lbl = "Date of Recommendation" value="">
																<label for="dateRecommendation" class="form-label mr-1 mb-0">Date of Recommendation</label>
															</div>
															<div class="col-lg-12 mb-2 px-0 floatingFieldsTextarea mt-3">
																 <textarea class="form-control rawField floatingLabletextarea" id="MGCrecommendationComments" rows="2" name="recommendationComments" data-fld = "MGCrecommendationComments_fld" data-lbl = "Recommendation Comments" placeholder="" style="resize:none;"></textarea>
																 <label for="MGCrecommendationComments" class="form-label mb-0">Recommendation Comments</label>
															</div>
														<div class="col-lg-12 px-0">
															<h6 class="headerBlock text-center m-0" style="font-weight: 600;">
																<div class="d-flex align-items-center">
																	<span class="text-center w-100">MGC Voting - Vote on Inmate Request</span>
																	<span class="d-flex justify-content-end" >																				
																		<span class="d-flex ml-1" data-toggle="modal" data-target="#SelectMGCMember" title="Click to open MGC member modal">								
									                                        <a href="#" id="" class="btn btn-success btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
																				<i class="fa fa-plus" aria-hidden="true"></i>
																			</a>
																		</span>
																		<span class="d-flex ml-1" id="MGCrowRemoveBtn" title="Click to remove MGC members">								
									                                        <a href="#"  id="" class="btn btn-danger btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
																				<i class="fa fa-times" aria-hidden="true"></i>
																			</a>
																		</span>
																	</span>
																</div>
															</h6> 

															<div id="mgc-Table" class="mt-1"></div>
														</div>
														<div class="col-lg-12 px-0 d-flex align-items-center mt-3">
															<h6 class="headerBlock text-center m-0 text-nowrap" style="font-weight: 600;">Total Votes</h6>
															<div class="row mx-3">
																<div class="d-flex align-items-center pl-0 col-md-4 col-lg-4 col-xl-4 floatingFields">
																	<input type="text" class="form-control floatingLable rawField" aria-label="totalUphold" name="mgcTotalUphold" id="mgcTotalUphold" data-fld = "mgcTotalUphold_fld" data-lbl = "Uphold" value="" placeholder="" >
																	<label for="mgcTotalUphold" class="form-label mr-2 mb-0 text-nowrap">Uphold</label>
																</div>
																<div class="d-flex align-items-center pl-0 col-md-4 col-lg-4 col-xl-4 floatingFields">
																	<input type="text" class="form-control floatingLable rawField" aria-label="totalDeny" name="mgcTotalDeny" id="mgcTotalDeny" data-fld = "mgcTotalDeny_fld" data-lbl = "Deny" value="" placeholder="" >
																	<label for="mgcTotalDeny" class="form-label mr-2 mb-0 text-nowrap">Deny</label>
																</div>
																<div class="d-flex align-items-center pl-0 col-md-4 col-lg-4 col-xl-4 floatingFields">
																	<input type="text" class="form-control floatingLable rawField" aria-label="totalAbstain" name="mgcTotalAbstain" id="mgcTotalAbstain" data-fld = "mgcTotalAbstain_fld" data-lbl = "Abstain" value="" placeholder="" >
																	<label for="mgcTotalAbstain" class="form-label mr-2 mb-0 text-nowrap">Abstain</label>
																</div>
															</div>
															<h6 class="headerBlock text-center m-0 text-nowrap" style="font-weight: 600;">Inmate Wishes to Appeal</h6> 
															<div class="d-flex">
																<div class="custom-control custom-radio mr-3 ml-2">
			                                                        <input type="radio" class="custom-control-input rawField" id="MgcRadioYesBtn" name="defaultExampleRadios" data-fld = "MgcRadioYesBtn_fld" data-lbl = "Yes">
			                                                        <label class="custom-control-label" for="MgcRadioYesBtn">Yes</label>
			                                                    </div>
			                                                    <div class="custom-control custom-radio">
			                                                        <input type="radio" class="custom-control-input rawField" id="MgcRadioYesBtn1" name="defaultExampleRadios" checked="" data-fld = "MgcRadioYesBtn1_fld" data-lbl = "No">
			                                                        <label class="custom-control-label" for="MgcRadioYesBtn1">No</label>
			                                                    </div>
															</div>
														</div>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div id="ReferralMainBlock" class="panel">
										<div class="disabled-overlay" id="referralOverlay" style="display: none;"></div>
	                                    <div class="panel-hdr">
	                                        <h2>
	                                            Referral
	                                        </h2>
	                                        <span class="d-flex w-100 justify-content-end">																				
												<span class="d-flex ml-1" data-toggle="modal" data-target="#" id="RefrowAddBtn">								
			                                        <a href="#"  id="" class="btn btn-success btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
														<i class="fa fa-plus" aria-hidden="true"></i>
													</a>
												</span>
												<span class="d-flex ml-1" id="RefrowRemoveBtn">								
			                                        <a href="#" class="btn btn-danger btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center lsme-remove-row" data-class="nav-function-hidden">
														<i class="fa fa-times" aria-hidden="true"></i>
													</a>
												</span>
											</span>
	                                    </div>
	                                    <div class="panel-container show">
	                                        <div class="panel-content p-1">
	                                            <div id="js-checkbox-toggles">
	                                                <div class="row mx-1">
														<div class="col-lg-12 px-0">
															<div id="referral-Table" class="my-1"></div>
															<div class="d-flex align-items-center mt-3">
																<div class="floatingFieldsTextarea w-100">
																	<textarea class="form-control rawField floatingLabletextarea" id="informationRequested" data-fld = "informationRequested_fld" data-lbl = "Information Requested" placeholder="" rows="2" name="Comments" aria-label="Comments" style="resize:none;" value=""></textarea>
																	 <label for="informationRequested" class="form-label mb-0">Information Requested</label>
																</div>
																<div class="floatingFieldsTextarea w-100 ml-2">
																	<textarea class="form-control rawField floatingLabletextarea" id="responseToRequest" data-fld = "responseToRequest_fld" data-lbl = "Response to Request" placeholder="" rows="2" name="Comments" aria-label="Comments" style="resize:none;" value="" disabled></textarea>
																	 <label for="responseToRequest" class="form-label mb-0">Response to Request</label>
																</div>
															</div>
														</div>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
									<div id="WardenBsmeMainBlock" class="panel">
									    <div class="panel-hdr">
									        <h2>
									            Warden/Bsme
									        </h2>
									    </div>
									    <div class="panel-container show">
									        <div class="panel-content p-0">
									            <div id="js-checkbox-toggles">
									                <div class="row mx-1 align-items-center">
									                    <div class="col-lg-12 col-xl-7 pl-0">
									                        <div class="row mx-1 align-items-center">
									                            <div class="col-md-3 col-lg-3 col-xl-3 pl-0 text-nowrap datePickerFloat mt-3 position-relative">
									                                <input type="date" class="form-control floatingLable rawField" placeholder="" name="wardenDateReceived" id="wardenDateReceived" data-fld="wardenDateReceived_fld" data-lbl="Date Received" value="">
									                                <label for="wardenDateReceived" class="form-label mb-0">Date Received</label>
									                            </div>
									                            <div class="d-flex align-items-center text-nowrap col-md-9 col-lg-9 col-xl-9 px-0 mt-3">
									                                <h6 class="headerBlock text-center m-0" style="font-weight: 600;">Vote on Inmate Request</h6>
									                                <!--<label for="sex" class="form-label mr-2 mb-0 text-primary" style="font-weight: 800;">Vote on Inmate Request</label>-->
									                                <div class="custom-control custom-radio mx-2">
									                                    <input type="radio" class="custom-control-input rawField" id="wardenUphold" name="wardenVote" value="U" data-fld="wardenUphold_fld" data-lbl="Uphold">
									                                    <label class="custom-control-label" for="wardenUphold">Uphold</label>
									                                </div>
									                                <div class="custom-control custom-radio">
									                                    <input type="radio" class="custom-control-input rawField" id="wardenDeny" name="wardenVote" value="D" data-fld="wardenDeny_fld" data-lbl="Deny">
									                                    <label class="custom-control-label" for="wardenDeny">Deny</label>
									                                </div>
									                                <div class="d-flex align-items-center ml-1 text-nowrap datePickerFloat position-relative w-100 pr-0">
									                                    <input type="date" class="form-control floatingLable rawField" placeholder="" name="wardenDecisionDate" id="wardenDecisionDate" data-fld="wardenDecisionDate_fld" data-lbl="Decision Date" value="">
									                                    <label for="wardenDecisionDate" class="form-label mr-1 mb-0">Decision Date</label>
									                                </div>
									                            </div>
									                            <div class="custom-control custom-checkbox custom-control-inline text-nowrap mt-3 col-md-3 col-lg-3 col-xl-3 mr-0">
									                                <input type="checkbox" class="custom-control-input rawField" id="wardenForwardToIGC" data-fld="wardenForwardToIGC_fld" data-lbl="Forward to IGC">
									                                <label class="custom-control-label" for="wardenForwardToIGC" style="font-weight: 500;">Forward to IGC</label>
									                            </div>
									                            <div class="d-flex align-items-center text-nowrap mt-3 col-md-9 col-lg-9 col-xl-5 px-0 floatingFields">
									                                <input type="text" class="form-control floatingLable rawField" aria-label="wardenDecisionBy" name="wardenDecisionBy" id="wardenDecisionBy" data-fld="wardenDecisionBy_fld" data-lbl="Decision By" value="" placeholder="">
									                                <label for="wardenDecisionBy" class="form-label mr-2 mb-0">Decision By</label>
									                            </div>
									                            <div class="floatingFieldsTextarea mt-3 mb-1 w-100">
									                                <textarea class="form-control rawField floatingLabletextarea" id="wardenComments" data-fld="wardenComments_fld" data-lbl="Comments" placeholder="" rows="2" name="wardenComments" aria-label="wardenComments" style="resize:none;" value=""></textarea>
									                                <label for="wardenComments" class="form-label mb-0">Comments</label>
									                            </div>
									                        </div>
									                    </div>
									                    <div class="col-lg-12 col-xl-5 px-0 mt-1">
									                        <div class="d-flex align-items-center">
									                            <h6 class="headerBlock text-center m-0" style="font-weight: 600;">Post Resolution</h6>
									                            <div class="custom-control custom-checkbox custom-control-inline text-nowrap ml-2">
									                                <input type="checkbox" class="custom-control-input rawField" id="wardenRequestToIGC" data-fld="wardenRequestToIGC_fld" data-lbl="Request to IGC">
									                                <label class="custom-control-label" for="wardenRequestToIGC" style="font-weight: 500;">Request to IGC</label>
									                            </div>
									                        </div>
									                        <div class="floatingFieldsTextarea mt-3 mb-1">
									                            <textarea class="form-control rawField floatingLabletextarea" id="wardenRequestComments" data-fld="wardenRequestComments_fld" data-lbl="Comments" placeholder="" rows="5" name="wardenRequestComments" aria-label="wardenRequestComments" style="resize:none;" value=""></textarea>
									                            <label for="wardenRequestComments" class="form-label mb-0">Comments</label>
									                        </div>
									                    </div>
									                    <div class="col-lg-12 px-0">
									                        <div class="d-flex align-items-center flex-wrap mt-1">
									                            <h6 class="headerBlock text-center m-0 text-nowrap" style="font-weight: 600;">Emergency Grievance</h6>
									                            <div class="custom-control custom-checkbox custom-control-inline text-nowrap ml-2">
									                                <input type="checkbox" class="custom-control-input rawField" id="emergencyRequestDenied" data-fld="emergencyRequestDenied_fld" data-lbl="Emergency Request Denied">
									                                <label class="custom-control-label" for="emergencyRequestDenied" style="font-weight: 500;">Emergency Request Denied</label>
									                            </div>
									                            <div class="d-flex align-items-center floatingFields w-25">
									                                <select class="form-control floatingLable rawField" aria-label="emergencyDenialReason" name="emergencyDenialReason" id="emergencyDenialReason" data-fld="emergencyDenialReason_fld" data-lbl="Reason for Denial">
									                                    <option value=""></option>
									                                    <option value="1">Not a emergency Grievance</option>
									                                </select>
									                                <label for="Security" class="form-label mr-2 mb-0 text-nowrap">Reason for Denial</label>
									                            </div>
									                            <div class="custom-control custom-checkbox custom-control-inline text-nowrap ml-2">
									                                <input type="checkbox" class="custom-control-input rawField" id="emergencySendBackToIGC" data-fld="emergencySendBackToIGC_fld" data-lbl="Send back to IGC">
									                                <label class="custom-control-label" for="emergencySendBackToIGC" style="font-weight: 500;">Send back to IGC</label>
									                            </div>
									                        </div>
									                        <div class="floatingFieldsTextarea mt-3 mb-1">
									                            <textarea class="form-control rawField floatingLabletextarea" id="emergencyComments" data-fld="emergencyComments_fld" data-lbl="Comments" placeholder="" rows="2" name="emergencyComments" aria-label="emergencyComments" style="resize:none;" value=""></textarea>
									                            <label for="emergencyComments" class="form-label mb-0">Comments</label>
									                        </div>
									                    </div>
									                </div>
									            </div>
									        </div>
									    </div>
									</div>
	                                <div id="AppealMainBlock" class="panel">
	                                    <div class="panel-hdr">
	                                        <h2>
	                                            Appeal
	                                        </h2>
	                                    </div>
	                                    <div class="panel-container show">
	                                        <div class="panel-content p-1">
	                                            <div id="js-checkbox-toggles">
	                                                <div class="pannel row p-1">
														<div class="col-lg-12">
															<div class="d-flex align-items-center text-nowrap pr-2">		
																<div class="d-flex align-items-center col-lg-3 pl-0 text-nowrap datePickerFloat mt-2">
																	<input type="date" class="form-control floatingLable rawField" placeholder="" name="appealDate" id="appealDate" data-fld = "appealDate_fld" data-lbl = "Date of Appeal" value="">
																	<label for="appealDate" class="form-label mr-1 mb-0">Date of Appeal</label>
																</div>
																<div class="custom-control custom-checkbox custom-control-inline text-nowrap mt-2">
																	<input type="checkbox" class="custom-control-input rawField" id="forwardToBGO" data-fld = "forwardToBGO_fld" data-lbl = "Forward to BGO">
																	<label class="custom-control-label" for="forwardToBGO" style="font-weight: 500;">Forward to BGO</label>
																</div>
																<div class="custom-control custom-checkbox custom-control-inline text-nowrap mt-2">
																	<input type="checkbox" class="custom-control-input rawField" id="forwardToBCEmergency" data-fld = "forwardToBCEmergency_fld" data-lbl = "Forward to BC (Emergency)">
																	<label class="custom-control-label" for="forwardToBCEmergency" style="font-weight: 500;">Forward to BC (Emergency)</label>
																</div>
															</div>
															<div class="floatingFieldsTextarea mt-3 mb-1">
																<textarea class="form-control rawField floatingLabletextarea" id="appealRequest" data-fld = "appealRequest_fld" data-lbl = "Appeal Request" placeholder="" rows="2" name="appealRequest" aria-label="appealRequest" style="resize:none;" value=""></textarea>
																<label for="appealRequest" class="form-label mb-0">Appeal Request</label>
															</div>
														</div>
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
									<div id="BGOMainBlock" class="panel">
									    <div class="panel-hdr">
									        <h2>
									            Bgo
									        </h2>
									    </div>
									    <div class="panel-container show">
									        <div class="panel-content p-1">
									            <div id="js-checkbox-toggles">
									                <div class="row mx-1 align-items-center">
									                    <div class="col-md-3 col-lg-3 col-xl-2 pl-0 text-nowrap datePickerFloat mt-2 position-relative">
									                        <input type="date" class="form-control floatingLable rawField" placeholder="" name="bgoDateReceived" id="bgoDateReceived" data-fld="bgoDateReceived_fld" data-lbl="Date Received" value="">
									                        <label for="bgoDateReceived" class="form-label mb-0">Date Received</label>
									                    </div>
									                    <div class="d-flex align-items-center text-nowrap col-md-9 mt-md-2 pl-md-0 col-lg-9 pl-lg-0 mt-lg-2 col-xl-6 pl-xl-0 mt-xl-2">
									                        <h6 class="headerBlock text-center m-0" style="font-weight: 600;">Vote on Inmate Request</h6>
									                        <div class="custom-control custom-radio mx-2">
									                            <input type="radio" class="custom-control-input rawField" id="bgoUphold" name="bgoVote" value="U" data-fld="bgoUphold_fld" data-lbl="Uphold">
									                            <label class="custom-control-label" for="bgoUphold">Uphold</label>
									                        </div>
									                        <div class="custom-control custom-radio">
									                            <input type="radio" class="custom-control-input rawField" id="bgoDeny" name="bgoVote" value="D" data-fld="bgoDeny_fld" data-lbl="Deny">
									                            <label class="custom-control-label" for="bgoDeny">Deny</label>
									                        </div>
									                        <div class="ml-1 text-nowrap datePickerFloat w-100 position-relative">
									                            <input type="date" class="form-control floatingLable rawField" placeholder="" name="bgoDecisionDate" id="bgoDecisionDate" data-fld="bgoDecisionDate_fld" data-lbl="Decision Date" value="">
									                            <label for="bgoDecisionDate" class="form-label mb-0">Decision Date</label>
									                        </div>
									                    </div>
									                    <div class="col-12 col-md-4 mt-md-3 pl-md-0 col-lg-3 mt-lg-3 pl-lg-0 col-xl-3 d-flex align-items-center floatingFields mt-xl-2 pl-xl-0">
									                        <input type="text" class="form-control floatingLable rawField" aria-label="Suffix" id="bgoDecisionBy" name="bgoDecisionBy" data-fld="bgoDecisionBy_fld" data-lbl="Decision By" value="" placeholder="" disabled="">
									                        <label for="bgoDecisionBy" class="form-label mr-1 text-nowrap">Decision By</label>
									                    </div>
									                    <div class="d-flex align-items-center px-0 col-md-2 col-lg-4 col-xl-1 mt-2">
									                        <label for="sex" class="form-label mr-2 mb-0" style="color: #9b7cca !important;">Referral</label>
									                        <span class="d-flex" data-toggle="modal" data-target="" title="Click to view refferal">
									                            <a href="#" type="button" id="historyButton" onclick="referralScroll()" class="btn btn-primary btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
									                                <i class="fa fa-users" aria-hidden="true"></i>
									                            </a>
									                        </span>
									                    </div>
									                    <div class="col-lg-12 px-0 mt-3 floatingFieldsTextarea">
									                        <textarea class="form-control rawField floatingLabletextarea" id="bgoComments" data-fld="bgoComments_fld" data-lbl="Comments" placeholder="" rows="5" name="bgoComments" aria-label="bgoComments" style="resize:none;" value=""></textarea>
									                        <label for="bgoComments" class="form-label mb-0">Comments</label>
									                    </div>
														<div class="d-flex align-items-center mt-2 col-lg-12 pl-0">
															<div class="custom-control custom-checkbox custom-control-inline text-nowrap ml-1">
																<input type="checkbox" class="custom-control-input rawField" id="bgoforwardToBC" data-fld = "bgoforwardToBC_fld" data-lbl = "Forward to BC">
																<label class="custom-control-label" for="bgoforwardToBC" style="font-weight: 500;">Forward to BC</label>
															</div>
															<div class="d-flex align-items-center col-md-3 col-lg-4 pl-0 text-nowrap datePickerFloat position-relative">
																<input type="date" class="form-control floatingLable rawField" placeholder="" name="bgoDateForwarded" id="bgoDateForwarded" data-fld = "bgoDateForwarded_fld" data-lbl = "Date Forwarded to BC" value="">
																<label for="bgoDateForwarded" class="form-label mb-0">Date Forwarded to BC</label>
															</div>
															</div>  
													</div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
									<div id="BureauChiefMainBlock" class="panel">
									    <div class="panel-hdr">
									        <h2>
									            Bureau Chief
									        </h2>
									    </div>
									    <div class="panel-container show">
									        <div class="panel-content p-1">
									            <div id="js-checkbox-toggles">
									                <div class="row mx-1 align-items-center">
									                    <div class="col-md-3 col-lg-3 col-xl-2 pl-0 text-nowrap datePickerFloat mt-2 position-relative">
									                        <input type="date" class="form-control floatingLable rawField" placeholder="" name="bureauDateReceived" id="bureauDateReceived" data-fld="bureauDateReceived_fld" data-lbl="Date Received" value="">
									                        <label for="bureauDateReceived" class="form-label mb-0">Date Received</label>
									                    </div>
									                    <div class="d-flex align-items-center text-nowrap col-md-9 mt-md-2 pl-md-0 col-lg-9 pl-lg-0 mt-lg-2 col-xl-6 pl-xl-0 mt-xl-2">
									                        <h6 class="headerBlock text-center m-0" style="font-weight: 600;">Vote on Inmate Request</h6>
									                        <div class="custom-control custom-radio mx-2">
									                            <input type="radio" class="custom-control-input rawField" id="bureauUphold" name="bureauVote" value="U" data-fld="bureauUphold_fld" data-lbl="Emergency">
									                            <label class="custom-control-label" for="bureauUphold">Uphold</label>
									                        </div>
									                        <div class="custom-control custom-radio">
									                            <input type="radio" class="custom-control-input rawField" id="bureauDeny" name="bureauVote" value="D" data-fld="bureauDeny_fld" data-lbl="Deny">
									                            <label class="custom-control-label" for="bureauDeny">Deny</label>
									                        </div>
									                        <div class="ml-1 text-nowrap datePickerFloat w-100 position-relative">
									                            <input type="date" class="form-control floatingLable rawField" placeholder="" name="bureauDecisionDate" id="bureauDecisionDate" data-fld="bureauDecisionDate_fld" data-lbl="Decision Date" value="">
									                            <label for="bureauDecisionDate" class="form-label mb-0">Decision Date</label>
									                        </div>
									                    </div>
									                    <div class="col-12 col-md-4 mt-md-3 pl-md-0 col-lg-3 mt-lg-3 pl-lg-0 col-xl-3 d-flex align-items-center floatingFields mt-xl-2 pl-xl-0">
									                        <input type="text" class="form-control floatingLable rawField" aria-label="bureauDecisionBy" id="bureauDecisionBy" data-fld="bureauDecisionBy_fld" data-lbl="Decision By" name="bureauDecisionBy" value="" placeholder="" disabled="">
									                        <label for="bureauDecisionBy" class="form-label mr-1 text-nowrap">Decision By</label>
									                    </div>
									                    <div class="d-flex align-items-center px-0 col-md-2 col-lg-4 col-xl-1 mt-2">
									                        <label for="sex" class="form-label mr-2 mb-0" style="color: #9b7cca !important;">Referral</label>
									                        <span class="d-flex" data-toggle="modal" data-target="" title="Click to view refferal">
									                            <a href="#" type="button" id="historyButton" onclick="referralScroll()" class="btn btn-primary btn-sm p-1 ml-1 btn js-waves-off d-flex align-items-center" data-class="nav-function-hidden">
									                                <i class="fa fa-users" aria-hidden="true"></i>
									                            </a>
									                        </span>
									                    </div>
									                    <div class="col-lg-12 px-0 mt-3 floatingFieldsTextarea">
									                        <textarea class="form-control rawField floatingLabletextarea" id="bureauComments" data-fld="bureauComments_fld" data-lbl="Comments" placeholder="" rows="5" name="Comments" aria-label="bureauComments" style="resize:none;" value=""></textarea>
									                        <label for="bureauComments" class="form-label mb-0">Comments</label>
									                    </div>
									                    <div class="d-flex align-items-center mt-2 col-lg-12 pl-0">
									                        <div class="custom-control custom-checkbox custom-control-inline text-nowrap ml-1">
									                            <input type="checkbox" class="custom-control-input rawField" id="burforwardToIGC" data-fld="burforwardToIGC_fld" data-lbl="Forward to IGC">
									                            <label class="custom-control-label" for="burforwardToIGC" style="font-weight: 500;">Forward to IGC</label>
									                        </div>
									                        <div class="col-md-3 col-lg-4 pl-0 text-nowrap datePickerFloat position-relative">
									                            <input type="date" class="form-control floatingLable rawField" placeholder="" name="bureauDateForwarded" id="bureauDateForwarded" data-fld="bureauDateForwarded_fld" data-lbl="Date Forwarded to IGC" value="">
									                            <label for="bureauDateForwarded" class="form-label mb-0">Date Forwarded to IGC</label>
									                        </div>
									                    </div>
									                </div>
									            </div>
									        </div>
									    </div>
									    
									</div>
									
									<div style="padding:15px 0px 15px 5px; display: flex; gap: 15px;">
								        <button class="btn btn-sm btn-primary" id="printReqBtn">Print Request Letter</button>
								        <button type="button" class="btn btn-sm btn-primary" onclick="referralScroll()">Referral</button>
								        <button class="btn btn-sm btn-primary" id="bureauChiefBtn">Bureau Chief Letter</button>
								    </div>

	                                
									<div class="modal fade" id="groupSupplementaryModal" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
											<div class="modal-content">
												<div class="modal-header pt-3 pb-2">
													<h6 class="modal-title"> Group / Supplementary Incident Details </h6>
													<button type="button" class="close" data-dismiss="modal" aria-label="Close">
														<span aria-hidden="true"><i class="fal fa-times"></i></span>
													</button>
												</div>
												<div class="modal-body py-0">
													<div id="groupSupplementaryTable"></div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button>
													<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
												</div>
											</div> 
										</div>	
									</div>
									
									<div class="modal fade" id="LSMEmemberModal" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
											<div class="modal-content">
												<div class="modal-header pt-3 pb-2">
													<h6 class="modal-title"> Select LSME Member </h6>
													<button type="button" class="close" data-dismiss="modal" aria-label="Close">
														<span aria-hidden="true"><i class="fal fa-times"></i></span>
													</button>
												</div>
												<div class="modal-body py-0">
													<!--<h6 class="m-0 headerBlock text-center" style="font-weight: 600;">LSME Member</h6>-->
													<div id="table-container">
														 <div id="lsmeMembers-table"></div>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary btn-sm" id="" data-toggle="modal" data-target="#namefromListModal" title="Click to select staff" >Add</button>
													<button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button>
													<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
												</div>
											</div> 
										</div>			
 									</div>
									
									<div class="modal fade" id="SelectRGCMember" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
											<div class="modal-content">
												<div class="modal-header pt-3 pb-2">
													<h6 class="modal-title"> Select RGC Member </h6>
													<button type="button" class="close" data-dismiss="modal" aria-label="Close">
														<span aria-hidden="true"><i class="fal fa-times"></i></span>
													</button>
												</div>
												<div class="modal-body py-0">
													<div id="rgcMembers-table"></div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary btn-sm" id="RGCrowAddBtn" >Add</button>
													<button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button>
													<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
												</div>
											</div> 
										</div>			
	     							</div>
									
									
										<div class="modal fade" id="SelectMGCMember" tabindex="-1" role="dialog" aria-hidden="true">
												<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
													<div class="modal-content">
														<div class="modal-header pt-3 pb-2">
															<h6 class="modal-title"> Select MGC Member </h6>
															<button type="button" class="close" data-dismiss="modal" aria-label="Close">
																<span aria-hidden="true"><i class="fal fa-times"></i></span>
															</button>
														</div>
														<div class="modal-body py-0">
															<div id="mgcMembers-table"></div>
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-primary btn-sm" id="MGCrowAddBtn" >Add</button>
															<button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button>
															<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
														</div>
													</div> 
												</div>			
				 							</div>	
																				
											<div class="modal fade" id="SelectRefMemberFindListModal" tabindex="-1" role="dialog" aria-hidden="true">
													<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
														<div class="modal-content">
															<div class="modal-header pt-3 pb-2">
																<h6 class="modal-title"> Select Name from the list </h6>
																<button type="button" class="close" data-dismiss="modal" aria-label="Close">
																	<span aria-hidden="true"><i class="fal fa-times"></i></span>
																</button>
															</div>
															<div class="modal-body py-0">
																<div class="row mx-1">
																	<div class="col-12 col-lg-12 col-md-12 d-flex align-items-center mt-2 px-0 floatingFields">
																		<input type="text" class="form-control w-100 floatingLable" aria-label="" id="" name="" value="" placeholder="%">
																		<label for="Name" class="form-label mr-1 text-nowrap mb-0">Find</label>
																		<button type="button" class="btn btn-primary btn-sm ml-2" id="fetchDataBtn">Find</button>
																	</div>
																	<div class="col-lg-12 mt-2 px-0">
																		<div id="refrefredselectName-table"></div>
																	</div>
																</div>
															</div>
															<div class="modal-footer">
																<!-- <button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button> -->
																<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
															</div>
														</div> 
													</div>			
			         							</div>
												
									<div class="modal fade" id="mgcUserSuffixModal" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
											<div class="modal-content">
												<div class="modal-header pt-3 pb-2">
													<h6 class="modal-title"> Select Name from the list </h6>
													<button type="button" class="close" data-dismiss="modal" aria-label="Close">
														<span aria-hidden="true"><i class="fal fa-times"></i></span>
													</button>
												</div>
												<div class="modal-body py-0">
													<div class="row mx-1">
														<div class="col-12 col-lg-12 col-md-12 d-flex align-items-center mt-2 px-0 floatingFields">
															<input type="text" class="form-control w-100 floatingLable" aria-label="" id="" name="" value="" placeholder="%">
															<label for="Name" class="form-label mr-1 text-nowrap mb-0">Find</label>
															<button type="button" class="btn btn-primary btn-sm ml-2" id="fetchDataBtn">Find</button>
														</div>
														<div class="col-lg-12 mt-2 px-0">
															<div id="mgcUserSuffixModal-table"></div>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<!-- <button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button> -->
													<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
												</div>
											</div> 
										</div>			
									</div>
																		
         							<div class="modal fade" id="rgcUserSuffixModal" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
											<div class="modal-content">
												<div class="modal-header pt-3 pb-2">
													<h6 class="modal-title"> Select Name from the list </h6>
													<button type="button" class="close" data-dismiss="modal" aria-label="Close">
														<span aria-hidden="true"><i class="fal fa-times"></i></span>
													</button>
												</div>
												<div class="modal-body py-0">
													<div class="row mx-1">
														<div class="col-12 col-lg-12 col-md-12 d-flex align-items-center mt-2 px-0 floatingFields">
															<input type="text" class="form-control w-100 floatingLable" aria-label="" id="" name="" value="" placeholder="%">
															<label for="Name" class="form-label mr-1 text-nowrap mb-0">Find</label>
															<button type="button" class="btn btn-primary btn-sm ml-2" id="fetchDataBtn">Find</button>
														</div>
														<div class="col-lg-12 mt-2 px-0">
															<div id="rgcUserSuffixModal-table"></div>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<!-- <button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button> -->
													<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
												</div>
											</div> 
										</div>			
         							</div>
									
									<div class="modal fade" id="selectNameFromlist" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-lg"
											role="document">
											<div class="modal-content">
												<div class="modal-header pb-1">
													<h4 class="modal-title">
														Select Name from the list
													</h4>
													<button type="button" class="close"
														data-dismiss="modal"
														aria-label="Close">
														<span aria-hidden="true"><i
																class="fal fa-times"></i></span>
													</button>
												</div>
												<div class="modal-body pt-0 pb-0">
													<div class="row mx-1">
														<div class="col-12 col-lg-12 col-md-12 d-flex align-items-center mt-2 px-0 floatingFields">
															<input type="text" class="form-control w-100 floatingLable" aria-label="" id="" name="" value="" placeholder="%">
															<label for="Name" class="form-label mr-1 text-nowrap mb-0">Find</label>
															<button type="button" class="btn btn-primary btn-sm ml-2" id="findButton">Find</button>
														</div>
														<div class="col-lg-12 mt-2 px-0">
															<div id="selectName-table"></div>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<!-- <button type="button" id="addCmntValBtn"
														class="btn btn-primary btn-sm"
														data-dismiss="modal">Ok</button> -->
													<button type="button"
														class="btn btn-secondary btn-sm"
														data-dismiss="modal">Cancel</button>
												</div>
											</div>
										</div>
									</div>
	     							<div class="modal fade" id="namefromListModal" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
											<div class="modal-content">
												<div class="modal-header pt-3 pb-2">
													<h6 class="modal-title"> Select Name from the list </h6>
													<button type="button" class="close" data-dismiss="modal" aria-label="Close">
														<span aria-hidden="true"><i class="fal fa-times"></i></span>
													</button>
												</div>
												<div class="modal-body py-0">
													<div class="row mx-1">
														<div class="col-12 col-lg-12 col-md-12 d-flex align-items-center mt-2 px-0 floatingFields">
															<input type="text" class="form-control w-100 floatingLable" aria-label="" id="staffSearchInput" name="" value="" placeholder="%">
															<label for="Name" class="form-label mr-1 text-nowrap mb-0">Find</label>
															<button type="button" class="btn btn-primary btn-sm waves-effect waves-themed ml-2" id="fetchDataBtn">Find</button>
														</div>
														<div class="col-lg-12 mt-2 px-0">
															<div id="individualselectName-table"></div>
														</div>
													</div>
												</div>
												<div class="modal-footer">
												    <!-- <button type="button" class="btn btn-primary btn-sm waves-effect waves-themed" id="fetchDataBtn" data-action="ok">Ok</button> -->
												    <button type="button" class="btn btn-secondary btn-sm waves-effect waves-themed" data-dismiss="modal">Cancel</button>
												</div>
											</div> 
										</div>			
	         						</div>	
					
		     							<div class="modal fade" id="userCommitteName" tabindex="-1" role="dialog" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
												<div class="modal-content">
													<div class="modal-header pt-3 pb-2">
														<h6 class="modal-title">Select Name from the list </h6>
														<button type="button" class="close" data-dismiss="modal" aria-label="Close">
															<span aria-hidden="true"><i class="fal fa-times"></i></span>
														</button>
													</div>
													<div class="modal-body py-0">
														<div class="row mx-1">
															<div class="col-12 col-lg-12 col-md-12 d-flex align-items-center mt-2 px-0 floatingFields">
																<input type="text" class="form-control w-100 floatingLable" aria-label="" id="" name="" value="" placeholder="%">
																<label for="Name" class="form-label mr-1 text-nowrap mb-0">Find</label>
																<button type="button" class="btn btn-primary btn-sm ml-2" id="fetchDataBtn">Find</button>
															</div>
															<div class="col-lg-12 mt-2 px-0">
																<div id="refCommitteselectName-table"></div>
															</div>
														</div>
													</div>
													<div class="modal-footer">
														<!-- <button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button> -->
														<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
													</div>
												</div> 
											</div>			
			         					</div>
										
										<div class="modal fade" id="attachDocumentModal" tabindex="-1" role="dialog" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
												<div class="modal-content">
													<div class="modal-header pt-3 pb-2">
														<h6 class="modal-title">Attach Document</h6>
														<button type="button" class="close" data-dismiss="modal" aria-label="Close">
															<span aria-hidden="true"><i class="fal fa-times"></i></span>
														</button>
													</div>
													<div class="modal-body py-0">
														<div class="row mx-1">
															<div class="col-lg-12 mt-2 px-0">
																<div id="attachDocument-table"></div>
																<textarea class="form-control mt-2" id="attachDocumentDescription" placeholder="Description" rows="3"></textarea>
															</div>
														</div>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-primary btn-sm" id="addMoreFilesBtn" data-action="">Add More Files</button>
														<button type="button" class="btn btn-primary btn-sm" id="attachBtn" data-action="">Attach</button>
														<button type="button" class="btn btn-primary btn-sm" id="clearAttachBtn" data-action="">Clear</button>
														<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
													</div>
												</div>
											</div>
										</div>
										
										<div class="modal fade" id="RefuserCommitteName" tabindex="-1" role="dialog" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
												<div class="modal-content">
													<div class="modal-header pt-3 pb-2">
														<h6 class="modal-title">User Name / Committee Name</h6>
														<button type="button" class="close" data-dismiss="modal" aria-label="Close">
															<span aria-hidden="true"><i class="fal fa-times"></i></span>
														</button>
													</div>
													<div class="modal-body py-0">
														<div class="row mx-1">
															<div class="col-12 col-lg-12 col-md-12 d-flex align-items-center mt-2 px-0 floatingFields">
																<input type="text" class="form-control w-100 floatingLable" aria-label="" id="" name="" value="" placeholder="%">
																<label for="Name" class="form-label mr-1 text-nowrap mb-0">Find</label>
																<button type="button" class="btn btn-primary btn-sm ml-2" id="fetchDataBtn">Find</button>
															</div>
															<div class="col-lg-12 mt-2 px-0">
																<div id="refCommitte-table"></div>
															</div>
														</div>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-primary btn-sm" id="fetchDataBtn" data-action="ok">Ok</button>
														<!-- <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button> -->
													</div>
												</div> 
											</div>			
			         					</div>

			         					<div class="panel d-none">
											<div class="panel-content">
												<ul class="nav nav-tabs position-relative" role="tablist">
													<li class="nav-item"><a class="nav-link active" data-toggle="tab"
															href="#Grievance_Tab" role="tab">Grievance</a></li>
													<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#LSME_Tab" role="tab">LSME</a></li>
															<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#IGC_Tab" role="tab">IGC</a></li>
															<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#LSME" role="tab">RGC/SME</a></li>
															<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#LSME" role="tab">MGC</a></li>
															<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#LSME" role="tab">Referral</a></li>
															<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#LSME" role="tab">Warden/BSME</a></li>
															<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#LSME" role="tab">Appeal</a></li>
															<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#LSME" role="tab">BGO</a></li>
															<li class="nav-item"><a class="nav-link" data-toggle="tab"
															href="#LSME" role="tab">Bureau Chief</a></li>
															
												</ul>
												<div class="tab-content px-0" style="padding-top: 5px!important;">
													<div class="tab-pane fade show active" id="Grievance_Tab" role="tabpanel">
														
													</div>
													<div class="tab-pane fade" id="LSME_Tab" role="tabpanel">
														
													</div>
													<div class="tab-pane fade" id="IGC_Tab" role="tabpanel">
														
													</div>
												</div>
											</div>
										</div>	
		         					 </div>
								
								
								</div>
							</div>
						</div>
					</div>
				</main>
				<!-- this overlay is activated only when mobile menu is triggered -->
				<div class="page-content-overlay" data-action="toggle" data-class="mobile-nav-on"></div>
				<!-- END Page Content -->
				<!-- BEGIN Page Footer -->
				<!--<div th:replace="~{fragments/footer :: footer}"></div>-->
				<!-- END Page Footer -->
				<!-- Modal Large -->
				<div class="modal fade" id="default-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
					<div class="modal-dialog modal-lg" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title">Staff Name</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true"><i class="fal fa-times"></i></span>
								</button>
							</div>
							<div class="modal-body">
								<div class="form-group row">
									<label for="staffSearch"
										class="col-form-label col-12 col-lg-1 form-label">Search</label>
									<div class="col-12 col-lg-11">
										<input type="text" class="form-control" aria-label="staffSearch"
											name="staffSearch" id="staffSearch" value="">
									</div>

								</div>
								<div class="table-responsive-lg">
									<table class="table table-bordered m-0">
										<thead>
											<tr>
												<th>Last Name</th>
												<th>First Name</th>
												<th>MI</th>
												<th>Suffix</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>

										</tbody>
									</table>
								</div>
							</div>

						</div>
					</div>
				</div>
				<!-- BEGIN Shortcuts -->
				<!-- modal shortcut -->
				<div class="modal fade modal-backdrop-transparent" id="modal-shortcut" tabindex="-1" role="dialog"
					aria-labelledby="modal-shortcut" aria-hidden="true">
					<div class="modal-dialog modal-dialog-top modal-transparent" role="document">
						<div class="modal-content">
							<div class="modal-body">
								<ul class="app-list w-auto h-auto p-0 text-left">
									<li>
										<a href="intel_introduction.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-3x opacity-100 color-primary-500 "></i>
												<i class="base base-7 icon-stack-2x opacity-100 color-primary-300 "></i>
												<i class="fal fa-home icon-stack-1x opacity-100 color-white"></i>
											</div>
											<span class="app-list-name">
												Home
											</span>
										</a>
									</li>
									<li>
										<a href="page_inbox_general.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-3x opacity-100 color-success-500 "></i>
												<i class="base base-7 icon-stack-2x opacity-100 color-success-300 "></i>
												<i class="ni ni-envelope icon-stack-1x text-white"></i>
											</div>
											<span class="app-list-name">
												Inbox
											</span>
										</a>
									</li>
									<li>
										<a href="intel_introduction.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-2x opacity-100 color-primary-300 "></i>
												<i class="fal fa-plus icon-stack-1x opacity-100 color-white"></i>
											</div>
											<span class="app-list-name">
												Add More
											</span>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div> <!-- END Shortcuts -->
			</div>
		</div>
	</div>
	<!-- END Page Wrapper -->
	<!-- BEGIN Quick Menu -->
	<!-- to add more items, please make sure to change the variable '$menu-items: number;' in your _page-components-shortcut.scss -->
	<nav class="shortcut-menu d-none d-sm-block"> <input
	type="checkbox" class="menu-open" name="menu-open" id="menu_open" />
	<label for="menu_open" class="menu-open-button "> <span
	class="app-shortcut-icon d-block"></span>
	</label> <a href="#" class="menu-item btn" data-toggle="tooltip"
	data-placement="left" title="Scroll Top"> <i
	class="fal fa-arrow-up"></i>
	</a> <a href="page_login-alt.html" class="menu-item btn"
	data-toggle="tooltip" data-placement="left" title="Logout"> <i
	class="fal fa-sign-out"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-fullscreen"
	data-toggle="tooltip" data-placement="left" title="Full Screen"> <i
	class="fal fa-expand"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-print"
	data-toggle="tooltip" data-placement="left" title="Print page"> <i
	class="fal fa-print"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-voice"
	data-toggle="tooltip" data-placement="left" title="Voice command">
	<i class="fal fa-microphone"></i>
	</a> </nav>
	<!-- END Quick Menu -->
	<!-- BEGIN Messenger -->
	<div class="modal fade js-modal-messenger modal-backdrop-transparent" tabindex="-1" role="dialog"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-right">
			<div class="modal-content h-100">
				<div class="dropdown-header bg-trans-gradient d-flex align-items-center w-100">
					<div class="d-flex flex-row align-items-center mt-1 mb-1 color-white">
						<span class="mr-2">
							<span class="rounded-circle profile-image d-block"
								style="background-image:url('img/demo/avatars/avatar-d.png'); background-size: cover;"></span>
						</span>
						<div class="info-card-text">
							<a href="javascript:void(0);" class="fs-lg text-truncate text-truncate-lg text-white"
								data-toggle="dropdown" aria-expanded="false">
								Tracey Chang
								<i class="fal fa-angle-down d-inline-block ml-1 text-white fs-md"></i>
							</a>
							<div class="dropdown-menu">
								<a class="dropdown-item" href="#">Send Email</a>
								<a class="dropdown-item" href="#">Create Appointment</a>
								<a class="dropdown-item" href="#">Block User</a>
							</div>
							<span class="text-truncate text-truncate-md opacity-80">IT Director</span>
						</div>
					</div>
					<button type="button" class="close text-white position-absolute pos-top pos-right p-2 m-1 mr-2"
						data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true"><i class="fal fa-times"></i></span>
					</button>
				</div>
				<div class="modal-body p-0 h-100 d-flex">
					<!-- BEGIN msgr-list -->
					<div
						class="msgr-list d-flex flex-column bg-faded border-faded border-top-0 border-right-0 border-bottom-0 position-absolute pos-top pos-bottom">
						<div>
							<div
								class="height-4 width-3 h3 m-0 d-flex justify-content-center flex-column color-primary-500 pl-3 mt-2">
								<i class="fal fa-search"></i>
							</div>
							<input type="text" class="form-control bg-white" id="msgr_listfilter_input"
								name="msgr_listfilter_input" placeholder="Filter contacts" aria-label="FilterSearch"
								value="" data-listfilter="#js-msgr-listfilter">
						</div>
						<div class="flex-1 h-100 custom-scroll">
							<div class="w-100">
								<ul id="js-msgr-listfilter" class="list-unstyled m-0">
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="tracey chang online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-d.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Tracey Chang
													<small class="d-block font-italic text-success fs-xs">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="oliver kopyuv online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-b.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Oliver Kopyuv
													<small class="d-block font-italic text-success fs-xs">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="dr john cook phd away">
											<div class="d-table-cell align-middle status status-warning status-sm ">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-e.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Dr. John Cook PhD
													<small class="d-block font-italic fs-xs">
														Away
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-g.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Ali Amdaney
													<small class="d-block font-italic fs-xs text-success">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="sarah mcbrook online">
											<div class="d-table-cell align-middle status status-success status-sm">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-h.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Sarah McBrook
													<small class="d-block font-italic fs-xs text-success">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney offline">
											<div class="d-table-cell align-middle status status-sm">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-a.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs">
														Offline
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney busy">
											<div class="d-table-cell align-middle status status-danger status-sm">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-j.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs text-danger">
														Busy
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney offline">
											<div class="d-table-cell align-middle status status-sm">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-c.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs">
														Offline
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney inactive">
											<div class="d-table-cell align-middle">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-m.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													+714651347790
													<small class="d-block font-italic fs-xs opacity-50">
														Missed Call
													</small>
												</div>
											</div>
										</a>
									</li>
								</ul>
								<div class="filter-message js-filter-message"></div>
							</div>
						</div>
						<div>
							<a class="fs-xl d-flex align-items-center p-3">
								<i class="fal fa-cogs"></i>
							</a>
						</div>
					</div>
					<!-- END msgr-list -->
					<!-- BEGIN msgr -->
					<div class="msgr d-flex h-100 flex-column bg-white">
						<!-- BEGIN custom-scroll -->
						<div class="custom-scroll flex-1 h-100">
							<div id="chat_container" class="w-100 p-4">
								<!-- start .chat-segment -->
								<div class="chat-segment">
									<div class="time-stamp text-center mb-2 fw-400">
										Jun 19
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent">
									<div class="chat-message">
										<p>
											Hey Ching, did you get my files?
										</p>
									</div>
									<div class="text-right fw-300 text-muted mt-1 fs-xs">
										3:00 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get">
									<div class="chat-message">
										<p>
											Hi
										</p>
										<p>
											Sorry going through a busy time in office. Yes I analyzed the solution.
										</p>
										<p>
											It will require some resource, which I could not manage.
										</p>
									</div>
									<div class="fw-300 text-muted mt-1 fs-xs">
										3:24 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent chat-start">
									<div class="chat-message">
										<p>
											Okay
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent chat-end">
									<div class="chat-message">
										<p>
											Sending you some dough today, you can allocate the resources to this
											project.
										</p>
									</div>
									<div class="text-right fw-300 text-muted mt-1 fs-xs">
										3:26 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get chat-start">
									<div class="chat-message">
										<p>
											Perfect. Thanks a lot!
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get">
									<div class="chat-message">
										<p>
											I will have them ready by tonight.
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get chat-end">
									<div class="chat-message">
										<p>
											Cheers
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment for timestamp -->
								<div class="chat-segment">
									<div class="time-stamp text-center mb-2 fw-400">
										Jun 20
									</div>
								</div>
								<!--  end .chat-segment for timestamp -->
							</div>
						</div>
						<!-- END custom-scroll  -->
						<!-- BEGIN msgr__chatinput -->
						<div class="d-flex flex-column">
							<div
								class="border-faded border-right-0 border-bottom-0 border-left-0 flex-1 mr-3 ml-3 position-relative shadow-top">
								<div class="pt-3 pb-1 pr-0 pl-0 rounded-0" tabindex="-1">
									<div id="msgr_input" contenteditable="true"
										data-placeholder="Type your message here..."
										class="height-10 form-content-editable"></div>
								</div>
							</div>
							<div class="height-8 px-3 d-flex flex-row align-items-center flex-wrap flex-shrink-0">
								<a href="javascript:void(0);" class="btn btn-icon fs-xl width-1 mr-1"
									data-toggle="tooltip" data-original-title="More options" data-placement="top">
									<i class="fal fa-ellipsis-v-alt color-fusion-300"></i>
								</a>
								<a href="javascript:void(0);" class="btn btn-icon fs-xl mr-1" data-toggle="tooltip"
									data-original-title="Attach files" data-placement="top">
									<i class="fal fa-paperclip color-fusion-300"></i>
								</a>
								<a href="javascript:void(0);" class="btn btn-icon fs-xl mr-1" data-toggle="tooltip"
									data-original-title="Insert photo" data-placement="top">
									<i class="fal fa-camera color-fusion-300"></i>
								</a>
								<div class="ml-auto">
									<a href="javascript:void(0);" class="btn btn-info">Send</a>
								</div>
							</div>
						</div>
						<!-- END msgr__chatinput -->
					</div>
					<!-- END msgr -->
				</div>
			</div>
		</div>
	</div>
	<!-- END Messenger -->
	<!-- BEGIN Page Settings -->
	<div class="modal fade js-modal-settings modal-backdrop-transparent" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog modal-dialog-right modal-md">
			<div class="modal-content">
				<div class="dropdown-header bg-trans-gradient d-flex justify-content-center align-items-center w-100">
					<h4 class="m-0 text-center color-white">
						Layout Settings
						<small class="mb-0 opacity-80">User Interface Settings</small>
					</h4>
					<button type="button" class="close text-white position-absolute pos-top pos-right p-2 m-1 mr-2"
						data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true"><i class="fal fa-times"></i></span>
					</button>
				</div>
				<div class="modal-body p-0">
					<div class="settings-panel">
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									App Layout
								</h5>
							</div>
						</div>
						<div class="list" id="fh">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="header-function-fixed"></a>
							<span class="onoffswitch-title">Fixed Header</span>
							<span class="onoffswitch-title-desc">header is in a fixed at all times</span>
						</div>
						<div class="list" id="nff">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="nav-function-fixed"></a>
							<span class="onoffswitch-title">Fixed Navigation</span>
							<span class="onoffswitch-title-desc">left panel is fixed</span>
						</div>
						<div class="list" id="nfm">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="nav-function-minify"></a>
							<span class="onoffswitch-title">Minify Navigation</span>
							<span class="onoffswitch-title-desc">Skew nav to maximize space</span>
						</div>
						<div class="list" id="nfh">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="nav-function-hidden"></a>
							<span class="onoffswitch-title">Hide Navigation</span>
							<span class="onoffswitch-title-desc">roll mouse on edge to reveal</span>
						</div>
						<div class="list" id="nft">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="nav-function-top"></a>
							<span class="onoffswitch-title">Top Navigation</span>
							<span class="onoffswitch-title-desc">Relocate left pane to top</span>
						</div>
						<div class="list" id="mmb">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-main-boxed"></a>
							<span class="onoffswitch-title">Boxed Layout</span>
							<span class="onoffswitch-title-desc">Encapsulates to a container</span>
						</div>
						<div class="expanded">
							<ul class="">
								<li>
									<div class="bg-fusion-50" data-action="toggle" data-class="mod-bg-1"></div>
								</li>
								<li>
									<div class="bg-warning-200" data-action="toggle" data-class="mod-bg-2"></div>
								</li>
								<li>
									<div class="bg-primary-200" data-action="toggle" data-class="mod-bg-3"></div>
								</li>
								<li>
									<div class="bg-success-300" data-action="toggle" data-class="mod-bg-4"></div>
								</li>
							</ul>
							<div class="list" id="mbgf">
								<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
									data-class="mod-fixed-bg"></a>
								<span class="onoffswitch-title">Fixed Background</span>
							</div>
						</div>
						<!-- <div class="mt-4 d-table w-100 px-5">
                            <div class="d-table-cell align-middle">
                                <h5 class="p-0">
                                    Mobile Menu
                                </h5>
                            </div>
                        </div>
                        <div class="list" id="nmp">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
                                data-class="nav-mobile-push"></a>
                            <span class="onoffswitch-title">Push Content</span>
                            <span class="onoffswitch-title-desc">Content pushed on menu reveal</span>
                        </div>
                        <div class="list" id="nmno">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
                                data-class="nav-mobile-no-overlay"></a>
                            <span class="onoffswitch-title">No Overlay</span>
                            <span class="onoffswitch-title-desc">Removes mesh on menu reveal</span>
                        </div>
                        <div class="list" id="sldo">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
                                data-class="nav-mobile-slide-out"></a>
                            <span class="onoffswitch-title">Off-Canvas <sup>(beta)</sup></span>
                            <span class="onoffswitch-title-desc">Content overlaps menu</span>
                        </div> -->
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Accessibility
								</h5>
							</div>
						</div>
						<div class="list" id="mbf">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-bigger-font"></a>
							<span class="onoffswitch-title">Bigger Content Font</span>
							<span class="onoffswitch-title-desc">content fonts are bigger for readability</span>
						</div>
						<div class="list" id="mhc">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-high-contrast"></a>
							<span class="onoffswitch-title">High Contrast Text (WCAG 2 AA)</span>
							<span class="onoffswitch-title-desc">4.5:1 text contrast ratio</span>
						</div>
						<div class="list" id="mcb">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-color-blind"></a>
							<span class="onoffswitch-title">Daltonism <sup>(beta)</sup> </span>
							<span class="onoffswitch-title-desc">color vision deficiency</span>
						</div>
						<div class="list" id="mpc">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-pace-custom"></a>
							<span class="onoffswitch-title">Preloader Inside</span>
							<span class="onoffswitch-title-desc">preloader will be inside content</span>
						</div>
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Global Modifications
								</h5>
							</div>
						</div>
						<div class="list" id="mcbg">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-clean-page-bg"></a>
							<span class="onoffswitch-title">Clean Page Background</span>
							<span class="onoffswitch-title-desc">adds more whitespace</span>
						</div>
						<div class="list" id="mhni">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-hide-nav-icons"></a>
							<span class="onoffswitch-title">Hide Navigation Icons</span>
							<span class="onoffswitch-title-desc">invisible navigation icons</span>
						</div>
						<div class="list" id="dan">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-disable-animation"></a>
							<span class="onoffswitch-title">Disable CSS Animation</span>
							<span class="onoffswitch-title-desc">Disables CSS based animations</span>
						</div>
						<div class="list" id="mhic">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-hide-info-card"></a>
							<span class="onoffswitch-title">Hide Info Card</span>
							<span class="onoffswitch-title-desc">Hides info card from left panel</span>
						</div>
						<div class="list" id="mlph">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-lean-subheader"></a>
							<span class="onoffswitch-title">Lean Subheader</span>
							<span class="onoffswitch-title-desc">distinguished page header</span>
						</div>
						<div class="list" id="mnl">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-nav-link"></a>
							<span class="onoffswitch-title">Hierarchical Navigation</span>
							<span class="onoffswitch-title-desc">Clear breakdown of nav links</span>
						</div>
						<div class="list mt-1">
							<span class="onoffswitch-title">Global Font Size <small>(RESETS ON REFRESH)</small> </span>
							<div class="btn-group btn-group-sm btn-group-toggle my-2" data-toggle="buttons">
								<label for="smRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
									data-class="root-text-sm" data-target="html">
									<input type="radio" aria-label="smRadio" name="smRadio" id="smRadio" value=""> SM
								</label>
								<label for="mdRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
									data-class="root-text" data-target="html">
									<input type="radio" aria-label="mdRadio" name="mdRadio" id="mdRadio" value=""
										checked=""> MD
								</label>
								<label for="lgRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
									data-class="root-text-lg" data-target="html">
									<input type="radio" aria-label="lgRadio" name="lgRadio" id="lgRadio" value=""> LG
								</label>
								<label for="xlRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
									data-class="root-text-xl" data-target="html">
									<input type="radio" aria-label="xlRadio" name="xlRadio" id="xlRadio" value=""> XL
								</label>
							</div>
							<span class="onoffswitch-title-desc d-block mb-g">Change <strong>root</strong> font size to
								effect rem values</span>
						</div>
						<div class="mt-2 d-table w-100 pl-5 pr-3">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Theme colors <small>(overlays base css)</small>
								</h5>
								<!-- <div class="fs-xs text-muted p-2 alert alert-warning mt-3 mb-0">
                                    <i class="fal fa-exclamation-triangle text-warning mr-2"></i>Due to network latency
                                    and CPU utilization, you may experience a brief flickering effect on page load which
                                    may show the intial applied theme for a split second. Setting the prefered
                                    style/theme in the header will prevent this from happening.
                                </div> -->
							</div>
						</div>
						<div id="loadingSpinner" class="spinner-container" style="display: none;">
						    <div class="spinner"></div>
						</div>
						<div class="expanded theme-colors pl-5 pr-3">
							<ul class="m-0">
								<li><a href="#" id="myapp-0" data-action="theme-update" data-themesave data-theme=""
										data-toggle="tooltip" data-placement="top" title="Wisteria (base css)"
										data-original-title="Wisteria (base css)"></a></li>
								<li><a href="#" id="myapp-1" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-1.css" data-toggle="tooltip"
										data-placement="top" title="Tapestry" data-original-title="Tapestry"></a></li>
								<li><a href="#" id="myapp-2" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-2.css" data-toggle="tooltip"
										data-placement="top" title="Atlantis" data-original-title="Atlantis"></a></li>
								<li><a href="#" id="myapp-3" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-3.css" data-toggle="tooltip"
										data-placement="top" title="Indigo" data-original-title="Indigo"></a></li>
								<li><a href="#" id="myapp-4" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-4.css" data-toggle="tooltip"
										data-placement="top" title="Dodger Blue" data-original-title="Dodger Blue"></a>
								</li>
								<li><a href="#" id="myapp-5" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-5.css" data-toggle="tooltip"
										data-placement="top" title="Tradewind" data-original-title="Tradewind"></a></li>
								<li><a href="#" id="myapp-6" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-6.css" data-toggle="tooltip"
										data-placement="top" title="Cranberry" data-original-title="Cranberry"></a></li>
								<li><a href="#" id="myapp-7" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-7.css" data-toggle="tooltip"
										data-placement="top" title="Oslo Gray" data-original-title="Oslo Gray"></a></li>
								<li><a href="#" id="myapp-8" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-8.css" data-toggle="tooltip"
										data-placement="top" title="Chetwode Blue"
										data-original-title="Chetwode Blue"></a></li>
								<li><a href="#" id="myapp-9" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-9.css" data-toggle="tooltip"
										data-placement="top" title="Apricot" data-original-title="Apricot"></a></li>
								<li><a href="#" id="myapp-10" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-10.css" data-toggle="tooltip"
										data-placement="top" title="Blue Smoke" data-original-title="Blue Smoke"></a>
								</li>
								<li><a href="#" id="myapp-11" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-11.css" data-toggle="tooltip"
										data-placement="top" title="Green Smoke" data-original-title="Green Smoke"></a>
								</li>
								<li><a href="#" id="myapp-12" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-12.css" data-toggle="tooltip"
										data-placement="top" title="Wild Blue Yonder"
										data-original-title="Wild Blue Yonder"></a></li>
								<li><a href="#" id="myapp-13" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-13.css" data-toggle="tooltip"
										data-placement="top" title="Emerald" data-original-title="Emerald"></a></li>
							</ul>
						</div>
						<hr class="mb-0 mt-4">
						<div class="pl-5 pr-3 py-3 bg-faded">
							<div class="row no-gutters">
								<div class="col-6 pr-1">
									<a href="#" class="btn btn-outline-danger fw-500 btn-block"
										data-action="app-reset">Reset Settings</a>
								</div>
								<div class="col-6 pl-1">
									<a href="#" class="btn btn-danger fw-500 btn-block"
										data-action="factory-reset">Factory Reset</a>
								</div>
							</div>
						</div>
					</div>
					<span id="saving"></span>
				</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="grievanceTypeChangeModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Reason for Grievance Type changed</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="grievanceTypeChangeForm">
                    <div class="form-group">
                        <label for="changeDate" style="color: #7a59ad; font-weight: 500;">Date</label>
                        <input type="text" readonly class="form-control" id="changeDate" style="color: #000000; background-color: #e9ecef;">
                    </div>
                    <div class="form-group">
                        <label for="changedByUser" style="color: #7a59ad; font-weight: 500;">Changed By</label>
                        <input type="text" readonly class="form-control" id="changedByUser" style="color: #000000; background-color: #e9ecef;">
                    </div>
                    <div class="form-group">
                        <label for="currentGrievanceType" style="color: #7a59ad; font-weight: 500;">Current Grievance Type</label>
                        <input type="text" readonly class="form-control" id="currentGrievanceType" style="color: #000000; background-color: #e9ecef;">
                    </div>
                    <div class="form-group">
                        <label for="newGrievanceType" style="color: #7a59ad; font-weight: 500;">New Grievance Type</label>
                        <input type="text" readonly class="form-control" id="newGrievanceType" style="color: #000000; background-color: #e9ecef;">
                    </div>
                    <div class="form-group mb-0">
                        <label for="changeReasonText" style="color: #7a59ad; font-weight: 500;">Reason for Type changed</label>
                        <textarea class="form-control" id="changeReasonText" rows="4" placeholder="Enter reason here..." style="color: #000000;"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="saveGrievanceTypeChange">Ok/Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel/Exit</button>
            </div>
        </div>
    </div>
</div>
<div id="custom-tooltip" style="position: absolute; display: none; padding: 5px; background-color:white; color: black; border:1px solid black; z-index: 10000; pointer-events: none;"></div>
	<div class="modal fade" id="abandonmentModal" tabindex="-1" role="dialog" aria-labelledby="abandonmentModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="abandonmentModalLabel">Reason for Abandonment</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		                    <span aria-hidden="true">×</span>
		                </button>
		            </div>
		            <div class="modal-body">
		                <form id="abandonmentForm">
		                    <div class="form-group">
		                        <label for="abandonmentReason" class="form-label mr-1 mb-0">Reason for Abandonment</label>
		                        <select class="custom-select form-control typecontact" id="abandonmentReason">
		                            <option value=""></option>
		                            </select>
		                    </div>
		                    <div class="form-group">
		                        <label for="abandonmentComments">Comments</label>
		                        <textarea class="form-control" id="abandonmentComments" rows="8"></textarea>
		                    </div>
		                </form>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-primary" id="abandonmentOkSaveBtn">Ok/Save</button>
		                <button type="button" class="btn btn-secondary" id="abandonmentCancelBtn">Cancel/Exit</button>
		            </div>
		        </div>
		    </div>
	</div>
	
	<div class="modal fade" id="returnCorrespondenceModal" tabindex="-1" role="dialog" aria-labelledby="returnCorrespondenceModalLabel" aria-hidden="true">
	            <div class="modal-dialog modal-lg" role="document">
	                <div class="modal-content">
	                    <div class="modal-header">
	                        <h5 class="modal-title" id="returnCorrespondenceModalLabel">Return with Correspondence</h5>
	                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                            <span aria-hidden="true">×</span>
	                        </button>
	                    </div>
	                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
	                        <form id="returnCorrespondenceForm">
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcVulgar" name="returnReason" class="custom-control-input" value="vulgar">
	                                    <label class="custom-control-label" for="rcVulgar"><strong>Vulgar/Abusive or Threatening Language.</strong> Per BOP Policy 4.4 "Inmate Grievance Policy" grievances submitted using vulgar abusive, or threatening language will not be processed. The unacceptable language is highlighted. The grievance may be resubmitted omitting this language.</label>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcDisciplinary" name="returnReason" class="custom-control-input" value="disciplinary">
	                                    <label class="custom-control-label" for="rcDisciplinary"><strong>Disciplinary Action.</strong> Disciplinary action may not be appealed through the grievance system. Appeals of disciplinary actions must be sent to the Disciplinary Hearing Officer within 15 days of receipt of the Disciplinary Hearing Decision Form using the Disciplinary Hearing Appeal Form. Refer to BOP Policy 4.2 "Rules of Conduct" on how to appeal. Disciplinary #</label>
	                                    <input type="text" class="form-control form-control-sm ml-3 mt-1" id="rcDisciplinaryNumber" style="width: 200px; display: inline-block;" placeholder="Enter Disciplinary #" disabled>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcParole" name="returnReason" class="custom-control-input" value="parole">
	                                    <label class="custom-control-label" for="rcParole"><strong>Parole Decision.</strong> Issues with decisions of the Parole Board should be directed to the Board of Parole in writing to:<br>
	                                    <span style="padding-left: 20px;">Carvel State Office Building - 4th Floor</span><br>
	                                    <span style="padding-left: 20px;">820 North French Street</span><br>
	                                    <span style="padding-left: 20px;">Wilmington, DE 19801</span></label>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcClassification" name="returnReason" class="custom-control-input" value="classification">
	                                    <label class="custom-control-label" for="rcClassification"><strong>Classification Action.</strong> Classification decisions may not be appealed through the grievance system. Written appeals must be within 10-days of receipt of the decision of the committee/board. IBCC decisions shall be directed to the facility Warden/designee. CICB decisions shall be directed to the Classification Administrator. Refer to BOP Policy 3.3 "Classification" on how to appeal.</label>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcProhibitedMail" name="returnReason" class="custom-control-input" value="prohibited_mail">
	                                    <label class="custom-control-label" for="rcProhibitedMail"><strong>Prohibited Mail.</strong> Decisions on prohibited mail may not be appealed through the grievance system. Written appeals on prohibited mail must be directed to the facility Warden. Refer to BOP Policy 8.92 "Mailroom Operations" on how to appeal.</label>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcDuplicate" name="returnReason" class="custom-control-input" value="duplicate">
	                                    <label class="custom-control-label" for="rcDuplicate"><strong>Duplicate Grievance(s).</strong> This issue has been addressed previously in Grievance #</label>
	                                    <input type="text" class="form-control form-control-sm ml-3 mt-1" id="rcDuplicateGrievanceNumber" style="width: 200px; display: inline-block;" placeholder="Enter Grievance #" disabled>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcOriginal" name="returnReason" class="custom-control-input" value="original">
	                                    <label class="custom-control-label" for="rcOriginal"><strong>Original Grievances</strong> must be submitted to the Inmate Grievance Chairperson. Photocopies are not accepted. The grievance may be resubmitted on the original form.</label>
	                                </div>
	                            </div>
	                             <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcInquiryOther" name="returnReason" class="custom-control-input" value="inquiry_other">
	                                    <label class="custom-control-label" for="rcInquiryOther"><strong>Inquiry on behalf of other Inmates.</strong> Inmate cannot submit grievances for other Inmates.</label>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcExpiredFiling" name="returnReason" class="custom-control-input" value="expired_filing">
	                                    <label class="custom-control-label" for="rcExpiredFiling"><strong>Expired Filing period.</strong> The grievance was not submitted within seven (7) days of the incident as required in BOP Policy 4.4 "Inmate Grievance Policy."</label>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcAbuse" name="returnReason" class="custom-control-input" value="abuse">
	                                    <label class="custom-control-label" for="rcAbuse"><strong>Abuse:</strong> Your use of the grievance process has been determined to be abusive. During the restriction period all grievances lodged in excess of the authorized amount shall be returned.</label>
	                                </div>
	                            </div>
	                            <div class="form-group">
	                                <div class="custom-control custom-radio">
	                                    <input type="radio" id="rcOtherRadio" name="returnReason" class="custom-control-input" value="other">
	                                    <label class="custom-control-label" for="rcOtherRadio"><strong>Other:</strong></label>
	                                </div>
	                                <textarea class="form-control mt-2" id="rcOtherText" rows="3" disabled></textarea>
	                            </div>
	                        </form>
	                    </div>
	                    <div class="modal-footer">
	                        <button type="button" class="btn btn-secondary" id="rcSpellCheckBtn">Spell/Check</button>
	                        <button type="button" class="btn btn-info" id="rcPrintBtn">Print</button>
	                        <button type="button" class="btn btn-primary" id="rcOkSaveBtn">OK/Save</button>
	                        <button type="button" class="btn btn-light" id="rcCancelBtnModal">Cancel/Exit</button>
	                    </div>
	                </div>
	            </div>
	        </div>
	<!-- END Page Settings -->
	
	<style>
		/*.tabulator .tabulator-tableholder{
			overflow-x: hidden;
		}*/
		.page-content-wrapper{
		    overflow: hidden;
		}
		.grievanceMainBlock{
		    overflow-x: hidden;
		    overflow-y: auto;
		    height: calc(100vh - 290px);
		    position: relative;
		    right: 5px !important;
		}
		
		.floatingFields input:not(:placeholder-shown) + label {
				    background: #fff !important;
				}
				
		.datePickerFloat input[type="date"]:not(.has-value):not(:focus) + .form-label,
		.datePickerFloat input[type="time"]:not(.has-value):not(:focus) + .form-label {
		    color: #886ab5 !important;
		}
		
		.date-input + .form-label {
			color: #886ab5 !important;
		}
					
		.datePickerFloat input[type="date"]:focus + label,
		.datePickerFloat input[type="date"].has-value + label,
		.datePickerFloat input[type="time"]:focus + label,
		.datePickerFloat input[type="time"].has-value + label {
		    color: #886ab5 !important;
		    top: -10px;
		    left: 6px;
		    background: #fff;
		    font-size: 11px;
		    z-index: 1;
		}

		.datePickerFloat input.has-value + label {
		    color: #886ab5 !important;
		    top: -10px !important;
		    left: 6px !important;
		    font-size: 11px !important;
		    background: #fff !important;
		    z-index: 1 !important;
		}
		
		.datePickerFloat .form-label{
			color:#9b7cca;
		    position: absolute;
		    left: 5px;
		    top: 3px;
		    transition: all 0.2s ease;
		    pointer-events: none;
		}

		/* Date/time input placeholder handling */
		input[type="date"]::-webkit-datetime-edit,
		input[type="time"]::-webkit-datetime-edit {
		    color: transparent !important;
		}


		input.has-value[type="date"]::-webkit-datetime-edit,
		input.has-value[type="time"]::-webkit-datetime-edit {
		    color: black !important;
		}

		input.has-value[type="date"] + .form-label,
		input.has-value[type="time"] + .form-label 
		{
		    color: #886ab5 !important;
		    top: -10px;
		    left: 6px;
		    background: #fff;
		    font-size: 11px;
		}


		.floatingFields select.has-value + label {
		    color: #886ab5 !important;
		    top: -12px !important;
		    left: 6px !important;
		    font-size: 11px; 
			text-shadow: -1px 1px 0px #fff,2px 1px 0px #fff,-3px 1px 0px #fff,4px 1px 0px #fff,-5px 1px 0px #fff, 6px 1px 0px #fff;
		}
		
		#sbiNumberInput.has-value + label {
		    background-color:#ede1ff !important;
		}
		
		#sbiNumberInput:not(:placeholder-shown) + label {
		    background: #fff !important;
		}
		
		body{
			overflow: hidden;
		}
		h6{
			color: #7a59ad;
			font-weight: 500;
		}
		#grievanceTable_wrapper div:first-child{
			margin: 0!important;
			padding-top: 0;
		}
		#grievanceTable_wrapper .col-sm-12{
			padding: 0;
		}
		.dataTables_info{
			margin-left: 12px;
    		padding-top: 0;
		}
		#grievanceTable	{
			margin-bottom: 5px !important;
		}
		.panel{
			margin-bottom: 8px !important;
		}
		.dataTables_scrollHeadInner{
			width: 100%!important;
	    	white-space: nowrap;
		}
		.dataTables_wrapper .row:nth-child(1){
			margin-bottom: 0px !important;
		}
		.select2-container--open .select2-dropdown--below {
			z-index: 9999;
		}
		label{
			font-weight: 500;
		}
		.headerBlock{
			background: #7a59ad;
			color: #fff;
			padding: 5px;
			border: 1px solid #ccc;
			margin-left: 5px;
			margin-right: 5px;
		}
		.panelContentBlock{
			border: 1px solid #7a58ac;	
			border-radius: 5px!important;
		}
		.nav-tabs{
			border: 1px solid #7a59ad;
    		border-radius: 5px 5px 5px 0px;
		}
		#grievanceTable, #SMETable, #AdditionalCommentsTable, #RgcSmeTable,
		#MgcVotingTable, #ReferralTable, .GrievanceBlockMain, .LSMEMainBlock, .IGCMainBlock,
		.RGCSMEMainBlock, .MGCMainBlock, .ReferralMainBlock, .WardenBsmeMainBlock, .AppealMainBlock, .BGOMainBlock, .BureauChiefMainBlock{
			border: 1px solid #7a59ad;
		}

		table .custom-select{
			height: 20px !important;
		}
		.AdditionalCommentsTable, #grievanceTable, #RgcSmeTable, #ReferralTable, #grievanceTable, #SMETable,
		#AdditionalCommentsTable, #RgcSmeTable, #MgcVotingTable, #ReferralTable  td{
			line-height: 0;
		}
		.GrievanceList .idList:hover{
			background-color: #ddd;
		}
		.tabListMainBlock{
			height: calc(100vh - 420px);
			overflow-x: hidden!important;	
		}
		.datepicker{
			width: fit-content;
		}
		.headerBtnGroup .dropdown-item{
			padding: 5px 10px;
		}
		
		.clickable-grievance {
		    cursor: pointer;
		}
		
		.selected-grievance {
		    background-color: #d4edff;
		    font-weight: bold;
		}
		
		#Group:focus,#GrievanceDate:focus,#Emergencyf:focus,#Confidentialf:focus,#Status:focus,#LevelOfResolution:focus,
		#Category:focus,#ResolDate:focus,#GrievanceType:focus,#IncidentDate:focus,#IncidentTime:focus,#IGCRecdDate:focus,
		#Pattersonfname:focus,#CurrentHousing:focus,#Facility:focus,#Location:focus{
		    border: 1px solid #544e82;
		    border-color: #9b7cca;
		    box-shadow: 0 0 0 .2rem rgb(57 93 253 / 25%);
		}
		
		.ui-datepicker {
            z-index: 10000 !important;
        }
		
		.disabled-overlay {
		    position: absolute;
		    top: 0;
		    left: 0;
		    width: 100%;
		    height: 100%;
		    background: transparent;
		    z-index: 10;
		    cursor: not-allowed;
			pointer-events: none;
		}
		
		#lsmeMembers-table .tabulator-row.tabulator-selected {
		    background-color:none;
		}
		
		#myModal{
			z-index:99999 !important;
			background: #2a2a2a45;
		}
		
		#referral-Table .tabulator-tableholder {
		    overflow-x: auto !important; 
		}
		
		.grievance-list-header {
		    display: grid;
		    grid-template-columns: 85px 1fr; 
		    font-weight: 500;
		    font-size: 0.8rem;
		    padding: 6px 8px;
		    border-bottom: 1px solid #a0a0a0;
			background-color: #9b7cca !important;
			color: white;
			border-top-right-radius: 5px;
			border-top-left-radius: 5px;
		}

		.idList span.ml-6 {
		    margin-left: 0 !important;
		}

		#grievanceListContainer .idList.clickable-grievance {
		    display: grid;
		    grid-template-columns: 85px 1fr;
		    align-items: center; 
		    padding: 6px 8px; 
		    cursor: pointer;
		    transition: background-color 0.2s;
		}

		#grievanceListContainer .idList.clickable-grievance:nth-child(odd) {
		    background-color: #ffffff; 
		}

		#grievanceListContainer .idList.clickable-grievance:nth-child(even) {
		    background-color: #f2f2f2; 
		}

		#grievanceListContainer .idList.clickable-grievance:hover {
		    background-color: #eef2ff;
		}

		.clickable-grievance.selected-grievance,
		.clickable-grievance:focus {
		    background-color: #c2cef5 !important;
		    outline: none !important;
		    font-weight: bold; 
		}
		
		#grievanceList-table{
			height: 100%;
			max-height: calc(100% - 0px); 
		}
		
		#grievanceList-table .tabulator-row.tabulator-selected {
		        background-color: #c2cef5 !important;
		        font-weight: bold;
		    }
			
			#grievanceList-table .tabulator-placeholder {
						color: #ccc;
						font-size: 20px;
						font-weight: 700;
					}
			
		
		@media screen and (max-width: 1024px) {
		    .page-content-wrapper {
		        margin-top: 0!important;
		    }
		}
		@media screen and (min-width: 990px) {
			.levelresolution-pr-xl-2{
				padding-right: 12px!important;
			}
		}
		
	</style>

	<div th:replace="~{fragments/script :: script}"></div>
	<script src="js/staticjs.js"></script>
	<script src="js/script.js"></script>
	<script>
			/*$(document).ready(function() {
			    function clearAllFormFields() {
			        $('input[type="text"], input[type="password"], input[type="email"], input[type="number"], input[type="tel"], input[type="url"], input[type="search"]').val('');
			        $('textarea').val('');
			        $('input[type="checkbox"], input[type="radio"]').prop('checked', false);
			        $('select').prop('selectedIndex', 0);
			        $('input[type="date"], input[type="time"], input[type="datetime-local"]').val('');
			    }
			    clearAllFormFields();
			    $(window).on('beforeunload', function() {
			        clearAllFormFields();
			    });
			});*/
			
			/*$(document).ready(function() {
				//let isSbiEntered = false;
				    function checkSbi() {
				        if (!isSbiEntered) {
				            message('OG02',0,0);
				            return false;
				        }
				        return true;
				    }
				    $('#sbiNumberInput').on('input change', function() {
				        isSbiEntered = $(this).val().trim().length === 8;
				    });
				    $('input,select,textarea').not('#sbiNumberInput').on('click', function(e) {
				        if (!isSbiEntered) {
							//message('OG01',0,0);
							message('CUW', 'Please enter a valid ID# before proceeding.', 0);     
				            $(this).blur();
				            e.preventDefault();
				        }
				    });
					$('[data-target="#LSMEmemberModal"],#IGCrowAddBtn,#addRow, #removeRow,#printBtn,#RefrowAddBtn,#RGCrowRemoveBtn, #MGCrowRemoveBtn, [data-target="#SelectRGCMember"], [data-target="#SelectMGCMember"]').on('click', function(e) {
				        if (!isSbiEntered) {
							e.stopImmediatePropagation();
				            e.preventDefault();
							message('CUW', 'Please enter a valid ID# before proceeding.', 0); 
				        }
				    });
				    $('input[type="checkbox"],input[type="radio"],#addRow, #removeRow,[data-target="#LSMEmemberModal"],#IGCrowAddBtn,#printBtn,#RefrowAddBtn,#RGCrowRemoveBtn, #MGCrowRemoveBtn, [data-target="#SelectRGCMember"], [data-target="#SelectMGCMember"]').on('click', function(e) {
				        if (!isSbiEntered) {
							e.preventDefault();
							message('CUW', 'Please enter a valid ID# before proceeding.', 0);     
				        }
				    });
					
					$(document).on('mousedown', '.tabulator-cell', function(e) {
					    if (!isSbiEntered) {
					        e.stopImmediatePropagation();
					        e.preventDefault();
							message('CUW', 'Please enter a valid ID# before proceeding.', 0);     
					        return false;
					    }
					});

			});*/

			var  imagendatanull="R0lGODlhoACgAPcAAAAAAAAICAgICAgIEAgQEBAQEBAQGBAYGBgYGBgYIRghISEhISEhKSEpKSkpKSkpMSkxMTExOTE5OTE5Qjk5QjlCQjlCSkJCSkJKSkJKUkpKUkpSUkpSWkpaWlJaWlJaY1JjY1pjY1pja1pra1prc2Nrc2Nzc2Nze2tze2t7hHN7hHOEjHuEjHuElHuMlISMlISMnISUnIyUnIyUpYycpZScrZSlrZSltZyltZyttZytvaWtvaW1vaW1xqW9xq29xq29zq3GzrXGzrXG1rXO1r3O1r3O3r3W3sbGxsbGzsbOzsbW3s7OztbW1tbW3t7e3ufn5+/v7+/v9+/39/f39////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ywAAAAAoACgAAAI/gCpRJESZWBBggYTIlx4sKFChwwfSoxIEaLFiRcrYtyosaPDKFVCiqwSBYiQIUJOpkSpsiXLlytjupQJc6bNmjhp6ry5MyfPnz6DxvQhZWTIkkKKKB1iZKlSI0OUFmHqtAhUqVSnPo26tKlWq1yneuV6tWvVsmLPhs1Kdu3YrVjfgo2rlu5XtCh5FDUaJUhUI0SaBrY6GHBTw4QPF16suHHix4gjM4Y8WbJjy5QvV96sufMQIHpFUjlqsrHlwJYNc06cOvBqw60xx2btujNt07Uz3749eMgPHlGoCB9NEsjfwqqNCFZeOTlsxrKdo4bevPZz3JelM8cOWfvsyIY//vOAUrCg8L5CGqPefZ11kencryOn3jk5e/i8D3+nT//+9sK+8dDEE048QZ5AxrmHX3sMLuigfpzFtl6D8c1XH3/K+afhdoSJlwQTTDTRBBQIpufffhxSqKJ17EVn3YP2yZchgy5eJ6FpQoCGhBJIhEheX8dBSGN/K14oJIb5nWjhhES+qF6GMC7JnHhI9IjEiAWVlhiTT6LoJWNNbgdehGBCmSJ9y40ppH/roZYjD1X2OCCCQaYJ3Xtn5olii2FuqSeRsdXoZ4xhIkZlEnI+IVAQJhZp1ZcV/jejk1xCyqaYYcJn5JcBxuljlkE+6mR+kX6XGp5dFqqqkbeZumpi/ocmmmWjLLpqqYyZOYenkqW+6iihRwY7lY5Vfgqkgn9ml5ukoqrZqoW/ktnrtM+mGl+niIaoKFLUqjjot969JmWzmvoaZbfn0kZlsXOWFKqkznqbbpEPctlmsrzmGy2+2Mr5I6NdZjbvwPgWvOCtBCNsMFTEyuousqcmLO2lGwKr8MXmTvkbEtliya2+GMOm77lSortwyOytm+ii72pHKsicwVjBBRbQbHPNON9M8we5VmcyyuFt3PG2Wupq66pobgaEBAA07fTTUEMtwrQZAz2dysYmKDLB5Aqbp1UxqLCCCmKTPbbYFESt9toS7GBrz7bt+12/2hYE8Mh6guuk/mppr+3331G7cKnL9K4pt2tYe6x1yRaeiCpjP/jQww+TR+B0AQUYgLnmBADueQvNgiU55aNPDkS3Fpsbq7YlBnzaydQ14LcPjsXgOeAsEDGE7njavrYG+1Za9ZuetusXxHdKbJrsa9POmu+3r71CjicNERUMfgNf9fZNra44rQV/ST2jJgXBgN87BBGESUAA4UL0fqOQgw457MCDD+77nYEQ5POfI6uEG1jingCq7oxKRtyxAfwWyMAG/q1wy8GbEYjXsX+Bj0t8as0NHMjBDi7QTqap1oYQ1zDWPWxrC+vaoxTowRa6MGqhQyD36NauoinPPaphoQL8hKeooAQI/j7gAQ/oZwMb4EAHPvgBEJTYgxzYYAYxcMELpEjFKVqxii6IwQxs0IOT9PCHQewBD8S4A6fh6Ya/6hS7/tWyA3qpCBsEQAIIMxUi1NF6OSKiDWpAgz7aYAf4498SdWCDGLzgiojEohVhEAMb8MAvu9udEH6gxyIW0WnW050dmSIu2HmPgB8zWplQpEOw6G4IfmHfb27QRxnE4JUzoEEOTKdEHuSABjKAgQt2OUVe7pKKvnxlDXTwgx+QLwg/2AEraQDFWEKvf5CMChodpEZ/FRCFETNYHOd4ysiJUYxDvCUUGfkCRtIAB7McIw9w4AIVjEAAARCAAAAwABSY4ASH/lSkFGNwTh2ok4ziNOQry+m0f/YgidazmnJ804MqfYgJFkRdoXQIFfHkAAc3cOINbNDHgcLgBa/0ow02ioIMeC4ELvhoOcspUJHeAAeW7KhAQfq+po0UpujcgUm4p64S1rCNENwNC7kpBB84sQZ7TGofnUkDLfaRBkjdIwRuN4AQNPWqTuUnVC2pVGY2FYo0eIHT9kgDjtogBz6wngTpQ8Mf2VBkR8NNHAGgOc0VgAB3zate8Yo5vLJgpDZ4AQeaJgAEHOACr3wlBBBggHkKQASNLCIKDoC5vmJuAHutLF8717SNcrSPOHgkJ3/GmGrW7VjY7BOzlMPCDjagBmJc/oHT6vnNfwqxByBw2gFeoM4LtJCMN+AjF4XA0+d4z63gu9iWWsvBEjBqBQVoGgdYwKj1CTJH5EtB3xQwA0bFILodXJ8PdmDJHvhFNsoz7U8NOKRSwdGDGDAODeYJAAHE4D2U64EHEqAABNCAd76ZKgAKkIPdPcCD1vtNeU+CHeFV6JOLuuCkrOUf5jIQA4AZggiadoEVAEYHB4aaAFjggh9ApQRMA8AOjdADD05FCD0oYmiDIBb0nox4a7zmvbK5n7k2sMBFAILT7GgEHggYaiAYrAUI8wML0DN3QzApB60HGs92cbQjTBYNQfnWt6nIwgu0QY4q0LQUVI95Ihbz/mCPg4KmZSAqNXXg+ijJ0RlTJagNShwb2UuyCSMGzNFbABdjgAAAIGAG+Juv2lBgmA8sQAfKaXPTVKAcD3BQiIQU7pVt/LrUUHBloawVoJY1HR8vUARF9C0AOoBOFxQ6agywgWIAAAEdFMEG5wMApYlgaQcWkY9+NG+NCwU39RKtTo+LlApZ68AHuMCVZAbABs75gbVdAD5tjgFgchBdShehAxyEYmLLygMGI+1rUBGaNdFD2hDm0IESKCcMyNwAfspWbQWgQQ9WmAIAmIApRojuCqxyAvoycKUgbaR578w1Bg1Qx8GKF4ze28AIUDFtDohBDVjwNwqMlwSvBkB6/ojQ7cOgeYFXhMEWy41lTjdONcedletGGSZAe04CUiRBdBuwxTivDQIOgBpxAw6AgQMm1wys4iu5eF5SIUlkxmYZ8kI4MFNHz+IvEME8HSBLsTJw5AbQtWFODj9fvmDl501e3hyuo6G1DmalsjngLC7FCQDAATbQAfSiVwGmxGCeRicC0lHOy6VvWoQUUtfGcnxCxjXYz4OR+9+w7oK0FeAEPdj77bRNBFV7ewUGXyAW0d7yUduoN2132N1EGZ/UWf12AviAFDHQNA2YtwSh/xsBaGAVJ4ud1xxUusIZzKuXA2jx616cmfa0WiNI/m8cmCIMFNC0GETF7rcTgVVy/iA7BdBAOeB2oNlJ/8bUpRtObg817Nztmuf7LfpSpD4AJOD33KtNAbImgqS1Z4MFcLCXCTdcDJcsDtYhPrUtx6MmB0Nsr3c7GiBFMIBmPxAYf/c3BbBvRkAD4KU9Ppd0V0R+E1MkbSVzekNhFOJ+8SN9TqMAOPAeMXAAa8MAOWAY9CUAKWAVHBd8VmR4xIdAI/Nwjbd8atdjHTQBIPUCvgcA2qccMbBhTmMBKIAC+WcE/dY0jFYEQYB94ldFIEh1cvNpxrJ68+IlKOg3FZBFMUB7A9ZdGVZEG2VigxEEKkBfJ+AaffN/hTd8A3h60xJ1Qdg1N5JALbQBMCBLg9U0/gkwg4/yGHr3NB5wGDcAgx00eo6UdnEjQKlnQm+FQe1FHQ0IPw2wAlvUYk7jACIAAi6gGCggAkdGV9r2HhrQQsIngCaTMsgXhsjWcDHifC6EAo3EAzCwAVBTABBQjBGQeyYga2ADXpPIhZVYepjyeD2Ffg7TZVWzXC5kgzRATLsjAQnwNwzQAY3RAi8EgDy4hyG4IOrlVkC1gO4VRwQQAiHwAR6QARhgARWAj/qYj/y4jx9wTgtXBDQgAiFAkCJwigbJA/hRAghZkAUJAvPIARpwj/3Ij9EGAJQoWi63MFsWYTNngg9SSqjEA0+UT4l0kox0Vj+wOza2G2XiG4Rk/kgneW8YuYN6+HgAdDUHSCdT15MNsk0vFmMxoEsnqU8gtXLKV37wgUpNBEX65AI5iJHOqJFDmI4jqH5eBiMiGQQkOQNF+ZUhNUvm1m4JxgM1MFD6FJVXdI7YEShsdYB2044ECHlNwUICQDMWQAESEAHFCAEP4JfF+Jd/CZiEGQESQAH5qDM5s5iKaTMzUwF6uZeBSZiC6TTllFIxIAPPuJFw0yHqljUSBkCu90Kk+UJQ5Er8RItrhRsDxJOppWzNV4alOZtq82texXTD1m5g8ZnGk1zXqBpAQDbCmQImwJAlcJzFeQIlkJzLWQLKyZwngALRqQIpIJzWeZ3YeZ0p/pACUXgCzPmdztmcYkRIwTaWqwkrPsWOfJYibwQfRBAETTQ/+NM/5UM99ck+KkFktbGfycGfdqQ7/nOf42OfOTJISRWQ0bhWW0aCrDcor0IERABjOZADPKBEKoFHGFo9Gmo9mRRJdaRJdwShuxOiHFqiKJGhGIpKqKRgRbRpndSSDAMnjJeAO1aV0wIVEopOPQAE1mVdPIpdPVpd1XUS5fMZJ7E+qESkR8o/STqkPVo+7ANNOTJeB0pc53kdYFhDvtl65hKhTXRW/kQ6kzOmSTSmlHOmB2WmByWmaFo6pYOmpMOmZCqnksMDnmVnOOkzTNKafwgvGBIpgWE9RrVR/hM6P/VjqPSTqIhqqDuwqIqqqI0KqY66qJFKqYs6oZaEVgllow6KI5noMWIIV6Y3alNBOYX6qIw6P5WKqokaqY26qqmKqpUKqzpAq4dKPxdFocaRNG3JVrc4IBAHQhWzLDECRj2gpmfqpnCKrGuapmW6rNDKrMkqrWOapkpEo+jGmefHMcm3pRJUgqeUEkNan1LqpP4zrgF6rvxjrkK6rupKrudqrkyKbIfTGHyKrYBofHmDH4hDogD2r5GkSR46sJsEsAIrsFoRsASrsHfUsK+zbKxnGFlKNKEpMCczI4exiBkbN1bRsRwLFRvrsWCxsRhbGLnCpQroNaixjsGa/mw+eTA8pB19RjgBBC8vUzjj0nykxiG686mgFKpZGT4swonuGENDu344RGysZy90KSp6BnH5ipOt8i3n8rBBGzIKZWNu4rNv16CdKJqMAWuMNhhNUzi0QQMR8CuJl7UP4ofYKqxrGy7WAhhrUwKHUbYuK6opgreqVbXF5avUCJq6iU2daRhlGxg8UG0GQBh4eziNO4Z/i7QxWjxcJpcSx56v8rhDcLhG0DRCwAHxtD/bkQMTIE9toxpQcxikO08UoJCrNU2SG6i8GVEl2KlJ4iWc2wPCiACa1DQXCQAYwEk8EHoGwAN3+zSAMbxPU7wbC7shg2OglpR5W6Ps17TX/iE9KSFkANC6Q9BmBOBDJjUBSkRmG4C6AIAY4VtMaVO+9RK7ktuRWGl6tzswUEMAzoamTVNgqOS51hNdxksEPDBg28G3JAcABQbAAsx8kXsaT4tajnezN3S4pRpO9NM0k8MoTRNITYMqGyxNG1xRTWNM1tPB7wGNbHstvMllFRtXSRsph5tghJSr+csD7dM0YwQE0bUDuhPABYChTbNJQtA5NYA/PMyh1TO97osiPSujyZeLKaSzysa3OWqo+UtMPjDDPUBmEjA56ztnP5DBxgEEviUB6NTFS2ShIzqX2jov8Au0v7kqnXu+ugOfuSpE+TtLXwwA6KQDiuY0BpAD/snkT2EHABUwSX3cNH8cyLe1qxlULQrDp8oXtUabLPshxV86PzqQv4CUx0Y0oTAgAfBExuNVqCkQXRGATDrwAhIQTxLARbZUqPdjnvtynjGnfkQ7y45SG0DQREiFThcVpqCRAxllqPNTTL+BqhW6PuSVUZPzGxOqA7hKw3XiKwgDhG+LxHBbtN4yJXRcRM98w+sTnzoATkdEw2I0P0LUqDcczPWDP6PsTzygzj3Aksmmr+Z3IlmKXBIFm1zjpcJMoc3MKEw5oRV6zHgcn2N0zsQUzhNKS/ST0LZETAx2uadSr34YyX4qtXw4ycUKn68aSCVaVNC8o7uMzpQT0ZgG/tBzRtBK9M4pPUb0XLMK/GBcy261+7XrmUEi2kRItFPSFGSUtMkejUSR06iYjM7l0wMPvaPOvKjSzF6r+SCw8qvq+ZrDWiRW+0NCtJITUpbJPElChD9AZNQTCkh+AdbQnES7TNYqPc2DG4gLGr8/gypQTSFTij/SxBw9q9ZEytdTGs/+hNfWA59bzaNjPUT3kyDOWyb+0cD4mtEcbc+qgkc7dbwnwBLG0TSoZBJGDERojLYA2j4Cnb18ncYLbHoT27WiBpKvi24OEqJiQQSEpZCZ9MM+9J8oKtsAUMInukkommwzjTc6ycSa6MQ8did6yyuGAiFOMwFKERgbHKhQ/vLTUCHBec1Jm3SlyuMYtezGKDu/rh3eyeFmAMACzNG4RpADoCwAE+A20I28cKXdmJuyUWtsUAvZPojVGVMETYPDBUA7uk0YyuvH/5u6ZxSxGaOLxxe43/OROl298l2276MBumPbRmBSEpBE63vecnwYkaQscw0ppbWTDiyEsLmLemq98HG4vhUD2qtW0ZUDJ5HJBWC45/seAJpJa6zGIWgfECbX3+qWEUckeMsDBIAAmQwAnJ3BC9fBAR6oc8bITyzVG91pBkjcimO5kt2rcYMiL6wCANBrkyME0eVIP5ADA4ZHmg2gyZTYeb2RD5yyeru1DP6zK0xz/DyXncm3/kvjNMQkxvOXd2acxxVqUTcQy+iYoFB8u/vRwNI7cZDL5Yg3HYerOzZAXxTqAzVAvIC8AzrwahVgoEb01JebZfStIqkN5O1l6umYJ3jLlCVQxfcjA6AcAK1MSRNayrRmqjImWsU35HlSgNfhtlqu0eViODfkGv7sy/YTTngcyE49OToAU0gkyz7zsu87uwy62g+e0/UaOiih1AQNzROqoyeNzvE8P5OzTro6dINDrJG7xJTbsgqu3yYDH4OUTmKEUWd1PzytThF9UK+8o2796/Lt4dpu099OuBTdpfk+OUHkRKNep+i+1KaqqzEtv1WuPLLbUOxybOvZ8MiexJOh/js90KhiTWdn1cxGTe5hSjkP7QPWHuzi/aKTsS4foqUOLtM7u+NwY0fINEbG9Ca4ytSjXKiAxKPHDEheZO+r2Wmyi+V7ZtVUXymF22fk8hlqTdm39QN9DdiJfaTgpESnvc+7WefbLrTS2B5D4FiWe7soEQRrvrlKLtChXdp0X6DHA3CPS/KAqhiOXuwQ/CdRad7uSTVTQfeMCwAcytsnehJ2pNm9jRicqxtrC8cLzq0mFKq3fOqcSGYmVQHVezSxHcfvISolvCumzzsi0/c8v/YoAsnGrVoofhg/EE9BMAACYGKGIVaibxVk9gKAQQQfEHbs7br8feNxHB4gYPwU/gBpix8D/scA92XjiBED37gAqQh3lo8ftWyNIQ4mYA48wqgCgToV8hQERhAE8gRwIQA1D2D97y0WufU0EED5UUMDVNG4NAA13wcQRIwUMSKw4MCDBwkaFMgQIcMhP3ggocikyZMoUYIMWYjwoEOCChMK7JiQoAQAM4jQACChyBCYQjAAYGFkBYAMCw0AcGEkBwAACIEOJAIUJpGdLob8DLoQ6IUfQCq0HEKkyFCrFngOiQGAwkMjIkGO9EiS7EsgE5MgsQglIxAhYA127DjWbliBPQAUIHkAQI8gQKLCAFDByNQXCoW4+NAAq5HHQIVsFPKjhQfHQQ0C7VGEyA4A/gKEwBzqeQBQ1AXOrr5rdmzEiRUvUokChKPJu0TxghWpEAVq4Ch88NjBw0cBAT0ECKhKMMZp4J6HAH1ZFEDUHzAIAAdQ/Wr3gtMB+IBLXSB38xw55na9u6TrIWmRrLX4hHaQuO95mxXr3mRBCNADAAIecrghBx4ywAknIo5KAIAPXuDBKNIAOAooH374QQEAOGCBKZiGEAIoHRoEjYAdNDSqwe0Q/GGjBkU8Sj+6+rOxwR96oIitJtyq7Tb+GvLPobnICsuICRFQaIgCAKABBxtw0OEF1GIQcTSgaPjhNwuD+AEouMTzoYcvAYAhhxOM8rJMCci8oLAcdtALAPyG/oigwxxuWiA+7DYCcsjdbnwovtiSYIIJH+GSK6wax/oIrI5GgLCjITYAQIQbcMghBx8Q2EsIwXoAAiXUdsKBBx2AMg4IVY27s1QATtUhVfRcsGFTzuDqCrgVckSVBx5ss4o1QG0ENTYe7dPoT90ErfFRkRyjYdCuGNj0Vh44AGCDiHrgoYccJFhuAxtwwhWAHHQoE1VwxRWAXHNzKJemBQBY4EMboiQx2B9WqNeAEtIy0IYDAfuTRmKXlI++Ht/KL+H2bPTMPSKL8FKHHDTVVF3K0tLhVwQF8xjKfHMgE9XixkyXzBwzzvdW8oAAN8p0NzWu5Y9/8GGHfGuIkocf/qrab2iEG5RPNox+fFbI3iIOsiyw4ptZ05INPhbjTT8GIjBUX67hBuPAzRlVk6PquueygwBXU28x1uHkWYGemQYa8lVX6EaLdZrQ+Xj0Eb9FIYXWaWfDk+iGlxEHO+jJftAhShveDkzgnvP9luwehsOY5QJ7pqFsmbO+nG2VPx4uhxp8zjdFodkjOqFjd6yPNttKmlji3IoOTwgfHofSZU19GG2InfO9IUX8HJfXBp/BbjtnscncGfGXcSBT7YwRJPtbiXQoruWX0w32YIiJ5pthZRXVvemhCV9IxB52EB9Yt6OCSaLfgx3NcZJLDhvBzBFHBxnqAcZedisyhe5W/lgzna/eprMdZGqBPNjI+twHu6P5LSMVZJ/riuS6l1wMaEAg4XB24AM/8c5t5BGRwBAHJegBS3rAwg4PJJgpTm3tBxk70MYSKJFVtWxTp+rBaEBYPtj0rT4OC1zeOvg6iFTmejLyEpmMSKhvwaVBXiqO+H6YQMGMaWuCQRkAX3SsAsWNTC0cE6hA1Tbu4a0/FhxUBtvyFmbd7oJP4+NDXjKEOq1HRH5STwsrWMioZEgw+MFPmPAjhOEFRkPYGR6odKahrQ0PkJAM0ZpeBBMnCikkF0wi+u7zsCPmDlrvqcpRDhKi5oQnRsNqUINGo8lW5vIohbxliIgQoyvJyCrA/vzlH2XUnCHs5oPKFNxH+IY02pFvcFBbnx4RshCCJBOb1nxJEW73Pu9YpZuuqUs4X0IU78iRJNkkSoM8M0qoOYppojRCKTVYG1T+pz2p1NvQmmmQVQZKn4IDqEMEus9AheRRdSEobhjlTDteZIN5zB0/50gsIjX0ogbdo0bvwtDXCcp8C7un+soHTzrqZ5kSK1xGUVq+j/ZTdxkNHHwimj5B/nGWu8zlTgu5U52CUqg9/SlPg1rUVh4VqDyN0R+ValSm7vKoTpUqVIn6EokocTYagSSoGulGuIQVrGMVa1nJelazphWta1VrW9n6VrfGFa6giqiPNOSty+UVr3uV/mFf9epXvv5VsIElLGANO9jDFhaxi1VsYxMLLK0mTQdQwsELIUfZy2YWsxLEbGcza1nPhlazoxVtaUcLWtKm1rScJZhpNxsl2TWMClPISBSgwAQl7Ei3u+Vtb337W+AGV7jDJW5xjVvc2VVBuVWgzROYcFzoRle606VudXmb2+Qut7mHQkJuvdtd8H5XvOEl73jNW170nle96WXvet3bXviudy25ZQsSGrZc5kbBuYd6bn/r618A/1fAASbwgA1cYAQfWMEJZvCCHczg/kb4jvilDRSacGEMZ1jDG+Zwhz38YRCHWMQjJnGJR/wEKFABv/mFAhRQ/GIXxxjGM5ZxPY1pfGMb5xjHO9Zxj3n8Yx8HGcg0douKKUwF2iQ5Ckpm8pKd3GQoP1nKUabylK1cZSxfWctZ5vKWp6zigAAAOw=="

			function showDefaultGrievanceList() {
				   const defaultGrievanceListData = [];

				   if (grievanceListTable) {
				       grievanceListTable.setData(defaultGrievanceListData);
				   }
            }
					
		    
			var grievanceListTable;
			var isSbiEntered = false; 

			$(document).ready(function() {
			    $('#sbiNumberInput').on('input change', function() {
			        isSbiEntered = $(this).val().trim().length === 8;
			    });
			    $('input, select, textarea').not('#sbiNumberInput').on('click focus', function(e) {
			        if (!isSbiEntered) {
			            message('CUW', 'Please enter a valid ID# before proceeding.', 0);
			            e.preventDefault();
			            e.stopImmediatePropagation();
			            $(this).blur();
			        }
			    });
				$('[data-target="#LSMEmemberModal"],#IGCrowAddBtn,#addRow, #removeRow,#printBtn,#RefrowAddBtn,#RGCrowRemoveBtn, #MGCrowRemoveBtn, [data-target="#SelectRGCMember"], [data-target="#SelectMGCMember"]').on('click', function(e) {
			        if (!isSbiEntered) {
						e.stopImmediatePropagation();
			            e.preventDefault();
						message('CUW', 'Please enter a valid ID# before proceeding.', 0); 
			        }
			    });
			    $('input[type="checkbox"],input[type="radio"],#addRow, #removeRow,[data-target="#LSMEmemberModal"],#IGCrowAddBtn,#printBtn,#RefrowAddBtn,#RGCrowRemoveBtn, #MGCrowRemoveBtn, [data-target="#SelectRGCMember"], [data-target="#SelectMGCMember"]').on('click', function(e) {
			        if (!isSbiEntered) {
						e.preventDefault();
						message('CUW', 'Please enter a valid ID# before proceeding.', 0);     
			        }
			    });
			    $(document).on('mousedown', '.tabulator-cell', function(e) {
			        if (!isSbiEntered) {
			            message('CUW', 'Please enter a valid ID# before proceeding.', 0);
			            e.preventDefault();
			            e.stopImmediatePropagation();
			            return false;
			        }
			    });
			});

			
			function clearGrievance(){
				    $("input[type='checkbox'],input[type='radio']").prop("checked",false);
				    $("select").prop("selectedIndex",0);
				    $("textarea").val("");
					$('#Status').removeData('original-status');
				    $('.date-input').each(function(){
					    if($(this).attr('id')!=='sbiNumberInput'){
						    $(this).val("");
						    $(this).datepicker('setDate',null);
						    $(this).removeClass('has-value');
						    $(this).trigger('change');
					    	}
					    });
						
					['totalUphold','totalAbstain','totalDeny','mgcTotalDeny','mgcTotalUphold','mgcTotalAbstain'].forEach(id=>$('#'+id).val('').removeClass('has-value'));

				    const clearTabulatorTable=(selector,emptyRows)=>{
					    const table=Tabulator.findTable(selector)[0];
					    if(table)table.setData(emptyRows);
				    };
				    const tableConfigs=[
					    ["#igcselect-table",Array.from({length:4},(_,i)=>({checkbox:"t",dateEntered:"",userName:"",comments:"",id:`empty-${i+1}`}))],
					    ["#individualsinvolved-table", Array.from({ length: 4 }, () => ({ checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", checked: false, _idEditable: true }))],
						["#lsme-table",Array.from({length:11},()=>({checkbox:"t",localSME:"",dateSent:"",reportDate:"",investigationReport:"",referralReason:"",userId:"",checked:false,userData:null}))],
					    ["#rgcSme-Table",Array(4).fill({checkbox:"t",typePerson:"",id:"",firstName:"",lastName:"",mi:"",suffix:"",voteCast:"",checkbox1:"t"})],
					    ["#mgc-Table",Array(4).fill({checkbox:"t",typePerson:"",id:"",firstName:"",lastName:"",mi:"",suffix:"",voteCast:"",checkbox1:"t"})],
					    ["#referral-Table",Array(4).fill({checkbox:"t",refdate:"",radioPerson:"",radioCommittee:"",nameCommittee:"",externalAgencies:"",referredBy:""})]
					];
				    tableConfigs.forEach(([selector,data])=>clearTabulatorTable(selector,data));
				}
				
				$(document).ready(function() {	
				    const defaultImage = 'data:image/jpeg;base64,' + imagendatanull;
				    document.querySelector(".imageContainerPhoto").src = defaultImage;
				                    
					$("#clearButton").click(function() {
						clearFormHeaderData();
						$('input[type="text"], input[type="time"], select').removeClass('has-value').trigger('change');
						clearGrievance();
						if (grievanceListTable) {
				            $('#grievanceList-table .tabulator-placeholder').text("Enter ID# to load grievances");
				        }
						showDefaultGrievanceList();
					});
					
				});


				$(document).ready(function() {
								
				    $('#sbiNumberInput').focus();
				  
					var isClearing = false;
				   	const userId = localStorage.getItem('userId');
				    let selectedGrievance = null;
					let currentRow = null;
					let selectedPerson = null;
					let currentPersonType = 'I';
					let currentPersonsInvolved = [];
					    
					const $personModal = $('#namefromListModal');
					const $personFindInput = $personModal.find('input[type="text"]');
					const $personTable = $personModal.find('#individualselectName-table');
					const $personOkBtn = $personModal.find('[data-action="ok"]');
				    
					let selectedUser = null;
					const $selectNameModal = $('#selectNameFromlist');
					const $findInput = $selectNameModal.find('input[placeholder="%"]');
					const $findButton = $selectNameModal.find('#findButton');
					const $okBtn = $selectNameModal.find('#addCmntValBtn');
					
					let selectedLSMEMember = null;
					let selectedStaff = null;
					let selectedLSMEMembers = [];
					let currentLSMERow = null; 
					let currentUser = localStorage.getItem('userId');
					let lsmeStaffSelectionActive = false
			
					function updateCharCount(textareaElement) {
					    const maxLength = 2000;
					    const $textarea = $(textareaElement);
					    const $counter = $textarea.next('.char-counter');
					    if (!$counter.length) {
					        return;
					    }
					    let currentLength = $textarea.val().length;
					    if (currentLength > maxLength) {
					        $textarea.val($textarea.val().substring(0, maxLength));
					        currentLength = maxLength;
					        if (typeof message === 'function') {
					            const fieldName = $textarea.attr('aria-label') || $textarea.attr('placeholder') || 'The field';
					            message('CUW', `Maximum character length reached for ${fieldName}.! You cannot paste more text or You cannot able to type `, 0);
					        }
					    }
					    $counter.text(currentLength + '/' + maxLength + ' characters');
					}

					$(document).on('input keyup paste', 'textarea.rawField', function() {
					    updateCharCount(this);
					});
					
					$('input[type="text"], textarea').attr({
					        'autocomplete': 'off',
					        'autocorrect': 'off',
					        'autocapitalize': 'off',
					        'spellcheck': false
					    });

				    initializeDropdowns();

					grievanceListTable = new Tabulator("#grievanceList-table", {
					    layout: "fitColumns",
					    placeholder:"Enter ID# to load grievances",
					    height: "100%",
					    selectableRows: 1, 
					    index: "grievance_seq_num", 
					    columns: [
					        { 
					            title: "Grievance#", 
					            field: "grievance_seq_num", 
					            headerTooltip: "Grievance#", 
					            width: 105,
								formatter: function(cell, formatterParams, onRendered) {
								    var data = cell.getRow().getData();
								    if (data.is_new) {
								        return "<span style='color:#9b7cca;font-weight:bold;'>New</span>";
								    } else {
								        return cell.getValue();
								    }
								}
					        },
					        { title: "Date Entered", field: "date_entered", headerTooltip: "Date Entered" },
					        { field: "sbi_no", visible: false },
					        { field: "commit_no", visible: false },
					        { field: "is_new", visible: false }
					    ],
					    dataLoaded: function(data) {
					        if (data.length > 0 && !data[0].is_new) {
					            var firstRow = this.getRows()[0];
					            if (firstRow) {
					                firstRow.select(); 
					                var rowData = firstRow.getData();
					                loadGrievanceDetails(rowData.sbi_no, rowData.grievance_seq_num, rowData.commit_no);
					            }
					        }
					    }
					});


					grievanceListTable.on("rowClick", function(e, row) {
					    var data = row.getData();
					    selectedGrievance = { sbiNo: data.sbi_no, seqNum: data.grievance_seq_num, commitNo: data.commit_no };

					    if (data.is_new) {
					        $("input:not(#sbiNumberInput,#search-form input)").val("");
					        clearGrievance();
							individualsInvolvedTable.setData(
					            Array.from({ length: 4 }, () => ({
					                checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "",
					                _idEditable: true, checked: false
					            }))
					        );
					        $('input[type="text"]:not(#sbiNumberInput),input[type="time"],select')
					            .removeClass('has-value').trigger('change');
					        $('#reportDate,#investigationReport,#referralReason').val('').prop('disabled', false);
					        currentLSMERow = null;
					        currentReferralRow = null;
					        $('#GrievanceDate').val(data.date_entered).trigger('input');
							$('#Group').val("New");
					        setDefaultValuesForNewGrievance();
					        updateLSMEResolutionFieldsAccess();
					        $('#IGCbtn').focus();
					    } else {
					        loadGrievanceDetails(data.sbi_no, data.grievance_seq_num, data.commit_no);
					        $('#IGCbtn').focus();
					    }
					});
					
					$("#clearButton").on('mousedown', function() {
			            isClearing = true;
			        }).on('mouseup mouseleave', function() {
			            isClearing = false;
			        });
					
					const initialSbiNo = ($("#sbiNumberInput").val() || '').trim();
						if (initialSbiNo.length === 8) {
						    validateAndFetchGrievances(initialSbiNo);
					}

					$("#sbiNumberInput").on('change', function() {
					    if (isClearing) {
					        return;
					    }
					    const sbiNo = $(this).val().trim();
					    if (sbiNo.length === 8) {
					        validateAndFetchGrievances(sbiNo);
					    } else {
					        showDefaultGrievanceList();
					        $('input:not(#sbiNumberInput), textarea').val('');
					        $('input[type="checkbox"], input[type="radio"]').prop('checked', false);
					        $('select').prop('selectedIndex', 0);
					        clearGrievance();
					        $('[data-target="#selectNameFromlist"], #saveOffenderBtn, #printBtn,#addNewGrievanceBtn').addClass('disabled').css('pointer-events', 'none').prop('disabled', true);
					        [updateGrievanceHeaderState, updateGrievanceBodyState, updateReferralState, updateRGCState, updateMGCState, updateIGCState, updateLSMEState, updateWardenState, updateBGOState, updateAppealState, updateBureauState].forEach(fn => fn(true));
					    }
						}).on('keydown', function(e) {
						    if (e.key === 'Enter') {
						        e.preventDefault(); 
						        $(this).trigger('change'); 
						    }
					});
					
					function initializeDropdowns() {
					    loader(1);
					    const totalRequests = 4;
					    let completedRequests = 0;
					    const ajaxTimeout = 15000;

					    function requestFinished() {
					        completedRequests++;
					        if (completedRequests === totalRequests) {
					            setTimeout(function() {
					                loader(0);
					            }, 1500);
					        }
					    }

					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getGrievanceStatuses',
					        type: 'GET',
					        timeout: ajaxTimeout,
					        success: function(data) {
					            const $statusDropdown = $('#Status');
					            $statusDropdown.empty().append('<option value=""> </option>');
					            data.forEach(status => {
					                $statusDropdown.append(`<option value="${status.ref_value_code}">${status.ref_value_desc}</option>`);
					            });
					        },
					        error: function() {
					            console.error("Failed to load Grievance Statuses.");
					        },
					        complete: requestFinished
					    });

					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getGrievanceTypes',
					        type: 'GET',
					        timeout: ajaxTimeout,
					        success: function(data) {
					            const $typeDropdown = $('#GrievanceType');
					            $typeDropdown.empty().append('<option value=""> </option>');
					            data.forEach(type => {
					                $typeDropdown.append(`<option value="${type.GRIEVANCE_CODE}">${type.GRIEVANCE_DESC}</option>`);
					            });
					        },
					        error: function() {
					            console.error("Failed to load Grievance Types.");
					        },
					        complete: requestFinished
					    });

					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getFacilities',
					        type: 'GET',
					        data: { userId: currentUser },
					        timeout: ajaxTimeout,
					        success: function(data) {
					            const $facilityDropdown = $('#Facility');
					            $facilityDropdown.empty().append('<option value=""> </option>');
					            data.forEach(facility => {
					                $facilityDropdown.append(`<option value="${facility.inst_num}">${facility.inst_name}</option>`);
					            });
					        },
					        error: function() {
					            console.error("Failed to load Facilities.");
					        },
					        complete: requestFinished
					    });

					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getAbandonmentReasons',
					        type: 'GET',
					        timeout: ajaxTimeout,
					        success: function(data) {
					            const $reasonsDropdown = $('#abandonmentReason');
					            $reasonsDropdown.empty().append('<option value=""></option>');
					            data.forEach(reason => {
					                $reasonsDropdown.append(`<option value="${reason.ref_value_code}">${reason.ref_value_desc}</option>`);
					            });
					        },
					        error: function() {
					            console.error("Failed to load Abandonment Reasons.");
					        },
					        complete: requestFinished
					    });
					}
					
					function validateAndFetchGrievances(sbiNo) {
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/validateSbi',
					        type: 'GET',
					        data: { sbiNo: sbiNo },
					        success: function(response) {
					            if (response && response.valid) {
					                isSbiEntered = true;
					                [updateGrievanceHeaderState, updateGrievanceBodyState, updateReferralState, updateRGCState, updateMGCState, updateIGCState, updateLSMEState, updateWardenState, updateBGOState, updateAppealState, updateBureauState].forEach(fn => fn(false));
					                $('[data-target="#selectNameFromlist"], #saveOffenderBtn, #printBtn,#addNewGrievanceBtn').removeClass('disabled').css('pointer-events', 'auto').prop('disabled', false);
					                fetchGrievanceList(sbiNo);
					            } else {
					                isSbiEntered = false;
					                message('OG02', 0, 0);
					                showDefaultGrievanceList();
					                clearGrievance();
					                $('#search-form').find('input').not('#sbiNumberInput').val('');
					                $('[data-target="#selectNameFromlist"], #saveOffenderBtn, #printBtn,#addNewGrievanceBtn').addClass('disabled').css('pointer-events', 'none').prop('disabled', true);
					                [updateGrievanceHeaderState, updateGrievanceBodyState, updateReferralState, updateRGCState, updateMGCState, updateIGCState, updateLSMEState, updateWardenState, updateBGOState, updateAppealState, updateBureauState].forEach(fn => fn(true));
					                $('#sbiNumberInput').focus();
					            }
					        },
					        error: function() {
					            isSbiEntered = false;
					            message('CUE', 'Error during SBI validation.', 0);
					            showDefaultGrievanceList();
					            clearGrievance();
					            $('[data-target="#selectNameFromlist"], #saveOffenderBtn, #printBtn,#addNewGrievanceBtn').addClass('disabled').css('pointer-events', 'none').prop('disabled', true);
					            [updateGrievanceHeaderState, updateGrievanceBodyState, updateReferralState, updateRGCState, updateMGCState, updateIGCState, updateLSMEState, updateWardenState, updateBGOState, updateAppealState, updateBureauState].forEach(fn => fn(true));
					            $('#sbiNumberInput').focus();
					        }
					    });
					}
					
					function isRowIncomplete(rowData){
					    const type = rowData.type||rowData.typePerson;
					    const firstName = rowData.first_name||rowData.firstName;
					    const lastName = rowData.last_name||rowData.lastName;
					    const sbiNo = rowData.sbi_no||rowData.id;
					    if(!type&&!firstName&&!lastName&&(!sbiNo||sbiNo.trim()==='')){
					        return false;
					    }
					    if(!firstName||!lastName) return true;
					    if(!type) return true;
					    if(type==='I'&&(!sbiNo||sbiNo.length!==8)) return true;
					    return false;
					}

					const generalTableCellEditingValidation = function(cell){
					    const table = cell.getTable();
					    const rows = table.getRows();
					    const currentRowIndex = rows.indexOf(cell.getRow());
					    if(currentRowIndex>0){
					        const prevRow = rows[currentRowIndex-1];
					        const prevRowData = prevRow.getData();
					        const type = prevRowData.type||prevRowData.typePerson;
					        const firstName = prevRowData.first_name||prevRowData.firstName;
					        const lastName = prevRowData.last_name||prevRowData.lastName;
					        const sbiNo = prevRowData.sbi_no||prevRowData.id;
					        if(type||firstName||lastName||(sbiNo&&sbiNo.trim()!=='')){
					            if(!firstName||!lastName){
					                message('CUW','First Name & Last Name is mandatory.',0);
					                return false;
					            }
					            if(!type){
					                message('CUW','Type of Person is mandatory',0);
					                return false;
					            }
					            if(type==='I'&&(!sbiNo||sbiNo.length!==8)){
					                message('OG02',0,0);
					                return false;
					            }
					        }
					    }
					    return true;
					};
					
					function emptyRowsAtBottomSorter(a, b, aRow, bRow, column, dir, sorterParams) {
					    const { isRowEmpty, type = 'string' } = sorterParams;
					    const aData = aRow.getData();
					    const bData = bRow.getData();
					    const aIsEmpty = isRowEmpty(aData);
					    const bIsEmpty = isRowEmpty(bData);
					    if (aIsEmpty && !bIsEmpty) return 1;
					    if (!aIsEmpty && bIsEmpty) return -1;
					    if (aIsEmpty && bIsEmpty) return 0;
					    const valA = a === null || a === undefined ? "" : a;
					    const valB = b === null || b === undefined ? "" : b;
					    let result = 0;
					    switch (type) {
					        case 'number':
					            result = parseFloat(valA) - parseFloat(valB);
					            break;
					        case 'date':
					            const dateA = valA ? new Date(valA).getTime() : 0;
					            const dateB = valB ? new Date(valB).getTime() : 0;
					            if (isNaN(dateA) || isNaN(dateB)) {
					                result = 0;
					            } else {
					                result = dateA - dateB;
					            }
					            break;
					        case 'string':
					        default:
					            result = String(valA).localeCompare(String(valB));
					            break;
					    }
					    return result;
					}
					
					var dateEditor = function(cell, onRendered, success, cancel) {
					    var editor = document.createElement("input");
					    editor.setAttribute("type", "text");
					    editor.setAttribute("maxlength", "10");

					    var cellValue = cell.getValue();
					    editor.value = cellValue || "";

					    $(editor).on('input', function() {
					        let value = $(this).val().replace(/\D/g, "");
					        if (value.length > 2) {
					            value = value.slice(0, 2) + '/' + value.slice(2);
					        }
					        if (value.length > 5) {
					            value = value.slice(0, 5) + '/' + value.slice(5, 9);
					        }
					        $(this).val(value);
					    });

					    $(editor).datepicker({
					        dateFormat: "mm/dd/yy",
					        changeMonth: true,
					        changeYear: true,
					        yearRange: (function() {
					            var currentYear = new Date().getFullYear();
					            return (currentYear - 20) + ":" + (currentYear + 20);
					        })(),
					        maxDate: 0,
					        onSelect: function(dateText) {
					            success(dateText);
					        },
					        beforeShow: function(input, inst) {
					            setTimeout(function() {
					                const $datepickerDiv = $('#ui-datepicker-div');
					                if (!$datepickerDiv.find('.custom-btn-wrapper').length) {
					                    const $wrapper = $('<div>', {
					                        class: 'custom-btn-wrapper',
					                        css: { display: 'flex', gap: '4px', marginTop: '2px', marginBottom: '2px', justifyContent: 'space-between' }
					                    });
					                    const $todayBtn = $('<button>', {
					                        text: "Today",
					                        class: 'custom-today-btn',
					                        css: { flex: 1, padding: '2px', cursor: 'pointer', background: '#ece0ff', border: 'none' },
					                        click: function(e) {
					                            e.preventDefault();
					                            const today = $.datepicker.formatDate("mm/dd/yy", new Date());
					                            success(today);
					                            $(input).datepicker("hide");
					                        }
					                    });
					                    const $clearBtn = $('<button>', {
					                        text: "Clear",
					                        class: 'custom-clear-btn',
					                        css: { flex: 1, padding: '2px', cursor: 'pointer', background: '#ece0ff', border: 'none' },
					                        click: function(e) {
					                            e.preventDefault();
					                            success("");
					                            $(input).datepicker("hide");
					                        }
					                    });
					                    $wrapper.append($todayBtn, $clearBtn);
					                    $datepickerDiv.append($wrapper);
					                }
					            }, 10);
					        }
					    }).css({
					        position: "relative",
					        zIndex: 9999
					    });

					    onRendered(function() {
					        editor.focus();
					        $(editor).datepicker("show");
					    });

					    editor.addEventListener("keydown", function(e) {
					        if (e.key === "Enter") {
					            const dateVal = editor.value;
					            if (dateVal && !isValidDate(dateVal)) {
					                if (typeof message === 'function') {
					                    message('CUW', 'Please enter a valid date in MM/DD/YYYY format.', 0);
					                }
					            } else {
					                success(editor.value);
					            }
					        } else if (e.key === "Escape") {
					            cancel();
					        }
					    });
					    return editor;
					};
										
					var lsme = Array.from({ length: 11 }, () => ({
					    checkbox: "t",
					    localSME: "",
					    dateSent: "",
					    reportDate: "",
					    investigationReport: "",
					    referralReason: "",
					    userId: "",
					    checked: false,
					    userData: null
					}));

					var lsmeMembers = Array.from({ length: 5 }, () => ({
					    checkbox: "t",
					    firstName: "",
					    lastName: "",
					    midName: "",
					    suffix: "",
					    startDate: "",
					    endDate: "",
					    userId: "",
					    checked: false
					}));

					//const isLsmeRowEmpty = (data) => !data.localSME && !data.userId;
					
					var lsmeTable = new Tabulator("#lsme-table", {
					    layout: "fitColumns",
					    data: lsme,
					    height: '325px',
					    selectable: 1,
					    columns: [
                            { title: "id", field: "id", visible: false },
                            { title: "upd", field: "upd", visible: false },
                            { title: "seqno", field: "seqno", visible: false },

					        {
					            //title: "Select",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeSelect', 'Select'),
					            field: "checkbox",
					            formatter: function(cell) {
					                const data = cell.getData();
					                return '<input type="checkbox" class="lsme-checkbox" ' + (data.checked ? "checked" : "") + '>';
					            },
					            width: 100,
					            headerSort: false,
					            cellClick: function(e, cell) {
					                if (e.target.classList.contains('lsme-checkbox')) {
					                    const row = cell.getRow();
					                    const data = row.getData();
					                    data.checked = !data.checked;
					                    row.update({checked: data.checked});
					                }
					            }
					        },
					        {
					            //title: "Local SME (F, L, M, S)",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeLocalSME', 'Local SME (L, F, M, S)'),
					            field: "localSME",
					            editor: "input",
					            editable: false,
								headerTooltip:"Local SME (L, F, M, S)",
								headerSort: true,
								sorter: customSorter
								//sorterParams: { isRowEmpty: isLsmeRowEmpty, type: 'string' }
					        },
					        {
					            //title: "Date Sent",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeDateSent', 'Date Sent'),
					            field: "dateSent",
								headerTooltip:"Date Sent",
					            editor: dateEditor,
								headerSort: true,
								sorter: customSorter
								//sorterParams: { isRowEmpty: isLsmeRowEmpty, type: 'date' }
					        }
					    ],
						rowClick: function(e, row) {
						        row.select();
						    }
					});

                    tabulatorRegistry["lsme-table"] = {
                        varName: "lsmeTable",
                        instance: lsmeTable
                    };
					
					const currentUserId = localStorage.getItem('userId');

					lsmeTable.on("rowClick", function(e, row) {
					    const data = row.getData();
					    window.currentLSMERow = row;

					    $('#investigationReport').val(data.investigationReport || '');
					    $('#referralReason').val(data.referralReason || '');
						$('#reportDate').val(data.reportDate || '').trigger('input');

					    $('#reportDate, #investigationReport, #referralReason').prop('disabled', false);

					    lsmeTable.deselectRow();
					    row.select();
						//$('#reportDate').focus();
					});

					$('#reportDate, #investigationReport, #referralReason').on('focus', function() {
					    const rowData = window.currentLSMERow?.getData();
					    
					    if (!rowData || !rowData.userId) {
							message('CUW', 'Please select an investigator from the LSME list before entering report details.', 0);
							e.stopImmediatePropagation();
							$(this).blur();
							return;
					    }
					    
					    if (rowData.userId !== currentUserId) {
							message('OG09', 0, 0);
							e.stopImmediatePropagation();
							$(this).blur();
					    }
					});
					
					/*lsmeTable.on("rowClick", function(e, row) {
					    const data = row.getData();
					    const currentUserId = localStorage.getItem('userId');
					    window.currentLSMERow = row;
					    $('#investigationReport').val(data.investigationReport || '').trigger('input');
					    $('#referralReason').val(data.referralReason || '').trigger('input');
					    $('#reportDate').val(data.reportDate || '').trigger('input');
					    const isAuthorized = !data.userId || (data.userId === currentUserId);
					    $('#reportDate, #investigationReport, #referralReason').prop('disabled', !isAuthorized);
					    lsmeTable.deselectRow();
					    row.select();
					    if (isAuthorized) {
					        setTimeout(function() {
					            $('#reportDate').focus();
					        }, 50);
					    } else {
					        message('OG09', 0, 0);
					    }
					});*/

					$('#reportDate, #investigationReport, #referralReason').on('change', function() {
					    if (window.currentLSMERow) {
					        const fieldId = $(this).attr('id');
					        const newValue = $(this).val();

					        window.currentLSMERow.update({
					            reportDate: $('#reportDate').val(),
					            investigationReport: $('#investigationReport').val(),
					            referralReason: $('#referralReason').val()
					        });
					    }
					});

					lsmeTable.on("rowSelected", function(row){
					});

					//const isLsmeMembersRowEmpty = (data) => !data.firstName && !data.lastName && !data.userId;

					var lsmeMembersTable = new Tabulator("#lsmeMembers-table", {
					    layout: "fitColumns",
					    data: lsmeMembers,
					    height: '140px',
					    selectable: 1,
					    columns: [
                            { title: "id", field: "id", visible: false },
                            { title: "upd", field: "upd", visible: false },
                            { title: "seqno", field: "seqno", visible: false },

					        {
					            //title: "Select",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeMemberselect', 'Select'),
					            field: "checkbox",
					            formatter: function(cell) {
					                const data = cell.getData();
					                return '<input type="checkbox" class="lsme-member-select-checkbox" ' + (data.checked ? "checked" : "") + '>';
					            },
					            width: 100,
					            headerSort: false,
					            cellClick: function(e, cell) {
					                if (e.target.classList.contains('lsme-member-select-checkbox') || e.target.tagName === 'TD') {
					                    const row = cell.getRow();
					                    const data = row.getData();
					                    data.checked = !data.checked;
					                    row.update({ checked: data.checked });
					                    row.toggleSelect();
					                }
					            }
					        },
					        {
					            //title: "First Name",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeMemberfirstName', 'First Name'),
					            field: "firstName",
					            editor: "input",
								headerTooltip:"First Name",
								headerSort: true,
					            sorter: customSorter
					            //sorterParams: { isRowEmpty: isLsmeMembersRowEmpty, type: 'string' }
					        },
					        {
					            //title: "Last Name",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeMemberlastName', 'Last Name'),
					            field: "lastName",
					            editor: "input",
								headerTooltip:"Last Name",
								headerSort: true,
								sorter: customSorter
								//sorterParams: { isRowEmpty: isLsmeMembersRowEmpty, type: 'string' }
					        },
					        {
					            //title: "MI",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeMembermidName', 'MI'),
					            field: "midName",
					            editor: "input",
					            width: 80,
								headerTooltip:"MI",
								headerSort: true,
								sorter: customSorter
								//sorterParams: { isRowEmpty: isLsmeMembersRowEmpty, type: 'string' }
					        },
					        {
					            //title: "Suffix",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeMembersuffix', 'Suffix'),
					            field: "suffix",
					            editor: "input",
					            width: 100,
								headerTooltip:"Suffix",
								headerSort: true,
								sorter: customSorter
								//sorterParams: { isRowEmpty: isLsmeMembersRowEmpty, type: 'string' }
					        },
					        {
					            //title: "Start Date",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeMemberstartDate', 'Start Date'),
					            field: "startDate",
					            editor: dateEditor,
								headerTooltip:"Start Date",
								headerSort: true,
								sorter: customSorter
								//sorterParams: { isRowEmpty: isLsmeMembersRowEmpty, type: 'date' }
					        },
					        {
					            //title: "End Date",
                                titleFormatter: (column) => setTitleDesc(column, 'lsmeMemberendDate', 'End Date'),
					            field: "endDate",
					            editor: dateEditor,
								headerTooltip:"End Date",
								headerSort: true,
								sorter: customSorter
								//sorterParams: { isRowEmpty: isLsmeMembersRowEmpty, type: 'date' }
					        }
					    ]
					});

                    tabulatorRegistry["lsmeMembers-table"] = {
                        varName: "lsmeMembersTable",
                        instance: lsmeMembersTable
                    };

					lsmeMembersTable.on("rowSelectionChanged", function(data, rows) {
					    lsmeMembersTable.getRows().forEach(row => {
					        const isSelected = rows.includes(row);
					        const rowData = row.getData();
					        if (rowData.checked !== isSelected) {
					            row.update({ checked: isSelected });
					        }
					    });
					});

					$('#LSMEmemberModal').on('show.bs.modal', function() {
					    const instNum = $('#Facility').val();
					    const grievanceType = $('#GrievanceType').val();
					    const preservedMembers = lsmeMembersTable.getData().filter(member =>
					        member.checked || (member.firstName && member.lastName)
					    );
					    const tableElement = document.getElementById("lsmeMembers-table");
					    const lastLoadedInst = tableElement.getAttribute('data-inst-num');
					    const lastLoadedType = tableElement.getAttribute('data-grievance-type');

					    if (instNum && grievanceType && lastLoadedInst === instNum && lastLoadedType === grievanceType) {
					        const currentTableData = lsmeMembersTable.getData();
					        if (currentTableData.length > 0 && currentTableData.some(r => r.userId)) {
					            return;
					        }
					    }

					    if (!instNum || !grievanceType) {
					        message('CUW', 'Please select a facility and grievance type first.', 0);
					        while (preservedMembers.length < 5) {
					            preservedMembers.push({
					                checkbox: "t", firstName: "", lastName: "", midName: "", suffix: "",
					                startDate: "", endDate: "", userId: "", checked: false
					            });
					        }
					        lsmeMembersTable.setData(preservedMembers);
					        tableElement.removeAttribute('data-inst-num');
					        tableElement.removeAttribute('data-grievance-type');
					        return;
					    }

					    tableElement.setAttribute('data-inst-num', instNum);
					    tableElement.setAttribute('data-grievance-type', grievanceType);

					    loader(1);
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getLSMEMembers',
					        type: 'GET',
					        data: { instNum: instNum, grievanceType: grievanceType },
					        success: function(membersFromServer) {
					            let serverData = membersFromServer.map(member => ({
					                checkbox: "t",
					                firstName: member.user_first_name || '',
					                lastName: member.user_last_name || '',
					                midName: member.user_mid_name || '',
					                suffix: member.user_suffix_name || '',
					                startDate: member.start_date ? formatDateForInput(member.start_date) : '',
					                endDate: member.end_date ? formatDateForInput(member.end_date) : '',
					                userId: member.user_id || '',
					                checked: false,
					                lsme_bcme_dtl_seq_num: member.lsme_bcme_dtl_seq_num
					            }));

					            const finalData = [];
					            const processedUserIds = new Set();

					            preservedMembers.forEach(p => {
					                if (p.userId) {
					                    finalData.push(p);
					                    processedUserIds.add(p.userId);
					                }
					            });

					            serverData.forEach(s => {
					                if (!processedUserIds.has(s.userId)) {
					                    finalData.push(s);
					                    processedUserIds.add(s.userId);
					                }
					            });

					            preservedMembers.forEach(p => {
					                if (!p.userId) {
					                    const isDuplicate = finalData.some(f => f.firstName === p.firstName && f.lastName === p.lastName);
					                    if (!isDuplicate) {
					                        finalData.push(p);
					                    }
					                }
					            });

					            while (finalData.length < 5) {
					                finalData.push({
					                    checkbox: "t", firstName: "", lastName: "", midName: "", suffix: "",
					                    startDate: "", endDate: "", userId: "", checked: false
					                });
					            }

					            lsmeMembersTable.setData(finalData);
					            loader(0);
					        },
					        error: function() {
					            message('CUE', 'Error loading LSME members.', 0);
					            lsmeMembersTable.setData(Array.from({ length: 5 }, () => ({
					                checkbox: "t", firstName: "", lastName: "", midName: "", suffix: "",
					                startDate: "", endDate: "", userId: "", checked: false
					            })));
					            loader(0);
					        }
					    });
					});

					$('#LSMEmemberModal').on('click', '.btn-primary[data-target="#namefromListModal"]', function(e) {
					    e.preventDefault();
						lsmeStaffSelectionActive = true;
						$personFindInput.val('').focus();
						loadPersonList();
						//$('#namefromListModal').modal('show');
					});

					$('#namefromListModal').on('click', '#fetchDataBtn[data-action="ok"]', function(e) {
					    e.preventDefault();
					    if (!lsmeStaffSelectionActive) return;
					    
					    const selectedRows = staffSelectionTable.getSelectedRows();
					    if (!selectedRows.length || selectedRows[0].getData().user_first_name === "No staff found") {
					        message('CUW', 'Please select a staff member', 0);
					        return;
					    }

					    const staff = selectedRows[0].getData();
					    const selectedStaff = {
					        firstName: staff.user_first_name || '',
					        lastName: staff.user_last_name || '',
					        midName: staff.user_mid_name || '',
					        suffix: staff.user_suffix_name || '',
					        userId: staff.user_id || ''
					    };
					    const existingMembers = lsmeMembersTable.getData();
					    if (existingMembers.some(member => member.userId === selectedStaff.userId)) {
					        message('CUW', 'This staff member is already in the LSME Members list.', 0);
					        return;
					    }
					    
					    const allMemberRows = lsmeMembersTable.getRows();
					    let rowUpdated = false;

					    for (const row of allMemberRows) {
					        const rowData = row.getData();
					        
					        if (!rowData.userId && (!rowData.firstName && !rowData.lastName && !rowData.midName && !rowData.suffix)) {
					            row.update({
					                firstName: selectedStaff.firstName,
					                lastName: selectedStaff.lastName,
					                midName: selectedStaff.midName,
					                suffix: selectedStaff.suffix,
					                startDate: formatDateForInput(new Date().toISOString().split('T')[0]),
					                endDate: "",
					                userId: selectedStaff.userId,
					                checked: true
					            });

					            rowUpdated = true;
					            break;
					        }
					    }
					    
					    if (!rowUpdated) {
					        lsmeMembersTable.addRow({
					            firstName: selectedStaff.firstName,
					            lastName: selectedStaff.lastName,
					            midName: selectedStaff.midName,
					            suffix: selectedStaff.suffix,
					            startDate: formatDateForInput(new Date().toISOString().split('T')[0]),
					            endDate: "",
					            userId: selectedStaff.userId,
					            checked: true
					        });
					    }
					    
					    $('#namefromListModal').modal('hide');
					});


					$('#LSMEmemberModal').on('click', '#fetchDataBtn', function(e) {
					    e.preventDefault();
					    const currentUserId = localStorage.getItem('userId');
					    const today = new Date();
					    today.setHours(0, 0, 0, 0);

					    const selectedLSMEMembers = lsmeMembersTable.getData().filter(member =>
					        member.checked && (member.firstName || member.lastName)
					    );


					    for (const member of selectedLSMEMembers) {
					        if (!member.startDate) {
					            message('CUW', 'Please enter the Start Date.', 0);
					            return;
					        }

					        const startDateParts = member.startDate.split('/');
					        if (startDateParts.length !== 3) {
					            message('CUE', 'Invalid start date format', 0);
					            return;
					        }

					        const startMonth = parseInt(startDateParts[0]);
					        const startDay = parseInt(startDateParts[1]);
					        const startDate = new Date(member.startDate);

					        if (startMonth < 1 || startMonth > 12) {
					            message('OG07', 0, 0);
					            return;
					        }

					        if (startDay < 1 || startDay > 31) {
					            message('OG08', 0, 0);
					            return;
					        }

					        if (isNaN(startDate.getTime())) {
					            message('CUE', 'Invalid start date', 0);
					            return;
					        }

					        if (startDate < today) {
					            message('OG04', 0, 0);
					            return;
					        }

					        if (startDate > today) {
					            message('OG05', 0, 0);
					            return;
					        }

					        if (member.endDate) {
					            const endDateParts = member.endDate.split('/');
					            if (endDateParts.length !== 3) {
					                message('CUE', 'Invalid end date format', 0);
					                return;
					            }

					            const endMonth = parseInt(endDateParts[0]);
					            const endDay = parseInt(endDateParts[1]);
					            const endDate = new Date(member.endDate);

					            if (endMonth < 1 || endMonth > 12) {
					                message('OG07', 0, 0);
					                return;
					            }

					            if (endDay < 1 || endDay > 31) {
					                message('OG08', 0, 0);
					                return;
					            }

					            if (isNaN(endDate.getTime())) {
					                message('CUE', 'Invalid end date', 0);
					                return;
					            }

					            if (endDate < startDate) {
					                message('OG06', 0, 0);
					                return;
					            }
					        }
					    }

						const allTableRows = lsmeTable.getRows();
						    const emptyRows = allTableRows.filter(row => {
						        const data = row.getData();
						        return !data.localSME && !data.userId;
						    });

						    const existingLSMEUserIds = new Set(lsmeTable.getData().map(row => row.userId).filter(Boolean));
						    let skippedCount = 0;
						   
						    selectedLSMEMembers.forEach(member => {
						        if (existingLSMEUserIds.has(member.userId)) {
						            skippedCount++;
						            return; 
						        }

						        const fullName = [
									member.lastName,
									[member.firstName, member.midName, member.suffix].filter(Boolean).join(" ")
								].filter(Boolean).join(", ");

						        const newRowData = {
						            localSME: fullName,
						            dateSent: member.startDate,
						            reportDate: "",
						            investigationReport: "",
						            referralReason: "",
						            userId: member.userId,
						            checked: false,
						            userData: member
						        };

						        if (emptyRows.length > 0) {
						            const rowToUpdate = emptyRows.shift(); 
						            rowToUpdate.update(newRowData);
						        } else {
						            lsmeTable.addRow(newRowData);
						        }
						        existingLSMEUserIds.add(member.userId);
						    });

						    if (skippedCount > 0) {
						    }

						    lsmeMembersTable.getData().forEach(member => {
						        member.checked = false;
						    });
						    lsmeMembersTable.redraw();

						    closeModalGracefully('#LSMEmemberModal');
						});
					
					$('#LSMEremoverow').click(function(e) {
					    e.preventDefault();

					    const selectedRows = lsmeTable.getRows().filter(row => {
					        const data = row.getData();
					        return data.checked || row.isSelected();
					    });

					    if (selectedRows.length === 0) {
					        message('CUW', 'There is no investigator to remove', 0);
					        return;
					    }

					    confirmation("Are you sure you want to remove all selected investigators from the list?", function() {
					        selectedRows.forEach(row => row.delete());

					        const currentData = lsmeTable.getData();
					        const currentRowCount = currentData.length;

					        const minEmptyRows = 5;
					        const emptyRowCount = currentData.filter(row => 
					            !row.localSME && !row.userId
					        ).length;

					        if (emptyRowCount < minEmptyRows) {
					            const rowsToAdd = minEmptyRows - emptyRowCount;
					            const newRows = Array.from({length: rowsToAdd}, () => ({
					                checkbox: "t",
					                localSME: "",
					                dateSent: "",
					                reportDate: "",
					                investigationReport: "",
					                referralReason: "",
					                userId: "",
					                checked: false,
					                userData: null
					            }));
					            lsmeTable.addRows(newRows);
					        }

					        $('#reportDate, #investigationReport, #referralReason').val('');
					        currentLSMERow = null;

					        lsmeTable.deselectRow();
					    });
					});


					function populateLSMETable(lsmeList) {
					    lsmeTable.setData([]);

					    const today = new Date();
					    today.setHours(0, 0, 0, 0);

					    const tableData = lsmeList.map(member => {
					        let isExpired = false;
					        if (member.end_date) {
					            const endDate = new Date(member.end_date);
					            if (endDate < today) {
					                isExpired = true;
					            }
					        }

					        if (isExpired) {
					            return {
					                checkbox: "t",
					                localSME: "",
					                dateSent: "",
					                reportDate: "",
					                investigationReport: "",
					                referralReason: "",
					                userId: "",
					                checked: false,
					                userData: null
					            };
					        } else {
								const nameParts = [
								    member.user_last_name,
								    [member.user_first_name, member.user_mid_name, member.user_suffix_name].filter(Boolean).join(" ")
								].filter(Boolean);

					            return {
					                checkbox: "t",
					                localSME: nameParts.join(", "),
					                dateSent: member.date_sent ? formatDateForInput(member.date_sent) : '',
					                reportDate: member.grvn_invst_dt ? formatDateForInput(member.grvn_invst_dt) : '',
					                investigationReport: member.grvn_invst_desc || '',
					                referralReason: member.grvn_resn_comnt || '',
					                userId: member.user_id || '',
					                checked: false,
					                userData: {
					                    firstName: member.user_first_name || '',
					                    lastName: member.user_last_name || '',
					                    midName: member.user_mid_name || '',
					                    suffix: member.user_suffix_name || '',
					                    startDate: member.date_sent || '',
					                    endDate: member.end_date || '',
					                    userId: member.user_id || ''
					                }
					            };
					        }
					    });

					    while (tableData.length < 12) {
					        tableData.push({
					            checkbox: "t",
					            localSME: "",
					            dateSent: "",
					            reportDate: "",
					            investigationReport: "",
					            referralReason: "",
					            userId: "",
					            checked: false,
					            userData: null
					        });
					    }

					    lsmeTable.setData(tableData);
					    $('#reportDate, #investigationReport, #referralReason').val('').prop('disabled', false);
					    currentLSMERow = null;
					}
					
					function updateLSMEResolutionFieldsAccess() {
					    const $fields = $('#informalResolution, #forwardToIGC, #forwardToIGCDate');
						const selectedRows = grievanceListTable.getSelectedRows();
						const isNew = selectedRows.length > 0 && selectedRows[0].getData().is_new;

					    if (isNew) {
					        $fields.prop('disabled', true);
					        return;
					    }
					    const currentUserId = localStorage.getItem('userId');
					    if (typeof lsmeTable === 'undefined' || !lsmeTable) {
					        $fields.prop('disabled', true);
					        return;
					    }
					    const lsmeData = lsmeTable.getData(); 
					    const isCurrentUserAnInvestigator = lsmeData.some(
					        member => member.userId && member.userId.toString().trim() === currentUserId.toString().trim()
					    );
					    $fields.prop('disabled', !isCurrentUserAnInvestigator);
					}

					$('#informalResolution, #forwardToIGC, #forwardToIGCDate').on('click focus', function(e) {
					    if ($(this).is(':disabled')) {
							const selectedRows = grievanceListTable.getSelectedRows();
							const isNew = selectedRows.length > 0 && selectedRows[0].getData().is_new;
					        e.preventDefault();
					        e.stopImmediatePropagation();
					        if (isNew) {
					            message('OG01', 0, 0);
					        } else {
					            message('OG09', 0, 0);
					        }
					        $(this).blur();
					    }
					});

					var rgcSme = [
					    { checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", voteCast: "", checkbox1: "t" },
					    { checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", voteCast: "", checkbox1: "t" },
					    { checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", voteCast: "", checkbox1: "t" },
					    { checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", voteCast: "", checkbox1: "t" }
					];

					//const isRgcSmeRowEmpty = (data) => !data.type && !data.first_name && !data.last_name;
					
					var rgcSmeTable = new Tabulator("#rgcSme-Table", {
					    layout: "fitColumns",
					    data: rgcSme,
					    height: '140px',
					    printAsHtml: true,
					    printStyled: true,
					    columns: [
					        { title: "id", field: "id", visible: false },
					        { title: "upd", field: "upd", visible: false },
					        { title: "seqno", field: "seqno", visible: false },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCSelect', 'Select'),
					            field: "checkbox",
					            formatter: function(cell) {
					                const data = cell.getData();
					                return '<input type="checkbox" class="rgc-member-checkbox" ' + (data.checked ? "checked" : "") + '>';
					            },
					            width: 100,
					            headerSort: false,
					            cellClick: function(e, cell) {
					                const row = cell.getRow();
					                const data = row.getData();
					                data.checked = !data.checked;
					                row.update({checked: data.checked});
					            }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCtype', 'Type of Person'),
					            field: "type",
					            editor: "list",
					            editable: false,
								headerTooltip:"Type of Person",
								headerSort: true,
					            sorter: customSorter,
					            //sorterParams: { isRowEmpty: isRgcSmeRowEmpty, type: 'string' },
					            editorParams: {
					                values: { "": "", "I": "Inmate", "S": "Staff" },
					                autocomplete: true,
					                allowEmpty: true,
					                listOnEmpty: true,
					                verticalNavigation: "table"
					            },
					            formatter: function(cell) {
					                const value = cell.getValue();
					                return { "": "", "I": "Inmate", "S": "Staff" }[value] || "";
					            },
					            cellEdited: function(cell) {
					                const row = cell.getRow();
					                const type = cell.getValue();
					                if (type === "S") {
					                    row.update({ sbi_no: "", first_name: "", last_name: "", mid_name: "", suffix_name: "" });
					                    row.getCell("sbi_no").getElement().style.backgroundColor = "";
					                    row.getCell("sbi_no").getElement().contentEditable = false;
					                } else {
					                    row.getCell("sbi_no").getElement().style.backgroundColor = "";
					                    row.getCell("sbi_no").getElement().contentEditable = true;
					                }
					            }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCsbi_no', 'ID#'),
					            field: "sbi_no",
					            editor: "input",
								headerTooltip:"ID#",
					            editable: false,
					            editorParams: {elementAttributes: {maxlength: "8"}},
					            cellEdited: function(cell) {
					                const row = cell.getRow();
					                const type = row.getData().type;
					                const sbiNo = cell.getValue();
					                if (type === "I" && sbiNo.length === 8) {
					                    fetchInmateDetailsForRGC(sbiNo, row);
					                } else if (type === "I" && sbiNo.length > 0 && sbiNo.length !== 8) {
					                    message('CUW', 'SBI number must be 8 digits', 0);
					                    cell.setValue("");
					                }
					            }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCfirst_name', 'First Name'),
					            field: "first_name",
					            editor: "input",
					            editable: false,
								headerTooltip:"First Name",
								headerSort: true,
					            sorter: customSorter
					            //sorterParams: { isRowEmpty: isRgcSmeRowEmpty, type: 'string' }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGClast_name', 'Last Name'),
					            field: "last_name",
					            editor: "input",
					            editable: false,
								headerTooltip:"Last Name",
								headerSort: true,
					            sorter: customSorter
					            //sorterParams: { isRowEmpty: isRgcSmeRowEmpty, type: 'string' }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmid_name', 'MI'),
					            field: "mid_name",
					            editor: "input",
					            editable: false,
					            width: 70,
								headerTooltip:"MI",
								headerSort: true,
					            sorter: customSorter
					            //sorterParams: { isRowEmpty: isRgcSmeRowEmpty, type: 'string' }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCsuffix_name', 'Suffix'),
					            field: "suffix_name",
					            editor: "input",
					            editable: false,
					            width: 100,
								headerTooltip:"Suffix",
								headerSort: true,
					            sorter: customSorter
					            //sorterParams: { isRowEmpty: isRgcSmeRowEmpty, type: 'string' }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCvote_type', 'Vote Cast'),
					            field: "vote_type",
					            editor: "list",
								headerTooltip:"Vote Cast",
								headerSort: true,
					            sorter: customSorter,
					            //sorterParams: { isRowEmpty: isRgcSmeRowEmpty, type: 'string' },
					            editorParams: {
					                values: { "": "", "U": "Uphold", "D": "Deny", "A": "Abstain" },
					                autocomplete: true,
					                allowEmpty: true,
					                listOnEmpty: true,
					                verticalNavigation: "table"
					            },
					            formatter: function(cell) {
					                const value = cell.getValue();
					                return { "": "", "U": "Uphold", "D": "Deny", "A": "Abstain" }[value] || "";
					            },
					            cellEdited: function(cell) {
					                updateVoteCounts();
					            }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCtie_breaker_flag', 'Tie Breaker'),
					            field: "tie_breaker_flag",
								headerTooltip:"Tie Breaker",
					            formatter: function(cell) {
					                const value = cell.getValue();
					                return `<input type="checkbox" ${value === "Y" ? "checked" : ""} />`;
					            },
					            width: 100,
					            headerSort: false,
								cellClick: function(e, cell) { // <-- CORRECTED
					                if (e.target.type === 'checkbox') {
					                    cell.setValue(e.target.checked ? "Y" : "N");
					                }
					            }
					        }
					    ]
					});

					tabulatorRegistry["rgcSme-Table"] = {
					    varName: "rgcSmeTable",
					    instance: rgcSmeTable
					};

					var rgcMembers = [
					    { checkbox: "t", typePerson: "", id: "", firstname: "", lastname: "", mi: "", suffix: "", startDate: "", endDate: "", checked: false },
					    { checkbox: "t", typePerson: "", id: "", firstname: "", lastname: "", mi: "", suffix: "", startDate: "", endDate: "", checked: false },
					    { checkbox: "t", typePerson: "", id: "", firstname: "", lastname: "", mi: "", suffix: "", startDate: "", endDate: "", checked: false },
					    { checkbox: "t", typePerson: "", id: "", firstname: "", lastname: "", mi: "", suffix: "", startDate: "", endDate: "", checked: false }
					];

					//const isRgcMembersRowEmpty = (data) => !data.type && !data.first_name && !data.last_name;

					var rgcMembersTable = new Tabulator("#rgcMembers-table", {
					    layout: "fitColumns",
					    data: rgcMembers,
					    height: '140px',
					    printAsHtml: true,
					    printStyled: true,
						editorParams: {elementAttributes: {maxlength: "8"}},
						cellEditing: generalTableCellEditingValidation,
					    columns: [
					        { title: "id", field: "id", visible: false },
					        { title: "upd", field: "upd", visible: false },
					        { title: "seqno", field: "seqno", visible: false },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmembercheckbox', 'Select'),
					            field: "checkbox",
					            formatter: function(cell) {
					                const data = cell.getData();
					                return '<input type="checkbox" class="rgc-member-select-checkbox" ' + (data.checked ? "checked" : "") + '>';
					            },
					            width: 100,
					            headerSort: false,
					            cellClick: function(e, cell) {
					                if (e.target.classList.contains('rgc-member-select-checkbox') || e.target.tagName === 'TD') {
					                    const row = cell.getRow();
					                    const data = row.getData();
					                    data.checked = !data.checked;
					                    row.update({ checked: data.checked });
					                }
					            }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmembertype', 'Type of Person'),
					            field: "type",
					            editor: "list",
								headerTooltip:"Type of Person",
								headerSort: true,
					            sorter: customSorter,
					            //sorterParams: { isRowEmpty: isRgcMembersRowEmpty, type: 'string' },
					            editorParams: {
					                values: { "": "", "I": "Inmate", "S": "Staff" },
					                autocomplete: true,
					                allowEmpty: true,
					                listOnEmpty: true
					            },
					            formatter: function(cell) {
					                const value = cell.getValue();
					                return { "": "", "I": "Inmate", "S": "Staff" }[value] || "";
					            },
					            cellEdited: function(cell) {
					                const row = cell.getRow();
					                const type = cell.getValue();
					                if (type === "S") {
					                    row.update({ sbi_no: "", first_name: "", last_name: "", mid_name: "", suffix_name: "" });
					                    row.getCell("sbi_no").getElement().style.backgroundColor = "";
					                    row.getCell("sbi_no").getElement().contentEditable = false;
					                } else {
					                    row.getCell("sbi_no").getElement().style.backgroundColor = "";
					                    row.getCell("sbi_no").getElement().contentEditable = true;
					                }
					            }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmembersbi_no', 'ID#'),
					            field: "sbi_no",
					            editor: "input",
								headerTooltip:"ID#",
								headerSort: true,
								sorter: customSorter,
					            editorParams: {elementAttributes: {maxlength: "8"}},
					            cellEdited: function(cell) {
					                const row = cell.getRow();
					                const type = row.getData().type;
					                const sbiNo = cell.getValue();
					                
					                if (type === "I" && sbiNo.length === 8) {
					                    fetchInmateDetailsForRGC(sbiNo, row);
					                } else if (type === "I" && sbiNo.length > 0 && sbiNo.length !== 8) {
					                    message('CUW', 'SBI number must be 8 digits', 0);
					                    cell.setValue("");
					                }
					            }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmemberfirst_name', 'First Name'),
					            field: "first_name",
					            editor: "input",
								headerTooltip:"First Name",
								headerSort: true,
								sorter: customSorter
								//sorterParams: { isRowEmpty: isRgcMembersRowEmpty, type: 'string' }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmemberlast_name', 'Last Name'),
					            field: "last_name",
					            editor: "input",
								headerTooltip:"Last Name",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isRgcMembersRowEmpty, type: 'string' }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmembermid_name', 'MI'),
					            field: "mid_name",
					            editor: "input",
					            width: 80,
								headerTooltip:"MI",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isRgcMembersRowEmpty, type: 'string' }
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmembersuffix_name', 'Suffix'),
					            field: "suffix_name",
					            editor: "input",
					            width: 100,
								headerTooltip:"Suffix",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isRgcMembersRowEmpty, type: 'string' }
					        },
							{
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmemberselectBtn', ''),
					            field: "selectBtn",
					            formatter: function(cell, formatterParams, onRendered) {
					                return `<span>
					                    <a href="#" class="ml-2 rgc-select-icon" data-toggle="modal" title="Click to select staff" data-target="#rgcUserSuffixModal" title="Select from list">					
					                        <i class="fa fa-users text-primary"></i>
					                    </a>
					                </span>`;
					            },
					            width: 40,
					            headerSort: false
							 },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmemberstart_date', 'Start Date'),
					            field: "start_date",
					            editor: dateEditor,
								headerTooltip:"Start Date",
								headerSort: true,
								sorter: customSorter,
								//customSortersorterParams: { isRowEmpty: isRgcMembersRowEmpty, type: 'date' },
					            cellEdited: function(cell) {}
					        },
					        {
					            titleFormatter: (column) => setTitleDesc(column, 'RGCmemberend_date', 'End Date'),
					            field: "end_date",
								headerTooltip:"End Date",
					            editor: dateEditor,
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isRgcMembersRowEmpty, type: 'date' },
					            cellEdited: function(cell) {}
					        }
					    ]
					});

					tabulatorRegistry["rgcMembers-table"] = {
					    varName: "rgcMembersTable",
					    instance: rgcMembersTable
					};

					var currentRGCRow = null;

					var rgcUserSuffixModal = [
					    {lastname:"", firstname:"", mi:"", suffix:""},
					    {lastname:"", firstname:"", mi:"", suffix:""},
					    {lastname:"", firstname:"", mi:"", suffix:""},
					    {lastname:"", firstname:"", mi:"", suffix:""},
					    {lastname:"", firstname:"", mi:"", suffix:""},
					    {lastname:"", firstname:"", mi:"", suffix:""},
					    {lastname:"", firstname:"", mi:"", suffix:""},
					    {lastname:"", firstname:"", mi:"", suffix:""}
					];

					var rgcUserSuffixModalTable = new Tabulator("#rgcUserSuffixModal-table", {
					layout: "fitColumns",
					//data: rgcUserSuffixModal,
					data:[],
					height: '200px',
					selectable: 1,
					columns: [
						{ title: "First Name", field: "user_first_name" },
						{ title: "Last Name", field: "user_last_name" },
						{ title: "MI", field: "user_mid_name", width: 80 },
						{ title: "Suffix", field: "user_suffix_name", width: 100 }
					],
					rowClick: function(e, row) {
						currentRGCRow.selectedPerson = row.getData();
						
						if (currentRGCRow.selectedPerson.user_first_name === "No staff found") {
							message('CUW', 'Please select a valid staff member', 0);
							return;
						}

						if (currentRGCRow.row) {
							currentRGCRow.row.update({
								type: "S",
								sbi_no: "", 
								user_id: currentRGCRow.selectedPerson.user_id || '', 
								first_name: currentRGCRow.selectedPerson.user_first_name || '',
								last_name: currentRGCRow.selectedPerson.user_last_name || '',
								mid_name: currentRGCRow.selectedPerson.user_mid_name || '',
								suffix_name: currentRGCRow.selectedPerson.user_suffix_name || '',
								start_date: formatDateForInput(new Date().toISOString()),
								checked: false
							});
							
							const idCell = currentRGCRow.row.getCell("sbi_no");
							if (idCell) {
								idCell.getElement().style.backgroundColor = "";
								idCell.getElement().contentEditable = false;
							}
						}

						closeModalGracefully('#rgcUserSuffixModal');
					},
					rowSelectionChanged: function(data, rows) {
						if (rows.length > 0) {
							currentRGCRow.selectedPerson = rows[0].getData();
						}
					}
				});

				// Update the row click handler
				$(document).on('click', '#rgcUserSuffixModal-table .tabulator-row', function() {
					const row = rgcUserSuffixModalTable.getRow(this);
					if (row) {
						currentRGCRow.selectedPerson = row.getData();
						
						if (currentRGCRow.selectedPerson.user_first_name === "No staff found") {
							message('CUW', 'Please select a valid staff member', 0);
							return;
						}

						if (currentRGCRow.row) {
							currentRGCRow.row.update({
								type: "S",
								sbi_no: "", 
								user_id: currentRGCRow.selectedPerson.user_id || '', 
								first_name: currentRGCRow.selectedPerson.user_first_name || '',
								last_name: currentRGCRow.selectedPerson.user_last_name || '',
								mid_name: currentRGCRow.selectedPerson.user_mid_name || '',
								suffix_name: currentRGCRow.selectedPerson.user_suffix_name || '',
								start_date: formatDateForInput(new Date().toISOString()),
								checked: false
							});
							
							const idCell = currentRGCRow.row.getCell("sbi_no");
							if (idCell) {
								idCell.getElement().style.backgroundColor = "";
								idCell.getElement().contentEditable = false;
							}
						}

						closeModalGracefully('#rgcUserSuffixModal');
					}
				});
					
					$("#rgcMembers-table").on("click", ".rgc-select-icon", function(e) {
					    e.preventDefault();
					    var rowElement = $(this).closest('.tabulator-row')[0];
					    var row = rgcMembersTable.getRow(rowElement);
					    var data = row.getData();

					    if (data.type !== "S") {
					        message('OG03', 0, 0);
					        e.stopPropagation();
					        return;
					    }
					    currentRGCRow = {
					        row: row,
					        selectedPerson: null
					    };
					});
					
					function fetchInmateDetailsForRGC(sbiNo, row) {
					    $.ajax({
					        url: "/OmnetTest/Booking/combinedDetails",
					        type: 'GET',
					        data: { sbiNo: sbiNo },
					        success: function(response) {
					            if (response && response.length > 0) {
					                const inmate = response[0];
					                row.update({
					                    first_name: inmate.COMMIT_FNAME || '',
					                    last_name: inmate.COMMIT_LNAME || '',
					                    mid_name: inmate.COMMIT_MNAME || '',
					                    suffix_name: inmate.COMMIT_SNAME || '',
					                    start_date: formatDateForInput(new Date().toISOString())
					                });
					            } else {
					                row.update({ first_name: '', last_name: '', mid_name: '', suffix_name: '' });
					                message('OG02',0,0);
					            }
					        },
					        error: function(xhr) {
					            row.update({ first_name: '', last_name: '', mid_name: '', suffix_name: '' });
					            message('CUE', 'Error fetching inmate details', 0);
					        }
					    });
					}

					function loadRGCStaffList(searchTerm = '') {
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getStaffList',
					        type: 'GET',
					        data: { searchTerm: searchTerm },
					        success: function(staffList) {
					            rgcUserSuffixModalTable.deselectRow();
					            
					            if (staffList && staffList.length > 0) {
					                rgcUserSuffixModalTable.setData(staffList).then(function() {
					                    if (currentRGCRow && currentRGCRow.selectedPerson) {
					                        const rows = rgcUserSuffixModalTable.getRows().filter(row => {
					                            return row.getData().user_id === currentRGCRow.selectedPerson.user_id;
					                        });
					                        if (rows.length > 0) {
					                            rows[0].select();
					                        }
					                    }
					                });
					            } else {
					                rgcUserSuffixModalTable.setData([{
					                    user_first_name: "No staff found",
					                    user_last_name: "",
					                    user_mid_name: "",
					                    user_suffix_name: ""
					                }]);
					                if (currentRGCRow) {
					                    currentRGCRow.selectedPerson = null;
					                }
					            }
					        },
					        error: function(xhr) {
					            console.error("Error loading staff list:", xhr.responseText);
					            message('CUE', 'Error loading staff list', 0);
					        }
					    });
					}

					function updateVoteCounts() {
					    let upholdCount = 0;
					    let denyCount = 0;
					    let abstainCount = 0;
					    
					    rgcSmeTable.getData().forEach(row => {
					        if ((row.first_name || row.last_name) && row.vote_type) {
					            switch(row.vote_type) {
					                case 'U': upholdCount++; break;
					                case 'D': denyCount++; break;
					                case 'A': abstainCount++; break;
					            }
					        }
					    });
					    
					    $('#totalUphold').val(upholdCount);
					    $('#totalDeny').val(denyCount);
					    $('#totalAbstain').val(abstainCount);
					}

					$('#RGCrowRemoveBtn').click(function(e){
					    e.preventDefault();
					    const allData = rgcSmeTable.getData();
					    const isAnyRowSelected = allData.some(row => row.checked);

					    if (!isAnyRowSelected) {
					        message('CUW', 'Please select one or more RGC Members to remove.', 0);
					        return;
					    }

					    confirmation("Are you sure you want to remove the selected RGC Members from the list?", function(){
					        let remainingData = allData.filter(row => !row.checked);

					        const createEmptyRow = () => ({
					            type: "", sbi_no: "", user_id: null, first_name: "", last_name: "", mid_name: "",
					            suffix_name: "", vote_type: "", tie_breaker_flag: "N", checked: false
					        });

					        const originalRowCount = allData.length;
					        while (remainingData.length < originalRowCount) {
					            remainingData.push(createEmptyRow());
					        }

					        rgcSmeTable.setData(remainingData).then(() => {
					            rgcSmeTable.getRows().forEach(row => {
					                if (row.getData().type === "S") {
					                    const idCell = row.getCell("sbi_no");
					                    if (idCell && idCell.getElement()) {
					                        idCell.getElement().style.backgroundColor = "";
					                        idCell.getElement().contentEditable = false;
					                    }
					                }
					            });
					            updateVoteCounts();
					        });
					    });
					});

					$('#RGCrowAddBtn').click(function(e) {
					    e.preventDefault();
					    const rows = rgcMembersTable.getData();
					    let allValid = true;
					    let lastRowComplete = true;

					    if (rows.length > 0) {
					        const lastRow = rows[rows.length - 1];
					        if (!lastRow.type || !lastRow.first_name || !lastRow.last_name || !lastRow.start_date) {
					            lastRowComplete = false;
					            return;
					        }
					        if (lastRow.type === "I" && (!lastRow.sbi_no || lastRow.sbi_no.length !== 8)) {
					            lastRowComplete = false;
					            message('OG01', 0, 0);
					            return;
					        }
					    }

					    for (let i = 0; i < rows.length; i++) {
					        const row = rows[i];
					        if (!row.type && !row.first_name && !row.last_name && !row.sbi_no) {
					            continue;
					        }
					        if (!row.type || !row.first_name || !row.last_name || 
					            (row.type === "I" && (!row.sbi_no || row.sbi_no.length !== 8))) {
					            allValid = false;
					            break;
					        }
					    }

					    if (lastRowComplete && allValid) {
					        rgcMembersTable.addRow({
					            type: "", 
					            sbi_no: "", 
					            first_name: "", 
					            last_name: "", 
					            mid_name: "", 
					            suffix_name: "", 
					            start_date: "", 
					            end_date: "", 
					            checked: false
					        }).then(row => {
					            row.getCell("type").edit();
					        });
					    }
					});



					$('#rgcUserSuffixModal').on('show.bs.modal', function() {
					    if (!currentRGCRow) {
					        return;
					    }
					    currentRGCRow.selectedPerson = null; 
						$('#rgcUserSuffixModal input[type="text"]').val(''); 
					    rgcUserSuffixModalTable.deselectRow();
					    loadRGCStaffList();
					});
					
					$('#rgcUserSuffixModal').on('shown.bs.modal', function() {
					   $('#rgcUserSuffixModal input[type="text"]').focus();
					});

					$('#rgcUserSuffixModal').on('hidden.bs.modal', function() {
					   currentRGCRow = null; 
					});

					$('#rgcUserSuffixModal').on('click', '#fetchDataBtn:not([data-action="ok"])', function(e) {
					    e.preventDefault();
					    const searchTerm = $('#rgcUserSuffixModal input[type="text"]').val().trim();
					    loadRGCStaffList(searchTerm);
					});

					$('#rgcUserSuffixModal').on('keydown', 'input[type="text"]', function(e) {
						if (e.key === 'Enter') {
							e.preventDefault();
							$('#rgcUserSuffixModal').find('#fetchDataBtn:not([data-action="ok"])').click();
						}
					});

					$('#SelectRGCMember').on('show.bs.modal', function() {
						
						const currentData = rgcMembersTable.getData();
					    const uncheckedData = currentData.map(row => {
					        return {...row, checked: false};
					    });
					    rgcMembersTable.setData(uncheckedData);
							
					    const instNum = $('#Facility').val();
					    const tableElement = document.getElementById("rgcMembers-table");
					    const lastLoadedInstNum = tableElement.getAttribute('data-inst-num');

					    if (instNum && lastLoadedInstNum === instNum && rgcMembersTable.getData().length > 0) {
					        return;
					    }

					    if (!instNum) {
					        message('CUW', 'Please select a facility first.', 0);
					        rgcMembersTable.setData(rgcMembers);
					        tableElement.removeAttribute('data-inst-num');
					        return;
					    }

					    tableElement.setAttribute('data-inst-num', instNum);

					    loader(1);
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getRGCMembers',
					        type: 'GET',
					        data: { instNum: instNum },
					        success: function(members) {
					            const tableData = members.map(member => ({
					                type: member.type_of_person || '',
					                sbi_no: member.sbi_no || '',
					                user_id: member.user_id || '',
					                first_name: member.user_first_name || '',
					                last_name: member.user_last_name || '',
					                mid_name: member.user_mid_name || '',
					                suffix_name: member.user_suffix_name || '',
					                start_date: member.start_date ? formatDateForInput(member.start_date) : '',
					                end_date: member.end_date ? formatDateForInput(member.end_date) : '',
					                checked: false,
					                rgc_mgc_dtl_seq_num: member.rgc_mgc_dtl_seq_num
					            }));

					            while (tableData.length < 4) {
					                tableData.push({
					                    type: "", sbi_no: "", user_id: "", first_name: "", last_name: "", mid_name: "",
					                    suffix_name: "", start_date: "", end_date: "", checked: false
					                });
					            }

					            rgcMembersTable.setData(tableData).then(function() {
					                rgcMembersTable.getRows().forEach(function(row) {
					                    const data = row.getData();
					                    const sbiCell = row.getCell("sbi_no");
					                    if (sbiCell) {
					                        if (data.type === "S") {
					                            sbiCell.getElement().style.backgroundColor = "";
					                            sbiCell.getElement().setAttribute('contentEditable', 'false');
					                            sbiCell.getElement().style.pointerEvents = 'none';
					                            if (sbiCell._cell.editor) {
					                                sbiCell._cell.editor.disabled = true;
					                            }
					                        } else {
					                            sbiCell.getElement().style.backgroundColor = "";
					                            sbiCell.getElement().setAttribute('contentEditable', 'true');
					                            sbiCell.getElement().style.pointerEvents = '';
					                            if (sbiCell._cell.editor) {
					                                sbiCell._cell.editor.disabled = false;
					                            }
					                        }
					                    }
					                });
					            });
					            loader(0);
					        },
					        error: function() {
					            message('CUE', 'Error loading RGC members.', 0);
					            rgcMembersTable.setData(rgcMembers);
					            loader(0);
					        }
					    });
					});


					$('#SelectRGCMember #fetchDataBtn').click(function(e){
					    e.preventDefault();
					    const selectedMembers = rgcMembersTable.getData().filter(m => m.checked);
					    if (!selectedMembers.length) {
					        message('CUW', 'Please select at least one valid member by checking the checkbox.', 0);
					        return;
					    }

						for (const member of selectedMembers) {
							if (!member.first_name || !member.last_name) {
								message('CUW', 'First Name & Last Name is mandatory.', 0);
								return;
							}
						}			
					    const currentSmeData = rgcSmeTable.getData();
					    const emptySmeRows = rgcSmeTable.getRows().filter(r => {
					        const d = r.getData();
					        return !d.type && !d.first_name && !d.last_name;
					    });

					    let addedCount = 0;
					    selectedMembers.forEach((member) => {
					        const isDuplicate = currentSmeData.some(existingMember => {
					            if (!existingMember.type) return false;
					            if (member.type === 'S' && existingMember.type === 'S') {
					                return existingMember.user_id && existingMember.user_id === member.user_id;
					            }
					            if (member.type === 'I' && existingMember.type === 'I') {
					                return existingMember.sbi_no && existingMember.sbi_no === member.sbi_no;
					            }
					            return false;
					        });

					        if (!isDuplicate) {
					            addedCount++;
					            const rowData = {
					                type: member.type,
					                sbi_no: member.type === 'I' ? member.sbi_no : '',
					                user_id: member.type === 'S' ? member.user_id : null,
					                first_name: member.first_name,
					                last_name: member.last_name,
					                mid_name: member.mid_name,
					                suffix_name: member.suffix_name,
					                vote_type: "",
					                tie_breaker_flag: "N",
					                checked: false
					            };
					            if (emptySmeRows.length > 0) {
					                const rowToUpdate = emptySmeRows.shift();
					                rowToUpdate.update(rowData);
					            } else {
					                rgcSmeTable.addRow(rowData);
					            }
					        }
					    });

					    rgcMembersTable.getRows().forEach(row => {
					        if (row.getData().checked) {
					            row.update({ checked: false });
					            row.deselect();
					        }
					    });

					    if (addedCount > 0) {
					        //message('CUS', `Added ${addedCount} new member(s) to the RGC table.`, 1);
					    } else if (selectedMembers.length > 0) {
					        message('CUW', 'Selected member(s) already exist in the RGC table.', 0);
					    }

					    closeModalGracefully('#SelectRGCMember');
					    updateVoteCounts();
					});

					function populateRGCTable(persons) {
					    const data = persons.map(person => {
					        const isStaff = person.grvn_staff_tp === 'S';
					        return {
					            type: person.grvn_staff_tp,
					            sbi_no: isStaff ? '' : (person.sbi_no || ''),
					            user_id: isStaff ? (person.user_id || '') : null,
					            first_name: person.first_name || '',
					            last_name: person.last_name || '',
					            mid_name: person.mid_name || '',
					            suffix_name: person.suffix_name || '',
					            vote_type: person.vote_type || '',
					            tie_breaker_flag: person.tie_breaker_flag || 'N',
					            checked: false
					        };
					    });

					    while (data.length < 4) {
					        data.push({
					            type: "", sbi_no: "", user_id: null, first_name: "", last_name: "", mid_name: "",
					            suffix_name: "", vote_type: "", tie_breaker_flag: "N", checked: false
					        });
					    }

					    rgcSmeTable.setData(data).then(() => {
					        rgcSmeTable.getRows().forEach(row => {
					            const rowData = row.getData();
					            if (rowData.type === "S") {
					                const idCell = row.getCell("sbi_no");
					                if (idCell && idCell.getElement()) {
					                    idCell.getElement().style.backgroundColor = "";
					                    idCell.getElement().contentEditable = false;
					                }
					            }
					        });
					        updateVoteCounts();
					    });
					}

					function loadRGCSMEData(commitNo, seqNum) {
					    if (!commitNo || !seqNum) return;
					   
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getRGCDetails',
					        type: 'GET',
					        data: { 
					            commitNo: commitNo,
					            seqNum: seqNum,
					            cmtyType: 'RGC'
					        },
					        success: function(rgcData) {
					            if (rgcData) {
					                $('#dateReceived').val(formatDateForInput(rgcData.grvn_rew_rcpt_dt)).trigger('input');
					                $('#dateRecommendation').val(formatDateForInput(rgcData.grvn_rew_recm_dt)).trigger('input');
					                $('#recommendationComments').val(rgcData.grvn_rew_recm_desc || '').trigger('input');;
					                $('#forwardToWarden').prop('checked', rgcData.grvn_rew_frwd_to_flg === 'Y');
					            }
					        }
					    });

					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getPersonsInvolved',
					        type: 'GET',
					        data: { 
					            commitNo: commitNo,
					            seqNum: seqNum,
					            cmtyType: 'RGC'
					        },
					        success: function(response) {
					            let persons = [];
					            if (response && response.RGC) { 
					                persons = response.RGC;
					            }
					            populateRGCTable(persons);
					            updateVoteCounts();
					        },
					        error: function(xhr) {
					            console.error("Error loading RGC members:", xhr.responseText);
					            populateRGCTable([]);
					        }
					    });
						}

						   
						var mgcSme = [
						    { checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", voteCast: "", checkbox1: "t" },
						    { checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", voteCast: "", checkbox1: "t" },
						    { checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", voteCast: "", checkbox1: "t" },
						    { checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "", voteCast: "", checkbox1: "t" }
						];

						//const isMgcSmeRowEmpty = (data) => !data.type && !data.first_name && !data.last_name;
						
						var mgcSmeTable = new Tabulator("#mgc-Table", {
						    layout: "fitColumns",
						    data: mgcSme,
						    height: '140px',
						    printAsHtml: true,
						    printStyled: true,
						    columns: [
						        { title: "id", field: "id", visible: false },
						        { title: "upd", field: "upd", visible: false },
						        { title: "seqno", field: "seqno", visible: false },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCSelect', 'Select'),
						            field: "checkbox",
						            formatter: function(cell) {
						                const data = cell.getData();
						                return '<input type="checkbox" class="mgc-member-checkbox" ' + (data.checked ? "checked" : "") + '>';
						            },
						            width: 100,
						            headerSort: false,
						            cellClick: function(e, cell) {
						                const row = cell.getRow();
						                const data = row.getData();
						                data.checked = !data.checked;
						                row.update({checked: data.checked});
						            }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCtype', 'Type of Person'),
						            field: "type",
						            editor: "list",
						            editable: false,
									headerTooltip:"Type of Person",
									headerSort: true,
						            sorter: customSorter,
						            //sorterParams: { isRowEmpty: isMgcSmeRowEmpty, type: 'string' },
						            editorParams: {
						                values: { "": "", "I": "Inmate", "S": "Staff" },
						                autocomplete: true,
						                allowEmpty: true,
						                listOnEmpty: true,
						                verticalNavigation: "table"
						            },
						            formatter: function(cell) {
						                const value = cell.getValue();
						                return { "": "", "I": "Inmate", "S": "Staff" }[value] || "";
						            },
						            cellEdited: function(cell) {
						                const row = cell.getRow();
						                const type = cell.getValue();
						                if (type === "S") {
						                    row.update({ sbi_no: "", first_name: "", last_name: "", mid_name: "", suffix_name: "" });
						                    row.getCell("sbi_no").getElement().style.backgroundColor = "";
						                    row.getCell("sbi_no").getElement().contentEditable = false;
						                } else {
						                    row.getCell("sbi_no").getElement().style.backgroundColor = "";
						                    row.getCell("sbi_no").getElement().contentEditable = true;
						                }
						            }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCsbi_no', 'ID#'),
						            field: "sbi_no",
						            editor: "input",
									headerTooltip:"ID#",
						            editable: false,
						            editorParams: {elementAttributes: {maxlength: "8"}},
						            cellEdited: function(cell) {
						                const row = cell.getRow();
						                const type = row.getData().type;
						                const sbiNo = cell.getValue();

						                if (type === "I" && sbiNo.length === 8) {
						                    fetchInmateDetailsForMGC(sbiNo, row);
						                } else if (type === "I" && sbiNo.length > 0 && sbiNo.length !== 8) {
						                    message('CUW', 'SBI number must be 8 digits', 0);
						                    cell.setValue("");
						                }
						            }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCfirst_name', 'First Name'),
						            field: "first_name",
						            editor: "input",
						            editable: false,
									headerTooltip:"First Name",
									headerSort: true,
									sorter: customSorter
									//sorterParams: { isRowEmpty: isMgcSmeRowEmpty, type: 'string' }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGClast_name', 'Last Name'),
						            field: "last_name",
						            editor: "input",
						            editable: false,
									headerTooltip:"Last Name",
									headerSort: true,
									sorter: customSorter
									//sorterParams: { isRowEmpty: isMgcSmeRowEmpty, type: 'string' }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmid_name', 'MI'),
						            field: "mid_name",
						            editor: "input",
						            editable: false,
									headerTooltip:"MI",
									headerSort: true,
									sorter: customSorter,
									//sorterParams: { isRowEmpty: isMgcSmeRowEmpty, type: 'string' },
						            width: 70
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCsuffix_name', 'Suffix'),
						            field: "suffix_name",
						            editor: "input",
						            editable: false,
									headerTooltip:"Suffix",
									headerSort: true,
									sorter: customSorter,
									//sorterParams: { isRowEmpty: isMgcSmeRowEmpty, type: 'string' },
						            width: 100
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCvote_type', 'Vote Cast'),
						            field: "vote_type",
						            editor: "list",
									headerTooltip:"Vote Type",
									headerSort: true,
									sorter: customSorter,
									//sorterParams: { isRowEmpty: isMgcSmeRowEmpty, type: 'string' },
						            editorParams: {
						                values: { "": "", "U": "Uphold", "D": "Deny", "A": "Abstain" },
						                autocomplete: true,
						                allowEmpty: true,
						                listOnEmpty: true,
						                verticalNavigation: "table"
						            },
						            formatter: function(cell) {
						                const value = cell.getValue();
						                return { "": "", "U": "Uphold", "D": "Deny", "A": "Abstain" }[value] || "";
						            },
						            cellEdited: function(cell) {
						                updateMGCVoteCounts();
						            }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCtie_breaker_flag', 'Tie Breaker'),
						            field: "tie_breaker_flag",
									headerTooltip:"Tie Breaker",
						            formatter: function(cell) {
						                const value = cell.getValue();
						                return `<input type="checkbox" ${value === "Y" ? "checked" : ""} />`;
						            },
						            width: 100,
						            headerSort: false,
									cellClick: function(e, cell) { // <-- CORRECTED
						                if (e.target.type === 'checkbox') {
						                    cell.setValue(e.target.checked ? "Y" : "N");
						                }
						            }
						        }
						    ]
						});

						tabulatorRegistry["mgc-Table"] = {
						    varName: "mgcSmeTable",
						    instance: mgcSmeTable
						};

						var mgcMembers = [
						    { checkbox: "t", typePerson: "", id: "", firstname: "", lastname: "", mi: "", suffix: "", startDate: "", endDate: "", checked: false },
						    { checkbox: "t", typePerson: "", id: "", firstname: "", lastname: "", mi: "", suffix: "", startDate: "", endDate: "", checked: false },
						    { checkbox: "t", typePerson: "", id: "", firstname: "", lastname: "", mi: "", suffix: "", startDate: "", endDate: "", checked: false },
						    { checkbox: "t", typePerson: "", id: "", firstname: "", lastname: "", mi: "", suffix: "", startDate: "", endDate: "", checked: false }
						];

						//const isMgcMembersRowEmpty = (data) => !data.type && !data.first_name && !data.last_name;
						
						var mgcMembersTable = new Tabulator("#mgcMembers-table", {
						    layout: "fitColumns",
						    data: mgcMembers,
						    height: '140px',
						    printAsHtml: true,
						    printStyled: true,
							editorParams: {elementAttributes: {maxlength: "8"}},
							cellEditing: generalTableCellEditingValidation,
						    columns: [
						        { title: "id", field: "id", visible: false },
						        { title: "upd", field: "upd", visible: false },
						        { title: "seqno", field: "seqno", visible: false },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmembercheckbox', 'Select'),
						            field: "checkbox",
						            formatter: function(cell) {
						                const data = cell.getData();
						                return '<input type="checkbox" class="mgc-member-select-checkbox" ' + (data.checked ? "checked" : "") + '>';
						            },
						            width: 100,
						            headerSort: false,
						            cellClick: function(e, cell) {
						                if (e.target.classList.contains('mgc-member-select-checkbox') || e.target.tagName === 'TD') {
						                    const row = cell.getRow();
						                    const data = row.getData();
						                    data.checked = !data.checked;
						                    row.update({ checked: data.checked });
						                }
						            }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmembertype', 'Type of Person'),
						            field: "type",
						            editor: "list",
									headerTooltip:"Type of Person",
									headerSort: true,
									sorter: customSorter,
									//sorterParams: { isRowEmpty: isMgcMembersRowEmpty, type: 'string' },
						            editorParams: {
						                values: { "": "", "I": "Inmate", "S": "Staff" },
						                autocomplete: true,
						                allowEmpty: true,
						                listOnEmpty: true
						            },
						            formatter: function(cell) {
						                const value = cell.getValue();
						                return { "": "", "I": "Inmate", "S": "Staff" }[value] || "";
						            },
						            cellEdited: function(cell) {
						                const row = cell.getRow();
						                const type = cell.getValue();
						                if (type === "S") {
						                    row.update({ sbi_no: "", first_name: "", last_name: "", mid_name: "", suffix_name: "" });
						                    row.getCell("sbi_no").getElement().style.backgroundColor = "";
						                    row.getCell("sbi_no").getElement().contentEditable = false;
						                } else {
						                    row.getCell("sbi_no").getElement().style.backgroundColor = "";
						                    row.getCell("sbi_no").getElement().contentEditable = true;
						                }
						            }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmembersbi_no', 'ID#'),
						            field: "sbi_no",
						            editor: "input",
									headerTooltip:"ID#",
						            editorParams: {elementAttributes: {maxlength: "8"}},
						            cellEdited: function(cell) {
						                const row = cell.getRow();
						                const type = row.getData().type;
						                const sbiNo = cell.getValue();
						                
						                if (type === "I" && sbiNo.length === 8) {
						                    fetchInmateDetailsForMGC(sbiNo, row);
						                } else if (type === "I" && sbiNo.length > 0 && sbiNo.length !== 8) {
						                    message('CUW', 'SBI number must be 8 digits', 0);
						                    cell.setValue("");
						                }
						            }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmemberfirst_name', 'First Name'),
						            field: "first_name",
						            editor: "input",
									headerTooltip:"First Name",
									headerSort: true,
									sorter: customSorter
									//sorterParams: { isRowEmpty: isMgcMembersRowEmpty, type: 'string' }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmemberlast_name', 'Last Name'),
						            field: "last_name",
						            editor: "input",
									headerTooltip:"Last Name",
									headerSort: true,
									sorter: customSorter
									//sorterParams: { isRowEmpty: isMgcMembersRowEmpty, type: 'string' }
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmembermid_name', 'MI'),
						            field: "mid_name",
						            editor: "input",
									headerTooltip:"MI",
									headerSort: true,
									sorter: customSorter,
									//sorterParams: { isRowEmpty: isMgcMembersRowEmpty, type: 'string' },
						            width: 80
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmembersuffix_name', 'Suffix'),
						            field: "suffix_name",
						            editor: "input",
									headerTooltip:"Suffix",
									headerSort: true,
									sorter: customSorter,
									//sorterParams: { isRowEmpty: isMgcMembersRowEmpty, type: 'string' },
						            width: 100
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmemberselectBtn', ''),
						            field: "selectBtn",
						            formatter: function(cell, formatterParams, onRendered) {
						                return `<span>
						                    <a href="#" class="ml-2 mgc-select-icon" data-toggle="modal" title="Click to select staff" data-target="#mgcUserSuffixModal" title="Select from list">                    
						                        <i class="fa fa-users text-primary"></i>
						                    </a>
						                </span>`;
						            },
						            width: 40,
						            headerSort: false
						         },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmemberstart_date', 'Start Date'),
						            field: "start_date",
						            editor: dateEditor,
									headerTooltip:"Start Date",
									headerSort: true,
									sorter: customSorter,
									//sorterParams: { isRowEmpty: isMgcMembersRowEmpty, type: 'date' },
						            cellEdited: function(cell) {}
						        },
						        {
						            titleFormatter: (column) => setTitleDesc(column, 'MGCmemberend_date', 'End Date'),
						            field: "end_date",
						            editor: dateEditor,
									headerTooltip:"End Date",
									headerSort: true,
									sorter: customSorter,
									//sorterParams: { isRowEmpty: isMgcMembersRowEmpty, type: 'date' },
						            cellEdited: function(cell) {}
						        }
						    ]
						});

						tabulatorRegistry["mgcMembers-table"] = {
						    varName: "mgcMembersTable",
						    instance: mgcMembersTable
						};

						var currentMGCRow = null;

						var mgcUserSuffixModal = [
						    {lastname:"", firstname:"", mi:"", suffix:""},
						    {lastname:"", firstname:"", mi:"", suffix:""},
						    {lastname:"", firstname:"", mi:"", suffix:""},
						    {lastname:"", firstname:"", mi:"", suffix:""},
						    {lastname:"", firstname:"", mi:"", suffix:""},
						    {lastname:"", firstname:"", mi:"", suffix:""},
						    {lastname:"", firstname:"", mi:"", suffix:""},
						    {lastname:"", firstname:"", mi:"", suffix:""}
						];

						var mgcUserSuffixModalTable = new Tabulator("#mgcUserSuffixModal-table", {
							layout: "fitColumns",
							//data: mgcUserSuffixModal,
							data:[],
							height: '200px',
							selectable: 1,
							columns: [
								{ title: "First Name", field: "user_first_name" },
								{ title: "Last Name", field: "user_last_name" },
								{ title: "MI", field: "user_mid_name", width: 80 },
								{ title: "Suffix", field: "user_suffix_name", width: 100 }
							],
							rowClick: function(e, row) {
								currentMGCRow.selectedPerson = row.getData();
								
								if (currentMGCRow.selectedPerson.user_first_name === "No staff found") {
									message('CUW', 'Please select a valid staff member', 0);
									return;
								}

								if (currentMGCRow.row) {
									currentMGCRow.row.update({
										type: "S",
										sbi_no: "", 
										user_id: currentMGCRow.selectedPerson.user_id || '', 
										first_name: currentMGCRow.selectedPerson.user_first_name || '',
										last_name: currentMGCRow.selectedPerson.user_last_name || '',
										mid_name: currentMGCRow.selectedPerson.user_mid_name || '',
										suffix_name: currentMGCRow.selectedPerson.user_suffix_name || '',
										start_date: formatDateForInput(new Date().toISOString()),
										checked: false
									});
									
									const idCell = currentMGCRow.row.getCell("sbi_no");
									if (idCell) {
										idCell.getElement().style.backgroundColor = "";
										idCell.getElement().contentEditable = false;
									}
								}

								closeModalGracefully('#mgcUserSuffixModal');
							},
							rowSelectionChanged: function(data, rows) {
								if (rows.length > 0) {
									currentMGCRow.selectedPerson = rows[0].getData();
								}
							}
						});

						$(document).on('click', '#mgcUserSuffixModal-table .tabulator-row', function() {
							const row = mgcUserSuffixModalTable.getRow(this);
							if (row) {
								currentMGCRow.selectedPerson = row.getData();
								
								if (currentMGCRow.selectedPerson.user_first_name === "No staff found") {
									message('CUW', 'Please select a valid staff member', 0);
									return;
								}

								if (currentMGCRow.row) {
									currentMGCRow.row.update({
										type: "S",
										sbi_no: "", 
										user_id: currentMGCRow.selectedPerson.user_id || '', 
										first_name: currentMGCRow.selectedPerson.user_first_name || '',
										last_name: currentMGCRow.selectedPerson.user_last_name || '',
										mid_name: currentMGCRow.selectedPerson.user_mid_name || '',
										suffix_name: currentMGCRow.selectedPerson.user_suffix_name || '',
										start_date: formatDateForInput(new Date().toISOString()),
										checked: false
									});
									
									const idCell = currentMGCRow.row.getCell("sbi_no");
									if (idCell) {
										idCell.getElement().style.backgroundColor = "";
										idCell.getElement().contentEditable = false;
									}
								}

								closeModalGracefully('#mgcUserSuffixModal');
							}
						});

						$("#mgcMembers-table").on("click", ".mgc-select-icon", function(e) {
						    e.preventDefault();
						    var rowElement = $(this).closest('.tabulator-row')[0];
						    var row = mgcMembersTable.getRow(rowElement);
						    var data = row.getData();

						    if (data.type !== "S") {
						        message('OG03', 0, 0);
						        e.stopPropagation();
						        return;
						    }
						    currentMGCRow = {
						        row: row,
						        selectedPerson: null
						    };
						});

						function fetchInmateDetailsForMGC(sbiNo, row) {
						    $.ajax({
						        url: "/OmnetTest/Booking/combinedDetails",
						        type: 'GET',
						        data: { sbiNo: sbiNo },
						        success: function(response) {
						            if (response && response.length > 0) {
						                const inmate = response[0];
						                row.update({
						                    first_name: inmate.COMMIT_FNAME || '',
						                    last_name: inmate.COMMIT_LNAME || '',
						                    mid_name: inmate.COMMIT_MNAME || '',
						                    suffix_name: inmate.COMMIT_SNAME || '',
						                    start_date: formatDateForInput(new Date().toISOString())
						                });
						            } else {
						                row.update({ first_name: '', last_name: '', mid_name: '', suffix_name: '' });
						                message('OG02',0,0);
						            }
						        },
						        error: function(xhr) {
						            row.update({ first_name: '', last_name: '', mid_name: '', suffix_name: '' });
						            message('CUE', 'Error fetching inmate details', 0);
						        }
						    });
						}

						function loadMGCStaffList(searchTerm = '') {
						    $.ajax({
						        url: '/OmnetTest/OffenderGrievance/getStaffList',
						        type: 'GET',
						        data: { searchTerm: searchTerm },
						        success: function(staffList) {
						            mgcUserSuffixModalTable.deselectRow();
						            
						            if (staffList && staffList.length > 0) {
						                mgcUserSuffixModalTable.setData(staffList).then(function() {
						                    if (currentMGCRow && currentMGCRow.selectedPerson) {
						                        const rows = mgcUserSuffixModalTable.getRows().filter(row => {
						                            return row.getData().user_id === currentMGCRow.selectedPerson.user_id;
						                        });
						                        if (rows.length > 0) {
						                            rows[0].select();
						                        }
						                    }
						                });
						            } else {
						                mgcUserSuffixModalTable.setData([{
						                    user_first_name: "No staff found",
						                    user_last_name: "",
						                    user_mid_name: "",
						                    user_suffix_name: ""
						                }]);
						                if (currentMGCRow) {
						                    currentMGCRow.selectedPerson = null;
						                }
						            }
						        },
						        error: function(xhr) {
						            console.error("Error loading staff list:", xhr.responseText);
						            message('CUE', 'Error loading staff list', 0);
						        }
						    });
						}

						function updateMGCVoteCounts() {
						    let upholdCount = 0;
						    let denyCount = 0;
						    let abstainCount = 0;
						    
						    mgcSmeTable.getData().forEach(row => {
						        if ((row.first_name || row.last_name) && row.vote_type) {
						            switch(row.vote_type) {
						                case 'U': upholdCount++; break;
						                case 'D': denyCount++; break;
						                case 'A': abstainCount++; break;
						            }
						        }
						    });
						    
						    $('#mgcTotalUphold').val(upholdCount);
						    $('#mgcTotalDeny').val(denyCount);
						    $('#mgcTotalAbstain').val(abstainCount);
						}

						$('#MGCrowRemoveBtn').click(function(e){
						    e.preventDefault();
						    const allData = mgcSmeTable.getData();
						    const isAnyRowSelected = allData.some(row => row.checked);

						    if (!isAnyRowSelected) {
						        message('CUW', 'Please select one or more MGC Members to remove.', 0);
						        return;
						    }

						    confirmation("Are you sure you want to remove the selected MGC Members from the list?", function(){
						        let remainingData = allData.filter(row => !row.checked);

						        const createEmptyRow = () => ({
						            type: "", sbi_no: "", user_id: null, first_name: "", last_name: "", mid_name: "",
						            suffix_name: "", vote_type: "", tie_breaker_flag: "N", checked: false
						        });

						        const originalRowCount = allData.length;
						        while (remainingData.length < originalRowCount) {
						            remainingData.push(createEmptyRow());
						        }

						        mgcSmeTable.setData(remainingData).then(() => {
						            mgcSmeTable.getRows().forEach(row => {
						                if (row.getData().type === "S") {
						                    const idCell = row.getCell("sbi_no");
						                    if (idCell && idCell.getElement()) {
						                        idCell.getElement().style.backgroundColor = "";
						                        idCell.getElement().contentEditable = false;
						                    }
						                }
						            });
						            updateMGCVoteCounts();
						        });
						    });
						});

						$('#MGCrowAddBtn').click(function(e) {
						    e.preventDefault();
						    const rows = mgcMembersTable.getData();
						    let allValid = true;
						    let lastRowComplete = true;

						    if (rows.length > 0) {
						        const lastRow = rows[rows.length - 1];
						        if (!lastRow.type || !lastRow.first_name || !lastRow.last_name || !lastRow.start_date) {
						            lastRowComplete = false;
						            return;
						        }
						        if (lastRow.type === "I" && (!lastRow.sbi_no || lastRow.sbi_no.length !== 8)) {
						            lastRowComplete = false;
						            message('OG01',0,0);
						            return;
						        }
						    }

						    for (let i = 0; i < rows.length; i++) {
						        const row = rows[i];
						        const isEmptyRow = !row.type && !row.first_name && !row.last_name && !row.sbi_no &&
						                          !row.mid_name && !row.suffix_name && !row.start_date && !row.end_date;
						        if (isEmptyRow) {
						            if (i < rows.length - 1) {
						                return;
						            }
						            continue;
						        }
						        if (!row.type || !row.first_name || !row.last_name || 
						            (row.type === "I" && (!row.sbi_no || row.sbi_no.length !== 8))) {
						            allValid = false;
						            break;
						        }
						    }

						    if (lastRowComplete && allValid) {
						        mgcMembersTable.addRow({
						            type: "",
						            sbi_no: "",
						            first_name: "",
						            last_name: "",
						            mid_name: "",
						            suffix_name: "",
						            start_date: "",
						            end_date: "",
						            checked: false
						        }).then(row => {
						            row.getCell("type").edit();
						        });
						    }
						});

						$('#mgcUserSuffixModal').on('show.bs.modal', function() {
						    if (!currentMGCRow) {
						        return;
						    }
						    currentMGCRow.selectedPerson = null; 
						    $('#mgcUserSuffixModal input[type="text"]').val('');
						    mgcUserSuffixModalTable.deselectRow();
						    loadMGCStaffList();
						});
						
						$('#mgcUserSuffixModal').on('shown.bs.modal', function() {
						   $('#mgcUserSuffixModal input[type="text"]').focus();
						});

						$('#mgcUserSuffixModal').on('hidden.bs.modal', function() {
						   currentMGCRow = null; 
						});

						$('#mgcUserSuffixModal').on('click', '#fetchDataBtn:not([data-action="ok"])', function(e) {
						    e.preventDefault();
						    const searchTerm = $('#mgcUserSuffixModal input[type="text"]').val().trim();
						    loadMGCStaffList(searchTerm);
						});

						$('#mgcUserSuffixModal').on('keydown', 'input[type="text"]', function(e) {
							if (e.key === 'Enter') {
								e.preventDefault();
								$('#mgcUserSuffixModal').find('#fetchDataBtn:not([data-action="ok"])').click();
							}
						});

						$('#SelectMGCMember').on('show.bs.modal', function() {
					
							const currentData = mgcMembersTable.getData();
							   const uncheckedData = currentData.map(row => {
							       return {...row, checked: false};
							   });
							   mgcMembersTable.setData(uncheckedData);
							   
						    const instNum = $('#Facility').val();
						    const tableElement = document.getElementById("mgcMembers-table");
						    const lastLoadedInstNum = tableElement.getAttribute('data-inst-num');

						    if (instNum && lastLoadedInstNum === instNum && mgcMembersTable.getData().length > 0) {
						        return;
						    }

						    if (!instNum) {
						        message('CUW', 'Please select a facility first.', 0);
						        mgcMembersTable.setData(mgcMembers);
						        tableElement.removeAttribute('data-inst-num');
						        return;
						    }

						    tableElement.setAttribute('data-inst-num', instNum);

						    loader(1);
						    $.ajax({
						        url: '/OmnetTest/OffenderGrievance/getMGCMembers',
						        type: 'GET',
						        data: { instNum: instNum },
						        success: function(members) {
						            const tableData = members.map(member => ({
						                type: member.type_of_person || '',
						                sbi_no: member.sbi_no || '',
						                user_id: member.user_id || '',
						                first_name: member.user_first_name || '',
						                last_name: member.user_last_name || '',
						                mid_name: member.user_mid_name || '',
						                suffix_name: member.user_suffix_name || '',
						                start_date: member.start_date ? formatDateForInput(member.start_date) : '',
						                end_date: member.end_date ? formatDateForInput(member.end_date) : '',
						                checked: false,
						                rgc_mgc_dtl_seq_num: member.rgc_mgc_dtl_seq_num
						            }));

						            while (tableData.length < 4) {
						                tableData.push({
						                    type: "", sbi_no: "", user_id: "", first_name: "", last_name: "", mid_name: "",
						                    suffix_name: "", start_date: "", end_date: "", checked: false
						                });
						            }

						            mgcMembersTable.setData(tableData).then(function() {
						                mgcMembersTable.getRows().forEach(function(row) {
						                    const data = row.getData();
						                    const sbiCell = row.getCell("sbi_no");
						                    if (sbiCell) {
						                        if (data.type === "S") {
						                            sbiCell.getElement().style.backgroundColor = "";
						                            sbiCell.getElement().setAttribute('contentEditable', 'false');
						                            sbiCell.getElement().style.pointerEvents = 'none';
						                            if (sbiCell._cell.editor) {
						                                sbiCell._cell.editor.disabled = true;
						                            }
						                        } else {
						                            sbiCell.getElement().style.backgroundColor = "";
						                            sbiCell.getElement().setAttribute('contentEditable', 'true');
						                            sbiCell.getElement().style.pointerEvents = '';
						                            if (sbiCell._cell.editor) {
						                                sbiCell._cell.editor.disabled = false;
						                            }
						                        }
						                    }
						                });
						            });
						            loader(0);
						        },
						        error: function() {
						            message('CUE', 'Error loading MGC members.', 0);
						            mgcMembersTable.setData(mgcMembers);
						            loader(0);
						        }
						    });
						});

						$('#SelectMGCMember #fetchDataBtn').click(function(e){
						    e.preventDefault();
						    const selectedMembers = mgcMembersTable.getData().filter(m => m.checked);
						    if (!selectedMembers.length) {
						        message('CUW', 'Please select at least one valid member by checking the checkbox.', 0);
						        return;
						    }

							for (const member of selectedMembers) {
								if (!member.first_name || !member.last_name) {
									message('CUW', 'First Name & Last Name is mandatory.', 0);
									return;
								}
							}
													
						    const currentSmeData = mgcSmeTable.getData();
						    const emptySmeRows = mgcSmeTable.getRows().filter(r => {
						        const d = r.getData();
						        return !d.type && !d.first_name && !d.last_name;
						    });

						    let addedCount = 0;
						    selectedMembers.forEach((member) => {
						        const isDuplicate = currentSmeData.some(existingMember => {
						            if (!existingMember.type) return false;
						            if (member.type === 'S' && existingMember.type === 'S') {
						                return existingMember.user_id && existingMember.user_id === member.user_id;
						            }
						            if (member.type === 'I' && existingMember.type === 'I') {
						                return existingMember.sbi_no && existingMember.sbi_no === member.sbi_no;
						            }
						            return false;
						        });

						        if (!isDuplicate) {
						            addedCount++;
						            const rowData = {
						                type: member.type,
						                sbi_no: member.type === 'I' ? member.sbi_no : '',
						                user_id: member.type === 'S' ? member.user_id : null,
						                first_name: member.first_name,
						                last_name: member.last_name,
						                mid_name: member.mid_name,
						                suffix_name: member.suffix_name,
						                vote_type: "",
						                tie_breaker_flag: "N",
						                checked: false
						            };
						            if (emptySmeRows.length > 0) {
						                const rowToUpdate = emptySmeRows.shift();
						                rowToUpdate.update(rowData);
						            } else {
						                mgcSmeTable.addRow(rowData);
						            }
						        }
						    });

						    mgcMembersTable.getRows().forEach(row => {
						        if (row.getData().checked) {
						            row.update({ checked: false });
						            row.deselect();
						        }
						    });

						    if (addedCount > 0) {
						        //message('CUS', `Added ${addedCount} new member(s) to the MGC table.`, 1);
						    } else if (selectedMembers.length > 0) {
						        message('CUW', 'Selected member(s) already exist in the MGC table.', 0);
						    }

						    closeModalGracefully('#SelectMGCMember');
						    updateMGCVoteCounts();
						});

						function populateMGCTable(persons) {
						    const data = persons.map(person => {
						        const isStaff = person.grvn_staff_tp === 'S';
						        return {
						            type: person.grvn_staff_tp,
						            sbi_no: isStaff ? '' : (person.sbi_no || ''),
						            user_id: isStaff ? (person.user_id || '') : null,
						            first_name: person.first_name || '',
						            last_name: person.last_name || '',
						            mid_name: person.mid_name || '',
						            suffix_name: person.suffix_name || '',
						            vote_type: person.vote_type || '',
						            tie_breaker_flag: person.tie_breaker_flag || 'N',
						            checked: false
						        };
						    });

						    while (data.length < 4) {
						        data.push({
						            type: "", sbi_no: "", user_id: null, first_name: "", last_name: "", mid_name: "",
						            suffix_name: "", vote_type: "", tie_breaker_flag: "N", checked: false
						        });
						    }

						    mgcSmeTable.setData(data).then(() => {
						        mgcSmeTable.getRows().forEach(row => {
						            const rowData = row.getData();
						            if (rowData.type === "S") {
						                const idCell = row.getCell("sbi_no");
						                if (idCell && idCell.getElement()) {
						                    idCell.getElement().style.backgroundColor = "";
						                    idCell.getElement().contentEditable = false;
						                }
						            }
						        });
						        updateMGCVoteCounts();
						    });
						}

						function loadMGCSMEData(commitNo, seqNum) {
						    if (!commitNo || !seqNum) return;
						   
						    $.ajax({
						        url: '/OmnetTest/OffenderGrievance/getMGCDetails',
						        type: 'GET',
						        data: { 
						            commitNo: commitNo,
						            seqNum: seqNum,
						            cmtyType: 'MGC'
						        },
						        success: function(mgcData) {
						            if (mgcData) {
						                $('#MGCdateReceived').val(formatDateForInput(mgcData.grvn_rew_rcpt_dt)).trigger('input');
						                $('#MGCdateRecommendation').val(formatDateForInput(mgcData.grvn_rew_recm_dt)).trigger('input');
						                $('#MGCrecommendationComments').val(mgcData.grvn_rew_recm_desc || '').trigger('input');;
						                $('#MGCforwardToWarden').prop('checked', mgcData.grvn_rew_frwd_to_flg === 'Y');
						            }
						        }
						    });

						    $.ajax({
						        url: '/OmnetTest/OffenderGrievance/getPersonsInvolved',
						        type: 'GET',
						        data: { 
						            commitNo: commitNo,
						            seqNum: seqNum,
						            cmtyType: 'MGC'
						        },
						        success: function(response) {
						            let persons = [];
						            if (response && response.MGC) { 
						                persons = response.MGC;
						            }
						            populateMGCTable(persons);
						            updateMGCVoteCounts();
						        },
						        error: function(xhr) {
						            console.error("Error loading MGC members:", xhr.responseText);
						            populateMGCTable([]);
						        }
						    });
						}
						   	   
					var refrefredselectName = Array(5).fill().map(() => ({ lastname: "", firstname: "", mi: "", suffix: "" }));
					var refCommitteselectName = Array(5).fill().map(() => ({ lastname: "", firstname: "", mi: "", suffix: "" }));

					var referral = Array(4).fill().map(() => ({
					    checkbox: "t",
					    refdate: "",
					    radioPerson: "",
					    radioCommittee: "",
					    nameCommittee: "",
					    externalAgencies: "",
					    referredBy: "",
						referredByUserId: null,
					    checked: false,
					    informationRequested: "",
					    responseToRequest: "",
					    assignedUserId: null,
						due_date: "",
		                response_date: "",
		                confidential_flag: "N",
		                completed_flag: "N",
		                scan: "",
		                view: "",
		                attach: ""
					}));
				
					let currentReferralRow = null; 

					//const isReferralRowEmpty = (data) => !data.refdate;
					
					var referralTable = new Tabulator("#referral-Table", {
						//layout: "fitColumns",
						data: referral,
						height: '160px',
						selectable: 1,
						printAsHtml: true,
						printStyled: true,
						columns: [
							{ title: "id", field: "id", visible: false },
							{ title: "upd", field: "upd", visible: false },
							{ title: "seqno", field: "seqno", visible: false },
							{
								titleFormatter: (column) => setTitleDesc(column, 'Refferalcheckbox', 'Select'),
								field: "checkbox",
								formatter: function (cell) {
									return '<input type="checkbox" class="referral-checkbox" ' + (cell.getData().checked ? "checked" : "") + '>';
								},
								width: 100,
								hozAlign: "center",
								headerSort: false,
								cellClick: function (e, cell) {
									
									const data = cell.getRow().getData();
									if (!data.refdate) {
										e.preventDefault();
										return;
									}
									if (e.target.classList.contains('referral-checkbox')) {
										const row = cell.getRow();
										row.update({ checked: !row.getData().checked });
									}
								}
							},
							{ titleFormatter: (column) => setTitleDesc(column, 'Refferalrefdate', 'Ref. Date'), field: "refdate", width: 100, editor: dateEditor,headerTooltip:"Refferal Date",headerSort: true,sorter: customSorter},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferalradioPerson', 'Person'),
								field: "radioPerson",
								headerTooltip:"Person",
								formatter: function (cell) {
									return `<input type="radio" name="refType_${cell.getRow().getPosition()}" ${cell.getRow().getData().radioPerson === 'Y' ? 'checked' : ''} />`;
								},
								width: 80,
								hozAlign: "center",
								cellClick: function (e, cell) {
									const row = cell.getRow();
									const rowData = row.getData();
									
									if (!rowData.refdate) {
										e.preventDefault();
										return;
									}

									if (rowData.radioPerson !== 'Y') {
										const updateData = { 
											radioPerson: 'Y', 
											radioCommittee: 'N', 
											nameCommittee: '', 
											assignedUserId: null,
											informationRequested: '', 
											responseToRequest: ''    
										};
										row.update(updateData);
										if (currentReferralRow && currentReferralRow.getPosition() === row.getPosition()) {
											$('#informationRequested').val('');
											$('#responseToRequest').val('');
										}
									}
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferalradioCommittee', 'Committee'),
								field: "radioCommittee",
								headerTooltip:"Commitee",
								formatter: function (cell) {
									return `<input type="radio" name="refType_${cell.getRow().getPosition()}" ${cell.getRow().getData().radioCommittee === 'Y' ? 'checked' : ''} />`;
								},
								width: 100,
								hozAlign: "center",
								cellClick: function (e, cell) {
									const row = cell.getRow();
									const rowData = row.getData();
									
									if (!rowData.refdate) {
										e.preventDefault();
										return;
									}
									if (rowData.radioCommittee !== 'Y') {
										const updateData = {
											radioPerson: 'N',
											radioCommittee: 'Y',
											nameCommittee: '', 
											assignedUserId: null,
											informationRequested: '',
											responseToRequest: ''     
										};
										row.update(updateData);
										if (currentReferralRow && currentReferralRow.getPosition() === row.getPosition()) {
											$('#informationRequested').val('');
											$('#responseToRequest').val('');
										}
									}
								}
							},
							{ 
								titleFormatter: (column) => setTitleDesc(column, 'RefferalnameCommittee', 'Name L, F, M, S / Committee'), 
								field: "nameCommittee", 
								editor: "input", 
								editable: false,
								headerTooltip: "Name L, F, M, S / Committee",
								width: 220,
								headerSort: true,
								sorter: customSorter,
								cellMouseOver: function (e, cell) {
									const data = cell.getRow().getData();
									if (data.nameCommittee) {
										showCustomTooltip(e, cell, data.nameCommittee);
									}
								},
								cellMouseMove: moveCustomTooltip,
								cellMouseOut: hideCustomTooltip
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferalselectBtn', ''),
								field: "selectBtn",
								formatter: nameCommitteeIcon,
								width: 40,
								headerSort: false,
								cellClick: function (e, cell) {
									e.preventDefault();
									const row = cell.getRow();
									const data = row.getData();
									
									if (!data.refdate) {
										return;
									}
									if (!data.radioPerson && !data.radioCommittee) {
										message('CUW', 'Please select either Person or Committee first', 0);
										return;
									}
									$('#userCommitteName, #RefuserCommitteName').data('currentRow', row);
									if (data.radioPerson === 'Y') {
										selectedReferralStaff = null;
										refStaffSelectionTable.deselectRow();
										refStaffSelectionTable.clearData();
										$('#userCommitteName').modal('show');
									} else if (data.radioCommittee === 'Y') {
										$('#RefuserCommitteName').modal('show');
									}
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferalexternalAgencies', 'External Agencies / Person'),
								field: "externalAgencies",
								headerTooltip: "External Agencies / Person",
								editor: "input",
								width: 250,
								headerSort: true,
								sorter: customSorter,
								editable: function(cell) {
									return !!cell.getRow().getData().refdate;
								},
								cellMouseOver: function (e, cell) {
									const data = cell.getRow().getData();
									if (data.externalAgencies) {
										showCustomTooltip(e, cell, data.externalAgencies);
									}
								},
								cellMouseMove: moveCustomTooltip,
								cellMouseOut: hideCustomTooltip
							},
							{ 
								titleFormatter: (column) => setTitleDesc(column, 'RefferalreferredBy', 'Referred By'), 
								field: "referredBy", 
								editor: "input", 
								editable: false,
								headerTooltip: "Referred By",
								width: 150,
								cellMouseOver: function (e, cell) {
									const data = cell.getRow().getData();
									if (data.referredBy) {
										showCustomTooltip(e, cell, data.referredBy);
									}
								},
								cellMouseMove: moveCustomTooltip,
								cellMouseOut: hideCustomTooltip
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferalreferredByBtn', ''),
								field: "referredByBtn",
								formatter: refferedIcon,
								width: 40,
								headerSort: false, 
								cellClick: function (e, cell) {
									e.preventDefault();
									
									const row = cell.getRow();
									if (!row.getData().refdate) {
										return;
									}
									$('#SelectRefMemberFindListModal').data('currentRow', row);
									selectedReferralStaff = null;
									refReferredByTable.deselectRow();
									refReferredByTable.clearData();
									$('#SelectRefMemberFindListModal').modal('show');
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferaldueDate', 'Due Date'),
								field: "due_date",
								width: 100,
								editor: dateEditor,
								headerTooltip:"Due Date",
								headerSort: true,
								sorter: customSorter,
								cellEdited: validateReferralDates,
								editable: function(cell) {
									return !!cell.getRow().getData().refdate;
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferalrespDate', 'Resp. Date'),
								field: "response_date",
								width: 100,
								editor: dateEditor,
								headerTooltip: "Response Date",
								headerSort: true,
								sorter: customSorter,
								cellEdited: validateReferralDates,
								editable: function(cell) {
									return !!cell.getRow().getData().refdate;
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferalConfidential', 'Confidential'),
								field: "confidential_flag",
								formatter: function (cell) {
									const value = cell.getValue();
									return `<input type="checkbox" ${value === 'Y' ? 'checked' : ''}>`;
								},
								headerTooltip: "Confidential",
								width: 110,
								hozAlign: "center",
								cellClick: function (e, cell) {
									
									if (!cell.getRow().getData().refdate) {
										e.preventDefault();
										return;
									}
									if (e.target.type === 'checkbox') {
										cell.setValue(e.target.checked ? 'Y' : 'N');
									}
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'RefferalCompleted', 'Completed'),
								field: "completed_flag",
								formatter: function (cell) {
									const value = cell.getValue();
									return `<input type="checkbox" ${value === 'Y' ? 'checked' : ''}>`;
								},
								width: 100,
								hozAlign: "center",
								headerTooltip:"Completed",
								cellClick: function (e, cell) {
									
									if (!cell.getRow().getData().refdate) {
										e.preventDefault();
										return;
									}
									if (e.target.type === 'checkbox') {
										const rowData = cell.getRow().getData();
										const currentUserId = localStorage.getItem('userId');
										const isPersonSelected = rowData.radioPerson === 'Y';
										const assignedUserId = rowData.assignedUserId ? String(rowData.assignedUserId).trim() : null;
										const currentId = currentUserId ? String(currentUserId).trim() : null;

										if (e.target.checked && isPersonSelected && (!assignedUserId || assignedUserId !== currentId)) {
											message('CUW', 'you cannot mark this referral as completed. This referral can be marked as completed by the user to whom this is referred', 0);
											e.preventDefault();
											return;
										}
										cell.setValue(e.target.checked ? 'Y' : 'N');
									}
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'Refferalscan', 'Scan'),
								field: "scan",
								formatter: scanIcon,
								width: 70,
								headerTooltip:"Scan",
								hozAlign: "center",
								headerSort: false,
								cellClick: function(e, cell) {
									e.preventDefault();
									if (!cell.getRow().getData().refdate) return;
									confirmation("Please make sure scanner is online and document is loaded! Continue?", function() {
										if (typeof loader === 'function') loader(1);
										const checkScannerConnection = new Promise((resolve, reject) => {
											setTimeout(() => {
												resolve(false);
											}, 1500);
										});
										checkScannerConnection.then(isScannerConnected => {
											if (typeof loader === 'function') loader(0);
											if (isScannerConnected) {
												message('CUS', 'Scanner connected. Starting scan...', 0);
											} else {
												message('CUE', 'Please make sure scanner is properly installed in your machine IO!', 0);
											}
										}).catch(error => {
											if (typeof loader === 'function') loader(0);
											console.error("Scanner check failed:", error);
											message('CUE', 'An error occurred while checking for the scanner.', 0);
										});
									});
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'Refferalview', 'View'),
								field: "view",
								formatter: viewIcon,
								headerTooltip:"View",
								width: 70,
								hozAlign: "center",
								headerSort: false,
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'Refferalattach', 'Attach'),
								field: "attach",
								headerTooltip: "Attach",
								formatter: attachIcon,
								width: 70,
								hozAlign: "center",
								headerSort: false,
								cellClick: function (e, cell) {
									e.preventDefault();
									if (!cell.getRow().getData().refdate) {
										return;
									}
									$('#attachDocumentModal').modal('show');
								}
							}
						],
						horizontalScroll: true,
						scrollHorizontal: true
					});

                    tabulatorRegistry["referral-Table"] = {
                        varName: "referralTable",
                        instance: referralTable
                    };
					
					referralTable.on("cellEditing", function(cell) {
					    if (cell.getField() !== "refdate") return;
					    const table = cell.getTable();
					    const rows = table.getRows();
					    const currentRowIndex = rows.indexOf(cell.getRow());
					    if (currentRowIndex === 0) return;
					    const prevRow = rows[currentRowIndex - 1];
					    const prevRowData = prevRow.getData();
					    if (!prevRowData.refdate) {
					        setTimeout(() => {
					            prevRow.getCell("refdate").edit(true);
					        }, 50);
					        return false;
					    }
					});
					
					referralTable.on("cellEdited", function(cell) {
					    if (cell.getField() !== "refdate" || !cell.getValue()) {
					        return;
					    }

					    const row = cell.getRow();
					    const table = cell.getTable();
					    const rowData = row.getData();
					    if (!rowData.referredBy || rowData.referredBy.trim() === '') {
					        const currentUserId = localStorage.getItem('userId');
					        if (currentUserId) {
					            $.ajax({
					                url: '/OmnetTest/OffenderGrievance/getUserDetails',
					                type: 'GET',
					                data: { userId: currentUserId },
					                success: function(user) {
										const fullName = [
											user.user_last_name,
											[user.user_first_name, user.user_mid_name, user.user_suffix_name].filter(Boolean).join(" ")
										].filter(Boolean).join(", ");
					                    row.update({ referredBy: fullName });
					                },
					                error: function() {
					                    row.update({ referredBy: currentUserId });
					                }
					            });
					        }
					    }

					    const rows = table.getRows();
					    if (rows.length > 0 && rows[rows.length - 1].getPosition() === row.getPosition()) {
					        const newEmptyRow = {
					            checkbox: "t", refdate: "", radioPerson: "", radioCommittee: "", nameCommittee: "",
					            externalAgencies: "", referredBy: "", checked: false, informationRequested: "",
					            responseToRequest: "", assignedUserId: null, due_date: "", response_date: "",
					            confidential_flag: "N", completed_flag: "N", scan: "", view: "", attach: ""
					        };
					        table.addRow(newEmptyRow, false);
					    }
					});
					
					function validateReferralDates(cell){
					    const row=cell.getRow();
					    const rowData=row.getData();
					    const dueDateString=rowData.due_date;
					    const responseDateString=rowData.response_date;
					    if(dueDateString&&responseDateString&&isValidDate(dueDateString)&&isValidDate(responseDateString)){
					        const dueDate=new Date(dueDateString);
					        const responseDate=new Date(responseDateString);
					        if(dueDate<responseDate){
					            if(typeof message==='function'){
					                message('CUW','Due Date should not be less than the Response Date.',0);
					            }
					            cell.setValue(cell.getOldValue(),true);
					        }
					    }
					}

					function scanIcon(cell) {
						return `<span data-toggle="modal" data-target="#">
								<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="Scan">                    
									<i class="fa fa-print text-primary"></i>
								</a>
							</span>
						`;
					}

					function viewIcon(cell) {
						return `<span data-toggle="modal" data-target="#">
								<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="View">                    
									<i class="fa fa-file text-primary"></i>
								</a>
							</span>
						`;
					}

					function attachIcon(cell) {
						return `<span class="attach-icon-handler">
								<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="Attach Document">                  
									<i class="fa fa-paperclip text-primary"></i>
								</a>
							</span>
						`;
					}

					function fileIcon(cell) {
						return `<span><a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" title="Select File"><i class="fa fa-file text-primary"></i></a></span>`;
					}

					function cancelIcon(cell) {
						return `<span><a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" title="Cancel"><i class="fa fa-times-circle text-danger"></i></a></span>`;
					}

					
					var attachDocument = Array(5).fill().map(() => ({
						checkbox: "t",
						documentName: "",
						attachfileName: "",
					}));

					var attachDocumentTable = new Tabulator("#attachDocument-table", {
						layout: "fitColumns",
						data: attachDocument,
						height: '140px',
						printAsHtml: true,
						printStyled: true,
						columns: [{
								title: "View",
								field: "checkbox",
								formatter: "tickCross",
								formatterParams: {
									allowEmpty: true
								},
								width: 80,
								hozAlign: "center",
								cellClick: function(e, cell) {
									cell.setValue(!cell.getValue());
								}
							},
							{
								title: "Document Name",
								field: "documentName",
								editor: "input"
							},
							{
								title: "Attach file Name",
								field: "attachfileName",
								editor: "input",
								editable: false,
							},
							{
								title: "",
								field: "file",
								formatter: fileIcon,
								width: 40,
								hozAlign: "center",
								headerSort: false
							},
							{
								title: "",
								field: "cancel",
								formatter: cancelIcon,
								width: 40,
								hozAlign: "center",
								headerSort: false
							},
						]
					});

					referralTable.on("rowClick", function(e, row) {
					    currentReferralRow = row;
					    const rowData = row.getData();
					    const isRowEmpty = !rowData.refdate;
					    const currentUserId = localStorage.getItem('userId');

					    if (isRowEmpty) {
					        $('#informationRequested').val('').prop('disabled', true);
					        $('#responseToRequest').val('').prop('disabled', true);
					    } else {
					        $('#informationRequested').val(rowData.informationRequested || '').trigger('input').prop('disabled', false);
					        $('#responseToRequest').val(rowData.responseToRequest || '').trigger('input');

					        let hasPermission = false;

					        if (rowData.radioPerson === 'Y') {
					            const assignedId = rowData.assignedUserId ? String(rowData.assignedUserId).trim() : null;
					            const currentId = currentUserId ? String(currentUserId).trim() : null;

					            if (assignedId && currentId && assignedId === currentId) {
					                hasPermission = true;
					            }
					        }

					        $('#responseToRequest').prop('disabled', !hasPermission);
					    }

					    referralTable.deselectRow();
					    row.select();
					});

					$('#informationRequested').on('change', function() {
					    if (currentReferralRow) {
					        const rowData = currentReferralRow.getData();
					        if (!rowData.refdate) {
					            message('CUE', 'Cannot Update data.', 0);
					            $(this).val(rowData.informationRequested || '');
					            return;
					        } else {
					            currentReferralRow.update({ informationRequested: $(this).val() });
					        }
					    }
					});

					$('#responseToRequest').on('change', function() {
					    if (currentReferralRow) {
					        const rowData = currentReferralRow.getData();
					        const currentUserId = localStorage.getItem('userId');

					        if (!rowData.refdate) {
					            message('CUE', 'Cannot Update data.', 0);
					            $(this).val(rowData.responseToRequest || '');
					            return;
					        }

					        let hasPermission = false;
					        if (rowData.radioPerson === 'Y') {
					            if (rowData.assignedUserId && currentUserId && String(rowData.assignedUserId).trim() === String(currentUserId).trim()) {
					                hasPermission = true;
					            }
					        } else {
					            hasPermission = true;
					        }

					        if (hasPermission) {
					            currentReferralRow.update({ responseToRequest: $(this).val() });
					        } else {
					            message('CUE', 'Cannot Update data.', 0);
					            $(this).val(rowData.responseToRequest);
					        }
					    }
					});

					function nameCommitteeIcon(cell, formatterParams, onRendered) {
					    return `<span><a href="#" class="ml-2" data-toggle="tooltip" title="Click to select staff / Commitee" data-placement="top" title="Select from list"><i class="fa fa-users text-primary"></i></a></span>`;
					}

					function refferedIcon(cell, formatterParams, onRendered) {
					    return `<span><a href="#" class="ml-2" data-toggle="tooltip" title="Click to select staff" data-placement="top" title="Select from list"><i class="fa fa-users text-primary"></i></a></span>`;
					}

					var refCommitteeTable = new Tabulator("#refCommitte-table", {
						layout: "fitColumns",
						data: [{commiteeName: "MGC"}, {commiteeName: "RGC/SME"}],
						height: '200px',
						selectable: 1,
						columns: [
							{ title: "Committee Name", field: "commiteeName" }
						],
						rowClick: function(e, row) {
							const committeeName = row.getData().commiteeName;
							const currentRow = $('#RefuserCommitteName').data('currentRow');
							
							let hasMembers = false;
							if (committeeName === "RGC/SME") {
								hasMembers = typeof rgcSmeTable !== 'undefined' && rgcSmeTable.getData().some(row => row.user_id || row.sbi_no);
							} else if (committeeName === "MGC") {
								hasMembers = typeof mgcSmeTable !== 'undefined' && mgcSmeTable.getData().some(row => row.user_id || row.sbi_no);
							}
							
							if (!hasMembers) {
								message('CUE', `No person available in the ${committeeName} table.`, 0);
								return;
							}
							
							if (currentRow) {
								currentRow.update({
									nameCommittee: committeeName,
									externalAgencies: '',
									assignedUserId: null 
								});
							}
							closeModalGracefully('#RefuserCommitteName');
						}
					});

					var refStaffSelectionTable = new Tabulator("#refCommitteselectName-table", {
						layout: "fitColumns",
						data: [],
						height: '200px',
						selectable: 1,
						columns: [
							{ title: "ID", field: "user_id", visible: false },
							{ title: "First Name", field: "user_first_name" },
							{ title: "Last Name", field: "user_last_name" },
							{ title: "MI", field: "user_mid_name", width: 80 },
							{ title: "Suffix", field: "user_suffix_name", width: 100 }
						],
						rowClick: function(e, row) {
							const staff = row.getData();
							const currentRow = $('#userCommitteName').data('currentRow');
							
							if (staff.user_first_name === "No staff found") {
								message('CUW', 'Please select a valid staff member', 0);
								return;
							}

							if (currentRow) {
								const fullName = [
									staff.user_last_name,
									[
									staff.user_first_name, 
									staff.user_mid_name,
									staff.user_suffix_name].filter(Boolean).join(" ")
								].filter(Boolean).join(", ");
								
								currentRow.update({
									nameCommittee: fullName,
									externalAgencies: '',
									assignedUserId: staff.user_id
								});

								if (currentReferralRow && currentReferralRow.getPosition() === currentRow.getPosition()) {
									const currentUserId = localStorage.getItem('userId');
									const hasPermission = String(staff.user_id).trim() === String(currentUserId).trim();
									$('#responseToRequest').prop('disabled', !hasPermission);
								}
							}
							closeModalGracefully('#userCommitteName');
						}
					});

					var refReferredByTable = new Tabulator("#refrefredselectName-table", {
						layout: "fitColumns",
						data: [],
						height: '140px',
						selectable: 1,
						columns: [
							{ title: "First Name", field: "user_first_name" },
							{ title: "Last Name", field: "user_last_name" },
							{ title: "MI", field: "user_mid_name", width: 80 },
							{ title: "Suffix", field: "user_suffix_name", width: 100 }
						],
						rowClick: function(e, row) {
							const staff = row.getData();
							const currentRow = $('#SelectRefMemberFindListModal').data('currentRow');
							
							if (staff.user_first_name === "No staff found") {
								message('CUW', 'Please select a valid staff member', 0);
								return;
							}

							if (currentRow) {
								const fullName = [
									staff.user_last_name,
									[
									staff.user_first_name, 
									staff.user_mid_name,
									staff.user_suffix_name].filter(Boolean).join(" ")
								].filter(Boolean).join(", ");
								currentRow.update({ 
					                referredBy: fullName,
					                referredByUserId: staff.user_id 
					            });
							}
							closeModalGracefully('#SelectRefMemberFindListModal');
						}
					});


					$(document).on('click', '#refCommitte-table .tabulator-row', function() {
						const row = refCommitteeTable.getRow(this);
						if (row) {
							const committeeName = row.getData().commiteeName;
							const currentRow = $('#RefuserCommitteName').data('currentRow');
							
							let hasMembers = false;
							if (committeeName === "RGC/SME") {
								hasMembers = typeof rgcSmeTable !== 'undefined' && rgcSmeTable.getData().some(row => row.user_id || row.sbi_no);
							} else if (committeeName === "MGC") {
								hasMembers = typeof mgcSmeTable !== 'undefined' && mgcSmeTable.getData().some(row => row.user_id || row.sbi_no);
							}
							
							if (!hasMembers) {
								message('CUE', `No person available in the ${committeeName} table.`, 0);
								return;
							}
							
							if (currentRow) {
								currentRow.update({
									nameCommittee: committeeName,
									externalAgencies: '',
									assignedUserId: null 
								});
							}
							closeModalGracefully('#RefuserCommitteName');
						}
					});

					$(document).on('click', '#refCommitteselectName-table .tabulator-row', function() {
						const row = refStaffSelectionTable.getRow(this);
						if (row) {
							const staff = row.getData();
							const currentRow = $('#userCommitteName').data('currentRow');
							
							if (staff.user_first_name === "No staff found") {
								message('CUW', 'Please select a valid staff member', 0);
								return;
							}

							if (currentRow) {
								const fullName = [
									staff.user_last_name,
									[
									staff.user_first_name, 
									staff.user_mid_name,
									staff.user_suffix_name].filter(Boolean).join(" ")
								].filter(Boolean).join(", ");
								
								currentRow.update({
									nameCommittee: fullName,
									externalAgencies: '',
									assignedUserId: staff.user_id
								});

								if (currentReferralRow && currentReferralRow.getPosition() === currentRow.getPosition()) {
									const currentUserId = localStorage.getItem('userId');
									const hasPermission = String(staff.user_id).trim() === String(currentUserId).trim();
									$('#responseToRequest').prop('disabled', !hasPermission);
								}
							}
							closeModalGracefully('#userCommitteName');
						}
					});

					$(document).on('click', '#refrefredselectName-table .tabulator-row', function() {
						const row = refReferredByTable.getRow(this);
						if (row) {
							const staff = row.getData();
							const currentRow = $('#SelectRefMemberFindListModal').data('currentRow');
							
							if (staff.user_first_name === "No staff found") {
								message('CUW', 'Please select a valid staff member', 0);
								return;
							}

							if (currentRow) {
								const fullName = [
									staff.user_last_name,
									[
									staff.user_first_name, 
									staff.user_mid_name,
									staff.user_suffix_name].filter(Boolean).join(" ")
								].filter(Boolean).join(", ");
								currentRow.update({ 
					                referredBy: fullName,
					                referredByUserId: staff.user_id 
					            });
							}
							closeModalGracefully('#SelectRefMemberFindListModal');
						}
					});

					function loadReferralStaffList(searchTerm = '') {
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getStaffList', type: 'GET', data: { searchTerm: searchTerm },
					        success: function(staffList) {
					            if (staffList && staffList.length > 0) {
					                refStaffSelectionTable.setData(staffList).then(() => refStaffSelectionTable.deselectRow());
					            } else {
					                refStaffSelectionTable.setData([{ user_first_name: "No staff found", user_last_name: "", user_mid_name: "", user_suffix_name: "" }]);
					            }
					        }
					    });
					}
					function loadReferredByStaffList(searchTerm = '') {
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getStaffList', type: 'GET', data: { searchTerm: searchTerm },
					        success: function(staffList) {
					            if (staffList && staffList.length > 0) {
					                refReferredByTable.setData(staffList).then(() => refReferredByTable.deselectRow());
					            } else {
					                refReferredByTable.setData([{ user_first_name: "No staff found", user_last_name: "", user_mid_name: "", user_suffix_name: "" }]);
					            }
					        }
					    });
					}

					$('#userCommitteName').on('show.bs.modal', function() {
					    $('#userCommitteName input[type="text"]').val(''); 
					    loadReferralStaffList(); 
					});
					
					$('#userCommitteName').on('shown.bs.modal', function() {
					    $('#userCommitteName input[type="text"]').focus();
					});

					$('#RefuserCommitteName').on('show.bs.modal', function() {
					    refCommitteeTable.deselectRow();
					});

					$('#SelectRefMemberFindListModal').on('show.bs.modal', function() {
					    $('#SelectRefMemberFindListModal input[type="text"]').val('');
					    loadReferredByStaffList(); 
					});
					
					$('#SelectRefMemberFindListModal').on('shown.bs.modal', function() {
					    $('#SelectRefMemberFindListModal input[type="text"]').focus();
					});

					$('#userCommitteName').on('keydown', 'input[type="text"]', function(e) {
						if (e.key === 'Enter') {
							e.preventDefault();
							$('#userCommitteName').find('#fetchDataBtn:not([data-action="ok"])').click();
						}
					});

					$('#userCommitteName').on('click', '#fetchDataBtn:not([data-action="ok"])', function(e) {
					    e.preventDefault();
					    const searchTerm = $('#userCommitteName input[type="text"]').val().trim();
					    loadReferralStaffList(searchTerm);
					});
					$('#SelectRefMemberFindListModal').on('click', '#fetchDataBtn:not([data-action="ok"])', function(e) {
					    e.preventDefault();
					    const searchTerm = $('#SelectRefMemberFindListModal input[type="text"]').val().trim();
					    loadReferredByStaffList(searchTerm);
					});

					$('#SelectRefMemberFindListModal').on('keydown', 'input[type="text"]', function(e) {
						if (e.key === 'Enter') {
							e.preventDefault();
							$('#SelectRefMemberFindListModal').find('#fetchDataBtn:not([data-action="ok"])').click();
						}
					});

					$('#RefrowAddBtn').click(function(e) {
					    e.preventDefault();
					    const firstEmptyRow = referralTable.getRows().find(row => !row.getData().refdate);
					    const actionHandler = (userFullName) => {
					        const today = formatDateForInput(new Date().toISOString().split('T')[0]);
					        const newRowData = {
					            refdate: today,
					            referredBy: userFullName,
					            radioPerson: 'N',
					            radioCommittee: 'N',
					            checked: false,
					            nameCommittee: "",
					            externalAgencies: "",
					            informationRequested: "",
					            responseToRequest: "",
					            assignedUserId: null,
					            due_date: "",
					            response_date: "",
					            confidential_flag: "N",
					            completed_flag: "N"
					        };
					        if (firstEmptyRow) {
					            firstEmptyRow.update(newRowData);
					        } else {
					            referralTable.addRow(newRowData);
					        }
					    };
					    const currentUser = localStorage.getItem('userId');
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getUserDetails',
					        type: 'GET',
					        data: { userId: currentUser },
					        success: function(user) {
								const fullName = [
											user.user_last_name,
											[user.user_first_name, user.user_mid_name, user.user_suffix_name].filter(Boolean).join(" ")
										].filter(Boolean).join(", ");
					            actionHandler(fullName);
					        },
					        error: function() {
					            actionHandler(currentUser);
					        }
					    });
					});

					$('#RefrowRemoveBtn').click(function(e) {
					    e.preventDefault();
					    const selectedRowsData = referralTable.getData().filter(row => row.checked);
					    if (!selectedRowsData.length) {
					        message('CUW', 'No referral selected for removal', 0);
					        return;
					    }
					    confirmation("Are you sure you want to remove the selected referrals?", function() {
					        const newData = referralTable.getData().filter(row => !row.checked);
					        while (newData.length < 4) {
					            newData.push({
					                checkbox: "t", refdate: "", radioPerson: "", radioCommittee: "", nameCommittee: "",
					                externalAgencies: "", referredBy: "", checked: false,
					                informationRequested: "", responseToRequest: "", assignedUserId: null
					            });
					        }
					        referralTable.setData(newData);
					        $('#informationRequested, #responseToRequest').val('');
					        currentReferralRow = null;
					    });
					});

					function populateReferralData(commitNo, seqNum) {
					    if (!commitNo || !seqNum) return;
					    $.ajax({
					        url: '/OmnetTest/OffenderGrievance/getReferralDetails',
					        type: 'GET',
					        data: { commitNo: commitNo, seqNum: seqNum },
					        success: function(data) {
					            if (!data || data.length === 0) {
					                referralTable.setData(referral);
					                $('#informationRequested, #responseToRequest').val('');
					                currentReferralRow = null;
					                return;
					            }
					            const promises = data.map(item => {
					                const namePromise = (item.refr_to === 'P' && item.refr_to_user_id) ? getUserFullName(item.refr_to_user_id) : Promise.resolve(item.refr_to_user_name || '');
					                const referredByPromise = item.refr_by_user_id ? getUserFullName(item.refr_by_user_id) : Promise.resolve(item.refr_by_user_name || '');
					                return Promise.all([namePromise, referredByPromise]).then(([nameCommittee, referredBy]) => ({
					                    ...item,
					                    formattedNameCommittee: nameCommittee,
					                    formattedReferredBy: referredBy
					                }));
					            });
					            Promise.all(promises).then(processedData => {
					                let tableData = processedData.map(item => ({
					                    refdate: formatDateForInput(item.refr_date),
					                    radioPerson: item.refr_to === 'P' ? 'Y' : 'N',
					                    radioCommittee: item.refr_to === 'C' ? 'Y' : 'N',
					                    nameCommittee: item.refr_to === 'P' ? item.formattedNameCommittee : (item.refr_to_user_name || ''),
					                    externalAgencies: item.refr_to_external_agency || '',
					                    referredBy: item.formattedReferredBy,
					                    checked: false,
					                    informationRequested: item.information_reqst || '',
					                    responseToRequest: item.response_received || '',
					                    assignedUserId: item.refr_to_user_id || null,
					                    referredByUserId: item.refr_by_user_id || null,
					                    due_date: formatDateForInput(item.due_date),
					                    response_date: formatDateForInput(item.response_date),
					                    confidential_flag: item.confidential_flag || 'N',
					                    completed_flag: item.completed_flag || 'N'
					                }));
					                while (tableData.length < 4) {
					                    tableData.push({
					                        checkbox: "t", refdate: "", radioPerson: "", radioCommittee: "", nameCommittee: "",
					                        externalAgencies: "", referredBy: "", checked: false,
					                        informationRequested: "", responseToRequest: "", assignedUserId: null,
					                        referredByUserId: null, due_date: "", response_date: "", confidential_flag: "N",
					                        completed_flag: "N"
					                    });
					                }
					                referralTable.setData(tableData);
					                $('#informationRequested, #responseToRequest').val('');
					                currentReferralRow = null;
					            });
					        },
					        error: function(xhr) {
					            console.error("Error loading referral data:", xhr.responseText);
					            referralTable.setData(referral);
					        }
					    });
					}
					
					$(function() {
					    if ($('#fileUploader').length === 0) {
					        $('body').append('<input type="file" id="fileUploader" style="display: none;" />');
					    }

					    let currentAttachTableRow = null;

					    let attachDocument = Array(5).fill().map(() => ({
					        view: false,
					        documentName: "",
					        attachfileName: "",
					        description: "",
					        fileObject: null
					    }));

					    if (window.attachDocumentTable) {
					        attachDocumentTable.destroy();
					    }

					    attachDocumentTable = new Tabulator("#attachDocument-table", {
					        layout: "fitColumns",
					        data: attachDocument,
					        height: '140px',
					        selectable: 1, 
					        columns: [
					            {
					                title: "View",
					                field: "view",
					                formatter: "tickCross",
					                width: 80,
									headerHozAlign: "center",
					                hozAlign: "center",
					                headerSort: false,
					                cellClick: function(e, cell) {
					                    const rowData = cell.getRow().getData();
					                    if (!rowData.fileObject) {
					                        message('CUW', 'No file attached to this row to view.', 0);
					                        return;
					                    }
					                    const file = rowData.fileObject;
					                    const fileType = file.type;
					                    if (fileType.startsWith('image/')) {
					                        const url = URL.createObjectURL(file);
					                        window.open(url, '_blank');
					                    } else if (fileType === 'text/plain' || file.name.endsWith('.txt')) {
					                        const reader = new FileReader();
					                        reader.onload = function(event) {
					                            const newWindow = window.open("", "_blank");
					                            newWindow.document.write('<pre>' + event.target.result + '</pre>');
					                            newWindow.document.title = file.name;
					                        };
					                        reader.readAsText(file);
					                    } else {
					                        message('CUW', 'This file type cannot be previewed. It can be attached and downloaded.', 0);
					                    }
					                }
					            },
					            {
					                title: "Document Name",
					                field: "documentName",
									headerHozAlign: "center",
					                editor: "input",
					                headerSort: false,
					                cellEditing: function(cell) {
					                    const row = cell.getRow();
					                    const rowData = row.getData();
					                    const rows = attachDocumentTable.getRows();
					                    const rowIndex = rows.indexOf(row);

					                    if (!rowData.fileObject) {
					                        message('CUE', 'Please attach a file to this row before adding a Document Name.', 0);
					                        return false;
					                    }

					                    if (rowIndex > 0) {
					                        const prevRowData = rows[rowIndex - 1].getData();
					                        if (!prevRowData.fileObject) {
					                            message('CUE', `Please upload a file in the previous row first.`, 0);
					                            return false;
					                        }
					                    }
					                    return true;
					                }
					            },
					            {
					                title: "Attach file Name",
					                field: "attachfileName",
									headerHozAlign: "center",
					                editable: false,
					                headerSort: false,
					                tooltip: "Browser security prevents access to the full file path. Only the filename is available."
					            },
					            {
					                title: "",
					                field: "file",
					                formatter: fileIcon,
					                width: 40,
					                hozAlign: "center",
					                headerSort: false,
					                cellClick: function(e, cell) {
					                    const clickedRow = cell.getRow();
					                    const rows = attachDocumentTable.getRows();
					                    const clickedRowIndex = rows.indexOf(clickedRow);
					                    
					                    if (clickedRowIndex > 0) {
					                        const prevRowData = rows[clickedRowIndex - 1].getData();
					                        if (!prevRowData.fileObject) {
					                            message('CUE', `Please upload a file in the previous row first.`, 0);
					                            return;
					                        }
					                        if (!prevRowData.documentName.trim()) {
					                            message('CUE', `Please enter a Document Name for the file in the previous row before proceeding.`, 0);
					                            rows[clickedRowIndex - 1].getCell('documentName').edit();
					                            return;
					                        }
					                    }
					                    
					                    currentAttachTableRow = clickedRow;
					                    $('#fileUploader').click();
					                }
					            },
					            {
					                title: "",
					                field: "cancel",
					                formatter: cancelIcon,
					                width: 40,
					                hozAlign: "center",
					                headerSort: false,
					                cellClick: function(e, cell) {
					                    const row = cell.getRow();
					                    if (!row.getData().fileObject && !row.getData().documentName) return;

					                    confirmation("Do you want to remove the document from the list?", function() {
					                        const wasSelected = row.isSelected();
					                        const rowData = row.getData();
					                        
					                        row.update({
					                            view: false,
					                            documentName: "",
					                            attachfileName: "",
					                            description: "",
					                            fileObject: null
					                        });
					                        
					                        if (wasSelected) {
					                            $('#attachDocumentDescription').val('').prop('disabled', true);
					                            currentAttachTableRow = null;
					                        }
					                    });
					                }
					            },
					        ]
					        });

					    attachDocumentTable.on("rowClick", function(e, row) {
					        currentAttachTableRow = row;
					        const rowData = row.getData();
					        $('#attachDocumentDescription').val(rowData.description || '');

					        if (rowData.fileObject) {
					            $('#attachDocumentDescription').prop('disabled', false);
					        } else {
					            $('#attachDocumentDescription').prop('disabled', true);
					        }
							attachDocumentTable.deselectRow();
					        row.select();
					    });
					    
					    $('#fileUploader').on('change', function(e) {
					        if (!e.target.files || e.target.files.length === 0 || !currentAttachTableRow) return;
					        const file = e.target.files[0];

					        currentAttachTableRow.update({
					            attachfileName: file.name,
					            fileObject: file,
					            description: "",
					            view: true
					        }).then(() => {
					            attachDocumentTable.deselectRow();
					            currentAttachTableRow.select();
					            attachDocumentTable.getRows().forEach(r => {
					                if(r.getPosition() === currentAttachTableRow.getPosition()){
					                    r.getTreeParent() || attachDocumentTable.getBus().emit("row-click", e, r);
					                }
					            });

					            currentAttachTableRow.getCell('documentName').edit();
					        });
					        
					        $(this).val('');
					    });

					    $('#attachDocumentDescription').on('input', function() {
					        if (currentAttachTableRow) {
					            currentAttachTableRow.update({ description: $(this).val() });
					        }
					    });

					    $('#addMoreFilesBtn').click(function() {
					        const rows = attachDocumentTable.getRows();
					        let firstEmptyRow = null;
					        let lastFilledRow = null;
					        
					        for (const row of rows) {
					            if (row.getData().fileObject) lastFilledRow = row;
					            else if (!firstEmptyRow) firstEmptyRow = row;
					        }
					        
					        if (lastFilledRow) {
					            const lastFilledData = lastFilledRow.getData();
					            if (!lastFilledData.documentName.trim()) {
					                message('CUE', `Please enter a Document Name before adding another file.`, 0);
					                lastFilledRow.getCell('documentName').edit();
					                return;
					            }
					        }
					        
					        if (firstEmptyRow) {
					            firstEmptyRow.getCell('file').getElement().querySelector('a').click();
					        } else {
					            message('CUW', 'All rows are full. Please clear a row to add a new file.', 0);
					        }
					    });

					    $('#clearAttachBtn').click(function() {
					        const emptyData = Array(5).fill().map(() => ({
					            view: false, 
					            documentName: "", 
					            attachfileName: "", 
					            description: "", 
					            fileObject: null
					        }));
					        attachDocumentTable.setData(emptyData);
					        $('#attachDocumentDescription').val('').prop('disabled', true);
					        currentAttachTableRow = null;
					    });

					    $('#attachBtn').click(function() {
					        const rowsWithFiles = attachDocumentTable.getData().filter(r => r.fileObject);
					        if (rowsWithFiles.length === 0) {
					            message('CUE', 'Please open at least one file to attach.', 0);
					            return;
					        }
					        
					        for (const row of rowsWithFiles) {
					            if (!row.documentName.trim()) {
					                message('CUE', `Document name must be entered for the file "${row.attachfileName}".`, 0);
					                const tableRow = attachDocumentTable.getRows().find(tr => tr.getData().fileObject === row.fileObject);
					                if (tableRow) tableRow.getCell('documentName').edit();
					                return;
					            }
					        }
					        
					        const fileCount = rowsWithFiles.length;
					        confirmation(`You have selected to attach ${fileCount} document(s). Continue?`, function() {
					            console.log("Attaching documents for referral row:", currentReferralRow ? currentReferralRow.getData() : "None");
					            console.log("Files to attach:", rowsWithFiles);
					            message('CUS', `${fileCount} file(s) are ready to be attached.`, 0);
					            $('#attachDocumentModal').modal('hide');
					        });
					    });

					    $('#attachDocumentModal').on('hidden.bs.modal', function() {
					        $('#clearAttachBtn').click();
					    });
					});

			    $('#Facility').change(function() {
			        const instNum = $(this).val();
			        if (instNum) {
			            loadLocations(instNum);
			        } else {
			            $('#Location').empty().append('<option value=""> </option>');
			        }
			    });

			    function loadLocations(instNum) {
			        return $.ajax({
			            url: '/OmnetTest/OffenderGrievance/getLocations',
			            type: 'GET',
			            data: { instNum: instNum },
			            success: function(data) {
			                const $locationDropdown = $('#Location');
			                $locationDropdown.empty().append('<option value=""> </option>');
			                if (data && data.length > 0) {
			                    data.forEach(location => {
			                        $locationDropdown.append(`<option value="${location.bld_num}">${location.bld_name}</option>`);
			                    });
			                }
			            }
			        });
			    }
				
				function fetchGrievanceList(sbiNo, commitNo = null, showLoader = true) {
			    	const ajaxData = { sbiNo: sbiNo };
					if (commitNo) {
						ajaxData.commitNo = commitNo;
					}
					if (showLoader) {
						loader(1);
					}
					return $.ajax({
						url: '/OmnetTest/OffenderGrievance/listWithDatesBySbi',
						type: 'GET',
						data: ajaxData,
						success: function(data) {
							if (data && data.length > 0) {
								const formattedData = data.map(grievance => ({
									grievance_seq_num: grievance.grievance_seq_num,
									date_entered: formatDateForInput(grievance.date_of_grievance),
									sbi_no: sbiNo,
									commit_no: grievance.commit_no,
									is_new: false
								}));
								formattedData.sort((a, b) => b.grievance_seq_num - a.grievance_seq_num);

								if (grievanceListTable) {
									grievanceListTable.setData(formattedData);
								}
							} else {
								if (commitNo && grievanceListTable)  {
									message('CUW', "No grievances found for the selected stay.", 0);
								} else {
										message('CUW', "No records found", 0);
								}
								
								if (grievanceListTable) {
									grievanceListTable.setData([]);
									$('#grievanceList-table .tabulator-placeholder').text("No records found");
								}
								clearGrievance();
							}
						},
						error: function(xhr) {
							const errorMsg = xhr.responseJSON?.message || 'Error loading grievance list';
							if(grievanceListTable) {
								grievanceListTable.alert(errorMsg, "error");
							}
						}
					}).always(function() {
						if (showLoader) {
							loader(0);
						}
					});
				}

					function loadGrievanceDetails(sbiNo, seqNum, commitNo) {
					    loader(1); 

					    if (!commitNo) {
					        loader(0);
					        return;
					    }

					    const requests = {
					        grievanceData: $.ajax({ url: '/OmnetTest/OffenderGrievance/getGrievanceDetails', type: 'GET', data: { commitNo: commitNo, seqNum: seqNum } }),
					        housingLocation: $.ajax({ url: '/OmnetTest/OffenderGrievance/getHousingLocation', type: 'GET', data: { commitNo: commitNo } }),
					        investigationData: $.ajax({ url: '/OmnetTest/OffenderGrievance/getInvestigationDetails', type: 'GET', data: { commitNo: commitNo, seqNum: seqNum } }),
					        igcData: $.ajax({ url: '/OmnetTest/OffenderGrievance/getIGCReviewDetails', type: 'GET', data: { commitNo: commitNo, seqNum: seqNum } }),
					        wardenData: $.ajax({ url: '/OmnetTest/OffenderGrievance/getWardenDetails', type: 'GET', data: { commitNo: commitNo, seqNum: seqNum, cmtyType: 'WRD' } }),
					        appealData: $.ajax({ url: '/OmnetTest/OffenderGrievance/getAppealDetails', type: 'GET', data: { commitNo: commitNo, seqNum: seqNum } }),
					        bgoData: $.ajax({ url: '/OmnetTest/OffenderGrievance/getBGODetails', type: 'GET', data: { commitNo: commitNo, seqNum: seqNum, cmtyType: 'BGO' } }),
					        bureauData: $.ajax({ url: '/OmnetTest/OffenderGrievance/getBureauChiefDetails', type: 'GET', data: { commitNo: commitNo, seqNum: seqNum, cmtyType: 'BUR' } })
					    };

					    Promise.all(Object.values(requests).map(p => p.catch(e => e))) // Use .catch to prevent Promise.all from failing early
					        .then(results => {
					            const [grievanceData, housingLocation, investigationData, igcData, wardenData, appealData, bgoData, bureauData] = results.map(r => r && r.statusText ? r.responseJSON : r);
					            
					            if (!grievanceData || Object.keys(grievanceData).length === 0) {
					                return;
					            }
					            const combinedData = {
					                ...grievanceData,
					                ...investigationData,
					                ...igcData,
					                ...wardenData,
					                ...appealData,
					                ...bgoData,
					                ...bureauData,
					                CURRENT_HOUSING: housingLocation || ''
					            };
					            populateGrievanceForm(combinedData);
					            updateLSMEResolutionFieldsAccess();
					            loadPersonsInvolved(commitNo, seqNum);
					            loadRGCSMEData(commitNo, seqNum);
					            loadMGCSMEData(commitNo, seqNum);
					            populateReferralData(commitNo, seqNum);
					        })
					        .finally(() => {
					            setTimeout(function() {
					                loader(0);
					            }, 1500);
					        });
					}
					
					if (window.tablehistory) {
					    tablehistory.on("rowClick", function(e, row) {
					        const rowData = row.getData();
					        const commitNoToFetch = rowData.Checkbox;
					        if (commitNoToFetch) {
					            const sbiNo = $('#sbiNumberInput').val().trim();
					            if (sbiNo) {
									
					                fetchGrievanceList(sbiNo, String(commitNoToFetch));
					            }
					            $('#previousStayModal').modal('hide');
					        } else {
					            message('CUW', 'Could not find a commit number for the selected stay.', 0);
					        }
					    });
					}

					$('body').on('click', '#fetchDataBtn', function(e) {
					    const $modalContent = $(this).closest('.modal-content');
					    if ($modalContent.find('h4.modal-title:contains("Prior Incarceration")').length > 0) {
					        e.preventDefault();
					        return;
					    }
					});
					
				    
				    $(document).on('change', '.vote-type', updateVoteCounts);
			
				
					function loadPersonsInvolved(commitNo, seqNum) {
						$.ajax({
							url: '/OmnetTest/OffenderGrievance/getPersonsInvolved',
							type: 'GET',
							data: { 
								commitNo: commitNo, 
								seqNum: seqNum,
								cmtyType: 'IND' 
							},
							success: function(data) {
								const firstCmtyType = Object.keys(data)[0];
								currentPersonsInvolved = firstCmtyType ? data[firstCmtyType] : [];
								populatePersonsTable(currentPersonsInvolved);
							},
							error: function() {
								message('CUE', 'Error loading persons involved', 0);
							}
						});
					}

					var individualsinvolved = [
						{checkbox: "t", typePerson:"", id:"", firstName:"", lastName:"", mi:"", suffix:"", checked: false},
						{checkbox: "t", typePerson:"", id:"", firstName:"", lastName:"", mi:"", suffix:"", checked: false},
						{checkbox: "t", typePerson:"", id:"", firstName:"", lastName:"", mi:"", suffix:"", checked: false},
						{checkbox: "t", typePerson:"", id:"", firstName:"", lastName:"", mi:"", suffix:"", checked: false}
					];

					//const isIndividualsInvolvedRowEmpty = (data) => !data.typePerson && !data.id && !data.firstName && !data.lastName && !data.mi && !data.suffix ;

					var individualsInvolvedTable = new Tabulator("#individualsinvolved-table", {
						layout: "fitColumns",
						data: individualsinvolved,
						height: '140px',
						printAsHtml: true,
						printStyled: true,
						cellEditing: generalTableCellEditingValidation,
						columns: [
							{ title: "id", field: "id", visible: false },
							{ title: "upd", field: "upd", visible: false },
							{ title: "seqno", field: "seqno", visible: false },
							{
								titleFormatter: (column) => setTitleDesc(column, 'INDSelect', 'Select'),
								field: "checkbox",
								formatter: function(cell) {
									const data = cell.getData();
									return '<input type="checkbox" class="ind-checkbox" ' + (data.checked ? "checked" : "") + '>';
								},
								width: 100,
								headerSort: false,
								cellClick: function(e, cell) {
									if (e.target.classList.contains('ind-checkbox')) {
										const row = cell.getRow();
										const data = row.getData();
										data.checked = !data.checked;
										row.update({checked: data.checked});
									}
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'INDtypePerson', 'Type of Person'),
								field: "typePerson",
								editor: "list",
								width: 200,
								headerTooltip:"Type of Person",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isIndividualsInvolvedRowEmpty, type: 'string' },
								editorParams: {
									values: {
										"": "",
										"I": "Inmate",
										"S": "Staff"
									},
									autocomplete: true,
									allowEmpty: true,
									listOnEmpty: true
								},
								formatter: function(cell) {
									const value = cell.getValue();
									return {
										"": "",
										"I": "Inmate",
										"S": "Staff"
									}[value] || "";
								},
								cellEdited: function(cell) {
									const row = cell.getRow();
									const type = cell.getValue();
									const rowData = row.getData();
									if (cell.getOldValue() !== type) {
										row.update({
											id: "",
											firstName: "",
											lastName: "",
											mi: "",
											suffix: "",
											_idEditable: type !== "S"
										});
									}
									if (type === "S") {
										row.getCell("id").getElement().style.backgroundColor = "";
										row.getCell("id").getElement().contentEditable = false;
									} else {
										row.getCell("id").getElement().style.backgroundColor = "";
										row.getCell("id").getElement().contentEditable = true;
									}
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'INDid', 'ID#'),
								field: "id",
								width: 100,
								editor: "input",
								headerTooltip:"ID#",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isIndividualsInvolvedRowEmpty, type: 'string' },
								editorParams: {elementAttributes: {maxlength: "8"}},
								editable: function(cell) {
									const rowData = cell.getRow().getData();
									return rowData._idEditable !== false;
								},
								formatter: function(cell) {
									const rowData = cell.getRow().getData();
									return rowData.typePerson === "I" ? cell.getValue() : "";
								},
								cellEdited: function(cell) {
									const row = cell.getRow();
									const type = row.getData().typePerson;
									const idValue = cell.getValue();
									if (type === "I") {
										if (idValue.length === 8) {
											fetchInmateDetails(idValue, row);
										} else if (idValue.length > 0 && idValue.length !== 8) {
											message('OG01',0,0);
											cell.setValue("");
										}
									}
								}
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'INDfirst_name', 'First Name'),
								field: "firstName",
								editor: "input",
								headerTooltip:"First Name",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isIndividualsInvolvedRowEmpty, type: 'string' }
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'INDlast_name', 'Last Name'),
								field: "lastName",
								editor: "input",
								headerTooltip:"Last Name",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isIndividualsInvolvedRowEmpty, type: 'string' }
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'INDmid_name', 'MI'),
								field: "mi",
								width: 70,
								editor: "input",
								headerTooltip:"MI",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isIndividualsInvolvedRowEmpty, type: 'string' }
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'INDsuffix_name', 'Suffix'),
								field: "suffix",
								width: 100,
								editor: "input",
								headerTooltip:"Suffix",
								headerSort: true,
								sorter: customSorter,
								//sorterParams: { isRowEmpty: isIndividualsInvolvedRowEmpty, type: 'string' }
							},
							{
								titleFormatter: (column) => setTitleDesc(column, 'INDselectBtn', ''),
								field: "selectBtn",
								formatter: downloadIcon,
								headerSort: false,
								width: 40,
								cellClick: function(e, cell) {
									e.preventDefault();
									handleDownloadIconClick(cell);
								}
							}
						]
					});

					tabulatorRegistry["individualsinvolved-table"] = {
						varName: "individualsInvolvedTable",
						instance: individualsInvolvedTable
					};

					function downloadIcon(cell, formatterParams, onRendered) {
						return `<span class="download-icon-handler">
							<a href="#" class="ml-2" data-toggle="tooltip" title="Click to select staff" data-placement="top" data-original-title="namefromListModal">                    
								<i class="fa fa-user text-primary"></i>
							</a>
						</span>`;
					}

					var currentRowContext = {
						row: null,
						selectedPerson: null
					};

					function handleDownloadIconClick(cell) {
						try {
							const row = cell.getRow();
							if (!row || !row.getData) {
								console.warn("Row not found");
								return;
							}

							const data = row.getData();
							if (data.typePerson !== "S") {
								message('OG03',0,0);
								return;
							}
							
							$('.modal-backdrop').remove();
							$('body').removeClass('modal-open');
							
							lsmeStaffSelectionActive = false;
							currentRowContext.row = row;
							currentRowContext.selectedPerson = null;
							staffSelectionTable.deselectRow();
							staffSelectionTable.clearData();
							
							$personModal.modal('show');
						} catch (error) {
							console.error("Error handling download icon click:", error);
						}
					}

					var individualselectName = [
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""}
					];

					var staffSelectionTable = new Tabulator("#individualselectName-table", {
						layout: "fitColumns",
						//data: individualselectName,
						data:[],
						height: '200px',
						selectable: 1,
						columns: [
							{ title: "First Name", field: "user_first_name" },
							{ title: "Last Name", field: "user_last_name" },
							{ title: "MI", field: "user_mid_name", width: 80 },
							{ title: "Suffix", field: "user_suffix_name", width: 100 },
						],
						rowClick: function(e, row) {
							const staff = row.getData();
							
							if (staff.user_first_name === "No staff found") {
								message('CUW', 'Please select a valid staff member', 0);
								return;
							}

							if (lsmeStaffSelectionActive) {
								const existingMembers = lsmeMembersTable.getData();
								if (existingMembers.some(member => member.userId === staff.user_id)) {
									message('CUW', 'This staff member is already in the LSME Members list.', 0);
									return;
								}
								
								const allMemberRows = lsmeMembersTable.getRows();
								let rowUpdated = false;

								for (const memberRow of allMemberRows) {
									const rowData = memberRow.getData();
									
									if (!rowData.userId && (!rowData.firstName && !rowData.lastName && !rowData.midName && !rowData.suffix)) {
										memberRow.update({
											firstName: staff.user_first_name || '',
											lastName: staff.user_last_name || '',
											midName: staff.user_mid_name || '',
											suffix: staff.user_suffix_name || '',
											startDate: formatDateForInput(new Date().toISOString().split('T')[0]),
											endDate: "",
											userId: staff.user_id || '',
											checked: true
										});

										rowUpdated = true;
										break;
									}
								}
								
								if (!rowUpdated) {
									lsmeMembersTable.addRow({
										firstName: staff.user_first_name || '',
										lastName: staff.user_last_name || '',
										midName: staff.user_mid_name || '',
										suffix: staff.user_suffix_name || '',
										startDate: formatDateForInput(new Date().toISOString().split('T')[0]),
										endDate: "",
										userId: staff.user_id || '',
										checked: true
									});
								}
							} else {
								if (currentRowContext.row) {
									currentRowContext.row.update({
										firstName: staff.user_first_name || '',
										lastName: staff.user_last_name || '',
										mi: staff.user_mid_name || '',
										suffix: staff.user_suffix_name || '',
										id: staff.user_id || '',
										user_id: staff.user_id || ''
									});
								}
							}

							$personModal.modal('hide').on('hidden.bs.modal', function() {
								$(this).data('bs.modal', null);
								$('body').removeClass('modal-open');
								$('.modal-backdrop').remove();
							});
						},
						rowSelectionChanged: function(data, rows) {
							if (rows.length > 0) {
								currentRowContext.selectedPerson = rows[0].getData();
							}
						}
					});

					$(document).on('click', '#individualselectName-table .tabulator-row', function() {
						const row = staffSelectionTable.getRow(this);
						if (row) {
							const staff = row.getData();
							
							if (staff.user_first_name === "No staff found") {
								message('CUW', 'Please select a valid staff member', 0);
								return;
							}

							if (lsmeStaffSelectionActive) {
								const existingMembers = lsmeMembersTable.getData();
								if (existingMembers.some(member => member.userId === staff.user_id)) {
									message('CUW', 'This staff member is already in the LSME Members list.', 0);
									return;
								}
								
								const allMemberRows = lsmeMembersTable.getRows();
								let rowUpdated = false;

								for (const memberRow of allMemberRows) {
									const rowData = memberRow.getData();
									
									if (!rowData.userId && (!rowData.firstName && !rowData.lastName && !rowData.midName && !rowData.suffix)) {
										memberRow.update({
											firstName: staff.user_first_name || '',
											lastName: staff.user_last_name || '',
											midName: staff.user_mid_name || '',
											suffix: staff.user_suffix_name || '',
											startDate: formatDateForInput(new Date().toISOString().split('T')[0]),
											endDate: "",
											userId: staff.user_id || '',
											checked: true
										});

										rowUpdated = true;
										break;
									}
								}
								
								if (!rowUpdated) {
									lsmeMembersTable.addRow({
										firstName: staff.user_first_name || '',
										lastName: staff.user_last_name || '',
										midName: staff.user_mid_name || '',
										suffix: staff.user_suffix_name || '',
										startDate: formatDateForInput(new Date().toISOString().split('T')[0]),
										endDate: "",
										userId: staff.user_id || '',
										checked: true
									});
								}
							} else {
								if (currentRowContext.row) {
									currentRowContext.row.update({
										firstName: staff.user_first_name || '',
										lastName: staff.user_last_name || '',
										mi: staff.user_mid_name || '',
										suffix: staff.user_suffix_name || '',
										id: staff.user_id || '',
										user_id: staff.user_id || ''
									});
								}
							}

							$personModal.modal('hide').on('hidden.bs.modal', function() {
								$(this).data('bs.modal', null);
								$('body').removeClass('modal-open');
								$('.modal-backdrop').remove();
							});
						}
					});

					function populatePersonsTable(persons) {
					const tableData = persons.map(person => {
							const type = person.grvn_staff_tp === 'S' ? 'S' : 'I';
							return {
								checkbox: "t",
								typePerson: type,
								id: type === 'I' ? (person.sbi_no || '') : (person.user_id || ''),
								firstName: person.first_name || '',
								lastName: person.last_name || '',
								mi: person.mid_name || '',
								suffix: person.suffix_name || '',
								cmty_type: person.cmty_type || 'IND',
								user_id: person.user_id || '',
								checked: false,
								_idEditable: type !== "S"
							};
						});

						const minRows = 4;
						while (tableData.length < minRows) {
							tableData.push({
								checkbox: "t",
								typePerson: "",
								id: "",
								firstName: "",
								lastName: "",
								mi: "",
								suffix: "",
								checked: false,
								_idEditable: true
							});
						}

						individualsInvolvedTable.setData(tableData).then(() => {
							individualsInvolvedTable.getRows().forEach(row => {
								const data = row.getData();
								if (data.typePerson === "S") {
									const idCell = row.getCell("id");
									if (idCell && idCell.getElement()) {
										
										idCell.getElement().contentEditable = false;
									}
								}
							});
						});
					}

					$('#addRow').click(function(e) {
						e.preventDefault();
						
						individualsInvolvedTable.addRow({
							checkbox: "t",
							typePerson: "",
							id: "",
							firstName: "",
							lastName: "",
							mi: "",
							suffix: "",
							checked: false,
							_idEditable: true
						}, true).then((newRow) => {
							newRow.getCell("typePerson").edit();
						});
					});

					$('#removeRow').click(function(e){
						e.preventDefault();

						const selectedRows = individualsInvolvedTable.getRows().filter(row => {
							return row.getData().checked;
						});

						if (selectedRows.length === 0) {
							message('CUW', 'There are no individuals selected to remove', 0);
							return;
						}

						confirmation("Are you sure you want to remove the selected individuals?", function() {
							selectedRows.forEach(row => row.delete());

							const currentData = individualsInvolvedTable.getData();
							const minRows = 4;
							
							if (currentData.length < minRows) {
								const rowsToAdd = minRows - currentData.length;
								for (let i = 0; i < rowsToAdd; i++) {
									individualsInvolvedTable.addRow({
										checkbox: "t",
										typePerson: "",
										id: "",
										firstName: "",
										lastName: "",
										mi: "",
										suffix: "",
										checked: false,
										_idEditable: true
									}, false);
								}
							}
						});
					});

					function loadPersonList(searchTerm = '') {
						$.ajax({
							url: '/OmnetTest/OffenderGrievance/getStaffList',
							type: 'GET',
							data: { searchTerm: searchTerm },
							success: function(persons) {
								staffSelectionTable.deselectRow();
								if (persons && persons.length > 0) {
									staffSelectionTable.setData(persons).then(function() {
										if (currentRowContext.selectedPerson) {
											const rows = staffSelectionTable.getRows().filter(row => {
												return row.getData().user_id === currentRowContext.selectedPerson.user_id;
											});
											if (rows.length > 0) {
												rows[0].select();
											}
										}
									});
								} else {
									staffSelectionTable.setData([{
										user_first_name: "No staff found",
										user_last_name: "",
										user_mid_name: "",
										user_suffix_name: ""
									}]);
									currentRowContext.selectedPerson = null;
								}
							}
						});
					}

					$personModal.on('show.bs.modal', function() {
						currentRowContext.selectedPerson = null;
						$personFindInput.val('');
						loadPersonList();
					});

					$personModal.on('shown.bs.modal', function() {
						$personFindInput.focus();
					});

					$personModal.on('hidden.bs.modal', function() {
						lsmeStaffSelectionActive = false;
						$('.modal-backdrop').remove();
						$('body').removeClass('modal-open');
					});

					$personModal.find('#fetchDataBtn').click(function(e) {
						e.preventDefault();
						loadPersonList($personFindInput.val().trim());
					});

					$personFindInput.on('keydown', function(e) {
						if (e.key === 'Enter') {
							e.preventDefault(); 
							$personModal.find('#fetchDataBtn:not([data-action="ok"])').click(); 
						}
					})

					$personModal.find('[data-dismiss="modal"]').click(function(e) {
						e.preventDefault();
						currentRowContext.selectedPerson = null;
						$personModal.modal('hide');
						$('.modal-backdrop').remove();
						$('body').removeClass('modal-open');
					});

					function fetchInmateDetails(sbiNo, row) {
						$.ajax({
							url: "/OmnetTest/Booking/combinedDetails",
							type: 'GET',
							data: { sbiNo: sbiNo },
							success: function(response) {
								if (response && response.length > 0) {
									const inmate = response[0];
									row.update({
										firstName: inmate.COMMIT_FNAME || '',
										lastName: inmate.COMMIT_LNAME || '',
										mi: inmate.COMMIT_MNAME || '',
										suffix: inmate.COMMIT_SNAME || ''
									});
								} else {
									row.update({
										firstName: '',
										lastName: '',
										mi: '',
										suffix: ''
									});
									message('OG02',0,0);
								}
							},
							error: function(xhr) {
								row.update({
									firstName: '',
									lastName: '',
									mi: '',
									suffix: ''
								});
								message('CUE', 'Error fetching inmate details', 0);
							}
						});
					}		  		

					$(document).on('click', '#selectName-table .tabulator-row', function() {
						const row = table.getRow(this);
						if (row) {
							selectedUser = row.getData();
							//row.select();
							if (selectedUser.user_first_name === "No users found") {
								message('CUW', 'Please select a valid staff member', 0);
								return;
							}

							$('#Pattersonfname').val(
								[
									selectedUser.user_last_name,
									[selectedUser.user_first_name, selectedUser.user_mid_name, selectedUser.user_suffix_name]
										.filter(Boolean)
										.join(" ")
								]
								.filter(Boolean)
								.join(", ")
								.trim()
							).data('user-id', selectedUser.user_id);

							$selectNameModal.modal('hide').on('hidden.bs.modal', function() {
								$(this).data('bs.modal', null); 
								$('body').removeClass('modal-open');
								$('.modal-backdrop').remove();
							});
						}
					});

					var selectName = [
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""},
						{lastname:"", firstname:"", mi:"", suffix:""}
					];

					var table = new Tabulator("#selectName-table", {
						layout: "fitColumns",
						//data: selectName,
						data:[],
						height: '200px',
						selectable: 1,
						columns: [
							{ title: "First Name", field: "user_first_name" },
							{ title: "Last Name", field: "user_last_name" },
							{ title: "MI", field: "user_mid_name", width: 80 },
							{ title: "Suffix", field: "user_suffix_name", width: 100 },
						],
						rowClick: function(e, row) {
							//row.select();
							selectedUser = row.getData();
							
							if (selectedUser.user_first_name === "No users found") {
								message('CUW', 'Please select a valid staff member', 0);
								return;
							}

							$('#Pattersonfname').val(
								[
									selectedUser.user_last_name,
									[selectedUser.user_first_name, selectedUser.user_mid_name, selectedUser.user_suffix_name]
										.filter(Boolean)
										.join(" ")
								]
								.filter(Boolean)
								.join(", ")
								.trim()
							).data('user-id', selectedUser.user_id);

							$selectNameModal.modal('hide').on('hidden.bs.modal', function() {
								$(this).data('bs.modal', null);
								$('body').removeClass('modal-open');
								$('.modal-backdrop').remove();
							});
						},
						rowSelectionChanged: function(data, rows) {
							if (rows.length > 0) {
								selectedUser = rows[0].getData();
							}
						}
					});

					function loadUsers(searchTerm = '') {
						const currentSelection = selectedUser;

						$.ajax({
							url: '/OmnetTest/OffenderGrievance/getUsers',
							type: 'GET',
							data: { searchTerm: searchTerm },
							success: function(users) {
								if (users && users.length > 0) {
									table.setData(users).then(function() {
										if (currentSelection) {
											const rows = table.getRows().filter(row => {
												return row.getData().user_id === currentSelection.user_id;
											});
											if (rows.length > 0) {
												rows[0].select();
												selectedUser = currentSelection;
											}
										}
									});
								} else {
									table.setData([{
										user_first_name: "No users found",
										user_last_name: "",
										user_mid_name: "",
										user_suffix_name: ""
									}]);
									selectedUser = null;
								}
							}
						});
					}

					$(document).on('show.bs.modal', '#selectNameFromlist', function() {
						selectedUser = null;
						$findInput.val('').focus();
						loadUsers();
					});

					$(document).on('shown.bs.modal', '#selectNameFromlist', function() {
						$findInput.focus();
					});

					$findButton.click(function(e) {
						e.preventDefault();
						loadUsers($findInput.val().trim());
					});

					$findInput.on('keydown', function(e) {
						if (e.key === 'Enter') {
							e.preventDefault();
							$findButton.click();
						}
					});
					
					function populateGrievanceForm(data) {

					    $('#Group').val(data.GRIEVANCE_SEQ_NUM);
						const originalGrievanceDate = formatDateForInput(data.DATE_OF_GRIEVANCE);
					    $('#GrievanceDate').val(originalGrievanceDate).trigger('input');
					    $('#GrievanceDate').data('original-date', originalGrievanceDate); 
					    $('#Emergencyf').prop('checked', data.EMERGENCY_GRV_FLAG === 'Y').trigger('change');;
					    $('#Confidentialf').prop('checked', data.CONF_GRV_FLAG === 'Y');
					    const isResolved = data.GRIEVANCE_STATUS === 'R';
					    $('#Status').val(data.GRIEVANCE_STATUS || '');
						$('#Status').data('original-status', data.GRIEVANCE_STATUS || '');
						if (data.GRIEVANCE_STATUS === 'Q') {
						    $('#Status').trigger('change');
						}

						const $statusIcon = $('#statusIcon');
						if (data.GRIEVANCE_STATUS === 'C' || data.GRIEVANCE_STATUS === 'A') {
							$statusIcon.show();
							$statusIcon.data('grievance-details', data);
						} else {
							$statusIcon.hide();
							$statusIcon.removeData('grievance-details');
						}

					    $('#LevelOfResolution').prop('disabled', !isResolved);
					    $('#LevelOfResolution').val(data.GRVN_LVL_RESL || '');
					    $('#Category').val(data.GRVN_CATG || '');
					    $('#ResolDate').val(formatDateForInput(data.RESOLUTION_DATE)).trigger('input'); 
					    $('#ResolDate').prop('disabled', !isResolved);
					    $('#GrievanceType').val(data.GRIEVANCE_CODE || '');
						const originalValue = data.GRIEVANCE_CODE || '';
						const originalText = $('#GrievanceType option:selected').text();
						$('#GrievanceType').data('original-value', originalValue).data('original-text', originalText);
						$('#GrievanceType').trigger('change');
						$('#IncidentDate').val(formatDateForInput(data.DATE_OF_INCIDENT)).trigger('input');
						$('#IncidentTime').val(data.GRVN_TM || '');
	
					    $('#IGCRecdDate').val(formatDateForInput(data.DATE_RECEIVED)).trigger('input'); 
					    const igcName = [data.USER_LAST_NAME, [data.USER_FIRST_NAME, data.USER_MID_NAME, data.USER_SUFFIX_NAME].filter(Boolean).join(" ")].filter(Boolean).join(", ").trim();
						$('#Pattersonfname').val(igcName || '');
					    $('#Pattersonfname').data('user-id', data.USER_ID_INVESTIGATED_BY || '');
					    $('#DescriptionOfComplaint').val(data.DESC_OF_COMPLAINT || '').trigger('input');
					    $('#RemedyRequested').val(data.REMEDY_REQUESTED || '').trigger('input');
					    $('#CurrentHousing').val(data.CURRENT_HOUSING || '');
					    $('#MedicalGrievance').prop('checked', data.GRVN_MED_REL_FLG === 'Y');
					    $('#MedicalReceiptDate').val(formatDateForInput(data.GRVN_MED_RCPT_DT)).trigger('input'); 
	
	
						if (data.GRVN_AMOUNT) {
					        const numericAmount = parseFloat(data.GRVN_AMOUNT);
					        if (!isNaN(numericAmount)) {
					            const formattedAmount = numericAmount.toFixed(2);
					            $('#GrievanceAmount').data('raw-value', formattedAmount).val('$' + formattedAmount);
					        } else {
					             $('#GrievanceAmount').data('raw-value', '').val('');
					        }
					    } else {
					        $('#GrievanceAmount').data('raw-value', '').val('');
					    }
	
					    if (data.INST_NUM) {
					        $('#Facility').val(data.INST_NUM);
					        loadLocations(data.INST_NUM).done(() => {
					            if (data.COUNT_LOC_CODE) {
					                $('#Location option').each(function() {
					                    if ($(this).val() === data.COUNT_LOC_CODE) {
					                        $(this).prop('selected', true);
					                        return false;
					                    }
					                });
					            }
					        });
					    }
							
					    $('#informalResolution').val(data.inFormal_resl_flag || '');
					    $('#forwardToIGC').prop('checked', data.frwd_to_icg_flag === 'Y');
					    $('#forwardToIGCDate').val(formatDateForInput(data.frwd_to_igc_date)).trigger('input'); 
					    $('#forwardToIGCDate').prop('disabled', !$('#forwardToIGC').is(':checked'));
					    populateLSMETable(data.lsmeList);
	
					    $('#comments').val(data.grvn_rew_recm_comnt || '').trigger('input');
					    $('#forwardToMGCCheckbox').prop('checked', data.frwd_med_provider_flg === 'Y');
					    $('#forwardToRGC_SMECheckbox').prop('checked', data.grvn_rew_frwd_to_flg === 'Y');
					    $('#offenderSignatureCheckbox').prop('checked', data.grvn_decn_ntf_flg === 'Y');
					    $('#dateForwardedToMGC').val(formatDateForInput(data.frwd_med_provider_date)).trigger('input'); 
					    $('#dateForwardedToRGC_SME').val(formatDateForInput(data.grvn_rew_recm_dt)).trigger('input'); 
					    $('#dateOffenderSigned').val(formatDateForInput(data.grvn_decn_ntf_dt)).trigger('input'); 
					    $('#dateForwardedToMGC').prop('disabled', !$('#forwardToMGCCheckbox').is(':checked'));
					    $('#dateForwardedToRGC_SME').prop('disabled', !$('#forwardToRGC_SMECheckbox').is(':checked'));
					    $('#dateOffenderSigned').prop('disabled', !$('#offenderSignatureCheckbox').is(':checked'));
					    populateAdditionalCommentsTable(data);
	
	
					    $('#wardenDateReceived').val(formatDateForInput(data.warden_grvn_rew_rcpt_dt)).trigger('input'); 
					    if (data.warden_grvn_rew_ud_ind === 'U') {
					        $('#wardenUphold').prop('checked', true);
					        $('#wardenDeny').prop('checked', false);
					    } else if (data.warden_grvn_rew_ud_ind === 'D') {
					        $('#wardenUphold').prop('checked', false);
					        $('#wardenDeny').prop('checked', true);
					    } else {
					        $('#wardenUphold').prop('checked', false);
					        $('#wardenDeny').prop('checked', false);
					    }
					    $('#wardenDecisionDate').val(formatDateForInput(data.warden_grvn_decn_dt)).trigger('input'); 
					    $('#wardenForwardToIGC').prop('checked', data.warden_grvn_rew_frwd_to_flg === 'Y');
						if (data.warden_user_id_decision) {
							const wardenId = data.warden_user_id_decision;
							$('#wardenDecisionBy').data('user-id', wardenId);
							getUserFullName(wardenId).then(fullName => {
								$('#wardenDecisionBy').val(fullName).addClass('has-value').trigger('change');
							});
						} else {
							$('#wardenDecisionBy').val('').removeData('user-id').removeClass('has-value').trigger('change');
						}
						
						$('#wardenComments').val(data.warden_grvn_decn_comnt || '').trigger('input');
	
					    $('#wardenRequestToIGC').prop('checked', data.request_to_igc === 'Y');
					    $('#wardenRequestComments').val(data.req_to_igc_comments || '').trigger('input');
	
					    $('#emergencyRequestDenied').prop('checked', data.emergency_grv_reqst_deny === 'Y');
					    $('#emergencyDenialReason').val(data.emergency_grv_resn_for_deny || '');
					    $('#emergencySendBackToIGC').prop('checked', data.emergency_frwd_to_igc === 'Y');
					    $('#emergencyComments').val(data.emergency_comments || '').trigger('input');
	
					    $('#appealDate').val(formatDateForInput(data.grvn_appeal_dt)).trigger('input'); 
					    $('#appealRequest').val(data.grvn_appeal_desc || '').trigger('input');
					    $('#forwardToBGO').prop('checked', data.frwd_to_bgo_flag === 'Y');
					    $('#forwardToBCEmergency').prop('checked', data.frwd_to_bc_flag === 'Y');
	
					    $('#bgoDateReceived').val(formatDateForInput(data.bgo_grvn_rew_rcpt_dt)).trigger('input'); 
					    if (data.bgo_grvn_rew_ud_ind === 'U') {
					        $('#bgoUphold').prop('checked', true);
					    } else if (data.bgo_grvn_rew_ud_ind === 'D') {
					        $('#bgoDeny').prop('checked', true);
					    }
					    $('#bgoDecisionDate').val(formatDateForInput(data.bgo_grvn_decn_dt)).trigger('input'); 
						if (data.bgo_user_id_decision) {
							const bgoId = data.bgo_user_id_decision;
							$('#bgoDecisionBy').data('user-id', bgoId);
							getUserFullName(bgoId).then(fullName => {
								$('#bgoDecisionBy').val(fullName).addClass('has-value').trigger('change');
							});
						} else {
							$('#bgoDecisionBy').val('').removeData('user-id').removeClass('has-value').trigger('change');
						}
	
					    $('#bgoComments').val(data.bgo_grvn_decn_comnt || '').trigger('input');
					    $('#bgoforwardToBC').prop('checked', data.bgo_grvn_rew_frwd_to_flg === 'Y');
					    $('#bgoDateForwarded').val(formatDateForInput(data.bgo_grvn_rew_frwd_dt)).trigger('input'); 
	
					    $('#bureauDateReceived').val(formatDateForInput(data.bur_grvn_rew_rcpt_dt)).trigger('input'); 
					    if (data.bur_grvn_rew_ud_ind === 'U') {
					        $('#bureauUphold').prop('checked', true);
					        $('#bureauDeny').prop('checked', false);
					    } else if (data.bur_grvn_rew_ud_ind === 'D') {
					        $('#bureauUphold').prop('checked', false);
					        $('#bureauDeny').prop('checked', true);
					    }
					    $('#bureauDecisionDate').val(formatDateForInput(data.bur_grvn_decn_dt)).trigger('input'); 
						if (data.bur_user_id_decision) {
							const bureauId = data.bur_user_id_decision;
							$('#bureauDecisionBy').data('user-id', bureauId);
							getUserFullName(bureauId).then(fullName => {
								$('#bureauDecisionBy').val(fullName).addClass('has-value').trigger('change');
							});
						} else {
							$('#bureauDecisionBy').val('').removeData('user-id').removeClass('has-value').trigger('change');
						}
	
					    $('#bureauComments').val(data.bur_grvn_decn_comnt || '').trigger('input');
					    $('#burforwardToIGC').prop('checked', data.bur_grvn_rew_frwd_to_flg === 'Y');
					    $('#bureauDateForwarded').val(formatDateForInput(data.bur_grvn_rew_frwd_dt)).trigger('input'); 
	
						$(' input[type="time"], select').each(function () {
						       if ($(this).val()) {
						           $(this).addClass('has-value');
						       } else {
						           $(this).removeClass('has-value');
						       }
						   });
						   
					    if (data.COUNT_LOC_CODE) {
					        $("#Location").addClass('has-value');
					    } else {
					        $("#Location").removeClass('has-value');
					    }
					}
				
				$('#RGCSMEMainBlock').on('click focus mousedown', ':input, a, .tabulator-cell, [data-toggle="modal"]', function(e) {
					if (!$('#forwardToRGC_SMECheckbox').is(':checked')) {
						e.preventDefault();
						e.stopImmediatePropagation();
						if (e.type === 'focus') {
							$(this).blur();
						}
						//message('OG01', 0, 0);
						message('CUW', "This section is disabled. Please check 'Forward to RGC/SME' in the IGC section to enable.", 0);
						return false;
					}
				});

				$('#WardenBsmeMainBlock').on('click focus mousedown', ':input, a, [data-toggle="modal"]', function(e) {
					if (!$('#forwardToWarden').is(':checked')) {
						e.preventDefault();
						e.stopImmediatePropagation();
						if (e.type === 'focus') {
							$(this).blur();
						}
						//message('OG01', 0, 0);
						message('CUW', "This section is disabled. Please check 'Forward to Warden/BSME' in the RGC/SME section to enable.", 0);
						return false;
					}
				});

				$('#Status').trigger('change');

				function getUserFullName(userId) {
				    return new Promise((resolve) => {
				        if (!userId) {
				            resolve('');
				            return;
				        }

				        $.ajax({
				            url: '/OmnetTest/OffenderGrievance/getUserDetails',
				            type: 'GET',
				            data: { userId: userId },
				            success: function(user) {
								const fullName = [
											user.user_last_name,
											[user.user_first_name, user.user_mid_name, user.user_suffix_name].filter(Boolean).join(" ")
										].filter(Boolean).join(", ");
				                resolve(fullName);
				            },
				            error: function() {
				                resolve(userId);
				            }
				        });
				    });
				}

				var igcselect = [
				    { checkbox: "t", dateEntered: "", userName: "", comments: "", id: "empty-1" },
				    { checkbox: "t", dateEntered: "", userName: "", comments: "", id: "empty-2" },
				    { checkbox: "t", dateEntered: "", userName: "", comments: "", id: "empty-3" },
				    { checkbox: "t", dateEntered: "", userName: "", comments: "", id: "empty-4" }
				];

				const isIgcRowEmpty = (data) => !data.dateEntered;
				
				var igcselectTable = new Tabulator("#igcselect-table", {
				    layout: "fitColumns",
				    data: igcselect,
				    height: '140px',
				    printAsHtml: true,
				    printStyled: true,
					selectable: true,
				    columns: [
                        { title: "id", field: "id", visible: false },
                        { title: "upd", field: "upd", visible: false },
                        { title: "seqno", field: "seqno", visible: false },
				        {
				            //title: "Select",
                            titleFormatter: (column) => setTitleDesc(column, 'IGCcheckbox', 'Select'),
				            field: "checkbox",
				            formatter: (cell) => {
				                const value = cell.getValue();
				                if (value) {
				                    return `
				                        <input type="checkbox" />
				                        <label>${value}</label>
				                    `;
				                }
				            },
				            width: 100,
				        },
						{
				            //title: "Date Entered",
                            titleFormatter: (column) => setTitleDesc(column, 'IGCdateEntered', 'Date Entered'),
				            field: "dateEntered",
							headerTooltip:"Date Entered",
				            width: 100,
							headerSort: true, // Enable sorting
							sorter: customSorter,
							//sorterParams: { isRowEmpty: isIgcRowEmpty, type: 'date' },
				            formatter: function(cell) {
				                const value = cell.getValue();
				                if (value) {
				                    const date = new Date(value);
				                    if (!isNaN(date)) {
				                        const month = String(date.getMonth() + 1).padStart(2, '0');
				                        const day = String(date.getDate()).padStart(2, '0');
				                        const year = date.getFullYear();
				                        return `${month}/${day}/${year}`; 
				                    }
				                }
				                return value || '';
				            }
				        },
				        {
				            //title: "User Name",
                            titleFormatter: (column) => setTitleDesc(column, 'IGCuserName', 'User Name'),
				            field: "userName",
							headerTooltip:"User Name",
							headerSort: true, 
							sorter: customSorter
							//sorterParams: { isRowEmpty: isIgcRowEmpty, type: 'string' }
				        }
				    ]
				});

                tabulatorRegistry["igcselect-table"] = {
                        varName: "igcselectTable",
                        instance: igcselectTable
                };

				let rowComments = new Map();
				let currentActiveRowId = null;

				function populateAdditionalCommentsTable(data) {
				    const commentsList = data.commentsList || [];
				    rowComments = new Map();
				    const tableData = [...igcselect];
				    
				    commentsList.forEach((comment, index) => {
				        if (index < tableData.length) {
				            tableData[index] = {
				                id: comment.id,
				                checkbox: "t",
				                dateEntered: comment.date_entered,
				                userName: comment.user_name,
				                comments: comment.comments || ''
				            };
				            rowComments.set(comment.id, comment.comments || '');
				        } else {
				            tableData.push({
				                id: comment.id,
				                checkbox: "t",
				                dateEntered: comment.date_entered,
				                userName: comment.user_name,
				                comments: comment.comments || ''
				            });
				            rowComments.set(comment.id, comment.comments || '');
				        }
				    });

				    igcselectTable.setData(tableData);

				    if (tableData.length > 0) {
				        currentActiveRowId = tableData[0].id;
				        $('#resolutionComments').val(tableData[0].comments || '');
				    }
				}

				$('#IGCrowAddBtn').click(async function() {
				    try {
				        const userName = await getUserFullName(userId);
				        const today = new Date().toISOString().split('T')[0];
				        const newId = 'new-' + Date.now();

				        const newRowData = {
				            id: newId,
				            checkbox: "t",
				            dateEntered: today,
				            userName: userName,
				            comments: ""
				        };

				        igcselectTable.addRow(newRowData, true).then(function(newRow) {
				            igcselectTable.deselectRow();
				            newRow.select();
				            rowComments.set(newId, "");
				            currentActiveRowId = newId;
				            $('#resolutionComments').val("").focus();
				        });
				    } catch (error) {
				        console.error("Error adding row:", error);
				    }
				});


				igcselectTable.on("rowClick", function(e, row){
				    if (currentActiveRowId !== null) {
				        const currentComment = $('#resolutionComments').val();
				        rowComments.set(currentActiveRowId, currentComment);
				        const currentRow = igcselectTable.getRow(currentActiveRowId);
				        if (currentRow) {
				            currentRow.update({comments: currentComment});
				        }
				    }

				    const rowData = row.getData();
				    currentActiveRowId = rowData.id;
				    
				    $('#resolutionComments').val(
				        rowData.comments ||
				        rowComments.get(currentActiveRowId) ||
				        ''
				    ).trigger('input');
				    
				    const rows = igcselectTable.getRows();
				    rows.forEach(r => {
				        r.getElement().style.backgroundColor = '';
				    });
				    
				    //row.getElement().style.backgroundColor = '#769bcc';
				    
				    igcselectTable.deselectRow();
				    row.select();
				});


				$('#resolutionComments').on('input', function() {
					
					const isResolved = $('#Status').val() === 'R';
					   if (!isResolved) {
					       //message('OG01',0,0);
						   message('CUW', "Resolution comments can only be added when the grievance status is 'Resolved'.", 0);
					       $(this).val('');
					       return;
					   }
					   
				    if (currentActiveRowId !== null) {
				        rowComments.set(currentActiveRowId, $(this).val());
				        const row = igcselectTable.getRow(currentActiveRowId);
				        if (row) {
				            row.update({comments: $(this).val()});
				        }
				    }
				});

				function formatDate(dateString) {
			        if (!dateString) return 'N/A';
			        try {
			            const date = new Date(dateString);
			            if (isNaN(date.getTime())) {
			                const parts = dateString.split(/[-T]/);
			                if (parts.length >= 3) return `${parts[1]}/${parts[2].substr(0, 2)}/${parts[0]}`;
			                return dateString;
			            }
			            return date.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' });
			        } catch {
			            return dateString;
			        }
			    }
				
				function isValidDate(dateString) {
				    if (!/^\d{2}\/\d{2}\/\d{4}$/.test(dateString)) {
				        return false;
				    }
				    const parts = dateString.split("/");
				    const month = parseInt(parts[0], 10);
				    const day = parseInt(parts[1], 10);
				    const year = parseInt(parts[2], 10);
				    if (year < 1900 || year > 2100 || month === 0 || month > 12) {
				        return false;
				    }
				    const monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
				    if (year % 400 === 0 || (year % 100 !== 0 && year % 4 === 0)) {
				        monthLength[1] = 29;
				    }
				    return day > 0 && day <= monthLength[month - 1];
				}
				
				$('input[type="date"]').each(function() {
				    $(this).attr('type', 'text').addClass('date-input').attr('maxlength', '10');

				    $(this).on('input', function() {
				        let value = $(this).val().replace(/\D/g, "");
				        if (value.length > 2) {
				            value = value.slice(0, 2) + "/" + value.slice(2);
				        }
				        if (value.length > 5) {
				            value = value.slice(0, 5) + "/" + value.slice(5, 9);
				        }
				        $(this).val(value);
				    });

				    $(this).on('change', function() {
				        validateDateField(this);
				    });

				    $(this).datepicker({
				        dateFormat: "mm/dd/yy",
				        changeMonth: true,
				        changeYear: true,
				        yearRange: (function() {
				            var currentYear = new Date().getFullYear();
				            return (currentYear - 20) + ":" + (currentYear + 20);
				        })(),
				        maxDate: 0,
				        onSelect: function(dateText) {
				            if ($(this).val()) {
				                $(this).addClass('has-value').trigger('change');
				            }
				        },
				        beforeShow: function(input, inst) {
				            const sbiIsEntered = $('#sbiNumberInput').val().trim().length === 8;
				            if (!sbiIsEntered) {
				                return false;
				            }

							if ($(input).is(':disabled')) {
								return false;
							}
							
				            setTimeout(function() {
				                const $datepickerDiv = $('#ui-datepicker-div');
				                if (!$datepickerDiv.find('.custom-btn-wrapper').length) {
				                    const $wrapper = $('<div>', {
				                        class: 'custom-btn-wrapper',
				                        css: { display: 'flex', gap: '4px', marginTop: '2px', marginBottom: '2px', justifyContent: 'space-between' }
				                    });
				                    const $todayBtn = $('<button>', {
				                        text: "Today",
				                        class: 'custom-today-btn',
				                        css: { flex: 1, padding: '2px', cursor: 'pointer', background: '#ece0ff', border: 'none' },
				                        click: function(e) {
				                            e.preventDefault();
				                            const today = $.datepicker.formatDate("mm/dd/yy", new Date());
				                            $(input).val(today).trigger('change').datepicker("hide");
				                        }
				                    });
				                    const $clearBtn = $('<button>', {
				                        text: "Clear",
				                        class: 'custom-clear-btn',
				                        css: { flex: 1, padding: '2px', cursor: 'pointer', background: '#ece0ff', border: 'none' },
				                        click: function(e) {
				                            e.preventDefault();
				                            $(input).val('').trigger('change').datepicker("hide");
				                        }
				                    });
				                    $wrapper.append($todayBtn, $clearBtn);
				                    $datepickerDiv.append($wrapper);
				                }
				            }, 10);
							return true; // Allows the datepicker to show if validation passes
				        }
				    });

				    $(this).on('input change', function() {
				        if ($(this).val()) {
				            $(this).addClass('has-value');
				            $(this).next('.form-label').css({
				                'color': '#886ab5', 'top': '-10px', 'left': '6px',
				                'background': '#fff', 'font-size': '11px', 'z-index': ''
				            });
				        } else {
				            $(this).removeClass('has-value');
				            $(this).next('.form-label').css({
				                'color': '#000', 'top': '3px', 'left': '5px',
				                'background': 'transparent', 'font-size': '', 'z-index': ''
				            });
				        }
				    });

				    if ($(this).val()) {
				        $(this).addClass('has-value').trigger('change');
				    }
				});

				function validateDateField(element) {
				    const $element = $(element);
				    const dateVal = $element.val();
				    let isFieldValid = true;
				    if ($element.attr('id') === 'GrievanceDate') {
				        const originalDate = $element.data('original-date');
				        if (originalDate && dateVal && dateVal !== originalDate) {
				            message('CUW', 'The Grievance Date cannot be modified', 0);
				            $element.val(originalDate);
				            $element.trigger('change');
				            return;
				        }
				    }
				    if (dateVal) {
				        const fieldId = $element.attr('id');
				        const fieldName = fieldId ? ($(`label[for="${fieldId}"]`).text().trim().replace(':', '') || fieldId) : 'this date field';
				        if (!isValidDate(dateVal)) {
				            message('CUW', `Please enter a valid date in MM/DD/YYYY format for '${fieldName}'.`, 0);
				            isFieldValid = false;
				        } else {
				            const selectedDate = new Date(dateVal);
				            const today = new Date();
				            today.setHours(0, 0, 0, 0);
				            if (selectedDate > today) {
				                message('CUW', `The date for '${fieldName}' cannot be in the future.`, 0);
				                isFieldValid = false;
				            }
				        }
				    }
				    if (!isFieldValid) {
				        $element.val('').trigger('change');
				    }
				}

				$('#GrievanceDate').on('blur', function() {
				    const $this = $(this);
				    const originalDate = $this.data('original-date');
				    const newDate = $this.val().trim();
				    if (originalDate && newDate && newDate !== originalDate) {
				        if (typeof message === 'function') {
				            message('CUW', 'The Grievance Date cannot be modified', 0);
				        }
				        $this.val(originalDate);
				        $this.trigger('change');
				    }
				});

				
				function formatDateForInput(dateString) {
				    if (!dateString) return '';
				    
				    if (typeof dateString === 'string' && dateString.match(/^\d{2}\/\d{2}\/\d{4}$/)) {
				        return dateString;
				    }
				    
				    const date = new Date(dateString);
				    if (isNaN(date.getTime())) {
				        const parts = dateString.split(/[-T]/);
				        if (parts.length >= 3) {
				            const month = parts[1].padStart(2, '0');
				            const day = parts[2].substr(0, 2).padStart(2, '0');
				            const year = parts[0];
				            return `${month}/${day}/${year}`;
				        }
				        return '';
				    }
				    
				    const month = String(date.getMonth() + 1).padStart(2, '0');
				    const day = String(date.getDate()).padStart(2, '0');
				    const year = date.getFullYear();
				    return `${month}/${day}/${year}`;
				}
				
				$('#IncidentTime').on('input', function(e) {
				    const timeInput = $(this);
				    let value = timeInput.val();
				    let digits = value.replace(/[^0-9]/g, '');
				    if (digits.length >= 2) {
				        let hourPart = parseInt(digits.substring(0, 2), 10);
				        if (hourPart > 24) {
				            digits = digits.substring(0, 1);
				        }
				    }
				    if (digits.length >= 4) {
				        let minutePart = parseInt(digits.substring(2, 4), 10);
				        if (minutePart > 60) {
				            digits = digits.substring(0, 3);
				        }
				    }
				    if (digits.length > 2) {
				        timeInput.val(digits.substring(0, 2) + ':' + digits.substring(2));
				    } else {
				        timeInput.val(digits);
				    }
				}).on('blur', function() {
				    const timeInput = $(this);
				    let timeValue = timeInput.val().trim();
				    if (timeValue === "") {
				        timeInput.removeClass('has-value').trigger('change');
				        return;
				    }
				    const parts = timeValue.split(':');
				    if (parts.length !== 2 || parts[0].length === 0 || parts[1].length === 0) {
				        message('CUW', 'Invalid time format. Please use HH:MM:SS.', 0);
				        timeInput.val('').removeClass('has-value').trigger('change');
				        return;
				    }
				    let hours = parseInt(parts[0], 10);
				    let minutes = parseInt(parts[1], 10);
				    if (hours === 23 && minutes === 60) {
				        hours = 0;
				        minutes = 0;
				    } else if (minutes === 60) {
				        hours += 1;
				        minutes = 0;
				    }
				    if (hours >= 24) {
				        hours = 0;
				    }
				    const finalTime = String(hours).padStart(2, '0') + ':' + String(minutes).padStart(2, '0');
				    timeInput.val(finalTime);
				    timeInput.addClass('has-value').trigger('change');
				});

				function closeModalGracefully(modalId) {
				    $(modalId).modal('hide')
				    setTimeout(() => {
				        const backdrops = document.querySelectorAll('.modal-backdrop.fade.show');
				        backdrops.forEach(el => {
				            if (el.parentNode) {
				                el.parentNode.removeChild(el);
				            }
				        })
				        document.body.classList.remove('modal-open');
				        document.body.style.overflow = '';
				        document.body.style.paddingRight = '';
				    }, 100);
				}

				function setModalReadOnlyState(modalId, isReadOnly) {
				    const $modal = $(modalId);
				    $modal.find('form').find('input, select, textarea').prop('disabled', isReadOnly);

				    if (modalId === '#abandonmentModal') {
				        $modal.find('#abandonmentOkSaveBtn').prop('disabled', isReadOnly);
				        $modal.find('#abandonmentCancelBtn').prop('disabled', false); 
				    } else if (modalId === '#returnCorrespondenceModal') {
				        $modal.find('#rcOkSaveBtn, #rcPrintBtn, #rcSpellCheckBtn').prop('disabled', isReadOnly);
				        $modal.find('#rcCancelBtnModal').prop('disabled', false); 
				    }
				}

				$('#abandonmentModal, #returnCorrespondenceModal').on('hidden.bs.modal', function () {
				    setModalReadOnlyState('#' + this.id, false);
				});

				$('#saveOffenderBtn').click(function(e) {
					e.preventDefault();

					const sbiNo = $('#sbiNumberInput').val().trim();
					if (!sbiNo || sbiNo.length !== 8) {
						message('CUW', 'Please enter a valid ID# to select or create a grievance to save', 0);
						return;
					}

					const selectedGrievanceData = grievanceListTable.getSelectedData();
					let activeGrievance;

					if (selectedGrievanceData.length > 0) {
						activeGrievance = selectedGrievanceData[0];
					} else if (selectedGrievance && selectedGrievance.is_new) {
						activeGrievance = selectedGrievance;
					} else {
						message('CUW', 'Please select or create a grievance to save', 0);
						return;
					}

					if (!checkMandatory()) {
						return;
					}

					const individualsData = individualsInvolvedTable.getData();
					for (const rowData of individualsData) {
						if (rowData.typePerson || rowData.firstName || rowData.lastName) {
							if (!rowData.firstName || !rowData.lastName) {
								message('CUW', 'First Name & Last Name is mandatory', 0);
								return;
							}
							if (rowData.typePerson === 'I' && (!rowData.id || rowData.id.length !== 8)) {
								message('OG02', 0, 0);
								return;
							}
						}
					}
					const rgcSmeData = rgcSmeTable.getData();
					for (const row of rgcSmeData) {
						if (row.type && (row.first_name || row.last_name)) {
							if (!row.vote_type) {
								message('CUW', 'Vote Type is mandatory', 0);
								return;
							}
						}
					}
					const mgcSmeData = mgcSmeTable.getData();
					for (const row of mgcSmeData) {
						if (row.type && (row.first_name || row.last_name)) {
							if (!row.vote_type) {
								message('CUW', 'Vote Type is mandatory', 0);
								return;
							}
						}
					}

					const currentUser = localStorage.getItem('userId');

					const currentIgcStaff = {
						name: $('#Pattersonfname').val().trim(),
						userId: $('#Pattersonfname').data('user-id')
					};

					if (!currentIgcStaff.name || !currentIgcStaff.userId) {
						message('CUW', 'Please ensure IGC staff is properly selected', 0);
						return;
					}

					loader(1);

					const seqNum = activeGrievance.grievance_seq_num || activeGrievance.seqNum;
					const isNew = activeGrievance.is_new;

					fetchCommitNo(sbiNo).then(mainCommitNo => {
						if (!mainCommitNo) {
							message('CUE', 'No offender record found for this SBI number', 0);
							setTimeout(() => loader(0), 1500);
							return;
						}

						const personsData = [];
						const inmatePromises = [];

						individualsInvolvedTable.getData().forEach(rowData => {
							if (rowData.typePerson) {
								const personData = {
									type: rowData.typePerson,
									first_name: rowData.firstName || '',
									last_name: rowData.lastName || '',
									mid_name: rowData.mi || '',
									suffix_name: rowData.suffix || '',
									user_id: rowData.user_id || '',
									cmty_type: rowData.cmty_type || 'IND'
								};

								if (rowData.typePerson === 'I') {
									const inmateSbi = rowData.id || '';
									if (inmateSbi) {
										const promise = fetchCommitNo(inmateSbi).then(inmateCommitNo => {
											return {
												personData: personData,
												sbi_no: inmateSbi,
												commit_no: inmateCommitNo || mainCommitNo
											};
										}).catch(() => {
											return {
												personData: personData,
												sbi_no: inmateSbi,
												commit_no: mainCommitNo
											};
										});
										inmatePromises.push(promise);
									} else {
										personData.sbi_no = '';
										personData.commit_no = mainCommitNo;
										personsData.push(personData);
									}
								} else {
									if (!rowData.user_id && rowData.id) {
										personData.user_id = rowData.id;
									}

									if (!personData.user_id) {
										message('CUW', 'Please select valid staff members for all staff entries', 0);
										return false;
									}
									personsData.push(personData);
								}
							}
						});

						Promise.all(inmatePromises).then(results => {
							results.forEach(result => {
								result.personData.sbi_no = result.sbi_no;
								result.personData.commit_no = result.commit_no;
								personsData.push(result.personData);
							});

							const investigationData = [];
							lsmeTable.getData().forEach(row => {
								if (row.userId && row.localSME) {
									const nameParts = row.localSME.split(' ');
									investigationData.push({
										user_id: row.userId,
										user_first_name: nameParts[0] || '',
										user_last_name: nameParts.length > 1 ? nameParts[1] : '',
										user_mid_name: nameParts.length > 2 ? nameParts[2] : '',
										user_suffix_name: nameParts.length > 3 ? nameParts[3] : '',
										date_sent: row.dateSent,
										end_date: row.userData ? row.userData.endDate : '',
										grvn_invst_dt: row.reportDate,
										grvn_invst_desc: row.investigationReport,
										grvn_resn_comnt: row.referralReason,
										inFormal_resl_flag: $('#informalResolution').val() || '',
										frwd_to_icg_flag: $('#forwardToIGC').is(':checked') ? 'Y' : 'N',
										frwd_to_igc_date: $('#forwardToIGCDate').val() || null,
										inserted_userid: currentUser
									});
								}
							});

							const lsmeMembersForConfig = [];
							if (typeof lsmeMembersTable !== 'undefined') {
								lsmeMembersTable.getData().forEach(member => {
									if (member.userId) {
										lsmeMembersForConfig.push({
											user_id: member.userId,
											user_first_name: member.firstName,
											user_last_name: member.lastName,
											user_mid_name: member.midName,
											user_suffix_name: member.suffix,
											start_date: member.startDate,
											end_date: member.endDate || null
										});
									}
								});
							}

							const grievanceData = {
								commitNo: mainCommitNo,
								grievanceSeqNum: seqNum,
								isNew: isNew,
								dateOfGrievance: $('#GrievanceDate').val(),
								instNum: $('#Facility').val(),
								grvnCatg: $('#Category').val(),
								dateOfIncident: $('#IncidentDate').val(),
								grvnTm: $('#IncidentTime').val(),
								grievanceCode: $('#GrievanceType').val(),
								dateReceived: $('#IGCRecdDate').val(),
								descOfComplaint: $('#DescriptionOfComplaint').val() || '',
								remedyRequested: $('#RemedyRequested').val() || '',
								medRelFlag: $('#MedicalGrievance').is(':checked') ? 'Y' : 'N',
								grvnMedRcptDt: $('#MedicalReceiptDate').val(),
								countLocCode: $('#Location').val(),
								emergencyGrvFlag: $('#Emergencyf').is(':checked') ? 'Y' : 'N',
								confGrvFlag: $('#Confidentialf').is(':checked') ? 'Y' : 'N',
								grievanceStatus: $('#Status').val(),
								grvnLvlResl: $('#LevelOfResolution').val(),
								resolutionDate: $('#ResolDate').val(),
								grvnAmount: $('#GrievanceAmount').data('raw-value') || null,
								investigatorUserId: currentIgcStaff.userId,
								investigatorName: currentIgcStaff.name,
								reason_for_abandoned: $('#abandonmentReason').val(),
								abandoned_comments: $('#abandonmentComments').val(),
								resn_retrn_vul_thread_lang: $('#rcVulgar').is(':checked') ? 'Y' : 'N',
								resn_retrn_dscp_act: $('#rcDisciplinary').is(':checked') ? 'Y' : 'N',
								resn_retrn_dscp_act_par_dcsn: $('#rcParole').is(':checked') ? 'Y' : 'N',
								resn_retrn_dscp_act_clsfn_act: $('#rcClassification').is(':checked') ? 'Y' : 'N',
								resn_retrn_act_prohb_mail: $('#rcProhibitedMail').is(':checked') ? 'Y' : 'N',
								resn_retrn_dupl_grv: $('#rcDuplicate').is(':checked') ? 'Y' : 'N',
								resn_retrn_need_orig_grv: $('#rcOriginal').is(':checked') ? 'Y' : 'N',
								resn_retrn_othr_inmate_enq: $('#rcInquiryOther').is(':checked') ? 'Y' : 'N',
								resn_retrn_expired: $('#rcExpiredFiling').is(':checked') ? 'Y' : 'N',
								resn_retrn_abuse: $('#rcAbuse').is(':checked') ? 'Y' : 'N',
								resn_retrn_other: $('#rcOtherRadio').is(':checked') ? 'Y' : 'N',
								resn_retrn_dscp_act_num: $('#rcDisciplinaryNumber').val() || null,
								resn_retrn_dupl_grv_num: $('#rcDuplicateGrievanceNumber').val() || null,
								resn_retrn_other_desc: $('#rcOtherText').val() || null,
								emergency_grv_reqst_deny: $('#emergencyRequestDenied').is(':checked') ? 'Y' : 'N',
								emergency_grv_resn_for_deny: $('#emergencyDenialReason').val(),
								emergency_frwd_to_igc: $('#emergencySendBackToIGC').is(':checked') ? 'Y' : 'N',
								emergency_comments: $('#emergencyComments').val(),
								investigationData: investigationData,
								lsmeData: {
									members: lsmeMembersForConfig
								},
								personsData: personsData
							};

							const reasonForTypeChange = $('#changeReasonText').val().trim();
							if (reasonForTypeChange) {
								grievanceData.grievanceTypeChangeData = {
									oldGrievanceType: $('#GrievanceType').data('original-value'),
									newGrievanceType: $('#GrievanceType').val(),
									changedDate: $('#changeDate').val(),
									reason: reasonForTypeChange
								};
								$('#changeReasonText').val('');
							}

							const wardenData = {};
							if ($('#wardenDateReceived').val() || $('#wardenDecisionDate').val()) {
								wardenData.warden_grvn_rew_rcpt_dt = $('#wardenDateReceived').val();
								wardenData.warden_grvn_rew_ud_ind = $('#wardenUphold').is(':checked') ? 'U' :
									($('#wardenDeny').is(':checked') ? 'D' : null);
								wardenData.warden_grvn_decn_dt = $('#wardenDecisionDate').val();
								wardenData.warden_user_id_decision = $('#wardenDecisionBy').data('user-id');
								wardenData.warden_user_id_decision_desc = null;
								wardenData.warden_grvn_decn_comnt = $('#wardenComments').val();
								wardenData.warden_grvn_rew_frwd_to_flg = $('#wardenForwardToIGC').is(':checked') ? 'Y' : 'N';
							}

							const appealData = {
								grvn_appeal_dt: $('#appealDate').val(),
								grvn_appeal_desc: $('#appealRequest').val(),
								grvn_appeal_remdy_req: '',
								frwd_to_bgo_flag: $('#forwardToBGO').is(':checked') ? 'Y' : 'N',
								frwd_to_bc_flag: $('#forwardToBCEmergency').is(':checked') ? 'Y' : 'N'
							};

							const bgoData = {};
							if ($('#bgoDateReceived').val() || $('#bgoDecisionDate').val()) {
								bgoData.bgo_grvn_rew_rcpt_dt = $('#bgoDateReceived').val();
								bgoData.bgo_grvn_rew_ud_ind = $('#bgoUphold').is(':checked') ? 'U' :
									($('#bgoDeny').is(':checked') ? 'D' : null);
								bgoData.bgo_grvn_decn_dt = $('#bgoDecisionDate').val();
								bgoData.bgo_user_id_decision = $('#bgoDecisionBy').data('user-id');
								bgoData.bgo_user_id_decision_desc = null;
								bgoData.bgo_grvn_decn_comnt = $('#bgoComments').val();
								bgoData.bgo_grvn_rew_frwd_to_flg = $('#bgoforwardToBC').is(':checked') ? 'Y' : 'N';
								bgoData.bgo_grvn_rew_frwd_dt = $('#bgoDateForwarded').val();
							}

							const bureauData = {};
							if ($('#bureauDateReceived').val() || $('#bureauDecisionDate').val()) {
								bureauData.bur_grvn_rew_rcpt_dt = $('#bureauDateReceived').val();
								bureauData.bur_grvn_rew_ud_ind = $('#bureauUphold').is(':checked') ? 'U' :
									($('#bureauDeny').is(':checked') ? 'D' : null);
								bureauData.bur_grvn_decn_dt = $('#bureauDecisionDate').val();
								bureauData.bur_grvn_rew_frwd_to_flg = $('#burforwardToIGC').is(':checked') ? 'Y' : 'N';
								bureauData.bur_user_id_decision = $('#bureauDecisionBy').data('user-id');
								bureauData.bur_user_id_decision_desc = null;
								bureauData.bur_grvn_decn_comnt = $('#bureauComments').val();
								bureauData.bur_grvn_rew_frwd_dt = $('#bureauDateForwarded').val();
							}

							$.ajax({
								url: '/OmnetTest/OffenderGrievance/saveGrievance',
								type: 'POST',
								contentType: 'application/json',
								headers: { "userId": currentUser },
								data: JSON.stringify(grievanceData),
								success: function(response) {
									if (response.success) {
										$('#Pattersonfname').val(currentIgcStaff.name).data('user-id', currentIgcStaff.userId);

										const savePromises = [];

										savePromises.push(saveIgcDetailsAndComments(mainCommitNo, response.newSeqNum || seqNum, currentUser));
										savePromises.push(saveRgcDetailsAndMembers(mainCommitNo, response.newSeqNum || seqNum, currentUser));
										savePromises.push(saveRgcMemberConfiguration(currentUser));
										savePromises.push(saveMgcDetailsAndMembers(mainCommitNo, response.newSeqNum || seqNum, currentUser));
										savePromises.push(saveMgcMemberConfiguration(currentUser));
										savePromises.push(saveReferralDetails(mainCommitNo, response.newSeqNum || seqNum, currentUser));

										if (Object.keys(wardenData).length > 0) {
											savePromises.push(saveSectionDetails('/OmnetTest/OffenderGrievance/saveWardenDetails', { commitNo: mainCommitNo, seqNum: response.newSeqNum || seqNum, wardenData: wardenData }, currentUser, 'Warden'));
										}

										if ($('#appealDate').val() || $('#appealRequest').val()) {
											savePromises.push(saveSectionDetails('/OmnetTest/OffenderGrievance/saveAppealDetails', { commitNo: mainCommitNo, seqNum: response.newSeqNum || seqNum, appealData: appealData }, currentUser, 'Appeal'));
										}

										if (Object.keys(bgoData).length > 0) {
											savePromises.push(saveSectionDetails('/OmnetTest/OffenderGrievance/saveBGODetails', { commitNo: mainCommitNo, seqNum: response.newSeqNum || seqNum, bgoData: bgoData }, currentUser, 'BGO'));
										}

										if (Object.keys(bureauData).length > 0) {
											savePromises.push(saveSectionDetails('/OmnetTest/OffenderGrievance/saveBureauChiefDetails', { commitNo: mainCommitNo, seqNum: response.newSeqNum || seqNum, bureauData: bureauData }, currentUser, 'Bureau Chief'));
										}

										Promise.all(savePromises).then(() => {
											completeSaveProcess(isNew, response.newSeqNum, response.commitNo);
										}).catch(error => {
											message('CUW', `Grievance saved, but an error occurred saving details: ${error}`, 0);
											completeSaveProcess(isNew, response.newSeqNum, response.commitNo);
										}).finally(() => {
											setTimeout(() => loader(0), 1500);
										});

									} else {
										message('CUE', response.message, 0);
										setTimeout(() => loader(0), 1500);
									}
								},
								error: function(xhr) {
									const errorMsg = xhr.responseJSON?.message || 'Error saving grievance';
									message('CUE', errorMsg, 0);
									setTimeout(() => loader(0), 1500);
								}
							});
						}).catch(error => {
							message('CUE', 'Error fetching inmate commit numbers: ' + error, 0);
							setTimeout(() => loader(0), 1500);
						});
					}).catch(error => {
						message('CUE', 'Error fetching main commit number: ' + error, 0);
						setTimeout(() => loader(0), 1500);
					});
				});

				function saveIgcDetailsAndComments(commitNo, seqNum, userId) {
				    return new Promise((resolve, reject) => {
				        $.ajax({
				            url: '/OmnetTest/OffenderGrievance/getUserDetails',
				            type: 'GET',
				            data: { userId: userId },
				            success: function(userDetails) {
				                const igcData = {
				                    user_id: userId,
				                    user_first_name: userDetails.user_first_name || '',
				                    user_last_name: userDetails.user_last_name || '',
				                    user_mid_name: userDetails.user_mid_name || '',
				                    user_suffix_name: userDetails.user_suffix_name || '',
				                    grvn_rew_asgn_dt: formatDateForInput(new Date().toISOString()),
				                    grvn_rew_recm_dt: $('#dateForwardedToRGC_SME').val() || null,
				                    grvn_rew_recm_comnt: $('#comments').val() || '',
				                    grvn_decn_ntf_flg: $('#offenderSignatureCheckbox').is(':checked') ? 'Y' : 'N',
				                    grvn_decn_ntf_dt: $('#dateOffenderSigned').val() || null,
				                    frwd_med_provider_flg: $('#forwardToMGCCheckbox').is(':checked') ? 'Y' : 'N',
				                    frwd_med_provider_date: $('#dateForwardedToMGC').val() || null,
				                    grvn_rew_rcpt_dt: $('#IGCRecdDate').val() || null,
				                    grvn_rew_frwd_to_flg: $('#forwardToRGC_SMECheckbox').is(':checked') ? 'Y' : 'N',
				                    notify_warden_flg: 'N'
				                };

				                const commentsData = [];
				                igcselectTable.getData().forEach(row => {
				                    if (row.dateEntered && row.userName) {
				                        commentsData.push({
				                            user_id: userId.substring(0, 8),
				                            user_name: row.userName,
				                            date_entered: formatDateForInput(row.dateEntered),
				                            comments: row.comments || ''
				                        });
				                    }
				                });

				                const igcPromise = saveSectionDetails('/OmnetTest/OffenderGrievance/saveIGCDetails', { commitNo, seqNum, igcData }, userId, 'IGC');
				                
				                const commentsPromise = commentsData.length > 0 ? 
				                    saveSectionDetails('/OmnetTest/OffenderGrievance/saveAdditionalComments', { commitNo, seqNum, commentsData }, userId, 'Additional Comments')
				                    : Promise.resolve();

				                Promise.all([igcPromise, commentsPromise]).then(resolve).catch(reject);
				            },
				            error: function() {
				                reject('Could not fetch user details for IGC save.');
				            }
				        });
				    });
				}

				function saveRgcDetailsAndMembers(commitNo, seqNum, userId) {
				    return new Promise((resolve, reject) => {
				        const rgcData = {
				            grvn_rew_rcpt_dt: $('#dateReceived').val(),
				            grvn_rew_recm_dt: $('#dateRecommendation').val(),
				            grvn_rew_recm_desc: $('#recommendationComments').val(),
				            grvn_rew_frwd_to_flg: $('#forwardToWarden').is(':checked') ? 'Y' : 'N'
				        };

				        const rgcStaffMembers = [];
				        const rgcInmatePromises = [];

				        rgcSmeTable.getData().forEach(row => {
				            if (!row.type || (!row.first_name && !row.last_name)) return;
				            if (row.type === 'S') {
				                rgcStaffMembers.push({ type: 'S', user_id: row.user_id, last_name: row.last_name, first_name: row.first_name, mid_name: row.mid_name, suffix_name: row.suffix_name, vote_type: row.vote_type, tie_breaker_flag: row.tie_breaker_flag === true || row.tie_breaker_flag === 'Y' ? 'Y' : 'N' });
				            } else if (row.type === 'I' && row.sbi_no) {
				                rgcInmatePromises.push(fetchCommitNo(row.sbi_no).then(inmateCommitNo => {
				                    if (!inmateCommitNo) return null;
				                    return { type: 'I', commit_no: inmateCommitNo, sbi_no: row.sbi_no, last_name: row.last_name, first_name: row.first_name, mid_name: row.mid_name, suffix_name: row.suffix_name, vote_type: row.vote_type, tie_breaker_flag: row.tie_breaker_flag === true || row.tie_breaker_flag === 'Y' ? 'Y' : 'N' };
				                }));
				            }
				        });

				        Promise.all(rgcInmatePromises).then(inmateMembers => {
				            const finalRgcMembers = rgcStaffMembers.concat(inmateMembers.filter(m => m !== null));
				            if (rgcData.grvn_rew_rcpt_dt || rgcData.grvn_rew_recm_dt || finalRgcMembers.length > 0) {
				                saveSectionDetails('/OmnetTest/OffenderGrievance/saveRGCDetails', { commitNo, seqNum, rgcData, members: finalRgcMembers }, userId, 'RGC')
				                    .then(resolve).catch(reject);
				            } else {
				                resolve();
				            }
				        }).catch(() => reject('Error fetching commit numbers for RGC members.'));
				    });
				}

				function saveRgcMemberConfiguration(userId) {
				    const rgcMembersData = rgcMembersTable.getData().filter(m => m.type && (m.first_name || m.last_name)).map(m => ({ ...m }));
				    if (rgcMembersData.length > 0) {
				        return saveSectionDetails('/OmnetTest/OffenderGrievance/saveRGCMembers', { instNum: $('#Facility').val(), members: rgcMembersData }, userId, 'RGC Configuration');
				    }
				    return Promise.resolve();
				}

				function saveMgcDetailsAndMembers(commitNo, seqNum, userId) {
				    return new Promise((resolve, reject) => {
				        const mgcData = {
				            grvn_rew_rcpt_dt: $('#MGCdateReceived').val(),
				            grvn_rew_recm_dt: $('#MGCdateRecommendation').val(),
				            grvn_rew_recm_desc: $('#MGCrecommendationComments').val()
				        };
				        const mgcStaffMembers = [];
				        const mgcInmatePromises = [];
				        mgcSmeTable.getData().forEach(row => {
				            if (!row.type || (!row.first_name && !row.last_name)) return;
				            if (row.type === 'S') {
				                mgcStaffMembers.push({ type: 'S', user_id: row.user_id, last_name: row.last_name, first_name: row.first_name, mid_name: row.mid_name, suffix_name: row.suffix_name, vote_type: row.vote_type, tie_breaker_flag: row.tie_breaker_flag === true || row.tie_breaker_flag === 'Y' ? 'Y' : 'N' });
				            } else if (row.type === 'I' && row.sbi_no) {
				                mgcInmatePromises.push(fetchCommitNo(row.sbi_no).then(inmateCommitNo => {
				                    if (!inmateCommitNo) return null;
				                    return { type: 'I', commit_no: inmateCommitNo, sbi_no: row.sbi_no, last_name: row.last_name, first_name: row.first_name, mid_name: row.mid_name, suffix_name: row.suffix_name, vote_type: row.vote_type, tie_breaker_flag: row.tie_breaker_flag === true || row.tie_breaker_flag === 'Y' ? 'Y' : 'N' };
				                }));
				            }
				        });
				        Promise.all(mgcInmatePromises).then(inmateMembers => {
				            const finalMgcMembers = mgcStaffMembers.concat(inmateMembers.filter(m => m !== null));
				            if (mgcData.grvn_rew_rcpt_dt || mgcData.grvn_rew_recm_dt || finalMgcMembers.length > 0) {
				                saveSectionDetails('/OmnetTest/OffenderGrievance/saveMGCDetails', { commitNo, seqNum, mgcData, members: finalMgcMembers }, userId, 'MGC').then(resolve).catch(reject);
				            } else {
				                resolve();
				            }
				        }).catch(() => reject('Error fetching commit numbers for MGC members.'));
				    });
				}

				function saveMgcMemberConfiguration(userId) {
				    const mgcMembersData = mgcMembersTable.getData().filter(m => m.type && (m.first_name || m.last_name)).map(m => ({ ...m, type_of_person: m.type }));
				    if (mgcMembersData.length > 0) {
				        return saveSectionDetails('/OmnetTest/OffenderGrievance/saveMGCMembers', { instNum: $('#Facility').val(), members: mgcMembersData }, userId, 'MGC Configuration');
				    }
				    return Promise.resolve();
				}

				function saveReferralDetails(commitNo, seqNum, userId) {
				    const referralData = referralTable.getData()
				        .filter(r => r.refdate && (r.nameCommittee || r.externalAgencies) && r.referredBy)
				        .map(r => ({
				            refdate: r.refdate,
				            radioPerson: r.radioPerson,
				            radioCommittee: r.radioCommittee,
				            nameCommittee: r.nameCommittee,
				            externalAgencies: r.externalAgencies,
				            referredBy: r.referredBy,
				            referredByUserId: r.referredByUserId,
				            informationRequested: r.informationRequested,
				            responseToRequest: r.responseToRequest,
				            assignedUserId: r.assignedUserId,
				            due_date: r.due_date,
				            response_date: r.response_date,
				            confidential_flag: r.confidential_flag,
				            completed_flag: r.completed_flag
				        }));

				    if (referralData.length > 0) {
				        return saveSectionDetails('/OmnetTest/OffenderGrievance/saveReferralDetails', {
				            commitNo,
				            seqNum,
				            referralData
				        }, userId, 'Referral');
				    }
				    return Promise.resolve();
				}

				function saveSectionDetails(url, data, userId, sectionName) {
				    return new Promise((resolve, reject) => {
				        $.ajax({
				            url: url,
				            type: 'POST',
				            contentType: 'application/json',
				            headers: { "userId": userId },
				            data: JSON.stringify(data),
				            success: function(response) {
				                if (response.success) {
				                    resolve();
				                } else {
				                    reject(`Failed to save ${sectionName} details: ${response.message}`);
				                }
				            },
				            error: function(xhr) {
				                const errorMsg = xhr.responseJSON?.message || `Unknown error saving ${sectionName} details`;
				                reject(errorMsg);
				            }
				        });
				    });
				}

				function completeSaveProcess(isNew, newSeqNum, commitNo) {
					loader(0);
					message('S', 0, 0);
					const newStatus = $('#Status').val();
					updateStatusIconState(newStatus);
					const sbiNo = $('#sbiNumberInput').val();
					
					if (selectedGrievance && selectedGrievance.is_new) {
						selectedGrievance = null;
					}
					
					if (isNew && newSeqNum) {
						$('#Group').val(newSeqNum);
						
						fetchGrievanceList(sbiNo, null, false).then(() => {
							const newRow = grievanceListTable.getRow(newSeqNum);
							if (newRow) {
								grievanceListTable.deselectRow();
								newRow.select();
								loadGrievanceDetails(sbiNo, newSeqNum, commitNo);
							}
						});
					} else {
						const selectedRowData = grievanceListTable.getSelectedData()[0];
						if (selectedRowData) {
							loadGrievanceDetails(sbiNo, selectedRowData.grievance_seq_num, selectedRowData.commit_no);
						}
					}
				}

				$('#addNewGrievanceBtn').click(function(e) {
					e.preventDefault();
					
					const sbiNo = $('#sbiNumberInput').val().trim();
					if (sbiNo.length !== 8) {
						message('CUW', 'Valid ID# Should be entered', 0);
						$('#sbiNumberInput').focus();
						return;
					}

					if (selectedGrievance && selectedGrievance.is_new) {
						message('CUW', 'Please complete the previous grievance before adding a new one.', 0);
						return;
					}
					
					grievanceListTable.deselectRow();

					$("input:not(#sbiNumberInput,#search-form input)").val("");
					clearGrievance();
					$('#GrievanceDate').removeData('original-date');
					individualsInvolvedTable.setData(
						Array.from({ length: 4 }, () => ({
							checkbox: "t", typePerson: "", id: "", firstName: "", lastName: "", mi: "", suffix: "",
							_idEditable: true, checked: false
						}))
					);
					$('input[type="text"]:not(#sbiNumberInput),input[type="time"],select').removeClass('has-value').trigger('change');
					$('#reportDate,#investigationReport,#referralReason').val('').prop('disabled',false);
					currentLSMERow=null; currentReferralRow=null;
					
					const tempId = 'new_' + Date.now();
					const formattedToday = formatDateForInput(new Date().toISOString().split('T')[0]);
					selectedGrievance = { sbiNo: sbiNo, seqNum: tempId, is_new: true };
					
					$('#GrievanceDate').val(formattedToday).trigger('input');
					$('#Group').val("New"); 
					
					setDefaultValuesForNewGrievance();
					updateLSMEResolutionFieldsAccess();
					setTimeout(function() { $('#IGCbtn').focus(); }, 100);

					message('CUS', `New grievance created. Please fill in the details.`, 1);
				});
				
				function updateComponentState(options) {
				    const {
				        $block,
				        $overlay,
				        tableInstance,
				        rowRemoveBtnSelector,
				        selectMemberSelector,
				        rowAddBtnSelector,
				        excludeFields = []
				    } = options;

				    if (tableInstance && !tableInstance) return;

				    const preventCellInteraction = function(e) {
				        e.preventDefault();
				        e.stopImmediatePropagation();
				    };

				    if (options.shouldDisable) {
				        $block.css('opacity', '0.4');
				        $overlay.show();
				        $block.find('input, textarea, select').prop('disabled', true);
				        $block.find('a.btn').addClass('disabled').attr('aria-disabled', 'true');
				        if (tableInstance) {
				            $block.on('mousedown focus', '.tabulator-cell', preventCellInteraction);
				        }
				        if (rowRemoveBtnSelector) {
				            $(rowRemoveBtnSelector).addClass('disabled').css('pointer-events', 'none');
				        }
				        if (selectMemberSelector) {
				            $(selectMemberSelector).addClass('disabled').css('pointer-events', 'none');
				        }
				        if (rowAddBtnSelector) {
				            $(rowAddBtnSelector).addClass('disabled').css('pointer-events', 'none');
				        }
				    } else {
				        $block.css('opacity', '1');
				        $overlay.hide();
				        $block.find('input, textarea, select')
				            .not(excludeFields.map(field => `#${field}`).join(', '))
				            .prop('disabled', false);
				        $block.find('a.btn').removeClass('disabled').attr('aria-disabled', 'false');
				        if (tableInstance) {
				            $block.off('mousedown focus', '.tabulator-cell', preventCellInteraction);
				        }
				        const buttonsToEnable = [
				            rowRemoveBtnSelector, 
				            selectMemberSelector,
				            rowAddBtnSelector
				        ].filter(Boolean).join(', ');
				        if (buttonsToEnable) {
				            $(buttonsToEnable).removeClass('disabled').css('pointer-events', 'auto');
				        }
				    }
				}

				function updateRGCState(shouldDisable) {
				    if (shouldDisable) {
				        clearSectionAndUncheckForwarder({
				            blockSelector: '#RGCSMEMainBlock',
				            tableInstance: rgcSmeTable,
				            initialTableData: rgcSme,
				            forwarderCheckboxSelector: '#forwardToRGC_SMECheckbox',
				            voteUpdateFunction: updateVoteCounts
				        });
				    }
				    updateComponentState({
				        shouldDisable,
				        $block: $('#RGCSMEMainBlock'),
				        $overlay: $('#rgcDisabledOverlay'),
				        tableInstance: rgcSmeTable,
				        rowRemoveBtnSelector: '#RGCrowRemoveBtn',
				        selectMemberSelector: '[data-target="#SelectRGCMember"]',
				        excludeFields: ['dateReceived', 'totalUphold', 'totalDeny', 'totalAbstain']
				    });
				}

				function updateMGCState(shouldDisable) {
				    if (shouldDisable) {
				        clearSectionAndUncheckForwarder({
				            blockSelector: '#MGCSMEMainBlock',
				            tableInstance: mgcSmeTable,
				            initialTableData: mgcSme,
				            forwarderCheckboxSelector: '#forwardToMGCCheckbox',
				            voteUpdateFunction: updateMGCVoteCounts
				        });
				    }
				    updateComponentState({
				        shouldDisable,
				        $block: $('#MGCSMEMainBlock'),
				        $overlay: $('#mgcDisabledOverlay'),
				        tableInstance: mgcSmeTable,
				        rowRemoveBtnSelector: '#MGCrowRemoveBtn',
				        selectMemberSelector: '[data-target="#SelectMGCMember"]'
				    });
				}


				function updateLSMEState(shouldDisable) {
				    updateComponentState({
				        shouldDisable,
				        $block: $('#LSMEMainBlock'),
				        $overlay: $('#lsmeDisabledOverlay'),
				        tableInstance: lsmeTable,
				        rowRemoveBtnSelector: '#LSMEremoverow',
				        selectMemberSelector: '[data-target="#LSMEmemberModal"]'
				    });
				}

				function updateIGCState(shouldDisable) {
				    updateComponentState({
				        shouldDisable,
				        $block: $('#IGCMainBlock'),
				        $overlay: $('#igcDisabledOverlay'),
				        tableInstance: igcselectTable,
				        rowAddBtnSelector: '#IGCrowAddBtn'
				    });
				}
				
				function updateGrievanceHeaderState(shouldDisable) {
				    updateComponentState({
				        shouldDisable,
				        $block: $('#GrievanceHeaderPanel'),
				        $overlay: $('#grievanceHeaderOverlay')
				    });
				}

				function updateGrievanceBodyState(shouldDisable) {
				    updateComponentState({
				        shouldDisable,
				        $block: $('#GrievanceBodyPanel'),
				        $overlay: $('#grievanceBodyOverlay'),
				        tableInstance: individualsInvolvedTable,
				        rowAddBtnSelector: '#addRow',
				        rowRemoveBtnSelector: '#removeRow'
				    });
				}

				function updateReferralState(shouldDisable) {
				    updateComponentState({
				        shouldDisable,
				        $block: $('#ReferralMainBlock'),
				        $overlay: $('#referralOverlay'),
				        tableInstance: referralTable,
				        rowAddBtnSelector: '#RefrowAddBtn',
				        rowRemoveBtnSelector: '#RefrowRemoveBtn'
				    });
				}

				function updateSectionState(sectionId, overlayId, shouldDisable) {
				    const $section = $(`#${sectionId}`);
				    const $overlay = $(`#${overlayId}`);
				    $section.css('opacity', shouldDisable ? '0.4' : '1');
				    shouldDisable ? $overlay.show() : $overlay.hide();
				    $section.find('input, textarea, select').prop('disabled', shouldDisable);
				    $section.find('a.btn')
				        .toggleClass('disabled', shouldDisable)
				        .attr('aria-disabled', shouldDisable ? 'true' : 'false');
				}
				const updateWardenState = (shouldDisable) => updateSectionState('WardenBsmeMainBlock', 'wardenDisabledOverlay', shouldDisable);
				const updateBGOState = (shouldDisable) => updateSectionState('BGOMainBlock', 'bgoDisabledOverlay', shouldDisable);
				const updateAppealState = (shouldDisable) => updateSectionState('AppealMainBlock', 'appealDisabledOverlay', shouldDisable);
				const updateBureauState = (shouldDisable) => { 
					updateSectionState('BureauChiefMainBlock', 'bureauDisabledOverlay', shouldDisable);
					$('#bureauChiefBtn').prop('disabled', shouldDisable);
				};
				
				function clearSectionAndUncheckForwarder(options) {
				    const { blockSelector, tableInstance, initialTableData, forwarderCheckboxSelector, voteUpdateFunction } = options;
				    $(blockSelector).find('input[type="text"]:not(.date-input), textarea').val('').trigger('input').trigger('change');
				    $(blockSelector).find('.date-input').each(function() {
				        $(this).val("");
				        $(this).datepicker('setDate', null);
				        $(this).removeClass('has-value');
				        $(this).trigger('change');
				    });
				    $(blockSelector).find('input[type="checkbox"]').prop('checked', false).trigger('change');
				    if (tableInstance && initialTableData) {
				        tableInstance.setData(initialTableData);
				    }
				    if (voteUpdateFunction) {
				        voteUpdateFunction();
				    }
				    $(forwarderCheckboxSelector).prop('checked', false).trigger('change');
				}

				$('#Status').change(function() {
				    const $statusDropdown = $(this);
				    const selectedValue = $statusDropdown.val();
					const selectedRows = grievanceListTable.getSelectedRows();
					const isNewGrievance = selectedRows.length > 0 && selectedRows[0].getData().is_new;
				    const originalStatus = $statusDropdown.data('original-status');

				    if (isNewGrievance) {
				        if (selectedValue === 'S') {
				            message('CUW', 'Cannot assign Request Resolved status to a new Grievance', 0);
				            $statusDropdown.val('');
				            return;
				        }
				        if (selectedValue === 'P') {
				            message('CUW', "Cannot use 'Return/Unprocessed' status for new Grievances. Please use 'Return with Correspondence' instead.", 0);
				            $statusDropdown.val('');
				            return;
				        }
				        if (selectedValue === 'N') {
				            message('CUW', 'Non Grievable option is no longer available.', 0);
				            $statusDropdown.val('');
				            return;
				        }
				    }

				    if (!isNewGrievance && selectedValue === 'S') {
				        if (originalStatus !== 'Q') {
				            message('CUW', 'Request Resolved status can be used only for a Grievance with a Request status.', 0);
				            $statusDropdown.val(originalStatus);
				            return;
				        }
				    }

				    if (selectedValue === 'A') {
				        $('#abandonmentReason').val('');
				        $('#abandonmentComments').val('');
				        setModalReadOnlyState('#abandonmentModal', false);
				        $('#abandonmentModal').modal('show');
				    } else if (selectedValue === 'C') {
				        setModalReadOnlyState('#returnCorrespondenceModal', false);
				        $('#returnCorrespondenceModal').modal('show');
				    } else {
				        const isResolved = selectedValue === 'R';
				        $('#LevelOfResolution').prop('disabled', !isResolved);
				        $('#ResolDate').prop('disabled', !isResolved);
				        if (!isResolved) {
				            $('#LevelOfResolution').val('').removeClass('has-value').trigger('change');
				            $('#ResolDate').val('').removeClass('has-value').trigger('change');
				        }
				    }
				});
				
				$('#abandonmentOkSaveBtn').click(function() {
			        const selectedReason = $('#abandonmentReason').val();
			        if (!selectedReason) {
			            return;
			        }
			        $('#abandonmentModal').modal('hide');
			    });

			    $('#abandonmentCancelBtn').click(function() {
			        $('#abandonmentModal').modal('hide');
			    });

			    $('#abandonmentModal').on('hidden.bs.modal', function() {
			        const reasonIsSelected = $('#abandonmentReason').val() !== '';
			        if ($('#Status').val() === 'A' && !reasonIsSelected) {
			            $('#Status').val('').trigger('change');
			        }
				 });

			    $('input[name="returnReason"]').change(function() {
			        $('#rcDisciplinaryNumber, #rcDuplicateGrievanceNumber, #rcOtherText').prop('disabled', true);
			        if ($(this).val() === 'disciplinary') {
			            $('#rcDisciplinaryNumber').prop('disabled', false).focus();
			        } else if ($(this).val() === 'duplicate') {
			            $('#rcDuplicateGrievanceNumber').prop('disabled', false).focus();
			        } else if ($(this).val() === 'other') {
			            $('#rcOtherText').prop('disabled', false).focus();
			        }
			    });

			    $('#rcOkSaveBtn').click(function() {
			        const selectedReason = $('input[name="returnReason"]:checked').val();
			        if (!selectedReason) {
			            message('CUW', 'Please select a return reason', 0);
			            return;
			        }
			        $('#returnCorrespondenceModal').modal('hide');
			        $('#Status').val('C').trigger('change');
			    });

			    $('#rcCancelBtnModal').click(function() {
					if (!$('input[name="returnReason"]:checked').val()) {
			            $('#Status').val('').trigger('change');
			        }
			        $('#returnCorrespondenceModal').data('user-cancelled', true); 
    				$('#returnCorrespondenceModal').modal('hide');
			    });

			    $('#returnCorrespondenceModal').on('show.bs.modal', function (e) {
					if (!$(this).data('is-view-only')) {
						resetReturnCorrespondenceModal();
					}
				});

				$('#returnCorrespondenceModal').on('hidden.bs.modal', function (e) {
					$(this).data('is-view-only', false);
					if (!$('input[name="returnReason"]:checked').val() && $(this).data('user-cancelled')) {
						$('#Status').val('').trigger('change');
					}
					$(this).data('user-cancelled', false);
				});

				function resetReturnCorrespondenceModal() {
					$('#returnCorrespondenceForm')[0].reset();
					$('input[name="returnReason"]').prop('checked', false);
					$('#rcDisciplinaryNumber, #rcDuplicateGrievanceNumber, #rcOtherText').val('').prop('disabled', true);
				}

				function populateReturnCorrespondenceModal(data) {
					$('#returnCorrespondenceForm')[0].reset();
					$('input[name="returnReason"]').prop('checked', false);
					$('#rcDisciplinaryNumber, #rcDuplicateGrievanceNumber, #rcOtherText').val('').prop('disabled', true);

					if (data.resn_retrn_vul_thread_lang === 'Y') {
						$('#rcVulgar').prop('checked', true);
					} else if (data.resn_retrn_dscp_act === 'Y') {
						$('#rcDisciplinary').prop('checked', true);
						$('#rcDisciplinaryNumber').val(data.resn_retrn_dscp_act_num || '');
					} else if (data.resn_retrn_dscp_act_par_dcsn === 'Y') {
						$('#rcParole').prop('checked', true);
					} else if (data.resn_retrn_dscp_act_clsfn_act === 'Y') {
						$('#rcClassification').prop('checked', true);
					} else if (data.resn_retrn_act_prohb_mail === 'Y') {
						$('#rcProhibitedMail').prop('checked', true);
					} else if (data.resn_retrn_dupl_grv === 'Y') {
						$('#rcDuplicate').prop('checked', true);
						$('#rcDuplicateGrievanceNumber').val(data.resn_retrn_dupl_grv_num || '');
					} else if (data.resn_retrn_need_orig_grv === 'Y') {
						$('#rcOriginal').prop('checked', true);
					} else if (data.resn_retrn_othr_inmate_enq === 'Y') {
						$('#rcInquiryOther').prop('checked', true);
					} else if (data.resn_retrn_expired === 'Y') {
						$('#rcExpiredFiling').prop('checked', true);
					} else if (data.resn_retrn_abuse === 'Y') {
						$('#rcAbuse').prop('checked', true);
					} else if (data.resn_retrn_other === 'Y') {
						$('#rcOtherRadio').prop('checked', true);
						$('#rcOtherText').val(data.resn_retrn_other_desc || '');
					}
					$('input[name="returnReason"]:checked').trigger('change');
				}

				function populateAbandonmentModal(data) {
					$('#abandonmentReason').val(data.reason_for_abandoned || '');
					$('#abandonmentComments').val(data.abandoned_comments || '');
				}

				$('#statusIcon').click(function() {
					const data = $(this).data('grievance-details');
					if (!data) return;

					if (data.GRIEVANCE_STATUS === 'C') {
						populateReturnCorrespondenceModal(data);
						setModalReadOnlyState('#returnCorrespondenceModal', true);
						$('#returnCorrespondenceModal').data('is-view-only', true); 
						$('#returnCorrespondenceModal').modal('show');
					} else if (data.GRIEVANCE_STATUS === 'A') {
						populateAbandonmentModal(data);
						setModalReadOnlyState('#abandonmentModal', true);
						$('#abandonmentModal').modal('show');
					}
				});
				
				function updateStatusIconState(s){
				    const $i=$('#statusIcon');
				    if(s==='A'||s==='C')$i.data('grievance-details',{...($i.data('grievance-details')||{}),GRIEVANCE_STATUS:s,reason_for_abandoned:$('#abandonmentReason').val(),abandoned_comments:$('#abandonmentComments').val(),resn_retrn_vul_thread_lang:$('#rcVulgar').is(':checked')?'Y':'N',resn_retrn_dscp_act:$('#rcDisciplinary').is(':checked')?'Y':'N',resn_retrn_dscp_act_num:$('#rcDisciplinaryNumber').val()||null,resn_retrn_dscp_act_par_dcsn:$('#rcParole').is(':checked')?'Y':'N',resn_retrn_dscp_act_clsfn_act:$('#rcClassification').is(':checked')?'Y':'N',resn_retrn_act_prohb_mail:$('#rcProhibitedMail').is(':checked')?'Y':'N',resn_retrn_dupl_grv:$('#rcDuplicate').is(':checked')?'Y':'N',resn_retrn_dupl_grv_num:$('#rcDuplicateGrievanceNumber').val()||null,resn_retrn_need_orig_grv:$('#rcOriginal').is(':checked')?'Y':'N',resn_retrn_othr_inmate_enq:$('#rcInquiryOther').is(':checked')?'Y':'N',resn_retrn_expired:$('#rcExpiredFiling').is(':checked')?'Y':'N',resn_retrn_abuse:$('#rcAbuse').is(':checked')?'Y':'N',resn_retrn_other:$('#rcOtherRadio').is(':checked')?'Y':'N',resn_retrn_other_desc:$('#rcOtherText').val()||null}).show();
				    else $i.hide().removeData('grievance-details');
				}
				
				$('#Emergencyf, #Category').on('change', function () {
				    const isEmergencyChecked = $('#Emergencyf').is(':checked');
				    const categoryVal = $('#Category').val();
				    if (this.id === 'Emergencyf') {
				        const newCategoryVal = isEmergencyChecked ? 'EGY' : 'IND';
				        $('#Category').val(newCategoryVal).addClass('has-value').trigger('change');
				    } else {
				        $('#Emergencyf').prop('checked', categoryVal === 'EGY');
				    }
				});
				
				const restrictedGrievanceTypes = ['C012', 'C011', 'C010', 'C062', 'C072'];
				const $grievanceTypeDropdown = $('#GrievanceType');
				let isEmergency = false;
				

				function handleGrievanceTypeChange() {
				    const currentType = $grievanceTypeDropdown.val();
				    const isRestricted = restrictedGrievanceTypes.includes(currentType);
					if (!isRestricted || currentType == '') {
					    updateRGCState(false);
					    updateMGCState(true);
					} else {
					    updateRGCState(isRestricted);
					    updateMGCState(isEmergency && !isRestricted);
					}
				}

				$('#Emergencyf').on('change', function() {
				    isEmergency = this.checked;
				    const currentType = $grievanceTypeDropdown.val();
				    const isRestricted = restrictedGrievanceTypes.includes(currentType);
				    if (!isEmergency) {
				        updateRGCState(isRestricted);
				        updateMGCState(!isRestricted);
						
				    } else {
				        updateRGCState(isEmergency);
				        updateMGCState(isEmergency && !isRestricted);
				    }
					updateLSMEState(isEmergency);
				});

				$grievanceTypeDropdown.on('change', handleGrievanceTypeChange);
				handleGrievanceTypeChange();

				
				$grievanceTypeDropdown.on('change', function() {
				    const selectedType = $(this).val();
				    const isRestricted = restrictedGrievanceTypes.includes(selectedType);
				    if (isRestricted) {
				        const today = formatDateForInput(new Date());
				        $('#MedicalGrievance').prop('checked', true);
				        $('#MedicalReceiptDate').val(today).addClass('has-value').trigger('change');
				    } else {
				        $('#MedicalGrievance').prop('checked', false);
				        $('#MedicalReceiptDate').val('').removeClass('has-value').trigger('change');
				    }
				});

				$('#MedicalGrievance, #MedicalReceiptDate, #GrievanceAmount').on('focus click', function(e) {
				    const currentType = $grievanceTypeDropdown.val();
				    const isRestricted = restrictedGrievanceTypes.includes(currentType);
				    if (!currentType || !isRestricted) {
						message('CUW','The selected grievance type is not Medical.Cannot update data.', 0);
				        $(this).blur();
				        e.preventDefault();
				    }
				});
				
				function handleStatusChange() {
				    const isQueued = $('#Status').val() === 'Q';
					$('#printReqBtn').prop('disabled', !isQueued);
				    const isFormGloballyDisabled = $('#saveOffenderBtn').is(':disabled');

				    if (isQueued) {
				        [updateRGCState, updateMGCState, updateIGCState, updateLSMEState, updateWardenState, updateBGOState, updateAppealState, updateBureauState].forEach(fn => fn(true));
				    } else if (!isFormGloballyDisabled) {
				        updateIGCState(false);
				        updateWardenState(false);
				        updateBGOState(false);
				        updateAppealState(false);
				        updateBureauState(false);
				    }
				}

				$('#Status').on('change', handleStatusChange);
				handleStatusChange();

				function handleCheckboxToggle(checkboxSelector, dateInputSelector) {
				    const $checkbox = $(checkboxSelector);
				    const $dateInput = $(dateInputSelector);

				    $checkbox.on('change', function() {
				        const isChecked = this.checked;
				        if (isChecked) {
				            $dateInput.val(formatDateForInput(new Date().toISOString()));
				            $dateInput.addClass('has-value');
				            if ($dateInput.hasClass('date-input')) {
				                $dateInput.datepicker('setDate', new Date());
				            }
				        } else {
				            $dateInput.val('');
				            $dateInput.removeClass('has-value');
				        }
				        $dateInput.trigger('change').trigger('input');
				    });

				    $dateInput.on('click focus', function(e) {
				        if (!$checkbox.is(':checked')) {
				            message('OG01', 0, 0);
				            $(this).blur();
				            e.preventDefault();
				            e.stopImmediatePropagation();
				        }
				    });

				    if ($checkbox.is(':checked')) {
				        if (!$dateInput.val()) {
				            $dateInput.val(formatDateForInput(new Date().toISOString()));
				        }
				        $dateInput.addClass('has-value').trigger('change');
				    }
				}

				handleCheckboxToggle('#forwardToIGC', '#forwardToIGCDate');
				handleCheckboxToggle('#forwardToRGC_SMECheckbox', '#dateForwardedToRGC_SME');
				handleCheckboxToggle('#forwardToMGCCheckbox', '#dateForwardedToMGC');
				handleCheckboxToggle('#offenderSignatureCheckbox', '#dateOffenderSigned');
				handleCheckboxToggle('#burforwardToIGC', '#bureauDateForwarded');
				handleCheckboxToggle('#bgoforwardToBC', '#bgoDateForwarded');
				handleCheckboxToggle('#forwardToBGO', '#bgoDateReceived');
				handleCheckboxToggle('#forwardToBGO', '#bgoDecisionDate');
				handleCheckboxToggle('#forwardToWarden', '#wardenDateReceived');
				
				$('#forwardToRGC_SMECheckbox').on('change', function() {
				    if (!this.checked) {
				        $('#dateReceived, #dateRecommendation, #recommendationComments').val('').trigger('input').trigger('change');
				        $('#forwardToWarden').prop('checked', false).trigger('change');
				        rgcSmeTable.setData(rgcSme);
				        updateVoteCounts();
				    }
				});

				$('#forwardToMGCCheckbox').on('change', function() {
				    if (!this.checked) {
				        $('#MGCdateReceived, #MGCdateRecommendation, #MGCrecommendationComments').val('').trigger('input').trigger('change');
				        mgcSmeTable.setData(mgcSme);
				        updateMGCVoteCounts();
				    }
				});
				
				function linkDateFields(receivedDateSelector, decisionDateSelector) {
				    const $receivedDateInput = $(receivedDateSelector);
				    const $decisionDateInput = $(decisionDateSelector);

				    $receivedDateInput.on('change', function() {
				        const receivedDate = $(this).val();
				        if (receivedDate) {
				            if (!$decisionDateInput.val()) {
				                $decisionDateInput.val(receivedDate);
				                $decisionDateInput.trigger('change');
				            }
				        } else {
				            $decisionDateInput.val('');
				            $decisionDateInput.trigger('change');
				        }
				    });

				    $decisionDateInput.on('change', function() {
				        const decisionDate = $(this).val();
				        const receivedDate = $receivedDateInput.val();
				        if (receivedDate && decisionDate !== receivedDate) {
				            //message('OG01', 0, 0);
							message('CUW', 'The Decision Date cannot be different from the Date Received for this section.', 0);
				            $(this).val(receivedDate);
				        }
				    });
				}

				linkDateFields('#bgoDateReceived', '#bgoDecisionDate');
				linkDateFields('#wardenDateReceived', '#wardenDecisionDate');
				linkDateFields('#bureauDateReceived', '#bureauDecisionDate');
				
				function setupDateForwarding(checkboxSelector, sourceDateSelector, targetDateSelector) {
				    $(checkboxSelector).on('change', function() {
				        const isChecked = $(this).is(':checked');
				        const dateValue = $(sourceDateSelector).val();
				        $(targetDateSelector).val(isChecked ? dateValue : '').trigger('input').trigger('change');
				    });

				    $(sourceDateSelector).on('change', function() {
				        if ($(checkboxSelector).is(':checked')) {
				            $(targetDateSelector).val($(this).val()).trigger('input').trigger('change');
				        }
				    });

				    $(targetDateSelector).on('click focus mousedown', function(e) {
				        e.preventDefault();
						e.stopImmediatePropagation();
						message('CUW', 'This date is automatically populated and cannot be edited directly.', 0);
						$(this).blur();
						return false;
				    });
				}

				setupDateForwarding('#forwardToRGC_SMECheckbox', '#dateForwardedToRGC_SME', '#dateReceived');
				setupDateForwarding('#forwardToMGCCheckbox', '#dateForwardedToMGC', '#MGCdateReceived');
				setupDateForwarding('#forwardToWarden', '#dateRecommendation', '#wardenDateReceived');
				setupDateForwarding('#bgoforwardToBC', '#bgoDateForwarded', '#bureauDateReceived');

				$('#bgoDateReceived, #bureauDateReceived').on('mousedown focus', function(e) {
    				e.preventDefault();
					e.stopImmediatePropagation();
					message('OG01', 0, 0);
					$(this).blur();
					return false;
				});

				function preventCheckWhenDisabled(checkboxSelector, overlaySelector) {
				    $(checkboxSelector).on('click', function(e) {
				        const isNowChecked = this.checked;
				        const isSectionDisabled = $(overlaySelector).is(':visible');
				        if (isNowChecked && isSectionDisabled) {
				            e.preventDefault();
				            message('OG01', 0, 0);
				        }
				    });
				}
				preventCheckWhenDisabled('#forwardToRGC_SMECheckbox', '#rgcDisabledOverlay');
				preventCheckWhenDisabled('#forwardToMGCCheckbox', '#mgcDisabledOverlay');

				$('input[name="wardenVote"]').change(function() {
				  if ($(this).val() === 'U') {
				    $('#wardenUphold').prop('checked', true);
				    $('#wardenDeny').prop('checked', false);
				  } else {
				    $('#wardenUphold').prop('checked', false);
				    $('#wardenDeny').prop('checked', true);
				  }
				});


				$('#emergencyRequestDenied').change(function() {
				  $('#emergencyDenialReason').prop('disabled', !this.checked);
				  if (!this.checked) $('#emergencyDenialReason').val('');
				});
				

				$('#forwardToRGC_SMECheckbox, #forwardToMGCCheckbox').on('click', function(e) {
				    if (!this.checked) {
				        return;
				    }
				    const isRGC = $(this).is('#forwardToRGC_SMECheckbox');
				    const overlayId = isRGC ? '#rgcDisabledOverlay' : '#mgcDisabledOverlay';
				    if ($(overlayId).is(':visible')) {
				        return;
				    }
				    const informalResolutionAccepted = !!$('#informalResolution').val();
				    const forwardedToIgc = $('#forwardToIGC').is(':checked');
				    const forwardDateEntered = !!$('#forwardToIGCDate').val();
				    if (!informalResolutionAccepted || !forwardedToIgc || !forwardDateEntered) {
				        e.preventDefault();
				        const committeeType = isRGC ? 'RGC' : 'MGC';
				        message('CUW', `LSME has not completed the Investigation & forwarded the Grievance to IGC. You cannot forward this Grievance to ${committeeType}.`, 0);
				    }
				});

				$('#forwardToWarden').on('click', function(e) {
				    if (!this.checked) {
				        return;
				    }
				    const forwardedToRgc = $('#forwardToRGC_SMECheckbox').is(':checked');
				    if (!forwardedToRgc) {
				        e.preventDefault();
				        message('CUW', "IGC has not forwarded this Grievance for RGC review. You cannot forward this Grievance to Warden/BSME.", 0);
				    }
				});

				$('#forwardToBGO').on('click', function(e) {
				    if (!this.checked) {
				        return;
				    }
				    const wardenDecisionDate = !!$('#wardenDecisionDate').val();
				    if (!wardenDecisionDate) {
				        e.preventDefault();
				        message('CUW', "Warden/BSME has not completed his/her decison. You cannot forward this Grievance to BGO.", 0);
				    }
				});
				
				$('#BGOMainBlock').on('mousedown click focus', ':input, a, [data-toggle="modal"]', function(e) {
					if (!$('#forwardToBGO').is(':checked')) {
						e.preventDefault();
						e.stopImmediatePropagation();
						if (e.type === 'focus') {
							$(this).blur();
						}
						message('CUW', "This section is disabled. Please check 'Forward to BGO' in the Appeal section to enable.", 0);
						return false;
					}
				});

				$('#BureauChiefMainBlock').on('mousedown click focus', ':input, a, [data-toggle="modal"]', function(e) {
					const isForwardedFromBGO = $('#bgoforwardToBC').is(':checked');
					const isForwardedFromAppeal = $('#forwardToBCEmergency').is(':checked');
					if (!isForwardedFromBGO && !isForwardedFromAppeal) {
						e.preventDefault();
						e.stopImmediatePropagation();
						if (e.type === 'focus') {
							$(this).blur();
						}
						message('CUW', "This section is disabled. Please check 'Forward to BC' in the Appeal or BGO section to enable.", 0);
						return false;
					}
				});

				$('#forwardToBCEmergency').on('click', function(e) {
				    if (this.checked) {
				        const isEmergencyGrievance = $('#Emergencyf').is(':checked');
				        if (isEmergencyGrievance) {
				            const isForwardedByWarden = $('#wardenForwardToIGC').is(':checked');
				            const wardenDecisionMade = !!$('#wardenDecisionDate').val();
				            if (!isForwardedByWarden || !wardenDecisionMade) {
				                e.preventDefault();
				                message('CUW', 'This Grievance has not been forwarded by the Warden/BSME to the IGC after the completion of Warden/BSME. You cannot forward this Grievance to BC.', 0);
				            }
				        } else {
				            e.preventDefault();
				            message('CUW', 'This is not an Emergency Grievance. You can only use this option for an Emergency Grievance. Please forward it to BGO.', 0);
				        }
				    }
				});
				
				function setupDecisionByPopulation(dateFieldId, byFieldId) {
			        $(dateFieldId).on('change', function() {
			            const $byField = $(byFieldId);
			            if ($(this).val() && !$byField.val()) {
			                const currentUserId = localStorage.getItem('userId');
			                if (currentUserId) {
			                    getUserFullName(currentUserId).then(fullName => {
			                        $byField.val(fullName).data('user-id', currentUserId);
			                        $byField.addClass('has-value').trigger('change');
			                    });
			                }
			            }
			        });
			    }

			    setupDecisionByPopulation('#wardenDecisionDate', '#wardenDecisionBy');
			    setupDecisionByPopulation('#bgoDecisionDate', '#bgoDecisionBy');
			    setupDecisionByPopulation('#bureauDecisionDate', '#bureauDecisionBy');
				
				$('#GrievanceAmount')
				    .on('focus', function() {
				        const $input = $(this);
				        const rawValue = $input.data('raw-value') || '';
				        $input.val(rawValue);
				    })
				    .on('input', function() {
				        let value = $(this).val();
				        value = value.replace(/[^\d.]/g, '');
				        const parts = value.split('.');
				        if (parts.length > 2) {
				            value = parts[0] + '.' + parts.slice(1).join('');
				        }
				        const cleanParts = value.split('.');
				        if (cleanParts[0].length > 10) {
				            cleanParts[0] = cleanParts[0].slice(0, 10);
				        }
				        if (cleanParts[1] && cleanParts[1].length > 2) {
				            cleanParts[1] = cleanParts[1].slice(0, 2);
				        }
				        const finalValue = cleanParts.join('.');
				        if ($(this).val() !== finalValue) {
				            $(this).val(finalValue);
				        }
				    })
				    .on('blur', function() {
				        const $input = $(this);
				        const value = $input.val().trim();
				        if (value === '' || isNaN(parseFloat(value))) {
				            $input.val('');
				            $input.data('raw-value', '');
				        } else {
				            const numericValue = parseFloat(value);
				            const formattedValue = numericValue.toFixed(2);
				            $input.data('raw-value', formattedValue);
				            $input.val('$' + formattedValue);
				        }
				    });

				
				$('#printReqBtn').click(function(e){
				    e.preventDefault();
				    if($(this).is(':disabled')){return;}
				    const selectedData = grievanceListTable.getSelectedData();
				    if (selectedData.length === 0 || selectedData[0].is_new) {
				        message('CUW','There is no grievance. Please select/save the grievance',0);
				        return;
				    }
				 
				});

				let grievanceTypeOriginalState = {};
				let isProgrammaticChange = false;

				$('#GrievanceType').on('focus', function() {
					const $this = $(this);
					grievanceTypeOriginalState = {
						value: $this.val(),
						text: $this.find('option:selected').text(),
						isMedicalChecked: $('#MedicalGrievance').is(':checked'),
						medicalDateValue: $('#MedicalReceiptDate').val(),
						isRgcDisabled: $('#rgcDisabledOverlay').is(':visible')
					};
				});

				$('#GrievanceType').on('change', function(e) {
					if (isProgrammaticChange) {
						return;
					}

					const $this = $(this);
					const selectedRows = grievanceListTable.getSelectedRows();
					const isNewGrievanceFromTable = selectedRows.length > 0 && selectedRows[0].getData().is_new;
					const isNewGrievanceFromState = selectedGrievance && selectedGrievance.is_new;
					const isNewGrievance = isNewGrievanceFromTable || isNewGrievanceFromState;

					const originalValue = $this.data('original-value');
					const newValue = $this.val();

					if (!isNewGrievance && originalValue !== undefined && newValue !== originalValue && newValue !== '') {
						const today = new Date();
						const formattedDate = (today.getMonth() + 1).toString().padStart(2, '0') + '/' +
											today.getDate().toString().padStart(2, '0') + '/' +
											today.getFullYear();
						$('#changeDate').val(formattedDate);

						const currentUserId = localStorage.getItem('userId');
						getUserFullName(currentUserId).then(fullName => {
							$('#changedByUser').val(fullName);
						});

						$('#currentGrievanceType').val($this.data('original-text'));
						$('#newGrievanceType').val($this.find('option:selected').text());
						$('#changeReasonText').val('');

						$('#grievanceTypeChangeModal').modal({ backdrop: 'static', keyboard: false });
					}
				});

				$('#saveGrievanceTypeChange').on('click', function() {
					const reason = $('#changeReasonText').val().trim();
					if (reason === '') {
						message('CUW', 'Please provide a reason for changing the Grievance Type.', 0);
						return;
					}

					const $grievanceTypeSelect = $('#GrievanceType');
					$grievanceTypeSelect.data('change-committed', true);
					$('#grievanceTypeChangeModal').modal('hide');
				});

				$('#grievanceTypeChangeModal').on('hidden.bs.modal', function () {
					const $grievanceTypeSelect = $('#GrievanceType');

					if (!$grievanceTypeSelect.data('change-committed')) {
						isProgrammaticChange = true;
						$grievanceTypeSelect.val(grievanceTypeOriginalState.value);
						$('#MedicalGrievance').prop('checked', grievanceTypeOriginalState.isMedicalChecked);
						$('#MedicalReceiptDate').val(grievanceTypeOriginalState.medicalDateValue).trigger('input');
						$grievanceTypeSelect.trigger('change');
						isProgrammaticChange = false;
					}

					$grievanceTypeSelect.data('change-committed', false);
				});

				document.querySelectorAll('input[type="text"], input[type="date"], input[type="time"], select').forEach(element => {
				    element.addEventListener('change', function() {
				        if (this.value !== "") {
				            this.classList.add('has-value');
				        } else {
				            this.classList.remove('has-value');
				        }
				    });

				    if (element.value !== "") {
				        element.classList.add('has-value');
				    }
				});


				const inputSelectors = 'input, select, textarea';
				$(document).on('keydown', inputSelectors, function(e) {
				    if (['ArrowLeft', 'ArrowRight', 'Tab'].indexOf(e.key) === -1) {
				        return;
				    }
				    const $currentPanel = $(this).closest('.panel');
				    if ($currentPanel.length === 0) {
				        return;
				    }
				    const $inputsInPanel = $currentPanel.find(inputSelectors).filter(':visible:not([readonly]):not([disabled])');
				    const idx = $inputsInPanel.index(this);
				    if (e.key === 'ArrowRight' || e.key === 'Tab') {
				        e.preventDefault();
				        if (idx < $inputsInPanel.length - 1) {
				            $inputsInPanel.eq(idx + 1).focus();
				        }
				    } else if (e.key === 'ArrowLeft') {
				        e.preventDefault();
				        if (idx > 0) {
				            $inputsInPanel.eq(idx - 1).focus();
				        }
				    }
				});
				$(document).on('keydown', 'input[type="checkbox"]', function(e) {
				    if (e.key === 'Enter' || e.key === ' ') {
				        e.preventDefault();
				        $(this).prop('checked', !$(this).prop('checked')).trigger('change');
				    }
				});
				
				$("#clearButton").click(function() {
					$('textarea.rawField').each(function() {
	                    updateCharCount(this);
	                });
					$('#statusIcon').hide().removeData('grievance-details');
					[updateGrievanceHeaderState, updateGrievanceBodyState, updateReferralState, updateRGCState, updateMGCState, updateIGCState, updateLSMEState, updateWardenState, updateBGOState, updateAppealState, updateBureauState].forEach(fn => fn(false));
					$('[data-target="#selectNameFromlist"], #saveOffenderBtn, #printBtn,#addNewGrievanceBtn').removeClass('disabled').css('pointer-events', 'auto').prop('disabled', false);
				});	
				
				/*function referralScroll() {
				    const referralBlock = document.getElementById('ReferralMainBlock');
				    if (referralBlock) {
				       referralBlock.scrollIntoView({ behavior: 'smooth', block: 'start' });
				    }
				}*/
	
				$('#bureauChiefBtn').click(function(e) {
				    e.preventDefault();
				    const decisionDate = $('#bureauDecisionDate').val();
				    
				    if (!decisionDate || decisionDate.trim() === '') {
				        message('CUW', 'Bureau Chief has not made a decision yet.', 0);
				        return;
				    }
				    
				    const letterStyles = `
				        <style>
				            body { font-family: Arial, sans-serif; margin: 40px; }
				            h1 { color: #333; }
				            p { line-height: 1.6; }
				            .content { border: 1px solid #ccc; padding: 20px; margin-top: 20px; }
				            strong { color: #555; }
				        </style>
				    `;
	
				    let letterContent = `
				        <html>
				        <head>
				            <title>Bureau Chief Decision Letter - Grievance #${$('#Group').val()}</title>
				            ${letterStyles}
				        </head>
				        <body>
				            <h1>Bureau Chief Decision Letter</h1>
				            <div class="content">
				                <p><strong>Grievance #:</strong> ${$('#Group').val()}</p>
				                <p><strong>Decision Date:</strong> ${$('#bureauDecisionDate').val()}</p>
				                <p><strong>Decision By:</strong> ${$('#bureauDecisionBy').val()}</p>
				                <p><strong>Vote:</strong> ${$('#bureauUphold').is(':checked') ? 'Uphold' : ($('#bureauDeny').is(':checked') ? 'Deny' : 'N/A')}</p>
				                <p><strong>Comments:</strong></p>
				                <p>${$('#bureauComments').val()}</p>
				            </div>
				        </body>
				        </html>
				    `;
	
				    let letterWindow = window.open('', '_blank');
				    letterWindow.document.write(letterContent);
				    letterWindow.document.close();
				    letterWindow.focus();
				    letterWindow.print();
				});
	
	
				$('#exitButton').click(function(event){
				    event.preventDefault();
				    window.location.href = 'GrievanceSummary.html';
				});

				
				$('#printBtn').click(async function(e) {
				    loader(1);
				    e.preventDefault();

				    const getFieldValue = (selector, type = 'text') => {
				        const $el = $(selector);
				        if (!$el.length) return '';
				        if (type === 'checkbox' || type === 'radio') {
				            return $el.is(':checked');
				        }
				        if ($el.is('select')) {
				            return $el.find('option:selected').text().trim() || '';
				        }
				        return $el.val() || '';
				    };

				    const getFormattedDate = (selector) => {
				        const val = getFieldValue(selector);
				        return val || '';
				    };

				    let facilityAddress = {};
				    const selectedInstNum = $('#Facility').val();

				    if (selectedInstNum) {
				        try {
				            facilityAddress = await $.ajax({
				                url: '/OmnetTest/OffenderGrievance/getFacilityAddressInfo',
				                type: 'GET',
				                data: { instNum: selectedInstNum }
				            });
				        } catch (error) {
				            console.error("Failed to fetch facility address:", error);
				           facilityAddress = {
				                inst_name: getFieldValue('#Facility'), 
				                street: '',
				                city: '',
				                state: '',
				                zip: '',
				                phone: ''
				            };
				        }
				    }

				    const offenderInfo = {
				        name: getFieldValue('#offenderName'),
				        sbi: getFieldValue('#sbiNumberInput'),
				        grievanceNum: getFieldValue('#Group'),
				        grievanceDate: getFormattedDate('#GrievanceDate'),
				        institution: getFieldValue('#Facility'),
				        category: getFieldValue('#Category'),
				        status: getFieldValue('#Status'),
				        resolutionStatus: '',
				        resolDate: getFormattedDate('#ResolDate'),
				        grievanceType: getFieldValue('#GrievanceType'),
				        incidentDate: getFormattedDate('#IncidentDate'),
				        incidentTime: getFieldValue('#IncidentTime'),
				        igc: getFieldValue('#Pattersonfname'),
				        housingAtTheTime: '',
				        grievanceLoc: getFieldValue('#Location'),
				        currentHousing: getFieldValue('#CurrentHousing')
				    };

				    const buildStyles = () => `
				        <style>
				            body { font-family: Arial, sans-serif; font-size: 10pt; color: #000; }
				            @page { size: letter; margin: 0.5in; }
				            .page { page-break-after: always; width: 100%; position: relative; min-height: 9.5in; display: flex; flex-direction: column; }
				            .page:last-child { page-break-after: avoid; }
				            .header-table, .info-table, .content-table, .footer-table { width: 100%; border-collapse: collapse; }
				            .header-table td { text-align: center; font-weight: bold; }
				            .header-table .address { font-size: 9pt; font-weight:normal; }
				            .page-title { font-weight: bold; text-align: center; padding: 4px 0; border: 1px solid #000; border-top: none; }
				            .info-table td { padding: 2px 5px; vertical-align: top; }
				            .info-grid { border: 1px solid #000; }
				            .info-grid td { padding: 1px 4px; }
				            .label { font-weight: bold; }
				            .section-title { font-weight: bold; text-align: center; background-color: #d3d3d3; border: 1px solid #000; padding: 3px; margin: 10px 0 0 0; }
				            .details-box { border: 1px solid #000; border-top: none; padding: 8px; word-wrap: break-word; }
				            .details-box td { padding: 2px 5px; }
				            .flex-container { display: flex; justify-content: space-between; align-items: center; }
				            .flex-item { display: flex; align-items: center; }
				            .flex-item .label { margin-right: 5px; }
				            .line { border-bottom: 1px solid #000; min-width: 200px; display: inline-block; }
				            .signature-section { margin-top: 15px; }
				            .footer { margin-top: auto; padding-top: 10px; width: 100%; text-align: right; font-size: 9pt; }
				            table.committee-members { width: 100%; border-collapse: collapse; margin-top: 5px; }
				            table.committee-members th, table.committee-members td { border: 1px solid #000; padding: 3px; text-align: center; }
				            table.committee-members th { font-weight: bold; background-color: #d3d3d3; }
				            table.referral-table { width: 100%; border-collapse: collapse; }
				            table.referral-table th, table.referral-table td { border: 1px solid #000; padding: 3px 5px; text-align: left; }
				            table.referral-table th { font-weight: bold; text-align: center; }
				            .check { font-family: 'Courier New', Courier, monospace; font-weight: bold; }
				        </style>
				    `;

				    const buildPageHeader = (pageTitle, offenderData) => {
				        const cityStateZip = [facilityAddress.city, facilityAddress.state, facilityAddress.zip].filter(Boolean).join(' ');
				        return `
				            <table class="header-table">
								<td style="text-align:right;">Date: ${new Date().toLocaleDateString('en-US')}</td>
				                <tr>
				                    <td>${facilityAddress.inst_name || 'Facility Name Not Found'}</td>
				                </tr>
				                <tr><td colspan="2" class="address">${facilityAddress.street || 'Address Not Found'}</td></tr>
				                <tr><td colspan="2" class="address">${cityStateZip}</td></tr>
				                <tr><td colspan="2" class="address">Phone No. ${facilityAddress.phone || 'Phone Not Found'}</td></tr>
				            </table>
				            <div class="page-title">${pageTitle}</div>
				            <div class="section-title">OFFENDER GRIEVANCE INFORMATION</div>
				            <div class="info-grid">
				                <table class="info-table">
				                    <tr>
				                        <td width="15%"><span class="label">Offender Name</span></td><td width="25%">: ${offenderData.name}</td>
				                        <td width="10%"><span class="label">SBI#</span></td><td width="15%">: ${offenderData.sbi}</td>
				                        <td width="12%"><span class="label">Institution</span></td><td width="23%">: ${offenderData.institution}</td>
				                    </tr>
				                    <tr>
				                        <td><span class="label">Grievance #</span></td><td>: ${offenderData.grievanceNum}</td>
				                        <td><span class="label">Grievance Date</span></td><td>: ${offenderData.grievanceDate}</td>
				                        <td><span class="label">Category</span></td><td>: ${offenderData.category}</td>
				                    </tr>
				                     <tr>
				                        <td><span class="label">Status</span></td><td>: ${offenderData.status}</td>
				                        <td><span class="label">Resolution Status</span></td><td>: ${offenderData.resolutionStatus}</td>
				                        <td><span class="label">Resol. Date</span></td><td>: ${offenderData.resolDate}</td>
				                    </tr>
				                     <tr>
				                        <td><span class="label">Grievance Type</span></td><td>: ${offenderData.grievanceType}</td>
				                        <td><span class="label">Incident Date</span></td><td>: ${offenderData.incidentDate}</td>
				                        <td><span class="label">Incident Time</span></td><td>: ${offenderData.incidentTime}</td>
				                    </tr>
				                     <tr>
				                        <td><span class="label">IGC</span></td><td>: ${offenderData.igc}</td>
				                        <td><span class="label">Housing at the</span></td><td>: ${offenderData.housingAtTheTime}</td>
				                        <td></td><td></td>
				                    </tr>
				                    <tr>
				                        <td><span class="label">Grievance Loc</span></td><td>: ${offenderData.grievanceLoc}</td>
				                        <td><span class="label">Current Housing</span></td><td colspan="3">: ${offenderData.currentHousing}</td>
				                    </tr>
				                </table>
				            </div>
				        `;
				    };

				    const buildFooter = (pageNum) => `<div class="footer">Page ${pageNum} of 8</div>`;

				    const buildPage1 = () => `
				        <div class="page">
				            <div>
				                ${buildPageHeader('GRIEVANCE REPORT', offenderInfo)}
				                <div class="section-title">OFFENDER GRIEVANCE DETAILS</div>
				                <div class="details-box">
				                    <table>
				                        <tr><td class="label" width="20%">Description of Complaint</td><td>: ${getFieldValue('#DescriptionOfComplaint')}</td></tr>
				                        <tr style="height: 10px;"></tr>
				                        <tr><td class="label">Remedy Requested</td><td>: ${getFieldValue('#RemedyRequested')}</td></tr>
				                    </table>
				                </div>
				                <div class="section-title">ADDITIONAL GRIEVANCE INFORMATION</div>
				                <div class="details-box">
				                    <div class="flex-container">
				                        <div class="flex-item"><span class="label">Medical Grievance:</span> ${getFieldValue('#MedicalGrievance', 'checkbox') ? 'YES' : 'NO'}</div>
				                        <div class="flex-item"><span class="label">Date Received by Medical Unit:</span> ${getFormattedDate('#MedicalReceiptDate')}</div>
				                    </div>
				                    <div class="flex-item" style="margin-top:5px;"><span class="label">Grievance Amount:</span> ${getFieldValue('#GrievanceAmount')}</div>
				                </div>
				                <br><br>
				                <div class="page-title">INFORMAL RESOLUTION</div>
				                ${buildPageHeader('', offenderInfo)}
				                <div class="section-title">INFORMAL RESOLUTION</div>
				                <div class="details-box">
				                    <table style="width:100%;">
				                        <tr>
				                            <td width="18%"><span class="label">Investigator Name</span></td><td width="50%">: ${(lsmeTable.getData().find(r => r.localSME) || {localSME: ''}).localSME}</td>
				                            <td width="15%"><span class="label">Date of Report:</span></td><td width="17%">${getFormattedDate('#reportDate')}</td>
				                        </tr>
				                        <tr><td class="label" colspan="4">Investigation Report :</td></tr>
				                        <tr><td colspan="4" style="padding-top:20px; min-height: 40px;">${getFieldValue('#investigationReport')}</td></tr>
				                        <tr><td class="label" colspan="4" style="padding-top:10px;">Reason for Referring:</td></tr>
				                        <tr><td colspan="4" style="padding-top:20px; min-height: 40px;">${getFieldValue('#referralReason')}</td></tr>
				                    </table>
				                     <table style="width:100%; margin-top: 40px;">
				                        <tr>
				                            <td width="50%"><span class="label">Offender's Signature:</span> <span class="line"></span></td>
				                            <td width="50%"><span class="label">Date:</span> <span class="line"></span></td>
				                        </tr>
				                        <tr style="height: 40px;"><td colspan="2"></td></tr>
				                        <tr>
				                            <td><span class="label">Witness (Officer):</span> <span class="line"></span></td>
				                            <td></td>
				                        </tr>
				                    </table>
				                </div>
				            </div>
				            ${buildFooter(1)}
				        </div>
				    `;

				    const buildPage2 = () => `
				        <div class="page">
				            <div>
				                ${buildPageHeader('GRIEVANCE INFORMATION - IGC', offenderInfo)}
				                <div class="section-title">IGC</div>
				                <div class="details-box">
				                    <div class="label">Comments:</div>
				                    <div style="width:100%; min-height: 80px; border: 1px solid #ccc; margin-top: 3px; padding: 3px; word-wrap: break-word;">${getFieldValue('#comments')}</div>
				                    <table style="width:100%; margin-top: 20px; border-collapse: collapse;">
				                        <tr style="vertical-align: middle;">
				                            <td style="width: 35%; padding: 5px 0;">
				                                <span class="check">${getFieldValue('#forwardToMGCCheckbox', 'checkbox') ? '[X]' : '[ ]'}</span> Forward to MGC
				                            </td>
				                            <td style="width: 65%; padding: 5px 0;">
				                                <span class="label">Date Forwarded to MGC:</span> ${getFormattedDate('#dateForwardedToMGC')}
				                            </td>
				                        </tr>
				                        <tr style="vertical-align: middle;">
				                            <td style="padding: 5px 0;">
				                                <span class="check">${getFieldValue('#forwardToRGC_SMECheckbox', 'checkbox') ? '[X]' : '[ ]'}</span> Forward to RGC / SME
				                            </td>
				                            <td style="padding: 5px 0;">
				                                <span class="label">Date Forwarded to RGC/SME:</span> ${getFormattedDate('#dateForwardedToRGC_SME')}
				                            </td>
				                        </tr>
				                        <tr style="vertical-align: middle;">
				                            <td style="padding: 5px 0;">
				                                <span class="check">${getFieldValue('#offenderSignatureCheckbox', 'checkbox') ? '[X]' : '[ ]'}</span> Offender Signature Captured
				                            </td>
				                            <td style="padding: 5px 0;">
				                                <span class="label">Date Offender Signed:</span> ${getFormattedDate('#dateOffenderSigned')}
				                            </td>
				                        </tr>
				                    </table>
				                </div>
				                <div class="section-title">ADDITIONAL COMMENTS AFTER RESOLUTION</div>
				                <div class="details-box" style="min-height: 200px;">
				                    <!-- Data from 'igcselectTable' can be added here if needed -->
				                </div>
				            </div>
				            ${buildFooter(2)}
				        </div>
				    `;

				    const buildPage3 = () => {
				        let rgcMembersHtml = '';
				        const rgcData = typeof rgcSmeTable !== 'undefined' ? rgcSmeTable.getData() : [];
				        if (rgcData.length > 0) {
				            rgcData.forEach(row => {
				                if (row.type) {
				                    rgcMembersHtml += `<tr><td>${{I:'Inmate',S:'Staff'}[row.type] || ''}</td><td>${row.sbi_no || ''}</td><td style="text-align:left;">${row.last_name || ''}, ${row.first_name || ''}</td><td>${{U:'Uphold',D:'Deny',A:'Abstain'}[row.vote_type] || ''}</td></tr>`;
				                }
				            });
				        }
				        if (rgcMembersHtml === '') rgcMembersHtml = '<tr><td colspan="4"> </td></tr>';

				        let tieBreakerHtml = '';
				        const tieBreaker = rgcData.find(row => row.tie_breaker_flag === 'Y');
				        if (tieBreaker) {
				             tieBreakerHtml = `<tr><td>${{I:'Inmate',S:'Staff'}[tieBreaker.type] || ''}</td><td>${tieBreaker.sbi_no || ''}</td><td style="text-align:left;">${tieBreaker.last_name || ''}, ${tieBreaker.first_name || ''}</td><td>${{U:'Uphold',D:'Deny',A:'Abstain'}[tieBreaker.vote_type] || ''}</td></tr>`;
				        } else {
				            tieBreakerHtml = '<tr><td colspan="4"> </td></tr>';
				        }

				        return `
				            <div class="page">
				                <div>
				                    ${buildPageHeader('GRIEVANCE INFORMATION - RGC', {...offenderInfo, currentHousing: `RGC / SME`})}
				                    <table style="width:100%; border:1px solid #000; border-top:none;">
				                        <tr>
				                            <td width="50%" style="padding: 3px 5px;"><span class="label">Date Received:</span> ${getFormattedDate('#dateReceived')}</td>
				                            <td width="50%" style="padding: 3px 5px;"><span class="label">Date of Recommendation:</span> ${getFormattedDate('#dateRecommendation')}</td>
				                        </tr>
				                    </table>
				                    <div class="section-title">GRIEVANCE COMMITTEE MEMBERS</div>
				                    <table class="committee-members">
				                        <thead><tr><th width="20%">Person Type</th><th width="15%">SBI #</th><th width="45%">Name</th><th width="20%">Vote</th></tr></thead>
				                        <tbody>${rgcMembersHtml}</tbody>
				                    </table>
				                    <div class="section-title">VOTE COUNT</div>
				                    <table style="width:100%; border:1px solid #000; border-top:none;">
				                         <tr>
				                            <td width="33.3%" style="padding: 3px 5px;"><span class="label">Uphold:</span> ${getFieldValue('#totalUphold')}</td>
				                            <td width="33.3%" style="padding: 3px 5px;"><span class="label">Deny:</span> ${getFieldValue('#totalDeny')}</td>
				                            <td width="33.3%" style="padding: 3px 5px;"><span class="label">Abstain:</span> ${getFieldValue('#totalAbstain')}</td>
				                        </tr>
				                    </table>
				                    <div class="section-title">TIE BREAKER</div>
				                     <table class="committee-members">
				                        <thead><tr><th width="20%">Person Type</th><th width="15%">SBI #</th><th width="45%">Name</th><th width="20%">Vote</th></tr></thead>
				                        <tbody>${tieBreakerHtml}</tbody>
				                    </table>
				                    <div class="section-title">RECOMMENDATION</div>
				                    <div class="details-box" style="min-height:100px;">${getFieldValue('#recommendationComments')}</div>
				                </div>
				                ${buildFooter(3)}
				            </div>
				        `;
				    };
				    
				    const buildPage4 = () => {
				        let mgcMembersHtml = '';
				        const mgcData = typeof mgcSmeTable !== 'undefined' ? mgcSmeTable.getData() : [];
				        if (mgcData.length > 0) {
				            mgcData.forEach(row => {
				                if (row.type) {
				                    mgcMembersHtml += `<tr><td>${{I:'Inmate',S:'Staff'}[row.type] || ''}</td><td>${row.sbi_no || ''}</td><td style="text-align:left;">${row.last_name || ''}, ${row.first_name || ''}</td><td>${{U:'Uphold',D:'Deny',A:'Abstain'}[row.vote_type] || ''}</td></tr>`;
				                }
				            });
				        }
				        if (mgcMembersHtml === '') mgcMembersHtml = '<tr><td colspan="4"> </td></tr>';

				        let tieBreakerHtml = '';
				        const tieBreaker = mgcData.find(row => row.tie_breaker_flag === 'Y');
				        if (tieBreaker) {
				             tieBreakerHtml = `<tr><td>${{I:'Inmate',S:'Staff'}[tieBreaker.type] || ''}</td><td>${tieBreaker.sbi_no || ''}</td><td style="text-align:left;">${tieBreaker.last_name || ''}, ${tieBreaker.first_name || ''}</td><td>${{U:'Uphold',D:'Deny',A:'Abstain'}[tieBreaker.vote_type] || ''}</td></tr>`;
				        } else {
				            tieBreakerHtml = '<tr><td colspan="4"> </td></tr>';
				        }
				        
				        return `
				            <div class="page">
				                <div>
				                    ${buildPageHeader('GRIEVANCE INFORMATION - MGC', {...offenderInfo, currentHousing: 'MGC'})}
				                    <table style="width:100%; border:1px solid #000; border-top:none;">
				                        <tr>
				                            <td width="50%" style="padding: 3px 5px;"><span class="label">Date Received:</span> ${getFormattedDate('#MGCdateReceived')}</td>
				                            <td width="50%" style="padding: 3px 5px;"><span class="label">Date of Recommendation:</span> ${getFormattedDate('#MGCdateRecommendation')}</td>
				                        </tr>
				                    </table>
				                    <div class="section-title">GRIEVANCE COMMITTEE MEMBERS</div>
				                    <table class="committee-members">
				                        <thead><tr><th width="20%">Person Type</th><th width="15%">SBI #</th><th width="45%">Name</th><th width="20%">Vote</th></tr></thead>
				                        <tbody>${mgcMembersHtml}</tbody>
				                    </table>
				                    <div class="section-title">VOTE COUNT</div>
				                    <table style="width:100%; border:1px solid #000; border-top:none;">
				                         <tr>
				                            <td width="33.3%" style="padding: 3px 5px;"><span class="label">Uphold:</span> ${getFieldValue('#mgcTotalUphold')}</td>
				                            <td width="33.3%" style="padding: 3px 5px;"><span class="label">Deny:</span> ${getFieldValue('#mgcTotalDeny')}</td>
				                            <td width="33.3%" style="padding: 3px 5px;"><span class="label">Abstain:</span> ${getFieldValue('#mgcTotalAbstain')}</td>
				                        </tr>
				                    </table>
				                    <div class="section-title">TIE BREAKER</div>
				                     <table class="committee-members">
				                        <thead><tr><th width="20%">Person Type</th><th width="15%">SBI #</th><th width="45%">Name</th><th width="20%">Vote</th></tr></thead>
				                        <tbody>${tieBreakerHtml}</tbody>
				                    </table>
				                    <div class="section-title">RECOMMENDATION</div>
				                    <div class="details-box" style="min-height:100px;">${getFieldValue('#MGCrecommendationComments')}</div>
				                    <div style="padding: 10px; border:1px solid #000; border-top:none;"><span class="label">Inmate wishes to appeal:</span> YES <span class="check">[${getFieldValue('#MgcRadioYesBtn', 'radio') ? 'X' : ' '}]</span>  NO <span class="check">[${getFieldValue('#MgcRadioYesBtn1', 'radio') ? 'X' : ' '}]</span></div>
				                </div>
				                ${buildFooter(4)}
				            </div>
				        `;
				    };

				    const buildPage5 = () => {
				        let referralRowsHtml = '';
				        const referralData = typeof referralTable !== 'undefined' ? referralTable.getData() : [];
				        if (referralData.length > 0 && referralData.some(r => r.refdate)) {
				            referralData.forEach(row => {
				                if (row.refdate) {
				                    referralRowsHtml += `
				                        <tr>
				                            <td style="text-align:center;">${row.refdate || ''}</td>
				                            <td style="text-align:center;"><span class="check">${row.radioPerson === 'Y' ? '[X]' : '[ ]'}</span></td>
				                            <td style="text-align:center;"><span class="check">${row.radioCommittee === 'Y' ? '[X]' : '[ ]'}</span></td>
				                            <td>${row.nameCommittee || ''}</td>
				                            <td>${row.externalAgencies || ''}</td>
				                            <td>${row.referredBy || ''}</td>
				                            <td style="text-align:center;"><span class="check">${row.confidential_flag === 'Y' ? '[X]' : '[ ]'}</span></td>
				                            <td style="text-align:center;"><span class="check">${row.completed_flag === 'Y' ? '[X]' : '[ ]'}</span></td>
				                        </tr>
				                    `;
				                }
				            });
				        } else {
				             referralRowsHtml = '<tr><td colspan="8"> </td></tr>';
				        }

				        const firstReferral = referralData.find(r => r.refdate) || { informationRequested: '', responseToRequest: '' };

				        return `
				            <div class="page">
				                <div>
				                    ${buildPageHeader('GRIEVANCE INFORMATION - REFERRAL', {...offenderInfo, currentHousing: 'REFERRAL'})}
				                    <table class="referral-table">
				                        <thead><tr><th>Referral Date</th><th>Person</th><th>Committee</th><th>Committee / User Name</th><th>Agencies/Person</th><th>Referred By</th><th>Confd.</th><th>Compl.</th></tr></thead>
				                        <tbody>${referralRowsHtml}</tbody>
				                    </table>
				                    <div style="padding: 5px; border:1px solid #000; border-top:none;">
				                        <div><span class="label">Information Requested:</span> ${firstReferral.informationRequested}</div>
				                        <div style="margin-top: 5px;"><span class="label">Response to Request:</span> ${firstReferral.responseToRequest}</div>
				                    </div>
				                </div>
				                ${buildFooter(5)}
				            </div>
				        `;
				    };
				    
				    const buildPage6 = () => `
				        <div class="page">
				            <div>
				                ${buildPageHeader('GRIEVANCE INFORMATION - WARDEN', {...offenderInfo, currentHousing: ''})}
				                <div class="section-title">DECISION</div>
				                <div class="details-box">
				                    <table style="width:100%;">
				                        <tr>
				                            <td width="50%"><span class="label">Decision Date:</span> ${getFormattedDate('#wardenDecisionDate')}</td>
				                            <td width="50%"><span class="label">Vote:</span> ${getFieldValue('#wardenUphold','radio') ? 'Uphold' : getFieldValue('#wardenDeny', 'radio') ? 'Deny' : ''}</td>
				                        </tr>
				                        <tr><td colspan="2"><span class="label">Comments:</span> ${getFieldValue('#wardenComments')}</td></tr>
				                    </table>
				                </div>
				                <div class="section-title">Emergency Grievance</div>
				                <div class="details-box">
				                     <table style="width:100%;">
				                        <tr>
				                            <td width="30%"><span class="label">Emergency Request Denied:</span> <span class="check">[${getFieldValue('#emergencyRequestDenied','checkbox') ? 'X' : ' '}]</span></td>
				                            <td width="40%"><span class="label">Reason for Denial:</span> ${getFieldValue('#emergencyDenialReason')}</td>
				                            <td width="30%"><span class="label">Send back to IGC:</span> <span class="check">[${getFieldValue('#emergencySendBackToIGC','checkbox') ? 'X' : ' '}]</span></td>
				                        </tr>
				                        <tr><td colspan="3"><span class="label">Comments:</span> ${getFieldValue('#emergencyComments')}</td></tr>
				                     </table>
				                </div>
				                <div class="signature-section" style="border: 1px solid #000; padding:10px;">
				                    <table style="width:100%;">
				                        <tr>
				                            <td colspan="2"><span class="label">WARDEN / WARDEN'S DESIGNEE SIGNATURE</span></td>
				                            <td style="text-align:right;"><span class="label">DATE</span></td>
				                        </tr>
				                        <tr style="height:30px;"><td colspan="3"></td></tr>
				                        <tr>
				                            <td colspan="3">
				                                <span class="label">I WISH TO APPEAL THIS TO THE BUREAU GRIEVANCE OFFICER (B.G.O.)</span>
				                                   <br> <br>YES: <span class="line" style="min-width:100px;"></span>
				                                    <br> <br>NO: <span class="line" style="min-width:100px;"></span>
				                            </td>
				                        </tr>
				                         <tr style="height:30px;"><td colspan="3"></td></tr>
				                        <tr>
				                            <td><span class="label">GRIEVANT'S SIGNATURE</span></td>
				                            <td></td>
				                            <td style="text-align:right;"><span class="label">DATE</span></td>
				                        </tr>
				                        <tr style="height:30px;"><td colspan="3"></td></tr>
				                        <tr>
				                            <td><span class="label">I.G.C. SIGNATURE</span></td>
				                            <td></td>
				                            <td style="text-align:right;"><span class="label">DATE</span></td>
				                        </tr>
				                    </table>
				                </div>
				            </div>
				            ${buildFooter(6)}
				        </div>
				    `;

				    const buildPage7 = () => `
				        <div class="page">
				            <div>
				                ${buildPageHeader('GRIEVANCE INFORMATION - BGO', {...offenderInfo, currentHousing: ''})}
				                <div class="section-title">DECISION</div>
				                <div class="details-box">
				                    <table style="width:100%;">
				                        <tr>
				                            <td width="50%"><span class="label">Decision Date:</span> ${getFormattedDate('#bgoDecisionDate')}</td>
				                            <td width="50%"><span class="label">Vote:</span> ${getFieldValue('#bgoUphold','radio') ? 'Uphold' : getFieldValue('#bgoDeny', 'radio') ? 'Deny' : ''}</td>
				                        </tr>
				                         <tr><td colspan="2" style="padding-top:10px;"><span class="label">Comments:</span> ${getFieldValue('#bgoComments')}</td></tr>
				                         <tr>
				                            <td style="padding-top:10px;"><span class="label">Date Received:</span> ${getFormattedDate('#bgoDateReceived')}</td>
				                            <td style="padding-top:10px;"><span class="label">Date Forwarded to BC:</span> ${getFormattedDate('#bgoDateForwarded')}</td>
				                        </tr>
				                    </table>
				                </div>
				            </div>
				            ${buildFooter(7)}
				        </div>
				    `;
				    
				    const buildPage8 = () => `
				         <div class="page">
				            <div>
				                ${buildPageHeader('GRIEVANCE INFORMATION - Bureau Chief', {...offenderInfo, currentHousing: ''})}
				                <div class="section-title">DECISION</div>
				                <div class="details-box">
				                    <table style="width:100%;">
				                        <tr>
				                            <td width="50%"><span class="label">Decision Date:</span> ${getFormattedDate('#bureauDecisionDate')}</td>
				                            <td width="50%"><span class="label">Vote:</span> ${getFieldValue('#bureauUphold','radio') ? 'Uphold' : getFieldValue('#bureauDeny', 'radio') ? 'Deny' : ''}</td>
				                        </tr>
				                         <tr><td colspan="2" style="padding-top:10px;"><span class="label">Comments:</span> ${getFieldValue('#bureauComments')}</td></tr>
				                         <tr>
				                            <td style="padding-top:10px;"><span class="label">Date Received:</span> ${getFormattedDate('#bureauDateReceived')}</td>
				                            <td style="padding-top:10px;"><span class="label">Date Forwarded to IGC:</span> ${getFormattedDate('#bureauDateForwarded')}</td>
				                        </tr>
				                    </table>
				                </div>
				            </div>
				            ${buildFooter(8)}
				        </div>
				    `;

				    let printHtml = `
				        <html>
				            <head>
				                <title>Grievance Report - #${offenderInfo.grievanceNum}</title>
				                ${buildStyles()}
				            </head>
				            <body>
				                ${buildPage1()}
				                ${buildPage2()}
				                ${buildPage3()}
				                ${buildPage4()}
				                ${buildPage5()}
				                ${buildPage6()}
				                ${buildPage7()}
				                ${buildPage8()}
				            </body>
				        </html>
				    `;

				    const printWindow = window.open('', '_blank');
				    printWindow.document.write(printHtml);
				    printWindow.document.close();
				    printWindow.focus();
				     setTimeout(() => {
				        printWindow.print();
				    }, 500);

				    loader(0);
				});
    							
		});
	

		function fetchCommitNo(sbiNo) {
					    return new Promise((resolve, reject) => {
					        if (!sbiNo || sbiNo.length !== 8) {
					            resolve(null); 
					            return;
					        }
					        
					        $.ajax({
					            url: '/OmnetTest/OffenderGrievance/getCommitNoBySbi',
					            type: 'GET',
					            data: { sbiNo: sbiNo },
					            success: function(commitNo) {
					                resolve(commitNo);
					            },
					            error: function(xhr) {
					                reject(xhr.responseText || 'Unknown error');
					            }
					        });
					    });
					}
					
					function setDefaultValuesForNewGrievance() {
					    $('#Status').val('U').addClass('has-value').trigger('change');
						$('#Category').val('IND').addClass('has-value').trigger('change');
					    const userLocationCode = $('#UserLocation').text().trim();
					    if (userLocationCode) {
					        const $facilityDropdown = $('#Facility');
					        let optionFound = false;
					        $facilityDropdown.find('option').each(function() {
					            const $option = $(this);
					            const optionText = $option.text().trim();
					            if (optionText.startsWith(userLocationCode)) {
					                $option.prop('selected', true);
					                optionFound = true;
					                return false;
					            }
					        });
					        if (optionFound) {
					            $facilityDropdown.addClass('has-value').trigger('change');
					        }
					    }
					}

					var sbiNumberInput = $('#sbiNumberInput').val();
					 var screenName = document.getElementById('screenNameHolder').textContent;
					 var screenCode = document.getElementById('screenNameHolder').dataset.name;  
					 console.log(screenName,screenCode)
					insertSBISearch(screenCode,screenName,sbiNumberInput); 
		
		$(document).ready(function () {

			$(function () {
				$('.select2').select2();

				$(".select2-placeholder-multiple").select2(
					{
						placeholder: "Select State"
					});
				$(".js-hide-search").select2(
					{
						minimumResultsForSearch: 1 / 0
					});
				$(".js-max-length").select2(
					{
						maximumSelectionLength: 2,
						placeholder: "Select maximum 2 items"
					});
				$(".select2-placeholder").select2(
					{
						placeholder: "Select a state",
						allowClear: true
					});



				$(".js-select2-icons").select2(
					{
						minimumResultsForSearch: 1 / 0,
						templateResult: icon,
						templateSelection: icon,
						escapeMarkup: function (elm) {
							return elm
						}
					});

				function icon(elm) {
					elm.element;
					return elm.id ? "<i class='" + $(elm.element).data("icon") + " mr-2'></i>" + elm.text : elm.text
				}

				$(".js-data-example-ajax").select2(
					{
						ajax:
						{
							url: "https://api.github.com/search/repositories",
							dataType: 'json',
							delay: 250,
							data: function (params) {
								return {
									q: params.term, // search term
									page: params.page
								};
							},
							processResults: function (data, params) {
								// parse the results into the format expected by Select2
								// since we are using custom formatting functions we do not need to
								// alter the remote JSON data, except to indicate that infinite
								// scrolling can be used
								params.page = params.page || 1;

								return {
									results: data.items,
									pagination:
									{
										more: (params.page * 30) < data.total_count
									}
								};
							},
							cache: true
						},
						placeholder: 'Search for a repository',
						escapeMarkup: function (markup) {
							return markup;
						}, // let our custom formatter work
						minimumInputLength: 1,
						templateResult: formatRepo,
						templateSelection: formatRepoSelection
					});

				function formatRepo(repo) {
					if (repo.loading) {
						return repo.text;
					}

					var markup = "<div class='select2-result-repository clearfix d-flex'>" +
						"<div class='select2-result-repository__avatar mr-2'><img src='" + repo.owner.avatar_url + "' class='width-2 height-2 mt-1 rounded' /></div>" +
						"<div class='select2-result-repository__meta'>" +
						"<div class='select2-result-repository__title fs-lg fw-500'>" + repo.full_name + "</div>";

					if (repo.description) {
						markup += "<div class='select2-result-repository__description fs-xs opacity-80 mb-1'>" + repo.description + "</div>";
					}

					markup += "<div class='select2-result-repository__statistics d-flex fs-sm'>" +
						"<div class='select2-result-repository__forks mr-2'><i class='fal fa-lightbulb'></i> " + repo.forks_count + " Forks</div>" +
						"<div class='select2-result-repository__stargazers mr-2'><i class='fal fa-star'></i> " + repo.stargazers_count + " Stars</div>" +
						"<div class='select2-result-repository__watchers mr-2'><i class='fal fa-eye'></i> " + repo.watchers_count + " Watchers</div>" +
						"</div>" +
						"</div></div>";

					return markup;
				}

				function formatRepoSelection(repo) {
					return repo.full_name || repo.text;
				}

			});
		});
		
		/*$(document).ready(function() {
			// initialize datatable
			$('#grievanceTable').dataTable({
				scrollY: "266px",
	            scrollCollapse: true,
	            paging: false,
	            searching: false,
	            ordering: false,
	            showNEntries: false,
				info: false
			});

		});
		$(document).ready(function() {
			// initialize datatable
			$('#groupSupplementaryTable').dataTable({
				scrollY: "200px",
	            scrollCollapse: true,
	            paging: false,
	            searching: false,
	            ordering: false,
	            showNEntries: false,
	            info: false
			});

		});
		$(document).ready(function() {
			// initialize datatable
			$('#SMETable').dataTable({
				scrollY: "126",
	            scrollCollapse: true,
	            paging: false,
	            searching: false,
	            ordering: false,
	            showNEntries: false,
	            info: false
			});
		});
		$(document).ready(function() {
			// initialize datatable
			$('#AdditionalCommentsTable').DataTable({
				scrollY: "200px",
	            scrollCollapse: true,
	            paging: false,
	            searching: false,
	            ordering: false,
	            showNEntries: false,
	            info: false,
			});
		});
		$(document).ready(function() {
			// initialize datatable
			$('#MgcVotingTable').DataTable({
				scrollY: "200px",
	            scrollCollapse: true,
	            paging: false,
	            searching: false,
	            ordering: false,
	            showNEntries: false,
	            info: false,
			});
		});
		$(document).ready(function() {
			// initialize datatable
			$('#RgcSmeTable').DataTable({
				scrollY: "200px",
	            scrollCollapse: true,
	            paging: false,
	            searching: false,
	            ordering: false,
	            showNEntries: false,
	            info: false,
			});
		});
		$(document).ready(function() {
			// initialize datatable
			$('#ReferralTable').DataTable({
				scrollY: "200px",
	            scrollCollapse: true,
	            paging: false,
	            searching: false,
	            ordering: false,
	            showNEntries: false,
	            info: false,
			});
		});*/
		
		function scrollToPanel(panelId) {
		    const container = document.querySelector('.grievanceMainBlock');
		    const elem = document.getElementById(panelId);
		    if (container && elem) {
		       const scrollTopValue = elem.getBoundingClientRect().top - container.getBoundingClientRect().top + container.scrollTop;

		        container.scrollTo({
		            top: scrollTopValue,
		            behavior: 'smooth'
		        });
		    }
		}
				
		function grievanceScroll() {
            scrollToPanel("GrievanceBlockMain");
        }
        function lsmeScroll() {
            scrollToPanel("LSMEMainBlock");
        }
        function igcScroll() {
            scrollToPanel("IGCMainBlock");
        }
        function rgcScroll() {
            scrollToPanel("RGCSMEMainBlock");
        }
        function mgcScroll() {
            scrollToPanel("MGCSMEMainBlock");
        }
		function referralScroll() {
           scrollToPanel("ReferralMainBlock");
       }
         function wardenScroll() {
            scrollToPanel("WardenBsmeMainBlock");
        }
         function appealScroll() {
            scrollToPanel("AppealMainBlock");
        }
         function bgoScroll() {
            scrollToPanel("BGOMainBlock");
        }
        function bureauScroll() {
            scrollToPanel("BureauChiefMainBlock");
        }
        
		/*	  var individualsinvolved = [
				{
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
				},
				{
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
				},
				{
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
				},
				{
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
				},
			];

			//Define Table
			var table = new Tabulator("#individualsinvolved-table", {
				layout: "fitColumns",
				data: individualsinvolved,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Type of Person",
						field: "typePerson",
						headerTooltip:"Type of Contact",
		                editor: "list", 
		                editorParams: {
		                    autocomplete:true,
		                    allowEmpty: true,
		                    listOnEmpty: true,
		                    values: ["Test","Test1","Test2",],
		                },
					},
					{
						title: "ID#",
						field: "id",
						width: 100,
					},
					{
						title: "First Name",
						field: "firstName",
					},
					{
						title: "Last Name",
						field: "lastName",
					},
					{
						title: "MI",
						field: "mi",
						width: 70,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
					{
						title: "",
						field: "",
						formatter: downloadIcon,
						width: 20,
					},
				]
			});
			
			// Define Test Data
			var lsme = [
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
				{
					checkbox: "t",
					localSME: "",
					dateSent: "",
				},
			];

			//Define Table
			var table = new Tabulator("#lsme-table", {
				layout: "fitColumns",
				data: lsme,
				height: '325px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Select",
						field: "checkbox",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
					{
						title: "Local SME (F, L, M, S)",
						field: "localSME",
					},
					{
						title: "Date Sent",
						field: "dateSent",
						width: 100,
					},
				]
			});
			
			var lsmeMembers = [
				{
					checkbox: "t",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
				{
					checkbox: "t",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
				{
					checkbox: "t",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
				{
					checkbox: "t",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
				{
					checkbox: "t",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
			];

			//Define Table
			var table = new Tabulator("#lsmeMembers-table", {
				layout: "fitColumns",
				data: lsmeMembers,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Select",
						field: "checkbox",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
					{
						title: "First Name",
						field: "firstname",
					},
					{
						title: "Last Name",
						field: "lastname",
					},
					{
						title: "MI",
						field: "mi",
						width: 80,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
					{
			    	    title: "Start Date",
			    	    field: "startDate",
			    	    width: 120,
			    	},
			    	{
			    	    title: "End Date",
			    	    field: "endDate",
			    	    width: 120,
			    	},
				]
			});
			
			// Define Test Data
			var igcselect = [
				{
					checkbox: "t",
					dateEntered: "",
					userName: "",
				},
				{
					checkbox: "t",
					dateEntered: "",
					userName: "",
				},
				{
					checkbox: "t",
					dateEntered: "",
					userName: "",
				},
				{
					checkbox: "t",
					dateEntered: "",
					userName: "",
				},
			];

			//Define Table
			var table = new Tabulator("#igcselect-table", {
				layout: "fitColumns",
				data: igcselect,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Select",
						field: "checkbox",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
					{
						title: "Date Entered",
						field: "dateEntered",
						width: 100,
					},
					{
						title: "User Name",
						field: "userName",
					},
				]
			});
			
			// Define Test Data
			var rgcSme = [
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
			];

			//Define Table
			var table = new Tabulator("#rgcSme-Table", {
				layout: "fitColumns",
				data: rgcSme,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Select",
						field: "checkbox",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
					{
						title: "Type of Person",
						field: "typePerson",
						headerTooltip:"Type of Person",
					},
					{
						title: "ID#",
						field: "id",
						width: 100,
					},
					{
						title: "First Name",
						field: "firstName",
						headerTooltip:"First Name",
					},
					{
						title: "Last Name",
						field: "lastName",
						headerTooltip:"Last Name",
					},
					{
						title: "MI",
						field: "mi",
						width: 70,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
				    {
		                title: "Vote Cast",
		                headerTooltip:"Vote Cast",
		                field: "voteCast",
		                editor: "list", 
		                editorParams: {
		                    autocomplete:true,
		                    allowEmpty: true,
		                    listOnEmpty: true,
		                    values: ["Test", "Test1", "Test2"],
		                },
		            },
		            {
						title: "Tie Breaker",
						headerTooltip:"Tie Breaker",
						field: "checkbox1",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
				]
			});
			// Define Test Data
			var mgc = [
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstName: "",
					lastName: "",
					mi: "",
					suffix: "",
					voteCast: "",
					checkbox1: "t",
				},
			];

			//Define Table
			var table = new Tabulator("#mgc-Table", {
				layout: "fitColumns",
				data: mgc,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Select",
						field: "checkbox",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
					{
						title: "Type of Person",
						field: "typePerson",
						headerTooltip:"Type of Person",
					},
					{
						title: "ID#",
						field: "id",
						width: 100,
					},
					{
						title: "First Name",
						field: "firstName",
						headerTooltip:"First Name",
					},
					{
						title: "Last Name",
						field: "lastName",
						headerTooltip:"Last Name",
					},
					{
						title: "MI",
						field: "mi",
						width: 70,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
				    {
		                title: "Vote Cast",
		                headerTooltip:"Vote Cast",
		                field: "voteCast",
		                editor: "list", 
		                editorParams: {
		                    autocomplete:true,
		                    allowEmpty: true,
		                    listOnEmpty: true,
		                    values: ["Test", "Test1", "Test2"],
		                },
		            },
		            {
						title: "Tie Breaker",
						headerTooltip:"Tie Breaker",
						field: "checkbox1",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
				]
			}); 
			// Define Test Data
			 var referral = [
				{
					checkbox: "t",
					refdate: "",
					radioPerson: "",
					radioCommittee: "",
					nameCommittee: "",
					externalAgencies: "",
					referredBy: "",
				},
				{
					checkbox: "t",
					refdate: "",
					radioPerson: "",
					radioCommittee: "",
					nameCommittee: "",
					externalAgencies: "",
					referredBy: "",
				},
				{
					checkbox: "t",
					refdate: "",
					radioPerson: "",
					radioCommittee: "",
					nameCommittee: "",
					externalAgencies: "",
					referredBy: "",
				},
				{
					checkbox: "t",
					refdate: "",
					radioPerson: "",
					radioCommittee: "",
					nameCommittee: "",
					externalAgencies: "",
					referredBy: "",
				},
			];

			//Define Table
			var table = new Tabulator("#referral-Table", {
				layout: "fitColumns",
				data: referral,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Select",
						field: "checkbox",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
					{
						title: "Ref. Date",
						field: "refdate",
						width: 100,
					},
					{
						title: "Person",
						field: "radioPerson",
						formatter: radioFormatter,
					    width: 80,
					    hozAlign: "center",
						cellClick: function(e, cell) {
				        cell.getRow().select();
				        table.redraw();
				      }
					},
					{
						title: "Committee",
						field: "radioCommittee",
						formatter: radioFormatter,
					    width: 100,
					    hozAlign: "center",
						cellClick: function(e, cell) {
				        cell.getRow().select();
				        table.redraw();
						}
					},
					{
						title: "Name F, L, M, S / Committee",
						field: "nameCommittee",
					},
					{
						title: "",
						field: "",
						formatter: nameCommitteeIcon,
						width:40,
					},
					{
						title: "External Agencies / Person",
						field: "externalAgencies",
						headerTooltip:"External Agencies / Person",
					},
					{
						title: "Referred By",
						field: "referredBy",
					},
					{
						title: "",
						field: "",
						formatter: refferedIcon,
						width:40,
					},
				]
			});
			
			// Define Test Data
			
			
			
			// Define Test Data
		 var selectName = [
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
			];

			//Define Table
			var table = new Tabulator("#selectName-table", {
				layout: "fitColumns",
				data: selectName,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Last Name",
						field: "lastname",
					},
					{
						title: "First Name",
						field: "firstname",
					},
					{
						title: "MI",
						field: "mi",
						width: 80,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
				]
			});
			
			
			// Define Test Data
			var individualselectName = [
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
			];

			//Define Table
			var table = new Tabulator("#individualselectName-table", {
				layout: "fitColumns",
				data: individualselectName,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Last Name",
						field: "lastname",
					},
					{
						title: "First Name",
						field: "firstname",
					},
					{
						title: "MI",
						field: "mi",
						width: 80,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
				]
			}); 
			
			// Define Test Data
			var refCommitteselectName = [
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
			];

			//Define Table
			var table = new Tabulator("#refCommitteselectName-table", {
				layout: "fitColumns",
				data: refCommitteselectName,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Last Name",
						field: "lastname",
					},
					{
						title: "First Name",
						field: "firstname",
					},
					{
						title: "MI",
						field: "mi",
						width: 80,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
				]
			});
			
			// Define Test Data
			var refrefredselectName = [
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
			];

			//Define Table
			var table = new Tabulator("#refrefredselectName-table", {
				layout: "fitColumns",
				data: refrefredselectName,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Last Name",
						field: "lastname",
					},
					{
						title: "First Name",
						field: "firstname",
					},
					{
						title: "MI",
						field: "mi",
						width: 80,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
				]
			});
			
			// Define Test Data
			var rgcUserSuffixModal = [
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
			];

			var mgcUserSuffixModal = [
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
				{
					lastname: "",
					firstname: "",
					mi: "",
					suffix: "",
				},
			];
			//Define Table
			var table = new Tabulator("#rgcUserSuffixModal-table", {
				layout: "fitColumns",
				data: mgcUserSuffixModal,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Last Name",
						field: "lastname",
					},
					{
						title: "First Name",
						field: "firstname",
					},
					{
						title: "MI",
						field: "mi",
						width: 80,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
				]
			});
			
			// Define Test Data
			var rgcMembers = [
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
				{
					checkbox: "t",
					typePerson: "",
					id: "",
					firstname: "",
					lastname: "",
					mi: "",
					suffix: "",
					startDate: "",
					endDate: "",
				},
			];


			//Define Table
			var table = new Tabulator("#rgcMembers-table", {
				layout: "fitColumns",
				data: rgcMembers,
				height: '140px',
				printAsHtml: true,
				printStyled: true,
				columns: [
					{
						title: "Select",
						field: "checkbox",
						formatter: (cell) => {
				            const value = cell.getValue();
				            if (value) {
				                return `
				                    <input type="checkbox" />
				                    <label>${value}</label>
				                `;
				            }
				        },
						width: 100,
					},
					{
		                title: "Type of Person",
		                headerTooltip:"Type of Person",
		                field: "typePerson",
		                editor: "list", 
		                editorParams: {
		                    autocomplete:true,
		                    allowEmpty: true,
		                    listOnEmpty: true,
		                    values: ["Test", "Test1", "Test2"],
		                },
		            },
					{
						title: "ID#",
						field: "id",
						width: 100,
					},
					{
						title: "First Name",
						field: "firstname",
					},
					{
						title: "Last Name",
						field: "lastname",
					},
					{
						title: "MI",
						field: "mi",
						width: 80,
					},
					{
						title: "Suffix",
						field: "suffix",
						width: 100,
					},
					{
						title: "",
						field: "",
						width: 40,
						formatter: rgcUserIcon,
					},
					{
			    	    title: "Start Date",
			    	    field: "startDate",
			    	    width: 120,
			    	},
			    	{
			    	    title: "End Date",
			    	    field: "endDate",
			    	    width: 120,
			    	},
				]
			});
			
			
			var table = new Tabulator("#mgcUserSuffixModal-table", {
						layout: "fitColumns",
						data: mgcUserSuffixModal,
						height: '140px',
						printAsHtml: true,
						printStyled: true,
						columns: [
							{
								title: "Last Name",
								field: "lastname",
							},
							{
								title: "First Name",
								field: "firstname",
							},
							{
								title: "MI",
								field: "mi",
								width: 80,
							},
							{
								title: "Suffix",
								field: "suffix",
								width: 100,
							},
						]
					});
					
					// Define Test Data
					var mgcMembers = [
						{
							checkbox: "t",
							typePerson: "",
							id: "",
							firstname: "",
							lastname: "",
							mi: "",
							suffix: "",
							startDate: "",
							endDate: "",
						},
						{
							checkbox: "t",
							typePerson: "",
							id: "",
							firstname: "",
							lastname: "",
							mi: "",
							suffix: "",
							startDate: "",
							endDate: "",
						},
						{
							checkbox: "t",
							typePerson: "",
							id: "",
							firstname: "",
							lastname: "",
							mi: "",
							suffix: "",
							startDate: "",
							endDate: "",
						},
						{
							checkbox: "t",
							typePerson: "",
							id: "",
							firstname: "",
							lastname: "",
							mi: "",
							suffix: "",
							startDate: "",
							endDate: "",
						},
					];

					//Define Table
					var table = new Tabulator("#mgcMembers-table", {
						layout: "fitColumns",
						data: mgcMembers,
						height: '140px',
						printAsHtml: true,
						printStyled: true,
						columns: [
							{
								title: "Select",
								field: "checkbox",
								formatter: (cell) => {
						            const value = cell.getValue();
						            if (value) {
						                return `
						                    <input type="checkbox" />
						                    <label>${value}</label>
						                `;
						            }
						        },
								width: 100,
							},
							{
			                    title: "Type of Person",
			                    headerTooltip:"Type of Person",
			                    field: "typePerson",
			                    editor: "list", 
			                    editorParams: {
			                        autocomplete:true,
			                        allowEmpty: true,
			                        listOnEmpty: true,
			                        values: ["Test", "Test1", "Test2"],
			                    },
			                },
							{
								title: "ID#",
								field: "id",
								width: 100,
							},
							{
								title: "First Name",
								field: "firstname",
							},
							{
								title: "Last Name",
								field: "lastname",
							},
							{
								title: "MI",
								field: "mi",
								width: 80,
							},
							{
								title: "Suffix",
								field: "suffix",
								width: 100,
							},
							{
								title: "",
								field: "",
								width: 40,
								formatter: mgcUserIcon,
							},
							{
					    	    title: "Start Date",
					    	    field: "startDate",
					    	    width: 120,
					    	},
					    	{
					    	    title: "End Date",
					    	    field: "endDate",
					    	    width: 120,
					    	},
						]
					}); */
					
					var groupSupplementaryTable = [
									{
										checkbox: "t",
										grievance: "",
										date: "",
										time: "",
										loc: "",
										shortDescription: "",
									},
									{
										checkbox: "t",
										grievance: "",
										date: "",
										time: "",
										loc: "",
										shortDescription: "",
									},
									{
										checkbox: "t",
										grievance: "",
										date: "",
										time: "",
										loc: "",
										shortDescription: "",
									},
									{
										checkbox: "t",
										grievance: "",
										date: "",
										time: "",
										loc: "",
										shortDescription: "",
									},
									{
										checkbox: "t",
										grievance: "",
										date: "",
										time: "",
										loc: "",
										shortDescription: "",
									},
								];

								//Define Table
								var table = new Tabulator("#groupSupplementaryTable", {
									layout: "fitColumns",
									data: groupSupplementaryTable,
									height: '140px',
									printAsHtml: true,
									printStyled: true,
									columns: [
										{
											title: "Select",
											field: "checkbox",
											formatter: (cell) => {
									            const value = cell.getValue();
									            if (value) {
									                return `
									                    <input type="checkbox" />
									                    <label>${value}</label>
									                `;
									            }
									        },
											width: 100,
										},
										{
											title: "Grievance#",
											field: "grievance",
										},
										{
											title: "Date",
											field: "date",
											width: 100,
										},
										{
											title: "Time",
											field: "time",
											width: 100,
										},
										{
											title: "Loc",
											field: "loc",
											width: 100,
										},
										{
											title: "Short Description",
											field: "shortDescription",
										},
									]
								});
								
								
								
								
								
								
								
		
		/*$(igcselect[0].checkbox).html("<input type='checkbox'>");
		$(rgcSme[0].checkbox).html("<input type='checkbox'>");
		$(mgc[0].checkbox).html("<input type='checkbox'>");
		$(referral[0].checkbox).html("<input type='checkbox'>");
		$(groupSupplementaryTable[0].checkbox).html("<input type='checkbox'>");*/
		
		/*function downloadIcon(cell) {
			return `<span data-toggle="modal" data-target="#namefromListModal">
					<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="namefromListModal">					
						<i class="fa fa-user" text-primary></i>
					</a>
				</span>
			`; // HTML with the icon and the age
		}
		
		function nameCommitteeIcon(cell) {
			return `<span data-toggle="modal" data-target="#userCommitteName">
					<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="namefromListModal">					
						<i class="fa fa-users" text-primary></i>
					</a>
				</span>
			`; // HTML with the icon and the age
		}
		
		function refferedIcon(cell) {
			return `<span data-toggle="modal" data-target="#SelectRefMemberFindListModal">
					<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="namefromListModal">					
						<i class="fa fa-users" text-primary></i>
					</a>
				</span>
			`; // HTML with the icon and the age
		}
		
		function rgcUserIcon(cell) {
			return `<span data-toggle="modal" data-target="#rgcUserSuffixModal">
					<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="namefromListModal">					
						<i class="fa fa-users" text-primary></i>
					</a>
				</span>
			`; // HTML with the icon and the age
		}
		
		function mgcUserIcon(cell) {
			return `<span data-toggle="modal" data-target="#mgcUserSuffixModal">
					<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="namefromListModal">					
						<i class="fa fa-users" text-primary></i>
					</a>
				</span>
			`; // HTML with the icon and the age
		}
		
		function scanIcon(cell) {
					return `<span data-toggle="modal" data-target="#">
							<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="Scan">					
								<i class="fa fa-print" text-primary></i>
							</a>
						</span>
					`;
				}
				function viewIcon(cell) {
					return `<span data-toggle="modal" data-target="#">
							<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="Scan">					
								<i class="fa fa-file" text-primary></i>
							</a>
						</span>
					`;
				}
				function attachIcon(cell) {
					return `<span data-toggle="modal" data-target="#attachDocumentModal">
							<a href="#" class="ml-2" data-toggle="tooltip" data-placement="top" data-original-title="Scan">					
								<i class="fa fa-paperclip" text-primary></i>
							</a>
						</span>
					`;
				}*/

				
		function radioFormatter(cell, formatterParams, onRendered) {
		  var row = cell.getRow();
		  var rowId = row.getIndex();
		
		  var checked = row.isSelected() ? 'checked' : '';
		
		  return `<input type="radio" name="rowRadio" value="${rowId}" ${checked}>`;
		}
		
	</script>
	
	<div th:replace="~{fragments/msgBox :: msgBox}"></div>
	<!--<script src="js/../script.js"></script>
	
	<script>
		$(document).ready(function () {
			
		});
	</script>-->
	<script type="text/javascript">
		$('#js-page-content').smartPanel();
	</script>
</body>

</html>