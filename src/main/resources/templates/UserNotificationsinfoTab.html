<div th:fragment="UserNotificationsinfoTab" th:remove="tag">
	<div class="row">
		<div class="col-md-12 pr-md-3 col-lg-5 pr-lg-0 col-xl-5 pr-xl-0">
			<div id="infoReqCat-table"></div>
			<div class="d-flex align-items-center my-1">
				<div class="d-flex align-items-center floatingFields mt-2 mr-2">
					<input type="text" class="form-control w-100 rawField floatingLable" data-fld="Total_Categories_InfoTab" data-lbl="Total Categories" aria-label="CategoryTotal1" name="CategoryTotal1" id="CategoryTotal1" value="">
					<label for="CategoryTotal1" class="form-label mb-0 text-nowrap">Total Categories:</label>																					
				</div>
				<div class="d-flex align-items-center floatingFields mt-2 mr-2">
					<input type="text" class="form-control w-100 rawField floatingLable" data-fld="Total_Count_InfoTab" data-lbl="Total Count" aria-label="CategoryTotalCount2" name="CategoryTotalCount2" id="CategoryTotalCount2" value="">
					<label for="CategoryTotalCount2" class="form-label mb-0 text-nowrap">Total Count:</label>																					
				</div>
				<button type="button" class="btn btn-primary btn-sm rawField" data-fld="REFRESH_Categories_InfoTab" data-lbl="REFRESH" id="Refresh1">REFRESH</button>
			</div>
		</div>
		<div class="col-md-12 col-lg-7 col-xl-7">
			<h6 class="mx-0 mb-0 text-nowrap headerBlock text-center" style="font-weight: 600;">DETAILS</h6>
			<div id="InfoReqDetail1-table"></div>
			<div class="mt-3">
				<div class="floatingFieldsTextarea">									
					<textarea class="form-control rawField floatingLabletextarea" data-fld="Message_Text_InfoTab" data-lbl="Message Text" placeholder="" id="addComments2" rows="6" name="Comments" aria-label="Comments" style="resize:none;" value="" readonly onclick="redirectToPage1(urlredirectforscreen2)" ></textarea>
					<label for="addComments2" class="form-label mb-0 mr-2 text-nowrap ">Message Text</label>		
				</div>
				<div class="d-flex align-items-center mt-2">
					<button type="button" class="btn btn-primary btn-sm mr-2 rawField" data-fld="Select_All_InfoTab" data-lbl="Select All" id="SelectAllInfoTab">Select All</button>
					<button type="button" class="btn btn-primary btn-sm rawField" data-fld="De-Select_All_InfoTab" data-lbl="De-Select All" id="DeSelectAllInfoTab">De-Select All</button>
				</div>
			</div>
		</div>
	</div>
	
	<style>
		
		#infoReqCat-table .tabulator-tableholder{
			overflow-x: hidden!important;
		}
		
		@media screen and (max-width: 1370px) {
		    #InfoReqDetail1-table{
				height: 160px!important;
			}
			#infoReqCat-table{
				height: 335px!important;
			}
		}
		
				input.InfoTabcheckbox1::before {
    content: "";
    width: 14px;
    height: 14px;
    top: -1px;
    left: -1px;
    position: absolute;
    border: 1px solid #1d68cd;
    border-radius: 4px;
    z-index: 9;
}
	</style>
	<script>
	
	document.getElementById('Refresh1').addEventListener('click', function() {
	      // Refresh the page
	      NOTIInfo()
	    });
	
	var urlredirectforscreen2;
	 function redirectToPage1(urlredirectforscreen2) {
       window.location.href = urlredirectforscreen2;
   }
	
	 $('#SelectAllInfoTab').on('click', function() {
			$('.InfoTabcheckbox').prop('checked', true);
		});

		$('#DeSelectAllInfoTab').on('click', function() {
			$('.InfoTabcheckbox').prop('checked', false);
		});  
		
		NOTIInfo();
		
		function NOTIInfo(){
	 $.ajax({
	        url: 'NOTI_info',
	        method: 'GET',
	        
	        success: function(data) {
	        	let sum = 0;
	        	$('#CategoryTotal1').val(data.length);
	        	
	        	tabledatainfo1=[];
	        	 $.each(data, function(index, item) {
	        		 var	countdata=item['COUNT(A.ROWID)'];
	        		    var ShortMessage=item.SHORT_MESSAGE;
	        		    var Message=item.MESSAGE_DESCRIPTION;
	        		    
	        		    tabledatainfo1.push({
	        		        countvalues: countdata,
	        		        shortMessagevalues: ShortMessage,
	        		        messagevalues: Message
	        		    });
	        		    
	        		    sum += countdata;
	        	 });
	        	  if(data.length<=17){
	        		  var tabledata1Extra = [];
	        			 var numRecords=17;
	        			 var Dlength=data.length;
	        		 	 var extraRecord=numRecords-Dlength;
	        			 tabledata1Extra = Array.from({ length: extraRecord }, () => ({
	        				 countvalues: "",
	        			        shortMessagevalues: "",
	        			        messagevalues: "",
	        			        }));
	        			 tabledatainfo1=tabledatainfo1.concat(tabledata1Extra);
	        	  }
	        	 tableInfo.setData(tabledatainfo1);
	        	  $('#CategoryTotalCount2').val(sum);
	        		var firstBedRow = $('.tableinfoclass').first(); 
	        	    if (firstBedRow.length > 0) {
	        	        firstBedRow.trigger('click'); 
	        	    }
	        	 
	              }, 
	        
	        error: function(xhr, status, error) {
	            console.error('Error:', error);
	          }
	       });
		}

		
		var tabledatainfo1 = [];
		var infoNum = 17;
		tabledatainfo1 = Array.from({ length: infoNum }, () => ({
			 countvalues: "",
		        shortMessagevalues: "",
		        messagevalues: "",
		        }));
	//	TableDataValue(tabledatainfo1);
	
		
		//Define Table
	//	function TableDataValue(tabledatainfo1){
		var tableInfo = new Tabulator("#infoReqCat-table", {
		  layout: "fitColumns",
		  height: "460px",
		  data: tabledatainfo1,
		  
		  printAsHtml: true,
		  printStyled: true,
		  printRowRange: function () {
		    return this.getRows().filter((row) => {
		      return row.getData().gender === "male";
		    });
		  },
		  columns: [
			  {
					title: "id",
					field: "id",
					visible: false,
				},
				{
					title: 'upd',
					visible: false,
					field: "upd",
				},
				{
					title: 'rowid',
					visible: false,
					field: "rowid",
				},
			 {
		//		title: "Category",
				titleFormatter: (column) => setTitleDesc(column, 'Category_Table_InfoTab', 'Category'),
				headerTooltip:"Category",
				field: "messagevalues",
				sorter: customSorter
			},
		    {
		//      title: "Count",
		      titleFormatter: (column) => setTitleDesc(column, 'Count_Table_InfoTab', 'Count'),
		      headerTooltip:"Count",
		      field: "countvalues",
		      sorter: customSorter,
		      width: 90,
		    }
		  ],
		  rowFormatter: function(row) {
			   var rowData = row.getData();  
	            var Shortmessage = rowData.shortMessagevalues || ''; 
	            var addClass ='tableinfoclass' ;
	            var rowElement = row.getElement(); 
	            rowElement.classList.add(addClass);
	            rowElement.setAttribute('data-shortmessage-type', Shortmessage); 
	        }
		});
		
		tabulatorRegistry["infoReqCat-table"] = {
				varName: "tableInfo",
				instance: tableInfo
			};
		
	//	}
		
		$(document).on('click', '.tableinfoclass', function (e) {
		    e.preventDefault();

		    var $div = $(this);

		    const ShortMessage = $div.attr('data-shortmessage-type');  
		    if(ShortMessage !== ''){
		 	$.ajax({
		        url: 'NOTI_dtl',
		        method: 'GET',
		         data: {
		        	 ivc_short_message:ShortMessage
				}, 
		        success: function(data) {
		        	tabledata3=[];   
		        	
		        	 $.each(data, function(index, item) {
		        		 
		        		 var Date=convertToMMDDYYYY(item.DATE_TIME_SENT);
		        		 var sbi=item.SBI_NO;
		        		 var offendername=formatName(item.OFFENDER_NAME);
		        		 var sentby=formatName(item.CREATED_USER_NAME);
		        		 var noofdays=item.NO_OF_DAYS ;
		        		 var remove=item.REMOVE;
		        		 var message=item.MESSAGE_TEXT;
		        		 var shmessage=item.SHORT_MESSAGE;
		        		 var SeqNo=item.USER_MESS_SEQ_NUM;
		        		 var screencode=item.SCREEN_CODE;
		        		 var commitno=item.COMMIT_NO;
		        		 var sentbyuserid=item.CREATED_USER_ID;
		        		 var URL=item.SCREEN_URL;
		        		 
		        		 tabledata3.push({
		        			 DATE_TIME_SENT: Date,
		        			 SBI_NO: sbi,
		        			 OFFENDER_NAME: offendername,
		        			 CREATED_USER_NAME: sentby,
		        			 NO_OF_DAYS: noofdays,
		        			 REMOVE: remove === "Y" ? true : false,
		        			 MESSAGE_TEXT: message,
		        			 SHORT_MESSAGE: shmessage,
		        			 USER_MESS_SEQ_NUM: SeqNo,
		        			 SCREEN_CODE: screencode,
		        			 COMMIT_NO: commitno,
		        			 CREATED_USER_ID: sentbyuserid,
		        			 URLScreen: URL
		        		    });
		        		 
		        		 
		        		 
		        	 });
		        	 
		        	 if(data.length<=10){
		        		 var tabledata2Extra = [];
			        	 var numRecords=10;
			        	  	var Dlength=data.length;
			        	 var extraRecord=numRecords-Dlength;
		        	 tabledata2Extra = Array.from({ length: extraRecord }, () => ({
		        				        		 DATE_TIME_SENT: "",
		        				        		 SBI_NO: "",
		        				        		 OFFENDER_NAME: "",
		        				        		 CREATED_USER_NAME: "",
		        				        		 NO_OF_DAYS : "",
		        				        		 checkbox: false,
		        				   		        }));
			        	 
		        	 tabledata3=tabledata3.concat(tabledata2Extra);
		        	 
		        	 }
		        
		 			 tableInfoDetails.setData(tabledata3);
	var firstBedRow = $('.Message-Text2').first(); 
    if (firstBedRow.length > 0) {
        firstBedRow.trigger('click'); 
    }
		              }, 
		        
		        error: function(xhr, status, error) {
		            console.error('Error:', error);
		          }
		       }); 
		    }

		});
		// Define Test Data
		var tabledata3 = [];
		var infoDetailsNum=10;
		tabledata3 = Array.from({ length: infoDetailsNum }, () => ({
					        		 DATE_TIME_SENT: "",
					        		 SBI_NO: "",
					        		 OFFENDER_NAME: "",
					        		 CREATED_USER_NAME: "",
					        		 NO_OF_DAYS : "",
					        		 checkbox: false,
					   		        }));
	//	Tabledatavalues4(tabledata3);
   //	    function Tabledatavalues4(tabledata3){
	   
	     var checkboxEditorfield1 = function(cell, onRendered, success, cancel) {
			    var input = document.createElement("input");
			    input.type = "checkbox";
			    input.checked = !!cell.getValue();
			    input.classList.add("InfoTabcheckbox1");
			    
			    var CN=cell.getData().DATE_TIME_SENT;
		 	    var ID=cell.getData().NO_OF_DAYS;
			    
			    console.log('Just print'+CN+' '+ID);
			    
			     if (CN === '' && ID === '') {
			        input.classList.add("disable-pointer");
			        // Optional: Disable editing logic too
			        input.disabled = true;
			        return input; // Prevent adding event listeners
			      }  
			    
			    input.addEventListener("change", function () {
			      success(input.checked);
			    });

			    input.addEventListener("keydown", function (e) {
			      if (e.key === "Enter") {
			        e.preventDefault();
			        input.checked = !input.checked;
			        success(input.checked);
			      } else if (e.key === "Escape") {
			        cancel();
			      }
			    });

			    onRendered(function () {
			      input.focus({ preventScroll: true });
			    });

			    return input;
			  };
			  
				// Checkbox formatter   
		   function checkboxFormatter1(cell) {
				 	const checked = !!cell.getValue();
			    return `<input class="InfoTabcheckbox checkboxclick2"  type="checkbox" ${checked ? "checked" : ""} />`; 
			  } 
		
		var tableInfoDetails = new Tabulator("#InfoReqDetail1-table", {
		  layout: "fitColumns",
		  height: "285px",
		  data: tabledata3,
		  printAsHtml: true,
		  printStyled: true,
		  printRowRange: function () {
		    return this.getRows().filter((row) => {
		      return row.getData().gender === "male";
		    });
		  },
		  columns: [ 
			  {
					title: "id",
					field: "id",
					visible: false,
				},
				{
					title: 'upd',
					visible: false,
					field: "upd",
				},
				{
					title: 'rowid',
					visible: false,
					field: "rowid",
				},
			  {
				title: "Date",
				titleFormatter: (column) => setTitleDesc(column, 'Date_Table_InfoDetailTab', 'Date'),
				 headerTooltip:"Date",
				field: "DATE_TIME_SENT",
				sorter: customSorter,
				cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.DATE_TIME_SENT) {
			              showCustomTooltip(e, cell, `${data.DATE_TIME_SENT}`);
			            }
			        },
			        cellMouseMove: moveCustomTooltip,
			        cellMouseOut: hideCustomTooltip,
				width: 120,
			},
		    {
		      title: "ID#",
		      titleFormatter: (column) => setTitleDesc(column, 'SBI_Table_InfoDetailTab', 'ID#'),
		      headerTooltip:"Count",
		      field: "SBI_NO",
		      sorter: customSorter,
		      cellMouseOver: function (e, cell) {
		          const data = cell.getRow().getData();
		          if (data.SBI_NO) {
		              showCustomTooltip(e, cell, `${data.SBI_NO}`);
		            }
		        },
		        cellMouseMove: moveCustomTooltip,
		        cellMouseOut: hideCustomTooltip,
		      width: 90,
		    },
		    {
		      title: "Offender Name (L, F, M, S)",
		      titleFormatter: (column) => setTitleDesc(column, 'OffenderName(F,L,M,S)_Table_InfoDetailTab', 'Offender Name (L, F, M, S)'),
		      headerTooltip:"Offender Name (L, F, M, S)",
		      field: "OFFENDER_NAME",
		      sorter: customSorter,
		      cellMouseOver: function (e, cell) {
		          const data = cell.getRow().getData();
		          if (data.OFFENDER_NAME) {
		              showCustomTooltip(e, cell, `${data.OFFENDER_NAME}`);
		            }
		        },
		        cellMouseMove: moveCustomTooltip,
		        cellMouseOut: hideCustomTooltip,
		      width: 200,
		    },
		    {
		      title: "Sent By (L, F, M, S)",
		      titleFormatter: (column) => setTitleDesc(column, 'SentBy(F,L,M,S)_Table_InfoDetailTab', 'Sent By (L, F, M, S)'),
		      headerTooltip:"Sent By (L, F, M, S)",
		      field: "CREATED_USER_NAME",
		      sorter: customSorter,
		      cellMouseOver: function (e, cell) {
		          const data = cell.getRow().getData();
		          if (data.CREATED_USER_NAME) {
		              showCustomTooltip(e, cell, `${data.CREATED_USER_NAME}`);
		            }
		        },
		        cellMouseMove: moveCustomTooltip,
		        cellMouseOut: hideCustomTooltip,
		      width: 200,
		    },
		    {
		      title: "Days#",
		      titleFormatter: (column) => setTitleDesc(column, 'Days_Table_InfoDetailTab', 'Days#'),
		      headerTooltip:"Days#",
		      field: "NO_OF_DAYS",
		      sorter: customSorter,
		      cellMouseOver: function (e, cell) {
		          const data = cell.getRow().getData();
		          if (data.NO_OF_DAYS) {
		              showCustomTooltip(e, cell, `${data.NO_OF_DAYS}`);
		            }
		        },
		        cellMouseMove: moveCustomTooltip,
		        cellMouseOut: hideCustomTooltip,
		      width: 120,
		    },
		    {
		      title: "Remove",
		      titleFormatter: (column) => setTitleDesc(column, 'Remove_Table_InfoDetailTab', 'Remove'),
		      headerTooltip:"Remove",
		      field: "REMOVE",
		      headerSort: false,
		      headerTooltip:"Remove",
		      formatter: checkboxFormatter1, 
			  editor: checkboxEditorfield1, 
		 /*      sorter: customSorter,
		      formatter: "tickCross", 
		       editor: true,
		      formatter: (cell) => {
	            const value = cell.getValue();
	            if (value) {
	                return `
	                    <input class="InfoTabcheckbox checkboxclick2" type="checkbox" />
	                    <label>${value}</label>
	                `;
	            }
	        }, */
		    },
		  ],
		  /*   rowClick: function(e, row) {
		        var rowData = row.getData(); 
		        var Message = rowData.MESSAGE_TEXT || ''; 
		        $('#addComments2').val(Message);

		        console.log('Message=' + Message); 
		    }, */
		    rowFormatter: function (row) {
	            var rowData = row.getData();
	            var rowElement = row.getElement();
	            // Attach event listener to checkbox
	            var checkbox = rowElement.querySelector(".checkboxclick2");
	            if (checkbox) {
	                checkbox.addEventListener("click", function (event) {
	                    event.stopPropagation(); // Prevent row click event
	                    showPopup(rowData); // Pass row data to the popup
	                });
	            }
	        },
		   rowFormatter: function(row) {
			   var rowData = row.getData();  
	            var MessageText2 = rowData.MESSAGE_TEXT || ''; 
	            var colorClass ='Message-Text2' ;
	            var SeqNo2 = rowData.USER_MESS_SEQ_NUM || null;
			      var Date2 = rowData.DATE_TIME_SENT || null;
			      var Sbi2 = rowData.SBI_NO || null;
			      var offenderName2 = rowData.OFFENDER_NAME || null;
			      var sentbyname2 = rowData.CREATED_USER_NAME || null;
			      var noofdays2 = rowData.NO_OF_DAYS || null;
			      var remove2 = rowData.checkbox || null;
			      var shortMessage2 = rowData.SHORT_MESSAGE || null;
			      var screencode2 = rowData.SCREEN_CODE || null;
			      var Commitno2 = rowData.COMMIT_NO || null;
			      var Sentbyuserid2 = rowData.CREATED_USER_ID || null;
			      var ScreenUrl2 = rowData.URLScreen || '#';
	            var rowElement = row.getElement(); 
	            rowElement.classList.add(colorClass);
	            rowElement.setAttribute('data-Messageinfo-type', MessageText2); 
	            rowElement.setAttribute('data-SeqNoinfo-type', SeqNo2);
			      rowElement.setAttribute('data-Dateinfo-type', Date2);
			      rowElement.setAttribute('data-Sbiinfo-type', Sbi2);
			      rowElement.setAttribute('data-offenderNameinfo-type', offenderName2);
			      rowElement.setAttribute('data-sentbynameinfo-type', sentbyname2);
			      rowElement.setAttribute('data-noofdaysinfo-type', noofdays2);
			      rowElement.setAttribute('data-removeinfo-type', remove2);
			      rowElement.setAttribute('data-shortMessageinfo-type', shortMessage2);
			      rowElement.setAttribute('data-screencodeinfo-type', screencode2);
			      rowElement.setAttribute('data-Commitnoinfo-type', Commitno2);
			      rowElement.setAttribute('data-Sentbyuseridinfo-type', Sentbyuserid2);
			      rowElement.setAttribute('data-ScreenUrl2-type', ScreenUrl2);
	        }
		});
		
		tabulatorRegistry["InfoReqDetail1-table"] = {
				varName: "tableInfoDetails",
				instance: tableInfoDetails
			};
		
	//	    }
		    
		  	$(document).on('click', '.Message-Text2', function (e) {
		  		if ($(e.target).is('input[type="checkbox"]')) {
			        return;
			    }
			    e.preventDefault();

			    var $div = $(this);
			    urlredirectforscreen2=$div.attr('data-ScreenUrl2-type');
			    const Message = $div.attr('data-Messageinfo-type') || "";  
			    $('#addComments2').val(Message);
			    console.log('Message=' + Message);
			}); 
		    
		$(tabledata2[0].checkbox).html("<input type='checkbox'>");
		
	 	document.getElementById("print").addEventListener("click", function () {
		  table.print();
		}); 


	</script>
</div>