<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<title class="CaseManagementSidebar">CSMCaseNotes</title>
<div th:replace="~{fragments/head :: head}"></div>
<div th:replace="~{fragments/script :: script}"></div>
<script src="js/script.js"></script> 
<body class="mod-bg-1 mod-nav-link">
<div th:replace="~{fragments/header :: header}"></div>
<div th:replace="~{fragments/navmenus :: navmenus}"></div>
	<!-- BEGIN Page Wrapper -->
	<div class="page-wrapper">
		<div class="page-inner">
			<!-- BEGIN Left Aside -->
			  <div th:replace="~{fragments/sidebar :: sidebar}"></div> 
			  <input type="hidden" name="screenCode" id="screenCode" value="CSM_NOSC">
			<!-- END Left Aside -->
			<div class="page-content-wrapper">
				<!-- BEGIN Page Header -->
				
				
				<!-- END Page Header -->
				<!-- BEGIN Page Content -->
				<!-- the #js-page-content id is needed for some plugins to initialize -->
				<main id="js-page-content" role="main" class="page-content">
					<!-- <ol class="breadcrumb page-breadcrumb">
                            <li class="breadcrumb-item"><a href="javascript:void(0);">SmartAdmin</a></li>
                            <li class="breadcrumb-item">category_1</li>
                            <li class="breadcrumb-item">category_2</li>
                            <li class="breadcrumb-item active">Page Titile</li>
                            <li class="position-absolute pos-top pos-right d-none d-sm-block"><span class="js-get-date"></span></li>
                        </ol> -->
					<div class="subheader mb-1">
						<h1 class="subheader-title">
						<div th:replace="~{fragments/toggleMenu :: toggleMenu}"></div>
							<i class='subheader-icon fal fa-'></i> <span id="screenNameHolder" th:data-name="${screenCode}"  th:text="${screenName}"></span></span>
						</h1>
						<!-- Example single danger button -->
						<div class="btn-group headerBtnGroup mr-2 position-relative" style="top: 2px;">
							<button type="button" class="btn btn-primary btn-sm dropdown-toggle position-relative"
								style="top: -3px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								Go To
							</button>
							<div class="dropdown-menu" style="height: 200px;overflow-y: auto;">
								<div class="dropdown-divider m-1" ></div>
									<a class="dropdown-item" href="#">Address Search</a>
								<a class="dropdown-item" href="#">C&T - Offender 	Schedule</a>
								<a class="dropdown-item" href="#">Classification - Offender Summary</a>
								<a class="dropdown-item" href="Disciplinaryinformation">DIS - Disciplinary information</a>
								<a class="dropdown-item" href="Demographics">Intake - Demographics</a>
								<a class="dropdown-item" href="EmergencyAttention">Intake - Emergency Attention</a>
								<a class="dropdown-item" href="#">Intake - Employer Information</a>
								<a class="dropdown-item" href="#">Intake - Facial Photo</a>
								<a class="dropdown-item" href="#">Intake - Family</a>
								<a class="dropdown-item" href="NoContactsCBINOCT">Intake - No Contacts</a>
								<a class="dropdown-item" href="UserNotifications">Notification Screen</a>
								<a class="dropdown-item" href="#">Offender Profile</a>
								<a class="dropdown-item" href="PrintStatusSheet">Print Status Sheet</a>
								<a class="dropdown-item" href="#">Officer's Caseload</a>
								<a class="dropdown-item" href="#">Program - Enroll Offender in Programs	</a>
								<a class="dropdown-item" href="#">Program Final Result</a>
								<a class="dropdown-item" href="#">Program Plan (Recommendation)</a>
								<a class="dropdown-item" href="securityThreatGroup">Security Threat Group(STG)</a>
								<a class="dropdown-item" href="#">Sentence Information</a>
								<a class="dropdown-item" href="#">Transition Accountability Plan</a>
								<a class="dropdown-item" href="#">Travel/Marriage Permit</a>
								<a class="dropdown-item" href="#">Urine/Breathalzer</a>
								<a class="dropdown-item" href="#">Violation Report</a>
								<a class="dropdown-item" href="VitalStatistics">Vital Statistics</a>
								<a class="dropdown-item" href="#">Warrant Check</a>
							</div>
						</div>
						<div class="frame-wrap bg-transparent">
							<div class="btn-group">
							<div class="col-12 pr-0">
                      <div class="js-get-date">[your date here]</div>
                              </div>
								<div class="mr-2">
									<div class="input-append date position-relative w-100">
										<span class="add-on"></span>
									</div>
								</div>
							</div>
							<a href="javascript:void(0);"
								class="btn btn-primary btn-sm btn-icon waves-effect waves-themed" data-toggle="tooltip"
								data-placement="top" data-original-title="Add" id="add-button"> <i
									class="fal fa-plus"></i>
							</a>
							<a href="javascript:void(0);"
								class="btn btn-secondary btn-sm btn-icon waves-effect waves-themed"
								data-toggle="tooltip" data-placement="top" data-original-title="Clear"
								id="clear-button" > <i class="fal fa-times"></i>
							</a>
							<a href="javascript:void(0);"
								class="btn btn-warning btn-sm btn-icon waves-effect waves-themed" data-toggle="tooltip"
								data-placement="top" data-original-title="Print" id="prints-button"><i
									class="fal fa-print"></i>
							</a>
							<!-- <a href="javascript:void(0);"
								class="btn btn-success btn-sm btn-icon waves-effect waves-themed" data-toggle="tooltip"
								data-placement="top" data-original-title="OK/Save" id="save-button"> <i
									class="fal fa-save"></i>
							</a> -->
							<a href="javascript:void(0);"
								class="btn btn-success btn-sm btn-icon waves-effect waves-themed" data-toggle="tooltip"
								data-placement="top" data-original-title="OK/Save" id="SaveScreen"> <i
									class="fal fa-save"></i>
							</a>
							<a href="javascript:void(0);"
								class="btn btn-danger btn-sm btn-icon waves-effect waves-themed" data-toggle="tooltip"
								data-placement="top" data-original-title="Cancel/Exit" id="exit-button" onclick="history.back()"> <i
									class="fal fa-sign-out"></i>
							</a>
						</div>

					</div>

					<div class="row">
						<div class="col-12 col-xl-12">
							<div th:replace="~{fragments/formheader :: formheader}"></div>
							<div class="panel">
								<div class="panel-content">
									<ul class="nav nav-tabs position-relative" role="tablist">
										<li class="nav-item"><a id="contactTypeTab" class="nav-link active" data-toggle="tab"
												href="#Contact_Type" role="tab">Contact Type</a></li>
										<li class="nav-item"><a id="contactPersonTab" class="nav-link" data-toggle="tab"
												href="#Contect_Person" role="tab">Contact Person</a></li>
										<li class="nav-item"><a id="contactHistoryTab" class="nav-link" data-toggle="tab"
												href="#Contact_History" role="tab">Contact History</a></li>
										<div class="row row ml-1 pl-3 position-absolute tabsCheckbox"
											style="border-left: 1px solid #f1f1f1;right: 15px;top: 10px;">
											<div class="d-flex align-items-center">
												<div class="custom-control custom-checkbox custom-control-inline mr-2">
													<input type="checkbox" class="custom-control-input rawField"
														id="registerOffender" data-fld="Registered Sex Offender_checkbox" data-lbl="Registered Sex Offender">
													<label class="custom-control-label"
														for="registerOffender">Registered Sex Offender</label>
												</div>
												<div class="custom-control custom-checkbox custom-control-inline mr-2">
													<input type="checkbox" class="custom-control-input rawField"
														id="ReentryCheck" data-fld="Reentry_checkbox" data-lbl="Reentry">
													<label class="custom-control-label"
														for="ReentryCheck">Reentry</label>
												</div>
												<div class="custom-control custom-checkbox custom-control-inline mr-2">
													<input type="checkbox" class="custom-control-input rawField"
														id="DischargePlan" data-fld="MD/BH_Discharge_Plan_checkbox" data-lbl="MD/BH Discharge Plan">
													<label class="custom-control-label" for="DischargePlan">MD/BH 
														Discharge Plan</label>
												</div>
											</div>
										</div>
									</ul>
									<div class="tab-content px-1" style="padding-top: 5px!important;">
										<div class="tab-pane fade show active" id="Contact_Type" role="tabpanel">
											<div id="selectBy-Block" class="panel">
			                                    <div class="panel-container show">
			                                        <div class="panel-content">
			                                            <div id="selectByBlock">
			                                                <form action="">
																<div class="row form-group">
																	<div class="col-12 col-md-1 col-lg-1">
																		<div class="custom-control custom-checkbox custom-control-inline mr-2"
																			style="margin-top: 5px;">
																			<input type="checkbox" class="custom-control-input rawField"
														id="AllDataValueNotes" data-fld="All_checkbox" data-lbl="All">
													<label class="custom-control-label" for="AllDataValueNotes">All</label>
																		<!-- 	<label class="custom-control-label"
																				for="AllDataValueNotes">All</label>
																			<input type="checkbox"
																				class="custom-control-input allCheckbox"
																				id="AllDataValueNotes"> -->
																		</div>
																	</div>
												<!-- 					<div class="col-12 col-lg-6 demo-v-spacing-sm">
					                                                    <div class="input-group">
					                                                        <input type="text" class="form-control " placeholder="Bottom left" id="datepicker-4-3">
					                                                        <div class="input-group-append">
					                                                            <span class="input-group-text fs-xl">
					                                                                <i class="fal fa-calendar-exclamation"></i>
					                                                            </span>
					                                                        </div>
					                                                    </div>
					                                                </div> -->
																	<div class="col-12 col-md-2 col-lg-2 mr-0 px-0 position-relative">
																		<div class="w-100 pr-3 floatingFields">																			
																			<input class="form-control floatingLable CSMvalueclear date-input2 rawField" size="16" type="text" aria-label="dateFrom-ip" name="dateFrom-ip" id="dateFrom-ip" value="" placeholder="" data-fld="Date_From" data-lbl="Date From">
																			<label class="form-label"  for="dateFrom-ip">Date From</label> 
																		</div>
																		
																	</div>
																	<div class="col-12 col-md-2 col-lg-2 mr-0 px-0 position-relative">
																		<div class="w-100 pr-3 floatingFields">																			
																			<input class="form-control floatingLable CSMvalueclear date-input2 rawField" size="16" type="text" aria-label="dateTo-ip" name="dateTo-ip" id="dateTo-ip" value="" placeholder="" data-fld="Date_To" data-lbl="Date To">
																			<label class="form-label"  for="dateTo-ip">Date To</label>
																		</div>
																		
																	</div>
																	<!-- <div class="col-12 col-lg-2 mr-0 pr-0">
																		<label class="form-label">To</label>
																		<div class="input-append date position-relative"
																			id="mdPicker">
																			<input
																				id="dateTo-ip" class="span2 form-control bg-light toDate"
																				size="16" type="text" value=""
																				readonly>
																			<span class="add-on"><i
																					class="fal fa-calendar-alt position-absolute"></i></span>
																		</div>
																	</div> -->
																	<div class="col-12 col-md-2 col-lg-2 pl-0 selectFloatingLabel">
																		<label for="ContactTypeDropdown" class="form-label mr-2 mb-0 control-label selectFloating" style="left: -5px;">Type of Contact</label>
																		<select class="custom-select form-control typecontact d-block mb-1 floatingLableClick rawField" id="ContactTypeDropdown" data-fld="Type_of_Contact_Dropdown" data-lbl="Type of Contact">
																			<option value="">Type of Contact</option>
																		</select>
																	</div>
																	<div class="col-12 col-md-2 col-lg-2 pl-0 selectFloatingLabel">
																		<label for="RelationshipDropdown" class="form-label mr-2 mb-0 control-label selectFloating">Relationship</label>
																		<select class="custom-select form-control d-block mb-1 floatingLableClick rawField" id="RelationshipDropdown" data-fld="Relationship_Dropdown" data-lbl="Relationship">
																			<option value="">Relationship</option>
																	
																		</select>
																	</div>
																	<div class="col-12 col-md-3  d-flex col-lg-3 pl-0 selectFloatingLabel">
																		<label for="ReasonMstDropdown" class="form-label mr-2 mb-0 control-label selectFloating">Results</label>
																		<select class="custom-select form-control d-block mb-1 floatingLableClick Results CSMvalueclear rawField" id="ReasonMstDropdown" data-fld="Results_Dropdown" data-lbl="Results">
																			<option value="">Results</option>
																		</select>
																		<div>
																	<button id="SELECTValue-Main" type="button" class="btn btn-primary btn-sm p-1 ml-1 btn js-waves-off rawField"
										data-toggle="tooltip" data-placement="top"  data-fld="SELECT" data-lbl="SELECT" data-original-title="SELECT"
										>
									<i  class="fa fa-search" style="font-size: 10px;"></i>
								</button>						</div>
																	</div>
												<!-- 					<div>
																	<button class="btn btn-primary btn-sm p-1 ml-1 btn js-waves-off"
										data-toggle="tooltip" data-placement="top" data-original-title="SELECT"
										>
									<i id="SELECT" class="fa fa-search" style="font-size: 10px;"></i>
								</button>						</div> -->
																</div>
															</form>
			                                            </div>
			                                        </div>
			                                    </div>
			                                </div>
											
											<div id="SeqOFContactInformation" class="panel" value="" data-SequenceOfContactPerson-type="" data-commitNo-type="" data-nameFLMS-type="" data-userId-type="" data-connectingSeqSave-type="" 
  data-AmendmentSeqNo-type="" data-AmendmentCommitNo-type="">
			                                    <div class="panel-hdr">
			                                        <h2>
			                                            Contact Information
			                                        </h2>
			                                    </div>
			                                    <div class="panel-container show">
			                                        <div class="panel-content">
			                                            <div id="js-checkbox-toggles">
			                                                <form>
																<div class="" id="contacttype-table1"></div>
																<div class="mb-2" id="contacttype-table"></div>
																<!-- <table id="dtBasicExample" class="table table-striped table-bordered table-sm contactTypeTable"
																	cellspacing="0" width="100%">
																	<thead class="bg-primary-600">
																		<tr>
																			<th data-sortable="false">Add Cmnt</th>
																			<th data-sortable="true">Contact Date</th> 
																			<th data-sortable="true">Contact Time</th>
																			<th data-sortable="false">Type of Contact</th>
																			<th data-sortable="true">Entered Date</th>
																			<th data-sortable="true">Entered Time</th>
																			<th data-sortable="false">Negative</th>
																			<th data-sortable="false">Corrected</th>
																			<th data-sortable="false">STG</th>
																			<th data-sortable="false">Negative Reasons</th>
																			<th class="text-nowrap" data-sortable="false">
																				Entered By (F,L,M,S)</th>
																		</tr>
																	</thead>
																	<tbody>
																		<tr id="input-contact-info">
																			<td>		
																			</td>
																			<td>
																				<div class="input-append date position-relative">
																					<input id="contact-date-sv"
																					 class="span2 form-control bg-light dateofbirth1"
																						size="16" type="text">
																					<span class="add-on"></span>
																				</div>
																			</td>
																			<td>
																				<input id="contact-time-sv" type="time" class="meeting-time"
																					style="line-height: 1;">
																			</td>
																			<td>
																				<div
																					class="input-group input-group-multi-transition">
																					<select id="selectTypeOfContact" style="width: 140px;"
																						class="custom-select form-control">
																					</select>
																				</div>
																			</td>
																			<td>
																				<input type="text"
																					class="form-control enteredDate" disabled>
																			</td>
																			<td>
																				<input type="text"
																					class="form-control enteredTime" disabled>
																			</td>
																			<td>
																				<div
																					class="custom-control custom-checkbox custom-control-inline mr-2">
																					<input type="checkbox"
																						class="custom-control-input negativeCheckbox"
																						id="NegativeCheckf">
																					<label class="custom-control-label"
																						for="NegativeCheckf"></label>
																				</div>
																			</td>
																			<td>
																				<div
																					class="custom-control custom-checkbox custom-control-inline mr-2">
																					<input type="checkbox"
																						class="custom-control-input CorrectedCheckbox"
																						id="Correctedf" disabled>
																					<label class="custom-control-label"
																						for="Correctedf"></label>
																				</div>
																			</td>
																			<td>
																				<div
																					class="custom-control custom-checkbox custom-control-inline mr-2">
																					<input type="checkbox"
																						class="custom-control-input STGCheckbox"
																						id="STGCheckf" disabled>
																					<label class="custom-control-label"
																						for="STGCheckf"></label>
																				</div>
																			</td>
																			<td>
																				<div
																					class="input-group input-group-multi-transition">
																					<select id="neg-reasons-sv" style="width: 140px;"
																						class="custom-select form-control">
																					</select>
																				</div>
																			</td>
																			<td>
																				<input type="text"
																					class="form-control enteredbyflms" disabled>
																			</td>
																		</tr>
																	</tbody>
																</table> -->
															</form>
															<div class="modal fade" id="AddCmntModal" tabindex="-1"
																role="dialog" data-backdrop="static" data-keyboard="false">
																<div class="modal-dialog modal-dialog-centered"
																	role="document">
																	<div class="modal-content">
																		<div class="modal-header">
																			<h4 class="modal-title">
																				DOC - Caution [Case Notes - CSM_NOSC]
																			</h4>
																			<button type="button" id="Closethepopup" class="close"
																				data-dismiss="modal" aria-label="Close">
																				<span ><i
																						class="fal fa-times"></i></span>
																			</button>
																		</div>
																		<div class="modal-body pt-0 pb-0">
																			<div class="d-flex align-items-center">
																				<i class="fa fa-exclamation-triangle mr-2"
																					style="font-size: 30px; color: #ffaf1b; "
																					></i>
																				<p class="m-0">Do you want to add an
																					amendment to this case note?</p>
																			</div>
																		</div>
																		<div class="modal-footer">
																			<button type="button" id="Yesuncheck" class="btn btn-primary"
																				data-toggle="modal"
																				data-target="#AddCmntModal1"
																				data-dismiss="modal">Yes</button>
																			<button type="button" id="nobtnuncheck" class="btn btn-secondary"
																				data-dismiss="modal">No</button>
																		</div>
																	</div>
																</div>
															</div>
															<div class="modal fade" id="AddCmntModal1" tabindex="-1"
																role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
																<div class="modal-dialog modal-dialog-centered"
																	role="document">
																	<div class="modal-content">
																		<div class="modal-header pb-1">
																			<h4 class="modal-title">
																				Amendment to Case Notes
																			</h4>
																			<button id="amendmentClose" type="button" class="close"
																				data-dismiss="modal" aria-label="Close">
																				<span aria-hidden="true"><i
																						class="fal fa-times"></i></span>
																			</button>
																		</div>
																		<div class="modal-body pt-0 pb-0">
																			<lable for="addCmntVal" ></lable>
																				<textarea class="form-control " id="addCommentsAmendment"
																				rows="5" name="addCommentsAmendment"
																				aria-label="addCommentsAmendment" value=""></textarea>
																				 <div id="AmendmentcharCount" style="display: none;">0/4000 characters</div> 
																		</div>
																		<div class="modal-footer">
																			<button type="button"
																				class="btn btn-secondary">Spell
																				Check</button>
																			<!-- <button type="button" id="addCmntValBtn"
																				class="btn btn-primary"
																				data-dismiss="modal">Ok</button> -->
																				<button type="button" id="OkayaddCmntVal"
																				class="btn btn-primary"
																				data-dismiss="modal">Ok</button>
																			<button type="button" class="btn btn-secondary"
																				id="addCmntValClear">Clear</button>
																			<button type="button" class="btn btn-secondary"
																				id="ExitCmntVal"data-dismiss="modal">Exit</button>
																		</div>
																	</div>
																</div>
															</div>
															<div class="row">
																<div class="col-12 col-lg-12 floatingFieldsTextarea mt-3" id="cmttest" value="">
																	<textarea class="form-control CSMvalueclear rawField contactPersonDisableValue floatingLabletextarea" data-fld="Comments" data-lbl="Comments" id="addCmntValShow"
																		rows="3" placeholder="" name="residenceCategory" value=""></textarea>
																		 <label for="addCmntValShow" class="form-label mb-0 ml-2 text-nowrap">Comments</label>
																		<div id="charCount">0/4000 characters</div>
																		
																</div>
															</div>
			                                            </div>
			                                        </div>
			                                    </div>
			                                </div>

										</div>
										<div class="tab-pane fade" id="Contect_Person" role="tabpanel">
											<div id="contactPerson-Block" class="panel">
			                                    <div class="panel-hdr">
			                                        <h2>
			                                            Contacted Persons
			                                        </h2>
			                                    </div>
			                                    <div class="panel-container show">
			                                        <div class="panel-content">
			                                            <div id="js-checkbox-toggles">
			                                                <div class="row">
																<div class="col-lg-12 col-xl-5 pr-0">
																	<div class="row">
																		<div class="col-12 col-md-4 col-lg-4 floatingFields pl-0">
																			<input id="TypeOfContactclick" type="text" class="form-control CSMvalueclear floatingLable rawField"
																				 placeholder=""  data-fld="Type_of_Contact" data-lbl="Type of Contact">
																				<label for="TypeOfContactclick" class="form-label mr-1 text-nowrap mb-0">Type of Contact</label>
																		</div>
																		<div class="col-12 col-md-2 col-lg-2 col-xl-4 pl-0 floatingFields">
																			<input id="ContactDateclick" type="text" class="form-control contactDate CSMvalueclear floatingLable rawField"
																				 placeholder=""  data-fld="Contact_Date" data-lbl="Contact Date">
																				<label for="ContactDateclick" class="form-label mr-1 text-nowrap mb-0">Contact Date</label>
																		</div>
																		<div class="col-12 col-md-2 col-lg-2 col-xl-4 pl-0 floatingFields">
																			<input id="ContactTimeclick" type="text" class="form-control contactTime CSMvalueclear floatingLable rawField"
																				 placeholder=""   data-fld="Contact_Time" data-lbl="Contact Time">
																				<label for="ContactTimeclick" class="form-label mr-1 text-nowrap mb-0">Contact Time</label>
																		</div>
																		<div class="col-12 col-md-2 col-lg-2 col-xl-4 pl-0 mt-xl-3">
																			<div class="custom-control custom-checkbox custom-control-inline mr-2">
																				<input type="checkbox"
																					class="custom-control-input InitiatedDDOC CSMvalueclear rawField contactPersonDisableValue"
																					id="InitiatedDDOC"   data-fld="Initiated_By_DDOC" data-lbl="Initiated By DDOC">
																				<label class="custom-control-label mt-1"
																					for="InitiatedDDOC"
																					style="font-weight: 500;">Initiated
																					By DDOC</label>
																			</div>
																		</div>
																		<div class="col-12 col-md-2 col-lg-2 col-xl-4 floatingFields pl-0 mt-xl-3">
																			<input type="text" class="form-control ISCTransferDate CSMvalueclear date-input1 floatingLable rawField contactPersonDisableValue"
																				aria-label="" id="isc-transferDate" name="" value="" placeholder=""  data-fld="ISC_Transfer_Date" data-lbl="ISC Transfer Date">
																			<label for="isc-transferDate" class="form-label mr-1 text-nowrap mb-0">ISC Transfer Date</label>
																		</div>
																		<div class="col-12 col-md-2 mt-md-3 col-lg-2 mt-lg-3 col-xl-4 pl-0 mt-xl-3">
																			<div class="custom-control custom-checkbox custom-control-inline mr-2">
																				<input type="checkbox"
																					class="custom-control-input ISCApproved rawField contactPersonDisableValue"
																					id="isc-approved" data-fld="ISC_Approved" data-lbl="ISC Approved">
																				<label class="custom-control-label"
																					for="isc-approved"
																					style="font-weight: 500;">ISC
																					Approved</label>
																			</div>
																		</div>
																	<div class="col-12 col-md-10 mt-md-3 col-lg-10 mt-lg-3 pl-0 col-xl-6 mt-xl-3">
																	<input type="hidden" name="useridinitiated" id="useridinitiated" value="">
																		<div class="input-group input-group-multi-transition floatingFields">
																			<input type="text" id="initiated-firstname" class="form-control CSMvalueclear floatingLable rawField"
																				placeholder="" style="border-radius: 3px;" data-fld="Initiated_By_(L, F, M, S)" data-lbl="Initiated By (L, F, M, S)">
																				<label for="initiated-firstname" class="form-label mr-1 text-nowrap mb-0">Initiated By (L, F, M, S)</label>
																			<span id="UserListValue1" class="disabled-icon" data-toggle="modal"
																				data-target="#initiatelfms"
																				data-dismiss="modal" disabled>
																				<a id="UserListValue" href="#"
																					class="btn btn-primary btn-sm p-1 btn js-waves-off rawField"
																					data-toggle="tooltip"
																					data-placement="top"
																					data-original-title="Download" disabled data-fld="Initiated_By_(L, F, M, S)_Button" data-lbl="Initiated By (L, F, M, S) Button">
																					<i id="UserListValue2" class="fa fa-download  rawField" data-fld="Initiated_By_(L, F, M, S)_ButtonIcon" data-lbl=""></i>
																				</a>
																			</span>
																		</div>
																	</div>
																	</div>
																</div>
																<div class="col-lg-12 mt-lg-2 col-xl-7 px-0">
																	<div class="panel">
																		<div class="panel-container show">
																			<div class="panel-content p-1">
																				<form>
																					<div id="contactperson-table"></div>
																				</form>
																				<div class="modal fade" id="initiatelfms" tabindex="-1"
																					role="dialog" aria-hidden="true">
																					<div class="modal-dialog modal-dialog-centered modal-lg"
																						role="document">
																						<div class="modal-content" id=Initiatedpopup>
																							<div class="modal-header pb-1" >
																								<h4 class="modal-title">
																									INITIATED BY (L,F,M,S)
																								</h4>
																								<button  type="button" class="close"
																									data-dismiss="modal"
																									aria-label="Close">
																									<span aria-hidden="true"><i
																											class="fal fa-times"></i></span>
																								</button>
																							</div>
																							<div class="modal-body pt-0 pb-0">
																							<div class="d-flex mb-1">																							
																									<lable for="namefind"
																										class="form-label mr-2">Find</lable>
																									<input type="text" class="form-control"
																										aria-label="namefind" name="namefind" id="namefind"
																										placeholder="Search..." value="" autocomplete="off">
																										<button type="button" id="findUser"
																										class="btn btn-primary btn-sm ml-2">Find</button>
																							</div>
																									<div id="helponofficer-table"></div>
																							</div>
																							<div class="modal-footer">
																								
																							<!-- 	<button type="button" id="addCmntValBtn"
																									class="btn btn-primary"
																									data-dismiss="modal">Ok</button> -->
																								<button type="button"
																									class="btn btn-secondary btn-sm"
																									data-dismiss="modal">Cancel</button>
																							</div>
																						</div>
																					</div>
																				</div>
																			</div>
																		</div>
																	</div>
																</div>
															</div>
			                                            </div>
			                                        </div>
			                                    </div>
			                                </div>
										</div>
										<div class="tab-pane fade" id="Contact_History" role="tabpanel">
											<div id="ContactedHistory-Block" class="panel">
			                                    <div class="panel-hdr">
			                                        <h2>
			                                            Contacted History
			                                        </h2>
			                                    </div>
			                                    <div class="panel-container show">
			                                        <div class="panel-content">
			                                            <div id="js-checkbox-toggles">
			                                            	<form>
																<div  id="history-table"></div>
																</form>
																<form>
																	<div class="row">
																		<div class="col-12 col-lg-12 mt-1 mb-0">
																			<textarea id="CommentsHistory" class="form-control addCmntVal"
																				rows="3"
																				placeholder="Comments" disabled></textarea>
																		</div>
																	</div>
																</form>
																<form action="" class="mt-1">
																	<div class="row mt-2">
																		<div class="col-12 col-lg-6 col-xl-5 pl-0 d-flex align-items-center">
																			<div class="custom-control custom-checkbox custom-control-inline mr-2">
																				<input type="checkbox" class="custom-control-input InitiatedDDOC CSMvalueclear rawField" data-fld="Initiated_By_DDOC_History" data-lbl="Initiated By DDOC" id="Ddocflag1">
																				<label class="custom-control-label text-nowrap" for="Ddocflag1">Initiated By DDOC</label>
																			</div>
																			<div class="input-group input-group-multi-transition floatingFields ">
																				<input type="text" class="form-control CSMvalueclear floatingLable rawField" data-fld="initiatedBy(F, L, M, S)History" data-lbl="Initiated By (F, L, M, S)" style="border-radius: 4px;" id="Fname" value="" placeholder="">
																				<label class="m-0 mr-2 form-label text-nowrap" for="Fname" style="font-weight: 500;">Initiated By (F, L, M, S)</label>
																			</div>
																		</div>
																		<div class="col-12 col-lg-6 col-xl-4  mt-1 pl-0 d-flex align-items-center">
																			<div class="custom-control custom-checkbox custom-control-inline mr-2 w-100">
																				<input type="checkbox" class="custom-control-input ISCApproved rawField" data-fld="ISC_Approved_History" data-lbl="ISC Approved" id="ISCflag">
																				<label class="custom-control-label ml-2" for="ISCflag" style="font-weight: 500;">ISC Approved</label>
																			</div>
																			<div class="floatingFields w-100">																				
																				<input type="text"class="form-control ISCTransferDate CSMvalueclear floatingLable rawField" data-fld="ISC_Transfer_Date_History" data-lbl="ISC Transfer Date" placeholder="" id="lbl-ISCTransferDate">
																				<label class="mr-2 m-0 form-label text-nowrap" for="lbl-ISCTransferDate" style="font-weight: 500;">ISC Transfer Date</label>
																			</div>
																		</div>
																		<div class="col-12 col-lg-2 text-nowrap mt-2 pl-0 position-relative">
																			<button type="button" id=" " class="btn btn-primary btn-sm rawField" data-fld="Supervision_Plan_History" data-lbl="Supervision Plan History">Supervision Plan History</button>
																			<button type="button" id=" " class="btn btn-primary ml-3 btn-sm rawField" data-fld="Print_History" data-lbl="Print History">Print History</button>
																		</div>
																	</div>
																</form>
			                                            </div>
			                                        </div>
			                                    </div>
			                                </div>
										</div>
									</div>



									<div class="d-none">
										<form id="entryform">
											<div class="form-group row">
												<!-- <input type="hidden" name="screenCode" id="screenCode" value="162"> -->
												
												<label forx="1" for="allCheckbox">All</label>
												<input type="text" id="allCheckbox" name="allCheckbox" data-typ="Checkbox">
												
												<label forx="1" for="fromDate">DateFrom</label>
												<input type="text" name="fromDate" id="fromDate" data-typ="Date">
												
												<label forx="1" for="toDate">To</label>
												<input type="text" name="toDate" id="toDate" data-typ="Date">
												
												<label forx="1" for="typecontact">TypeofContact</label>
												<input id="typecontact" name="typecontact" type="text" data-typ="Dropdown">
												
												<label forx="1" for="Relationship">Relationship</label>
												<input id="Relationship" name="Relationship" type="text" data-typ="Dropdown">
												
												<label forx="1" for="Results">Results</label>
												<input id="Results" name="Results" type="text" data-typ="Dropdown">
												
												<label forx="1" for="dateofbirth1">DOB</label>
												<input type="text" name="dateofbirth1" id="dateofbirth1" data-typ="Date">
												
												<label forx="1" for="meeting-time">Meeting Time</label>
												<input type="text" id="meeting-time" name="meeting-time" data-type="Text">
												
												<label forx="1" for="enteredDate">Entered Date</label>
												<input type="text" name="enteredDate" id="enteredDate" data-typ="Date">
												
												<label forx="1" for="enteredTime">Entered Time</label>
												<input type="text" name="enteredTime" id="enteredTime" data-typ="Text">
												
												<label forx="1" for="negativeCheckbox">Negative Checkbox</label>
												<input type="text" name="negativeCheckbox" data-typ="Text" id="negativeCheckbox">
												
												<label forx="1" for="CorrectedCheckbox"></label>
												<input type="text" name="CorrectedCheckbox" data-typ="Text" id="CorrectedCheckbox">
												
												<label forx="1" for="STGCheckbox"></label>
												<input type="text" name="STGCheckbox" data-typ="Checkbox" id="STGCheckbox">
												
												<label forx="1" for="negativeReason">negativeReason</label>
												<input id="negativeReason" name="negativeReason" data-typ="Dropdown">
												
												<label forx="1" for="enteredbyflms">enteredbyflms</label>
												<input type="text" name="enteredbyflms" id="enteredbyflms" data-typ="Text">
												
												<label forx="1" for="addcmntCheck"></label>
												<input type="text" id="addcmntCheck" name="addcmntCheck" data-typ="Checkbox">
												
												<label forx="1" for="contactDate">contactDate</label>
												<input type="text" name="contactDate" id="contactDate" data-typ="Date">
												
												<label forx="1" for="contactTime">contactTime</label>
												<input type="text" name="contactTime" id="contactTime" data-typ="Text">
												
												<label forx="1" for="InitiatedDDOC">InitiatedByDDOC</label>
												<input type="text" id="InitiatedDDOC" name="InitiatedDDOC" data-typ="Checkbox">
												
												<label forx="1" for="ISCTransferDate">ISCTransferDate</label>
												<input type="text" name="ISCTransferDate" id="ISCTransferDate" data-typ="Date">
												
												<label forx="1" for="ISCApproved">ISCApproved</label>
												<input type="text" id="ISCApproved" name="ISCApproved" data-typ="Checkbox">
												
												<!--<label for="Name"> Initiated By (L,F,M,S) </label>-->
												
												<label forx="1" for="lastName1">lastName</label>
												<input type="text" name="lastName1" id="lastName1" data-typ="Text">
												
												<label forx="1" for="FirstName1">FirstName</label>
												<input type="text" name="FirstName1" id="FirstName1" data-typ="Text">
												
												<label forx="1" for="nameMi1">nameMi</label>
												<input type="text" name="nameMi1" id="nameMi1" data-typ="Text">
												
												<label forx="1" for="nameSuffix1">nameSuffix</label>
												<input type="text" name="nameSuffix1" id="nameSuffix1" data-typ="Text">
												
												<label forx="1" for="relationwithOffender">relationwithOffender</label>
												<input id="relationwithOffender" name="relationwithOffender" data-typ="Dropdown">
												
												<label forx="1" for="namelfms">namelfms</label>
												<input type="text" name="namelfms" id="namelfms" data-typ="Text">
												
												<label forx="1" for="negativeCheckbox1">negativeCheckbox1</label>
												<input type="text" id="negativeCheckbox1" name="negativeCheckbox1" data-typ="Checkbox">
													
												<label forx="1" for="CorrectedCheckbox2">CorrectedCheckbox2</label>
												<input type="text" id="CorrectedCheckbox2" name="CorrectedCheckbox2" data-typ="Checkbox">
												
												<label forx="1" for="enteredbyflms1">Enteredbyflms</label>												
												<input type="text" name="enteredbyflms1" id="enteredbyflms1" data-typ="Text">
												
												<label forx="1" for="negativeCheckbox3">negativeCheckbox3</label>												
												<input type="text" id="negativeCheckbox3" name="negativeCheckbox3" data-typ="Checkbox">
													
												<label forx="1" for="CorrectedCheckbox3"></label>
												<input type="text" id="CorrectedCheckbox3" name="CorrectedCheckbox3" data-typ="Checkbox">
											</div>
										</form>


									</div>
								</div>
							</div>
				</main>
				<!-- this overlay is activated only when mobile menu is triggered -->
				<div class="page-content-overlay" data-action="toggle" data-class="mobile-nav-on"></div>
				<!-- END Page Content -->
				
				<!-- Modal Large -->
				<div class="modal fade" id="default-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
					<div class="modal-dialog modal-lg" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title">Staff Name</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true"><i class="fal fa-times"></i></span>
								</button>
							</div>
							<div class="modal-body">
								<div class="form-group row">
									<label for="staffSearch"
										class="col-form-label col-12 col-lg-1 form-label">Search</label>
									<div class="col-12 col-lg-11">
										<input type="text" class="form-control" aria-label="staffSearch"
											name="staffSearch" id="staffSearch" value="">
									</div>

								</div>
								<div class="table-responsive-lg">
									<table class="table table-bordered m-0">
										<thead>
											<tr>
												<th>Last Name</th>
												<th>First Name</th>
												<th>MI</th>
												<th>Suffix</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<td>14</td>
												<td>Staff</td>
												<td></td>
												<td></td>
											</tr>

										</tbody>
									</table>
								</div>
							</div>

						</div>
					</div>
				</div>
				<!-- BEGIN Shortcuts -->
				<!-- modal shortcut -->
				<div class="modal fade modal-backdrop-transparent" id="modal-shortcut" tabindex="-1" role="dialog"
					aria-labelledby="modal-shortcut" aria-hidden="true">
					<div class="modal-dialog modal-dialog-top modal-transparent" role="document">
						<div class="modal-content">
							<div class="modal-body">
								<ul class="app-list w-auto h-auto p-0 text-left">
									<li>
										<a href="intel_introduction.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-3x opacity-100 color-primary-500 "></i>
												<i class="base base-7 icon-stack-2x opacity-100 color-primary-300 "></i>
												<i class="fal fa-home icon-stack-1x opacity-100 color-white"></i>
											</div>
											<span class="app-list-name">
												Home
											</span>
										</a>
									</li>
									<li>
										<a href="page_inbox_general.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-3x opacity-100 color-success-500 "></i>
												<i class="base base-7 icon-stack-2x opacity-100 color-success-300 "></i>
												<i class="ni ni-envelope icon-stack-1x text-white"></i>
											</div>
											<span class="app-list-name">
												Inbox
											</span>
										</a>
									</li>
									<li>
										<a href="intel_introduction.html" class="app-list-item text-white border-0 m-0">
											<div class="icon-stack">
												<i class="base base-7 icon-stack-2x opacity-100 color-primary-300 "></i>
												<i class="fal fa-plus icon-stack-1x opacity-100 color-white"></i>
											</div>
											<span class="app-list-name">
												Add More
											</span>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div> <!-- END Shortcuts -->
			</div>
		</div>
	</div>
	<!-- END Page Wrapper -->
	<!-- BEGIN Quick Menu -->
	<!-- to add more items, please make sure to change the variable '$menu-items: number;' in your _page-components-shortcut.scss -->
		<nav class="shortcut-menu d-none d-sm-block"> <input
	type="checkbox" class="menu-open" name="menu-open" id="menu_open" />
	<label for="menu_open" class="menu-open-button "> <span
	class="app-shortcut-icon d-block"></span>
	</label> <a href="#" class="menu-item btn" data-toggle="tooltip"
	data-placement="left" title="Scroll Top"> <i
	class="fal fa-arrow-up"></i>
	</a> <a href="page_login-alt.html" class="menu-item btn"
	data-toggle="tooltip" data-placement="left" title="Logout"> <i
	class="fal fa-sign-out"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-fullscreen"
	data-toggle="tooltip" data-placement="left" title="Full Screen"> <i
	class="fal fa-expand"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-print"
	data-toggle="tooltip" data-placement="left" title="Print page"> <i
	class="fal fa-print"></i>
	</a> <a href="#" class="menu-item btn" data-action="app-voice"
	data-toggle="tooltip" data-placement="left" title="Voice command">
	<i class="fal fa-microphone"></i>
	</a> </nav>
	<!-- END Quick Menu -->
	<!-- BEGIN Messenger -->
	<div class="modal fade js-modal-messenger modal-backdrop-transparent" tabindex="-1" role="dialog"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-right">
			<div class="modal-content h-100">
				<div class="dropdown-header bg-trans-gradient d-flex align-items-center w-100">
					<div class="d-flex flex-row align-items-center mt-1 mb-1 color-white">
						<span class="mr-2">
							<span class="rounded-circle profile-image d-block"
								style="background-image:url('img/demo/avatars/avatar-d.png'); background-size: cover;"></span>
						</span>
						<div class="info-card-text">
							<a href="javascript:void(0);" class="fs-lg text-truncate text-truncate-lg text-white"
								data-toggle="dropdown" aria-expanded="false">
								Tracey Chang
								<i class="fal fa-angle-down d-inline-block ml-1 text-white fs-md"></i>
							</a>
							<div class="dropdown-menu">
								<a class="dropdown-item" href="#">Send Email</a>
								<a class="dropdown-item" href="#">Create Appointment</a>
								<a class="dropdown-item" href="#">Block User</a>
							</div>
							<span class="text-truncate text-truncate-md opacity-80">IT Director</span>
						</div>
					</div>
					<button type="button" class="close text-white position-absolute pos-top pos-right p-2 m-1 mr-2"
						data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true"><i class="fal fa-times"></i></span>
					</button>
				</div>
				<div class="modal-body p-0 h-100 d-flex">
					<!-- BEGIN msgr-list -->
					<div
						class="msgr-list d-flex flex-column bg-faded border-faded border-top-0 border-right-0 border-bottom-0 position-absolute pos-top pos-bottom">
						<div>
							<div
								class="height-4 width-3 h3 m-0 d-flex justify-content-center flex-column color-primary-500 pl-3 mt-2">
								<i class="fal fa-search"></i>
							</div>
							<input type="text" class="form-control bg-white" id="msgr_listfilter_input"
								name="msgr_listfilter_input" placeholder="Filter contacts" aria-label="FilterSearch"
								value="" data-listfilter="#js-msgr-listfilter">
						</div>
						<div class="flex-1 h-100 custom-scroll">
							<div class="w-100">
								<ul id="js-msgr-listfilter" class="list-unstyled m-0">
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="tracey chang online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-d.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Tracey Chang
													<small class="d-block font-italic text-success fs-xs">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="oliver kopyuv online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-b.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Oliver Kopyuv
													<small class="d-block font-italic text-success fs-xs">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="dr john cook phd away">
											<div class="d-table-cell align-middle status status-warning status-sm ">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-e.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Dr. John Cook PhD
													<small class="d-block font-italic fs-xs">
														Away
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney online">
											<div class="d-table-cell align-middle status status-success status-sm ">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-g.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Ali Amdaney
													<small class="d-block font-italic fs-xs text-success">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="sarah mcbrook online">
											<div class="d-table-cell align-middle status status-success status-sm">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-h.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													Sarah McBrook
													<small class="d-block font-italic fs-xs text-success">
														Online
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney offline">
											<div class="d-table-cell align-middle status status-sm">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-a.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs">
														Offline
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney busy">
											<div class="d-table-cell align-middle status status-danger status-sm">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-j.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs text-danger">
														Busy
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney offline">
											<div class="d-table-cell align-middle status status-sm">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-c.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													oliver.kopyuv@gotbootstrap.com
													<small class="d-block font-italic fs-xs">
														Offline
													</small>
												</div>
											</div>
										</a>
									</li>
									<li>
										<a href="#" class="d-table w-100 px-2 py-2 text-dark hover-white"
											data-filter-tags="ali amdaney inactive">
											<div class="d-table-cell align-middle">
												<span class="profile-image-md rounded-circle d-block"
													style="background-image:url('img/demo/avatars/avatar-m.png'); background-size: cover;"></span>
											</div>
											<div class="d-table-cell w-100 align-middle pl-2 pr-2">
												<div class="text-truncate text-truncate-md">
													+714651347790
													<small class="d-block font-italic fs-xs opacity-50">
														Missed Call
													</small>
												</div>
											</div>
										</a>
									</li>
								</ul>
								<div class="filter-message js-filter-message"></div>
							</div>
						</div>
						<div>
							<a class="fs-xl d-flex align-items-center p-3">
								<i class="fal fa-cogs"></i>
							</a>
						</div>
					</div>
					<!-- END msgr-list -->
					<!-- BEGIN msgr -->
					<div class="msgr d-flex h-100 flex-column bg-white">
						<!-- BEGIN custom-scroll -->
						<div class="custom-scroll flex-1 h-100">
							<div id="chat_container" class="w-100 p-4">
								<!-- start .chat-segment -->
								<div class="chat-segment">
									<div class="time-stamp text-center mb-2 fw-400">
										Jun 19
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent">
									<div class="chat-message">
										<p>
											Hey Ching, did you get my files?
										</p>
									</div>
									<div class="text-right fw-300 text-muted mt-1 fs-xs">
										3:00 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get">
									<div class="chat-message">
										<p>
											Hi
										</p>
										<p>
											Sorry going through a busy time in office. Yes I analyzed the solution.
										</p>
										<p>
											It will require some resource, which I could not manage.
										</p>
									</div>
									<div class="fw-300 text-muted mt-1 fs-xs">
										3:24 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent chat-start">
									<div class="chat-message">
										<p>
											Okay
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-sent chat-end">
									<div class="chat-message">
										<p>
											Sending you some dough today, you can allocate the resources to this
											project.
										</p>
									</div>
									<div class="text-right fw-300 text-muted mt-1 fs-xs">
										3:26 pm
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get chat-start">
									<div class="chat-message">
										<p>
											Perfect. Thanks a lot!
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get">
									<div class="chat-message">
										<p>
											I will have them ready by tonight.
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment -->
								<div class="chat-segment chat-segment-get chat-end">
									<div class="chat-message">
										<p>
											Cheers
										</p>
									</div>
								</div>
								<!--  end .chat-segment -->
								<!-- start .chat-segment for timestamp -->
								<div class="chat-segment">
									<div class="time-stamp text-center mb-2 fw-400">
										Jun 20
									</div>
								</div>
								<!--  end .chat-segment for timestamp -->
							</div>
						</div>
						<!-- END custom-scroll  -->
						<!-- BEGIN msgr__chatinput -->
						<div class="d-flex flex-column">
							<div
								class="border-faded border-right-0 border-bottom-0 border-left-0 flex-1 mr-3 ml-3 position-relative shadow-top">
								<div class="pt-3 pb-1 pr-0 pl-0 rounded-0" tabindex="-1">
									<div id="msgr_input" contenteditable="true"
										data-placeholder="Type your message here..."
										class="height-10 form-content-editable"></div>
								</div>
							</div>
							<div class="height-8 px-3 d-flex flex-row align-items-center flex-wrap flex-shrink-0">
								<a href="javascript:void(0);" class="btn btn-icon fs-xl width-1 mr-1"
									data-toggle="tooltip" data-original-title="More options" data-placement="top">
									<i class="fal fa-ellipsis-v-alt color-fusion-300"></i>
								</a>
								<a href="javascript:void(0);" class="btn btn-icon fs-xl mr-1" data-toggle="tooltip"
									data-original-title="Attach files" data-placement="top">
									<i class="fal fa-paperclip color-fusion-300"></i>
								</a>
								<a href="javascript:void(0);" class="btn btn-icon fs-xl mr-1" data-toggle="tooltip"
									data-original-title="Insert photo" data-placement="top">
									<i class="fal fa-camera color-fusion-300"></i>
								</a>
								<div class="ml-auto">
									<a href="javascript:void(0);" class="btn btn-info">Send</a>
								</div>
							</div>
						</div>
						<!-- END msgr__chatinput -->
					</div>
					<!-- END msgr -->
				</div>
			</div>
		</div>
	</div>
	<!-- END Messenger -->
	<!-- BEGIN Page Settings -->
	<div class="modal fade js-modal-settings modal-backdrop-transparent" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog modal-dialog-right modal-md">
			<div class="modal-content">
				<div class="dropdown-header bg-trans-gradient d-flex justify-content-center align-items-center w-100">
					<h4 class="m-0 text-center color-white">
						Layout Settings
						<small class="mb-0 opacity-80">User Interface Settings</small>
					</h4>
					<button type="button" class="close text-white position-absolute pos-top pos-right p-2 m-1 mr-2"
						data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true"><i class="fal fa-times"></i></span>
					</button>
				</div>
				<div class="modal-body p-0">
					<div class="settings-panel">
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									App Layout
								</h5>
							</div>
						</div>
						<div class="list" id="fh">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="header-function-fixed"></a>
							<span class="onoffswitch-title">Fixed Header</span>
							<span class="onoffswitch-title-desc">header is in a fixed at all times</span>
						</div>
						<div class="list" id="nff">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="nav-function-fixed"></a>
							<span class="onoffswitch-title">Fixed Navigation</span>
							<span class="onoffswitch-title-desc">left panel is fixed</span>
						</div>
						<div class="list" id="nfm">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="nav-function-minify"></a>
							<span class="onoffswitch-title">Minify Navigation</span>
							<span class="onoffswitch-title-desc">Skew nav to maximize space</span>
						</div>
						<div class="list" id="nfh">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="nav-function-hidden"></a>
							<span class="onoffswitch-title">Hide Navigation</span>
							<span class="onoffswitch-title-desc">roll mouse on edge to reveal</span>
						</div>
						<div class="list" id="nft">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="nav-function-top"></a>
							<span class="onoffswitch-title">Top Navigation</span>
							<span class="onoffswitch-title-desc">Relocate left pane to top</span>
						</div>
						<div class="list" id="mmb">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-main-boxed"></a>
							<span class="onoffswitch-title">Boxed Layout</span>
							<span class="onoffswitch-title-desc">Encapsulates to a container</span>
						</div>
						<div class="expanded">
							<ul class="">
								<li>
									<div class="bg-fusion-50" data-action="toggle" data-class="mod-bg-1"></div>
								</li>
								<li>
									<div class="bg-warning-200" data-action="toggle" data-class="mod-bg-2"></div>
								</li>
								<li>
									<div class="bg-primary-200" data-action="toggle" data-class="mod-bg-3"></div>
								</li>
								<li>
									<div class="bg-success-300" data-action="toggle" data-class="mod-bg-4"></div>
								</li>
							</ul>
							<div class="list" id="mbgf">
								<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
									data-class="mod-fixed-bg"></a>
								<span class="onoffswitch-title">Fixed Background</span>
							</div>
						</div>
						<!-- <div class="mt-4 d-table w-100 px-5">
                            <div class="d-table-cell align-middle">
                                <h5 class="p-0">
                                    Mobile Menu
                                </h5>
                            </div>
                        </div>
                        <div class="list" id="nmp">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
                                data-class="nav-mobile-push"></a>
                            <span class="onoffswitch-title">Push Content</span>
                            <span class="onoffswitch-title-desc">Content pushed on menu reveal</span>
                        </div>
                        <div class="list" id="nmno">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
                                data-class="nav-mobile-no-overlay"></a>
                            <span class="onoffswitch-title">No Overlay</span>
                            <span class="onoffswitch-title-desc">Removes mesh on menu reveal</span>
                        </div>
                        <div class="list" id="sldo">
                            <a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
                                data-class="nav-mobile-slide-out"></a>
                            <span class="onoffswitch-title">Off-Canvas <sup>(beta)</sup></span>
                            <span class="onoffswitch-title-desc">Content overlaps menu</span>
                        </div> -->
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Accessibility
								</h5>
							</div>
						</div>
						<div class="list" id="mbf">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-bigger-font"></a>
							<span class="onoffswitch-title">Bigger Content Font</span>
							<span class="onoffswitch-title-desc">content fonts are bigger for readability</span>
						</div>
						<div class="list" id="mhc">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-high-contrast"></a>
							<span class="onoffswitch-title">High Contrast Text (WCAG 2 AA)</span>
							<span class="onoffswitch-title-desc">4.5:1 text contrast ratio</span>
						</div>
						<div class="list" id="mcb">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-color-blind"></a>
							<span class="onoffswitch-title">Daltonism <sup>(beta)</sup> </span>
							<span class="onoffswitch-title-desc">color vision deficiency</span>
						</div>
						<div class="list" id="mpc">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-pace-custom"></a>
							<span class="onoffswitch-title">Preloader Inside</span>
							<span class="onoffswitch-title-desc">preloader will be inside content</span>
						</div>
						<div class="mt-4 d-table w-100 px-5">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Global Modifications
								</h5>
							</div>
						</div>
						<div class="list" id="mcbg">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-clean-page-bg"></a>
							<span class="onoffswitch-title">Clean Page Background</span>
							<span class="onoffswitch-title-desc">adds more whitespace</span>
						</div>
						<div class="list" id="mhni">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-hide-nav-icons"></a>
							<span class="onoffswitch-title">Hide Navigation Icons</span>
							<span class="onoffswitch-title-desc">invisible navigation icons</span>
						</div>
						<div class="list" id="dan">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-disable-animation"></a>
							<span class="onoffswitch-title">Disable CSS Animation</span>
							<span class="onoffswitch-title-desc">Disables CSS based animations</span>
						</div>
						<div class="list" id="mhic">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-hide-info-card"></a>
							<span class="onoffswitch-title">Hide Info Card</span>
							<span class="onoffswitch-title-desc">Hides info card from left panel</span>
						</div>
						<div class="list" id="mlph">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-lean-subheader"></a>
							<span class="onoffswitch-title">Lean Subheader</span>
							<span class="onoffswitch-title-desc">distinguished page header</span>
						</div>
						<div class="list" id="mnl">
							<a href="#" onclick="return false;" class="btn btn-switch" data-action="toggle"
								data-class="mod-nav-link"></a>
							<span class="onoffswitch-title">Hierarchical Navigation</span>
							<span class="onoffswitch-title-desc">Clear breakdown of nav links</span>
						</div>
						<div class="list mt-1">
							<span class="onoffswitch-title">Global Font Size <small>(RESETS ON REFRESH)</small> </span>
							<div class="btn-group btn-group-sm btn-group-toggle my-2" data-toggle="buttons">
								<label for="smRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
									data-class="root-text-sm" data-target="html">
									<input type="radio" aria-label="smRadio" name="smRadio" id="smRadio" value=""> SM
								</label>
								<label for="mdRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
									data-class="root-text" data-target="html">
									<input type="radio" aria-label="mdRadio" name="mdRadio" id="mdRadio" value=""
										checked=""> MD
								</label>
								<label for="lgRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
									data-class="root-text-lg" data-target="html">
									<input type="radio" aria-label="lgRadio" name="lgRadio" id="lgRadio" value=""> LG
								</label>
								<label for="xlRadio" class="btn btn-default btn-sm" data-action="toggle-swap"
									data-class="root-text-xl" data-target="html">
									<input type="radio" aria-label="xlRadio" name="xlRadio" id="xlRadio" value=""> XL
								</label>
							</div>
							<span class="onoffswitch-title-desc d-block mb-g">Change <strong>root</strong> font size to
								effect rem values</span>
						</div>
						<div class="mt-2 d-table w-100 pl-5 pr-3">
							<div class="d-table-cell align-middle">
								<h5 class="p-0">
									Theme colors <small>(overlays base css)</small>
								</h5>
								<!-- <div class="fs-xs text-muted p-2 alert alert-warning mt-3 mb-0">
                                    <i class="fal fa-exclamation-triangle text-warning mr-2"></i>Due to network latency
                                    and CPU utilization, you may experience a brief flickering effect on page load which
                                    may show the intial applied theme for a split second. Setting the prefered
                                    style/theme in the header will prevent this from happening.
                                </div> -->
							</div>
						</div>
						<div class="expanded theme-colors pl-5 pr-3">
							<ul class="m-0">
								<li><a href="#" id="myapp-0" data-action="theme-update" data-themesave data-theme=""
										data-toggle="tooltip" data-placement="top" title="Wisteria (base css)"
										data-original-title="Wisteria (base css)"></a></li>
								<li><a href="#" id="myapp-1" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-1.css" data-toggle="tooltip"
										data-placement="top" title="Tapestry" data-original-title="Tapestry"></a></li>
								<li><a href="#" id="myapp-2" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-2.css" data-toggle="tooltip"
										data-placement="top" title="Atlantis" data-original-title="Atlantis"></a></li>
								<li><a href="#" id="myapp-3" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-3.css" data-toggle="tooltip"
										data-placement="top" title="Indigo" data-original-title="Indigo"></a></li>
								<li><a href="#" id="myapp-4" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-4.css" data-toggle="tooltip"
										data-placement="top" title="Dodger Blue" data-original-title="Dodger Blue"></a>
								</li>
								<li><a href="#" id="myapp-5" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-5.css" data-toggle="tooltip"
										data-placement="top" title="Tradewind" data-original-title="Tradewind"></a></li>
								<li><a href="#" id="myapp-6" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-6.css" data-toggle="tooltip"
										data-placement="top" title="Cranberry" data-original-title="Cranberry"></a></li>
								<li><a href="#" id="myapp-7" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-7.css" data-toggle="tooltip"
										data-placement="top" title="Oslo Gray" data-original-title="Oslo Gray"></a></li>
								<li><a href="#" id="myapp-8" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-8.css" data-toggle="tooltip"
										data-placement="top" title="Chetwode Blue"
										data-original-title="Chetwode Blue"></a></li>
								<li><a href="#" id="myapp-9" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-9.css" data-toggle="tooltip"
										data-placement="top" title="Apricot" data-original-title="Apricot"></a></li>
								<li><a href="#" id="myapp-10" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-10.css" data-toggle="tooltip"
										data-placement="top" title="Blue Smoke" data-original-title="Blue Smoke"></a>
								</li>
								<li><a href="#" id="myapp-11" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-11.css" data-toggle="tooltip"
										data-placement="top" title="Green Smoke" data-original-title="Green Smoke"></a>
								</li>
								<li><a href="#" id="myapp-12" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-12.css" data-toggle="tooltip"
										data-placement="top" title="Wild Blue Yonder"
										data-original-title="Wild Blue Yonder"></a></li>
								<li><a href="#" id="myapp-13" data-action="theme-update" data-themesave
										data-theme="css/themes/cust-theme-13.css" data-toggle="tooltip"
										data-placement="top" title="Emerald" data-original-title="Emerald"></a></li>
							</ul>
						</div>
						<hr class="mb-0 mt-4">
						<div class="pl-5 pr-3 py-3 bg-faded">
							<div class="row no-gutters">
								<div class="col-6 pr-1">
									<a href="#" class="btn btn-outline-danger fw-500 btn-block"
										data-action="app-reset">Reset Settings</a>
								</div>
								<div class="col-6 pl-1">
									<a href="#" class="btn btn-danger fw-500 btn-block"
										data-action="factory-reset">Factory Reset</a>
								</div>
							</div>
						</div>
					</div>
					<span id="saving"></span>
				</div>
			</div>
		</div>
	</div>

	<style>
		.floatingLabletextarea:focus + label, .floatingLabletextarea:not(:placeholder-shown) + label, .floatingLabletextarea:not(:empty) + label {
	    	top: -15px;
	    }
		#contacttype-table1{
			height: 100%;
			max-height: 190px;
		}
	
		.floatingFields input:not(:placeholder-shown) + label {
		    background: #fff !important;
		    z-index: 9;
		}
		.tabulator .tabulator-tableholder{
			overflow-x: hidden;
		}
		.form-group.focused .selectFloating{
			color: #7a59ae !important;
		    background: #fff;
		    left: 0;
		    top: -17px;	
		}
		.selectFloatingLabel .form-label{
			position: absolute;
		}
	/* 	.datePickerFloatContent .form-label{
			position: absolute;
			top: 3px;
    		left: 5px;
		}
		.datePickerFloat .form-label{
		    position: absolute;
		    top: 3px;
		    left: 5px;
		}
		.floatingFields input:focus + label,
		.floatingFields input:not(:placeholder-shown) + label {
		  transform: translateY(calc(-50% - 3px)) scale(.8);
		  color: #000;
		  font-size: 15px;
		  background-color: #fff;
		  color: #886ab5 !important;
		  position: absolute;
		  top: 0px;
		  height: 21px;
		} */
		#dateFrom-ip::-webkit-datetime-edit,
		#dateFrom-ip::-webkit-datetime-edit {
		    color: transparent !important; 
		}

		#dateFrom-ip.has-value::-webkit-datetime-edit,
		#dateFrom-ip.has-value::-webkit-datetime-edit {
		    color: black !important; 
		}
		
		.datePickerFloatContent .has-value + .form-label{
			    top: -11px;
			    background: #fff;
			    color: #9b7cca !important;
			    font-size: 12px;
		}
		/* .datePickerFloatContent .floatingLable{
			color: transparent;
		} */
		.datePickerFloatContent .has-value, floatingLable{
			color: #000!important;
		}
		
		#contacttype-table .tabulator-header{
			display:none;
		}
		contacttype-table{
			border-top:0;
		}
		.headerBlock{
			background: #7a59ad;			
			color: #fff;			
			padding: 5px;			
			border: 1px solid #ccc;			
			margin-left: 5px;			
			margin-right: 5px;			
		}
		
		.table-bordered {
			border: 1px solid #7a58ac;
		}
					
		.nav-tabs{			
			border: 1px solid #7a59ad;			
			border-radius: 5px 5px 5px 0px;			
		}
			
		h6 {
			color: #7a59ad;
			font-weight: 500;
		}

		#dtBasicExample tr {
			white-space: nowrap;
		}

		#dtBasicExample .sorting_asc:first-child::before {
			display: none;
		}

		#dtBasicExample .sorting_asc:first-child::after {
			display: none;
		}

		#dtBasicExample_wrapper div:first-child {
			margin: 0 !important;
			padding-top: 0;
		}

		#dtBasicExample_wrapper .row:nth-child(3) {
			position: absolute;
			left: 20px;
			bottom: 4px;
		}

		#dtBasicExample_wrapper .col-sm-12 {
			padding: 0;
		}

		.dataTables_info {
			margin-left: 12px;
			padding-top: 0;
		}

		#dtBasicExample {
			margin-bottom: 5px !important;
		}

		.panel {
			margin-bottom: 8px !important;
		}

		.dataTables_scrollHeadInner {
			width: 100% !important;
			white-space: nowrap;
		}

		#initiatelfms .dataTables_wrapper .row:nth-child(1) {
			margin-bottom: 5px !important;
		}

		#initiatelfms .dataTables_info {
			margin-left: 0px !important;
		}

		#contactHistoryTable_wrapper .dataTables_info {
			margin-left: 0px !important;
			position: absolute;
			bottom: -152px;
		}

		#contactHistoryTable_wrapper .row:first-child {
			margin-bottom: 0 !important;
		}

		.headerBtnGroup .dropdown-item {
			padding: .2rem 1.5rem;
		}

		.select2-container--open .select2-dropdown--below {
			z-index: 9999;
		}
		/* .hovered-row{
		background-color: #7a59ad;
		} */
		

    .tabulator-cell {
      text-align: center; 
    }
		.v-casenotes{
			background-color: #c5c5c5;
		}
		
		.EvenCommit .tabulator-cell {
		    color: rgb(0, 205, 219) !important;
		}
		
		.OddCommit .tabulator-cell{
		    color: rgb(198, 212, 8) !important;
		}
		
		.hidden {
		    display: none;
		}
		
		.grey-cell {
		    background-color: #e0e0e0; /* Grey color */
		}
		
		.selected td {
		    background-color: #1dc9b7 !important; /* Green color */
		}
		
        #charCount {
            font-size: 0.9em;
            color: #555;
        }
        
        #userroledetails th,
		#userroledetails td {
		    white-space: nowrap;
		}
		
		.btn-disabled-relationship {
		    background-color: grey !important;
		    border-color: grey !important;
		    color: white !important;
		    pointer-events: none;
		    cursor: not-allowed;
		}
		.disabled-row {
    pointer-events: none; 
    /* opacity: 0.5;  */
}

tabulator.tabulator-block-select, .tabulator.tabulator-ranges .tabulator-cell:not(.tabulator-editing){
	display: inline-flex;
    justify-content: center;
}
.tabulator-row .tabulator-cell.tabulator-editing {
    display: inline-flex;
    justify-content: center;
    align-items: center;
}
.leader-editor-checkbox::before{
        content: '';
	    display: inline-block;
	    width: 14px;
	    height: 14px;
	    border: 2px solid #0075ff;
	    position: absolute;
	    top: 1px;
	    left: 1px;
    }
		
/*         .nav-function-top .page-content-wrapper {

margin-top: 4rem;

} */

/* Prevent interference during editing */
/* .tabulator-editing-disabled .tabulator-cell {
  pointer-events: none !important;
}

.tabulator-editing-disabled .tabulator-cell.tabulator-editing {
  pointer-events: auto !important;
} */

	@media screen and (max-width: 1024px) {
	    .page-content-wrapper {
	        margin-top: 0 !important;
	    }
	}
	@media screen and (max-width: 1093px) {
		.tabsCheckbox{
			position: unset !important;
		    display: flex;
		    justify-content: end;
		    width: 100%;
		}
	}
	
	 .no-toggle-checkbox {
      pointer-events: none;
    }
     .disabled-icon{
      pointer-events: none !important;
     }
     
/* .tabulator .tabulator-cell {
  justify-content: flex-start !important; 
  text-align: left !important;
} */

.tabulator-cell.enteredlfms-align-left {
  justify-content: flex-start !important;
  text-align: left !important;
}
	</style>

	<!-- END Page Settings -->
	
	<script>
		document.addEventListener('DOMContentLoaded', function() {
		    const inputs = document.querySelectorAll('.datefloatingLable');
		    inputs.forEach(function(input) {
		        input.addEventListener('input', function() {
		            if (this.value.trim() !== "") {
		                this.classList.add('has-value');
		            } else {
		                this.classList.remove('has-value');
		            }
		        });
		    });
		});
		$(document).ready(function () {
			
			// initialize datatable
		/* 	$('#dtBasicExample').dataTable({
			    scrollCollapse: true,
			    scrollY: '25vh',
			    scrollX: true,
			    paging: false,
			    responsive: false,
			    searching: false,
			    lengthChange: false,
			    info: false,
			    ordering: true,
			    columnDefs: [
			        {
			            targets: 0, // Target the Actions column
			            orderable: false // Disable sorting for this column
			        },
			        {
			            targets: 1, // Target the Contact Date column
			            type: 'date-custom' // Use the custom date sorting function
			        },
			        {
			            targets: 2, // Target the Contact Time column
			            type: 'time-custom' // Use the custom time sorting function
			        },
			        {
			            targets: 4, // Target the Entered Date column
			            type: 'date-custom' // Use the custom date sorting function
			        },
			        {
			            targets: 5, // Target the Entered Time column
			            type: 'time-custom' // Use the custom time sorting function
			        },
			        {
			            targets: 'no-sort', // Columns to exclude from sorting
			            orderable: false // Disable sorting for these columns
			        }
			    ]
			}); */
			
		/* 	// Custom date sorting function for MM/DD/YYYY format
			jQuery.fn.dataTable.ext.type.order['date-custom-pre'] = function (date) {
			    var dateParts = date.split('/');
			    return new Date(dateParts[2], dateParts[0] - 1, dateParts[1]).getTime();
			};
			
			// Custom time sorting function for HH:MM format
			jQuery.fn.dataTable.ext.type.order['time-custom-pre'] = function (time) {
			    var timeParts = time.split(':');
			    return parseInt(timeParts[0]) * 60 + parseInt(timeParts[1]);
			};
			
			// initialize datatable
			$('#contactHistoryTable').dataTable({
				scrollY: "250px",
				scrollCollapse: true,
				paging: false,
				searching: false,
				ordering: false,
				showNEntries: false,
				info: false,
			});

			// initialize datatable
			$('#contactpersonlfms').dataTable({
				scrollY: "350px",
				scrollCollapse: true,
				paging: false,
				searching: false,
				ordering: false,
				showNEntries: false,
				info: false,
			}); */

			const addCmntText = document.getElementById('addComments');
			const addCmntclickBtn = document.getElementById('addCmntValBtn');
			const addCmntshowVal = document.getElementById('addCmntValShow');
			const addCmntClear = document.getElementById('addCmntValClear');

			function addcmtfun() {
				addCmntshowVal.innerHTML = addCmntText.value;
			}

			addCmntclickBtn.addEventListener('click', addcmtfun);
			addCmntClear.addEventListener('click', () => {
				addCmntshowVal.innerHTML = addCmntText.value = '';
			});

			$(function () {

				function AllowOnlyNumbers(e) {
					e = (e) ? e : window.event;

					var clipboardData = e.clipboardData ? e.clipboardData : window.clipboardData;
					var key = e.keyCode ? e.keyCode : e.which ? e.which : e.charCode;
					var str = (e.type && e.type == "paste") ? clipboardData.getData('Text') : String.fromCharCode(key);

					return (/^\d+$/.test(str));
				}

				$(document.body).on('keypress', '.num', function (e) {
					return AllowOnlyNumbers(e);
				});

				$(document.body).on('keypress keyup keydown focus', '.mail', function (e) {

					if ($(this).val() != '') {

						if (validateEmail($(this).val())) {
							$(this).removeClass('error_fld');
						} else {
							$(this).addClass('error_fld');
						}

					} else {
						$(this).removeClass('error_fld');
					}


				});

				function validateEmail(email) {
					var re = /\S+@\S+\.\S+/;
					return re.test(email);
				}

		//		getLOV();

				function getLOV() {
					var scrncode = $('#screenCode').val();

					console.log('scrncode is ' + scrncode);

					$.ajax({
						url: contextPath + 'getLOV',
						method: 'POST',
						dataType: "json",
						data: { screenCode: scrncode },
						success: function (response) {
							for (var i = 0; i < response.length; i++) {
								console.log(response[i]['ALGORITHM_QUERY'] + " for " + response[i]['FIELD_NAME']);

								var cat = response[i]['ALGORITHM_QUERY'].split('::')[0];
								var vals = response[i]['ALGORITHM_QUERY'].split('::')[1];

								if (cat == 'hardcoded' && vals != '') {
									vals = vals.split(',');
									var content = '<option value="">Select ' + response[i]['FIELD_LABEL'] + '</option>';
									for (var j = 0; j < vals.length; j++) {
										content += '<option value="' + vals[j].split(':')[0] + '">' + vals[j].split(':')[1] + '</option>';
									}

									$('.' + response[i]['FIELD_NAME']).html(content);
								}

								if (cat == 'query' && vals != '') {
									setOption(vals, response[i]['FIELD_NAME'], response[i]['FIELD_LABEL']);
								}

							}
						},
						error: function (error) {
							//console.error("Error getting table names:", error);
						}
					});
				}

	//			getValid();

				function getValid() {
					var scrncode = $('#screenCode').val();

					console.log('scrncode is ' + scrncode);

					$.ajax({
						url: contextPath + 'getValid',
						method: 'POST',
						dataType: "json",
						data: { screenCode: scrncode },
						success: function (response) {

							console.log('asif try 1');
							console.log('response.length : ' + response.length);

							for (var i = 0; i < response.length; i++) {
								console.log(response[i]['VALIDATION_LOGIC'] + " for " + response[i]['FIELD_NAME']);

								var typ = response[i]['VALIDATION_LOGIC'].split('::')[0];
								var rul = response[i]['VALIDATION_LOGIC'].split('::')[1];
								var len = response[i]['VALIDATION_LOGIC'].split('::')[2];

								if (typ == 'Text') {
									if (rul == 'Number') {
										$('.' + response[i]['FIELD_NAME']).addClass('num');
									}

									if (rul == 'Email') {
										$('.' + response[i]['FIELD_NAME']).addClass('mail');
									}

									if (len != 'X' && len > 0) {
										$('.' + response[i]['FIELD_NAME']).prop('maxlength', len);
									}
								} else if (typ == 'Date') {
									rules = rul.split(",");

									var min = '';
									var max = '';
									var ddates = [];

									for (var j = 0; j < rules.length; j++) {
										var rule = rules[j].split(":")[0];
										var value = rules[j].split(":")[1];
										switch (rule) {
											case 'mindt':
												min = chkToday(value);
												break;
											case 'maxdt':
												max = chkToday(value);
												break;
											case 'mindt+':
												min = differDay(chkToday(value), 'N');
												break;
											case 'maxdt-':
												max = differDay(chkToday(value), 'P');
												break;
											case 'not':
												ddates.push(chkToday(value));
												break;
										}

									}

									//alert(response[i]['FIELD_NAME']);
									var valid_info = min + '::' + max + '::' + ddates.join(',');
									$('#' + response[i]['FIELD_NAME']).attr('data-valid', valid_info);
									applyRange(min, max, ddates, response[i]['FIELD_NAME']);
								}



								/*
								if (cat == 'hardcoded' && vals != '') {
									vals = vals.split(',');
									var content = '<option value="">Select ' + response[i]['FIELD_LABEL'] + '</option>';
									for (var j = 0; j < vals.length; j++) {
										content += '<option value="' + vals[j].split(':')[0] + '">' + vals[j].split(':')[1] + '</option>';
									}
	
									$('.' + response[i]['FIELD_NAME']).html(content);
								}
	
								if (cat == 'query' && vals != '') {
									setOption(vals, response[i]['FIELD_NAME'], response[i]['FIELD_LABEL']);
								}
								*/

							}
						},
						error: function (error) {
							//console.error("Error getting table names:", error);
						}
					});
				}

				function setOption(vals, field, label) {
					$.ajax({
						url: contextPath + 'getVals',
						method: 'POST',
						dataType: "json",
						data: { vals: vals },
						success: function (response) {
							var content = '<option value="">Select ' + label + '</option>';
							for (var i = 0; i < response.length; i++) {
								content += '<option value="' + response[i]['VAL'] + '">' + response[i]['VAL'] + '</option>';
							}
							$('.' + field).html(content);
						},
						error: function (error) {
							//console.error("Error getting table names:", error);
						}
					});
				}

				function applyRange(min, max, ddates, cls) {

					if (min == '') {
						min = null;
					}

					if (max == '') {
						max = null;
					}

					$("." + cls).datepicker({
						dateFormat: "mm/dd/yy",
						minDate: min,
						maxDate: max,
						beforeShowDay: function (date) {
							var string = jQuery.datepicker.formatDate('mm/dd/yy', date);
							return [ddates.indexOf(string) == -1];
						}
					});

				}

				function chkToday(str) {
					if (str == 'today') {
						const d = new Date();
						let year = d.getFullYear();
						let month = d.getMonth() + 1;
						let date = d.getDate();
						str = padDigits(month, 2) + "/" + padDigits(date, 2) + "/" + padDigits(year, 4);
					}

					console.log('str check ' + str);

					return str;
				}

				function padDigits(number, digits) {
					return Array(Math.max(digits - String(number).length + 1, 0)).join(0) + number;
				}

				function differDay(dt, diff) {
					var day = new Date(dt);

					var nd = new Date(day);
					if (diff == 'N') {
						nd.setDate(day.getDate() + 1);
					} else {
						nd.setDate(day.getDate() - 1);
					}

					let year = nd.getFullYear();
					let month = nd.getMonth() + 1;
					let date = nd.getDate();
					var str = padDigits(month, 2) + "/" + padDigits(date, 2) + "/" + padDigits(year, 4);
					return str;
				}

				$(document).on('blur', '.hasDatepicker', function () {
					var fld = $(this).attr('data-field');
					if ($(this).val() != '') {
						var mydate = $(this).val();
						if (!valDate(mydate)) {
							$(this).val('');
							//alert("Invalid Date");
							Swal.fire('Alert', 'Invalid Date Given', 'warning');
						} else {
							var newdt = padDigits(mydate.split("/")[0], 2) + "/" + padDigits(mydate.split("/")[1], 2) + "/" + mydate.split("/")[2];
							if (checkAvailable(newdt, fld)) {
								$(this).val(newdt);
							} else {
								$(this).val('');
								//alert("Disabled Date Not Allowed");
								Swal.fire('Alert', 'Disabled Date Not Allowed', 'warning');
							}

						}
					}
				});

				function checkAvailable(dt, fld) {
					var valid_dt = $('#' + fld).attr('data-valid');
					var mindt = valid_dt.split('::')[0];
					var maxdt = valid_dt.split('::')[1];
					var ddates = valid_dt.split('::')[2].split(',');

					if (mindt != '') {
						var d1 = new Date(dt.split('/')[2], dt.split('/')[0] - 1, dt.split('/')[1]);
						var d2 = new Date(mindt.split('/')[2], mindt.split('/')[0] - 1, mindt.split('/')[1]);

						if (d1 < d2) {
							return false;
						}

					}

					if (maxdt != '') {
						var d1 = new Date(dt.split('/')[2], dt.split('/')[0] - 1, dt.split('/')[1]);
						var d2 = new Date(maxdt.split('/')[2], maxdt.split('/')[0] - 1, maxdt.split('/')[1]);

						if (d1 > d2) {
							return false;
						}

					}

					for (var i = 0; i < ddates.length; i++) {
						if (dt == ddates[i]) {
							return false;
						}
					}

					return true;

				}

				function valDate(mydate) {
					var valid = true;
					if (mydate.indexOf("/") == -1) {
						valid = false;
					}
					if (mydate.split('/').length != 3) {
						valid = false;
					}
					var mn = parseInt(mydate.split('/')[0]);
					var dt = parseInt(mydate.split('/')[1]);
					var yr = parseInt(mydate.split('/')[2]);
					if (mn > 12 || mn < 1) {
						valid = false;
					}
					if (mn == 1 || mn == 3 || mn == 5 || mn == 7 || mn == 8 || mn == 10 || mn == 12) {
						if (dt > 31 || dt < 1) {
							valid = false;
						}
					}
					if (mn == 4 || mn == 6 || mn == 9 || mn == 11) {
						if (dt > 30 || dt < 1) {
							valid = false;
						}
					}
					if (mn == 2) {
						if (yr % 4 == 0) {
							if (dt > 29 || dt < 1) {
								valid = false;
							}
						} else {
							if (dt > 28 || dt < 1) {
								valid = false;
							}
						}
					}
					if (yr > 2100 || yr < 2000) {
						valid = false;
					}
					return valid;
				}

				$('.select2').select2();

				$(".select2-placeholder-multiple").select2(
					{
						placeholder: "Select State"
					});
				$(".js-hide-search").select2(
					{
						minimumResultsForSearch: 1 / 0
					});
				$(".js-max-length").select2(
					{
						maximumSelectionLength: 2,
						placeholder: "Select maximum 2 items"
					});
				$(".select2-placeholder").select2(
					{
						placeholder: "Select a state",
						allowClear: true
					});



				$(".js-select2-icons").select2(
					{
						minimumResultsForSearch: 1 / 0,
						templateResult: icon,
						templateSelection: icon,
						escapeMarkup: function (elm) {
							return elm
						}
					});

				function icon(elm) {
					elm.element;
					return elm.id ? "<i class='" + $(elm.element).data("icon") + " mr-2'></i>" + elm.text : elm.text
				}

				$(".js-data-example-ajax").select2(
					{
						ajax:
						{
							url: "https://api.github.com/search/repositories",
							dataType: 'json',
							delay: 250,
							data: function (params) {
								return {
									q: params.term, // search term
									page: params.page
								};
							},
							processResults: function (data, params) {
								// parse the results into the format expected by Select2
								// since we are using custom formatting functions we do not need to
								// alter the remote JSON data, except to indicate that infinite
								// scrolling can be used
								params.page = params.page || 1;

								return {
									results: data.items,
									pagination:
									{
										more: (params.page * 30) < data.total_count
									}
								};
							},
							cache: true
						},
						placeholder: 'Search for a repository',
						escapeMarkup: function (markup) {
							return markup;
						}, // let our custom formatter work
						minimumInputLength: 1,
						templateResult: formatRepo,
						templateSelection: formatRepoSelection
					});

				function formatRepo(repo) {
					if (repo.loading) {
						return repo.text;
					}

					var markup = "<div class='select2-result-repository clearfix d-flex'>" +
						"<div class='select2-result-repository__avatar mr-2'><img src='" + repo.owner.avatar_url + "' class='width-2 height-2 mt-1 rounded' /></div>" +
						"<div class='select2-result-repository__meta'>" +
						"<div class='select2-result-repository__title fs-lg fw-500'>" + repo.full_name + "</div>";

					if (repo.description) {
						markup += "<div class='select2-result-repository__description fs-xs opacity-80 mb-1'>" + repo.description + "</div>";
					}

					markup += "<div class='select2-result-repository__statistics d-flex fs-sm'>" +
						"<div class='select2-result-repository__forks mr-2'><i class='fal fa-lightbulb'></i> " + repo.forks_count + " Forks</div>" +
						"<div class='select2-result-repository__stargazers mr-2'><i class='fal fa-star'></i> " + repo.stargazers_count + " Stars</div>" +
						"<div class='select2-result-repository__watchers mr-2'><i class='fal fa-eye'></i> " + repo.watchers_count + " Watchers</div>" +
						"</div>" +
						"</div></div>";

					return markup;
				}

				function formatRepoSelection(repo) {
					return repo.full_name || repo.text;
				}
			});
						
						//Rest API Functions
						
			/*<![CDATA[*/
			var contextPath = /*[[@{/}]]*/ '';
			/*]]>*/
			
			//Api that return type of contact , relationship, negative reasons Lov			
			setTimeout(getContTpDesc, 1000);
			setTimeout(getRelationship,1000);
			setTimeout(getNegativeReasons,500);
			var Values
			// Function to return type of contact table values
 			function getContTpDesc() {
			    $.ajax({
			        method: "GET",
			        url: contextPath + 'getContactTpDesc',
			        contentType: 'application/json',
			        success: function(response) {
			        	var ValuesOfTypeofcontact=response.activeContactCodesAndDescriptions;
			        	   //       ValueofCT(ValuesOfTypeofcontact);
			            let activeContacts = response.activeContactCodesAndDescriptions;
			            if (activeContacts && activeContacts.length > 0) {
			                populateDropdown(activeContacts, '#selectTypeOfContact');
			                populateDropdown(activeContacts, '#typeOfContact-ip');
			            } else {
			                console.log('No data available');
			            }
			            $.each(Values, function(index, item) {
			            	
			            //	console.log('checking ct='+item[0]+' '+item[1]);
			            	 $('#typeContact-constant').append(`
			        				<option data-value="${item[0]}">${item[1]}</option>
			        		
			        		`);
			            	 
			            });
			        },
			        error: function(error) {
			            console.error('Error:', error);
			            console.log(error.responseText);
			        }
			    });
			} 
			
			 
			function getRelationship() {
			    $.ajax({
			        method: "GET",
			        url: contextPath + 'getRelationshipDesc',
			        contentType: 'application/json',
			        success: function(response) {
			            let activeRelationships = response.activeRelationCodesAndDescriptions;
			            if (activeRelationships && activeRelationships.length > 0) {
			                populateDropdown(activeRelationships, '#relationship-ip');
			                populateDropdown(activeRelationships,'.relationshipwithOffender');
			            } else {
			                console.log('No data available');
			            }
			        },
			        error: function(error) {
			            console.error('Error:', error);
			            console.log(error.responseText);
			        }
			    });
			}
			getRelationship();
			// Function to return negative reason table values
			function getNegativeReasons() {
			    $.ajax({
			        method: "GET",
			        url: contextPath + 'getReasonCodes',
			        contentType: 'application/json',
			        success: function(response) {
			            let activeReasons = response.activeReasonCodesAndDescriptions;
			            if (activeReasons && activeReasons.length > 0) {
			                populateDropdown(activeReasons, '#neg-reasons-sv');
			                populateDropdown(activeReasons, '#negative');
			            } else {
			                console.log('No data available');
			            }
			        },
			        error: function(error) {
			            console.error('Error:', error);
			            console.log(error.responseText);
			        }
			    });
			}
			
			//function to populate dropdowns
			function populateDropdown(data, dropdownId) {
			    var dropdown = $(dropdownId);
			    dropdown.empty();
			    
			    dropdown.append($('<option></option>').attr('value', '').text('')); 

			    data.forEach(function(item) {
			        var Code = item[0];
			        var Desc = item[1];
			        var option = $('<option></option>').attr('value', Code).text(Desc);
			        dropdown.append(option);
			    });
			}
			
			//Initialising local variables 			
			var commitNo;
			var dateFromIp;
			var dateToIp;
			var typeOfContactIp;
			var relationshipIp;
			var resultsIp;
			
			//Dom event handler to retive the values
			$('#dateFrom-ip').on('change', function(event) {
		        dateFromIp = $(this).val(); 
		            return dateFromIp;
		    });
					
		    $('#dateTo-ip').on('change', function(event) {
		        dateToIp = $(this).val(); 
		            return dateToIp;
		    });
		    
		    $('#typeOfContact-ip').on('change', function(event) {
		        typeOfContactIp = $(this).find('option:selected').val();
		            return typeOfContactIp;
		    });
		    
		    $('#relationship-ip').on('change', function(event) {
		        relationshipIp = $(this).find('option:selected').text(); 
		            return relationshipIp;
		    });
		    
		    $('#results-ip').on('change', function(event) {
		        resultsIp = $(this).find('option:selected').text();
		            return resultsIp;
		    });
		    
		    /* $('#searchButton').on('click', function() {
			//	getCaseNotes();
			//	iscFlagAndDate(); // Function definition in Contacted person tab
			var sbiNumber=$('#sbiNumberInput').val();
			console.log('sbiNumber='+sbiNumber);
			caseNotesHistory(sbiNumber);
			}); */
			
			// Function to initialize case notes input object
			function initializeCaseNotesInput(commitNo, sbiNumberInput) {
			    return {
			        commitNo: commitNo,
			        sbiNumber: sbiNumberInput,
			        dateFrom: dateFromIp,
			        dateTo: dateToIp,
			        typeOfContact: typeOfContactIp,
			        relationship: relationshipIp,
			        results: resultsIp
			    };
			}
			
			// Function to get case notes used in search button
			function getCaseNotes() {
			    var sbiNumberInput = $('#sbiNumberInput').val();
			    commitNo = null;
			    var casenotesIp = initializeCaseNotesInput(commitNo, sbiNumberInput);
			    if (sbiNumberInput != null) {
			        caseNotesData(casenotesIp);
			        caseNotesHistory(sbiNumberInput);
			    }
			}
			
			//Initialising a save object
			let csmnSave = {
							  commitNo: null
							};
			
			// Function to retrieve existing case notes 
			function caseNotesData(casenotesIp) {
			    $.ajax({
			        method: "POST",
			        url: contextPath + 'CaseNotesData',
			        contentType: 'application/json',
			        data: JSON.stringify(casenotesIp),  
			        success: function(response) {						
			            if (response.caseNotes && response.caseNotes.length > 0) {
			                let firstCaseNote = response.caseNotes[0];
			                csmnSave.commitNo = firstCaseNote.commitNo; // Initializing the value of commit no for save API.
			            }
			            clearCaseNotesTable();  // Clear the table before populating new data
			            populateCaseNotes(response.caseNotes || []);  // Populate with the case notes list
			        },
			        error: function(error) {
			            console.error('Error:', error);
			            console.log(error.responseText);
			        }
			    });
			    return csmnSave;
			}
			
			//function to clear data in contact information data table		    
			/* function clearCaseNotesTable() {
			    var table = $('#dtBasicExample').DataTable();
			    table.rows(function(idx, data, node) {
			        return $(node).attr('id') !== 'input-contact-info';
			    }).remove().draw();
			}
			 */
			// Variables to store commitNo and sequenceNo
			let selectedCommitNo = null;
			let selectedSequenceNo = null;
			
			//Object to determine insertion or updation of case notes
				let insertOrupdate = {
					insert: true,
					update: false
				}
			
			// Function to parse data into the contact information table
			function populateCaseNotes(caseNotes) {
			    var table = $('#dtBasicExample').DataTable();
			
			    if (caseNotes.length > 0) {
			        caseNotes.forEach(function(caseNote, index) {
			            var checkboxId = 'addcmntCheck_' + index;
			            var checkboxHtml = `
			                <div class="custom-control custom-checkbox custom-control-inline mr-2">
			                    <input type="checkbox" class="custom-control-input addcmntCheck" id="${checkboxId}">
			                    <label class="custom-control-label" for="${checkboxId}"></label>
			                </div>`;
			         
			            var row = [
			                checkboxHtml,
			                formatDate(caseNote.csmnContDt),
			                formatTime(caseNote.csmnContTm),
			                caseNote.contTpDesc,
			                formatDate(caseNote.insertedDateTime.substring(0, 10)),
			                formatTime(caseNote.insertedTime),
			                caseNote.csmnContSprvNegFlg === 'Y' ? '<input type="checkbox" checked disabled>' : '<input type="checkbox" disabled>',
			                caseNote.correctionFlag === 'Y' ? '<input type="checkbox" checked disabled>' : '<input type="checkbox" disabled>',
			                (caseNote.contTpCd === 'STG' || caseNote.contTpDesc === 'STG Related') ? '<input type="checkbox" checked disabled>' : '<input type="checkbox" disabled>',
			                caseNote.resnDesc,
			                caseNote.fullName,
			                caseNote.csmnContComnt
			            ];
			
			            var addedRow = table.row.add(row).draw(false).node();
			
			            $(addedRow).find('td').addClass('grey-cell');
			            
			            //Adding the commitNo ,DdocFlg and sequenceNo values as data attributes to the row
			            $(addedRow).data('commitNo', caseNote.commitNo);
			            $(addedRow).data('sequenceNo', caseNote.csmnContSeqNum);
			            $(addedRow).data('csmnContInitDdocFlg', caseNote.csmnContInitDdocFlg);
			            
			            // Click event handler to highlight row in blue
			            $(addedRow).on('click', function() {
							
			                table.$('tr.selected').removeClass('selected');
			                $(this).addClass('selected');
			
			                var rowData = table.row(this).data();
			                var commentValue = rowData[rowData.length - 1]; 
			                $('#addCmntValShow').val(commentValue);
			                
			                updateCharCount();
			                
			                if(insertOrupdate.insert){
				                // Set insert to false and update to true
				                insertOrupdate.insert = false;
				                insertOrupdate.update = true;
			                }
			                // Check if update is true before grabbing the values
			                if (insertOrupdate.update) {
			                    selectedCommitNo = $(this).data('commitNo');
			                    selectedSequenceNo = $(this).data('sequenceNo');
			                }
			                
			                disableAndEnableInputs();// changes table in contacted person tab
			                
			                // Update the input fields with the selected row data
			                $('#inputTypeOfContact').val(rowData[3]); 
			                $('#inputContactDate').val(rowData[1]);  
			                $('#inputContactTime').val(rowData[2]);
			                
			                // Trigger InitiatedDDOC checkbox based on csmnContInitDdocFlg
			                var ddocFlag = $(this).data('csmnContInitDdocFlg');
			                $('#InitiatedDDOC').prop('checked', ddocFlag === 'Y');
			            });
			        });
			    }
			}
			
			//function to format date string
			function formatDate(dateString) {
			    var datePart = dateString.split('T')[0];
			    var dateParts = datePart.split('-');
			    return dateParts[1] + '/' + dateParts[2] + '/' + dateParts[0];
			}
			
			//function to format time string
			function formatTime(timeString) {
			    if (typeof timeString !== 'string' || timeString.trim() === '') {
			        return '';
			    }
			
			    var timeParts = timeString.split(':');
			    var hours = parseInt(timeParts[0], 10);
			    var minutes = parseInt(timeParts[1], 10);
			
			    if (isNaN(hours) || isNaN(minutes)) {
			        return '';
			    }
			
			    var formattedHours = (hours < 10 ? '0' : '') + hours;
			    var formattedMinutes = (minutes < 10 ? '0' : '') + minutes;
			
			    return formattedHours + ':' + formattedMinutes;
			}
			
			// Function to retrieve case notes for the history tab
			/* function caseNotesHistory(sbiNumber) {
			    $.ajax({
			        method: "POST",
			        url: contextPath + 'CaseNotesHistory',
			        contentType: 'application/json',
			        data: sbiNumber,  
			        success: function(response) {
			            $('#contactHistoryTable tbody').empty();
			            if (response.caseNotesHistory) {
			                response.caseNotesHistory.forEach(function(obj) {
			                    appendRowToTable(obj);
			                });
			            }
			        },
			        error: function(error) {
			            console.error('Error:', error);
			            console.log(error.responseText);
			        }
			    });
			} */
			
		
			
			//function to append data to the contact history datatable
			/* function appendRowToTable(obj, index) {
			    var bgColorClass = isOdd(obj.commitNo) ? 'OddCommit' : 'EvenCommit';
			
			    var newRow = `<tr>
			        <td class="${bgColorClass}">${obj.csmnContDt.substring(0, 10)}</td>
			        <td class="${bgColorClass}">${obj.csmnContTm}</td>
			        <td class="${bgColorClass}">${obj.contTpDesc}</td>
			        <td class="${bgColorClass}">${obj.insertedDateTime.substring(0, 10)}</td>
			        <td class="${bgColorClass}">${formatTime(obj.insertedTime)}</td>
			        <td class="${bgColorClass}"><input type="checkbox" disabled ${obj.csmnContSprvNegFlg === 'Y' ? 'checked' : ''}></td>
			        <td class="${bgColorClass}"><input type="checkbox" disabled ${obj.correctionFlag === 'Y' ? 'checked' : ''}></td>
			        <td class="${bgColorClass}">${obj.resnDesc || ''}</td>
			        <td class="${bgColorClass}">${obj.userFirstName || ''}, ${obj.userLastName || ''} ${obj.userMidName || ''} ${obj.userSuffixName || ''}</td>
			        <td style="display:none;">${obj.csmnContComnt || ''}</td>
			        <td style="display:none;">${obj.csmnContInitDdocFlg || ''}</td>
			        <td style="display:none;">${obj.iscRequestedDateBox || ''}</td>
			        <td style="display:none;">${obj.iscApprovedFlag || ''}</td>
			        <td style="display:none;">${obj.commitNo || ''}</td>
			        <td style="display:none;">${obj.csmnContSeqNum || ''}</td>
			    </tr>`;
			    
			    var $newRow = $(newRow);
			    $('#contactHistoryTable tbody').append($newRow);
			
			    $newRow.on('click', handleRowClick);
			} */
			
			// Click event handler to view comment of each case notes
			function handleRowClick() {
			    var comment = $(this).find('td:eq(9)').text(); 
			    $('#comment-history').val(comment);
			}
			
			//function to check if the commit no is odd or even
			function isOdd(commitNo) {
			    return parseInt(commitNo) % 2 !== 0;
			}
			
			$('#StayHistoryModal').on('shown.bs.modal', function() {
			    $('#fetchDataBtn').on('click', function() {
			        $('#CheckedRadio').prop('checked', true);
			
			        if ($(this).data('fetching')) {
			            return;
			        }
			
			        $(this).data('fetching', true);
			
			        var selectedCheckbox = $('.custom-control-input.stayhistory:checked');
			        if (selectedCheckbox.length > 0) {
			            var row = selectedCheckbox.closest('tr');
			            commitNo = row.find('#stay').val();
			
			            // Check if the commitNo is 'current' and set it to null 
			            if (commitNo === 'current') {
			                commitNo = null;
			            }
			        }
			        
			        if (commitNo != null) {
						var sbiNumberInput = null;
			            var casenotesIp = initializeCaseNotesInput(commitNo, sbiNumberInput);
			            caseNotesData(casenotesIp);
			        }else{
						var sbiNumberInput = $('#sbiNumberInput').val();
			            var casenotesIp = initializeCaseNotesInput(commitNo, sbiNumberInput);
			            caseNotesData(casenotesIp);
					}
			
			        $('#StayHistoryModal').modal('hide');
			    });
			    $('#fetchDataBtn').data('fetching', false);
			});	
			
			// Function to update the character count
			function updateCharCount() {
			    var text = $('#addCmntValShow').val();
			    var charCount = text.length;
			
			    $('#charCount').text(charCount + "/3000 characters");
			    if (charCount > 3000) {
			        var trimmedText = text.substring(0, 3000);
			        $('#addCmntValShow').val(trimmedText);
			        $('#charCount').text("3000/3000 characters");
			    }
			}
			
			// Disabling all fields based on the trigger value
			function toggleInputs(triggerValue) {
			    var ids = [
			        "#addCmntValShow", 
			        "#input-contact-info", 
			        "#InitiatedDDOC",
			        "#initiated-firstname", 
			        "#initiated-lastname", 
			        "#initiated-middlename", 
			        "#initiated-suffixname", 
			        "#userroledetails"
			    ];
			    
			    ids.forEach(function(id) {
			        var element = $(id);
			
			        if (element.is("table")) {
			            element.find('input, select, textarea').prop('disabled', !triggerValue);
			        } else if (element.is(":checkbox")) {
			            element.prop('disabled', !triggerValue);
			        } else if (element.is("tr")) {
			            element.find('input, select, textarea').prop('disabled', !triggerValue);
			        } else {
			            element.prop('disabled', !triggerValue);
			        }
			    });
			}
			
			// Disable all fields by default when the page loads
    		toggleInputs(false);
						
			//Setting up a trigger to check if the header is populated
			$(document).ajaxComplete(function(event, jqxhr, settings) {
			    if (settings.url.includes('checkSbiNoAndLocation')) {
			        if (jqxhr.status === 200) {
			            $(document).trigger('apiCallSuccess');
			        } else {
			            $(document).trigger('apiCallFailure');
			        }
			    }
			});
			
			// Doms and Function declaration that will only take effect if this trigger is set
		    $(document).on('apiCallSuccess', function() {
				
				// Enabling inputs after a successful api call
    			toggleInputs(true);
    			
    			$('#save-button').on('click', function() {
					if (insertOrupdate.insert){
					    if (!areFieldsEmpty()) {
					        saveCsmnData(populateCsmnSave());
					    }else{
							alert('Save cannot proceed since there is no data in one or more fields.');
						}
				    } else if (insertOrupdate.update) {
				        submitAllAmendments();
				    } else {
				        console.error("Neither insert nor update flag is set. Cannot determine action.");
				    }
				});
				
				//function to populate the save object			
				function populateCsmnSave(){				
					var csmnContTm;
					var	csmnContDt;
					var contTpCd;
					var csmnContSprvNegFlg;
					var correctionFlag;
					var resnCdNegCont;
					var csmnContInitDdocFlg;
					var csmnContComnt;
					
					var contDate= $('#contact-date-sv').val();
					
			        csmnContDt = formattedDate(contDate);
			        csmnContTm = $('#contact-time-sv').val();
			        contTpCd = $('#selectTypeOfContact').find('option:selected').val();
			        csmnContSprvNegFlg = $('#NegativeCheckf').prop('checked') ? 'Y' : 'N';
			        resnCdNegCont = $('#neg-reasons-sv').find('option:selected').val();
			        csmnContInitDdocFlg = $('#InitiatedDDOC').prop('checked') ? 'Y' : 'N';
			        csmnContComnt = $('#addCmntValShow').val();
			        		        
			       	csmnSave.csmnContTm = csmnContTm;
				    csmnSave.csmnContDt = csmnContDt;
				    csmnSave.contTpCd = contTpCd;
				    csmnSave.csmnContSprvNegFlg = csmnContSprvNegFlg;
				    csmnSave.correctedFlag = 'N';
				    csmnSave.resnCdNegCont = resnCdNegCont;
				    csmnSave.csmnContInitDdocFlg = csmnContInitDdocFlg;
				    csmnSave.csmnContComnt = csmnContComnt;
				    csmnSave.sbiNo = $('#sbiNumberInput').val();
				     		        
					return csmnSave;		          
				}
				
				//function to format date string
				function formattedDate(inputDate) {
				    var parts = inputDate.split('/');
				    var formattedDate = parts[2] + '-' + parts[0].padStart(2, '0') + '-' + parts[1].padStart(2, '0');			    
				    return formattedDate;
				}
				
				// function to check if any insert field is null or empty
				function areFieldsEmpty() {
				    const fields = [
				        '#contact-date-sv',
				        '#contact-time-sv',
				        '#selectTypeOfContact'
				    ];
				
				    for (let field of fields) {
				        if ($(field).val().trim() === '') {
				            return true;
				        }
				    }
				
				    return false;
				}
				
				// Function to save new case notes
			    function saveCsmnData(csmnSave) {
			        if (contactedPersons.length > 0) {
			            csmnSave.contactedPersons = contactedPersons;
			        }
			
			        $.ajax({
			            method: "POST",
			            url: contextPath + 'SaveCaseNotes',
			            contentType: 'application/json',
			            data: JSON.stringify(csmnSave),
			            success: function(response) {
			                if (response.status === "Success") {
			                    Swal.fire('Success', 'Case Notes saved successfully', 'success').then(function () {
									insertionRow();
			                        if (commitNo === null || commitNo === undefined) {
			                            getCaseNotes();
			                        } else {
			                            console.log(response.commitNo);
			                        }
			                    });
			                } else {
			                    Swal.fire('Warning', 'Error saving Case Notes', 'warning');
			                }
			            },
			            error: function(error) {
			                console.error('Error:', error);
			                Swal.fire('Error', 'Error saving Case Notes', 'error');
			            }
			        });
			    }
				
				// Initialize the array to store case amendments
				let caseAmendments = [];
				
				var currentCheckbox;
				
				$(document).on('change', '.addcmntCheck', function() {
				    currentCheckbox = $(this);
				    let row = $(this).closest('tr');
				    let commitNumber = row.data('commitNo');
				    let seqNum = row.data('sequenceNo');
				
				    // Store these values in global variables
				    window.currentCommitNo = commitNumber;
				    window.currentSeqNum = seqNum;
				
				    // Check if there's already an amendment for this row
				    let existingAmendment = caseAmendments.find(amendment => amendment.commitNo === commitNumber && amendment.csmnContSeqNum === seqNum);
				
				    if (existingAmendment) {
				        // If an amendment exists and the checkbox is checked, show delete confirmation modal
				        Swal.fire({
				            title: 'Do you want to delete the amendment?',
				            type: 'warning',
				            showCancelButton: true,
				            confirmButtonText: 'Yes',
				            cancelButtonText: 'No'
				        }).then((result) => {
				            if (result.value) {
				                // Remove the amendment from the array
				                caseAmendments = caseAmendments.filter(amendment => amendment.commitNo !== commitNumber || amendment.csmnContSeqNum !== seqNum);
				
				                // Save the updated array to session storage
				                sessionStorage.setItem('caseAmendments', JSON.stringify(caseAmendments));
				
				                Swal.fire('Deleted!', 'The amendment has been deleted.', 'success');
				                currentCheckbox.prop('checked', false);
				            } else {
				                currentCheckbox.prop('checked', true); // Re-check the checkbox if the user cancels
				            }
				        });
				    } else {
				        // Show the modal for adding a new amendment
				        $('#AddCmntModal').modal('show');
				
				        if (existingAmendment) {
				            $('#addComments').val(existingAmendment.csmnContComnt); // Populate with existing comment
				        } else {
				            $('#addComments').val(''); // Clear the textarea if no existing comment
				        }
				    }
				});
				
				// Event handler for the case amendment's first modal close buttons
				$('#AddCmntModal .btn-secondary, #AddCmntModal .close').on('click', function() {
				    if (currentCheckbox) {
				        currentCheckbox.prop('checked', false); // Uncheck the specific checkbox
				    }
				    window.currentCommitNo = null;
				    window.currentSeqNum = null;
				});
				
				// Event handler for the case amendment's second modal close buttons
				$('#AddCmntModal1 .btn-secondary, #AddCmntModal1 .close').on('click', function() {
				    if (currentCheckbox) {
				        currentCheckbox.prop('checked', false); // Uncheck the specific checkbox
				    }
				    window.currentCommitNo = null;
				    window.currentSeqNum = null;
				});
				
				// Event handler for the submit button case amendment in the modal
				$(document).on('click', '#addCmntValBtn', function() {
				    if (window.currentCommitNo && window.currentSeqNum) {
				        var caseAmendment = $('#addComments').val();
				        var existingIndex = caseAmendments.findIndex(amendment => amendment.commitNo === window.currentCommitNo && amendment.csmnContSeqNum === window.currentSeqNum);
				
				        var csmnAmend = {
				            commitNo: window.currentCommitNo,
				            csmnContSeqNum: window.currentSeqNum,
				            csmnContComnt: caseAmendment
				        };
				
				        if (existingIndex !== -1) {
				            caseAmendments[existingIndex] = csmnAmend; // Update existing amendment
				        } else {
				            caseAmendments.push(csmnAmend); // Add new amendment
				        }
				
				        // Save the array to session storage
				        sessionStorage.setItem('caseAmendments', JSON.stringify(caseAmendments));
				
				        console.log('Case Amendments:', caseAmendments);
				
				        Swal.fire('Success', 'Case Amendment Added to List Successfully', 'success');
				    } else {
				        console.log('Commit No or Sequence No is null');
				        Swal.fire('Error', 'Error adding an Amendment', 'error');
				    }
				});
				
				// Function to send all amendments to the server
				function submitAllAmendments() {
				    if (caseAmendments.length > 0) {
				        $.ajax({
						    url: contextPath + 'CaseAmendment',
						    type: 'POST',
						    contentType: 'application/json',
						    data: JSON.stringify(caseAmendments),
						    success: function (response) {
						        console.log('Success:', response);
						        getCaseNotes();
						        var successMessage = response.success + ' out of ' + response.total + ' amendments saved';
						        Swal.fire('Success', successMessage, 'success');
						        caseAmendments = [];
						        sessionStorage.removeItem('caseAmendments');
						    },
						    error: function (error) {
						        console.log('Error:', error);
						        Swal.fire('Warning', 'Error adding Amendments', 'warning');
						    }
						});
				    } else {
				        Swal.fire('Error', 'No Amendments to submit', 'error');
				    }
				}
				
				// Event handler for #input-contact-info click
				$('#input-contact-info').on('click', function() {
				    if (!insertOrupdate.insert) {
						// Clear selection from the dtBasicExample table
					    $('#dtBasicExample').DataTable().$('tr.selected').removeClass('selected');
					    $('#addCmntValShow').val("");
					    
					    updateCharCount();
						
						var timeText = $('#contact-time-sv').val();
					    $('#inputContactTime').val(timeText);
					    
					    var selectedText = $('#selectTypeOfContact').find('option:selected').text();
					    $('#inputTypeOfContact').val(selectedText);	
						
						var contactText = $('#contact-date-sv').val();
					    $('#inputContactDate').val(contactText);
					    
					        insertOrupdate.insert = true;
					        insertOrupdate.update = false;
					        disableAndEnableInputs();
					        clearInputFields(); 
					    } 
					contactedPersons = [];
				});
		
		    });
		    
		    // Reverting back Doms and Function during an unsucceful api call or if the call is not made
		    $(document).on('apiCallFailure', function() {
			    toggleInputs(false);
			});
	
			disableAndEnableInputs();
			
			//Removing existing session storage variable 
			sessionStorage.removeItem('caseAmendments');
			
			//function to clear data in contact information data table		    
			function clearCaseNotesHistoryTable() {
				var table = $('#contactHistoryTable').DataTable();
				table.clear().draw();
			}
			
			// Function to disable or enable input fields and rows
			function disableAndEnableInputs() {
			    let inserttable = $('#userroledetails');
			    let updatetable = $('#userroledetails-view');
			
			    if (insertOrupdate.insert === true) {
			        // Enable input fields with id addCmntValShow
			        $('#addCmntValShow').prop('disabled', false);
			        
			        // Hide the update table if not already hidden
			        if (!updatetable.hasClass('d-none')) {
			            updatetable.addClass('d-none');
			        }
			        
			        // Show the insert table if hidden
			        if (inserttable.hasClass('d-none')) {
			            inserttable.removeClass('d-none');
			        }
			       						
			    } else if (insertOrupdate.update === true) {
			        // Disable input fields with id addCmntValShow
			        $('#addCmntValShow').prop('disabled', true);
			        
			        // Hide the insert table if not already hidden
			        if (!inserttable.hasClass('d-none')) {
			            inserttable.addClass('d-none');
			        }
			        
			        // Show the update table if hidden
			        if (updatetable.hasClass('d-none')) {
			            updatetable.removeClass('d-none');
			        }
			    }
			}
			
			//Clear button
			function clearData() {
			    // Clear the csmnSave object
			    csmnSave = {
			        commitNo: null
			    };
			
			    // Set field variables to null
			    commitNo = null;
			    dateFromIp = null;
			    dateToIp = null;
			    typeOfContactIp = null;
				relationshipIp = null;
			    resultsIp = null;
			    currentCheckbox = null;
			
			    $('#dateFrom-ip').val('');
			    $('#dateTo-ip').val('');
			    $('#results-ip').val('');
			    $('#contact-date-sv').val('');
			    $('#contact-time-sv').val('');
			    $('#addCmntValShow').val('');		
			
			    // Clear data in contact information data table
			    clearCaseNotesTable();
			    
			    //Unchecks all checkboxes
			    $('input[type="checkbox"]').prop('checked', false);
			    
			    //Selects default value for all dropdowns
			    $('select').each(function() {
			        $(this).val($(this).find('option:first').val());
			    });
			    
			    // Clear data in contact history data table and in session storage
			    clearCaseNotesHistoryTable();
			    sessionStorage.removeItem('caseAmendments');
			    caseAmendments = [];
			    
			    //Reverting the trigger back to failure to disable all input fields and save buttons
			    $(document).trigger('apiCallFailure');  
			}
			
			/* $('#clear-button').on('click', function(){
				clearData();
				clearRelationshipTable();
				clearFormHeaderData(); //The function declaration for this function is in form Header inside the static/js/staticjs.js
			}); */
			
			//Function to clear out value in the insert field after saving
			function insertionRow(){
				$('#dateFrom-ip').val('');
				$('#dateTo-ip').val('');
				$('#results-ip').val('');
				$('#contact-date-sv').val('');
				$('#contact-time-sv').val('');
				$('#addCmntValShow').val('');
			    $('#selectTypeOfContact').val($('#selectTypeOfContact option:first').val());
			    $('#neg-reasons-sv').val($('#neg-reasons-sv option:first').val());
			    clearRelationshipTable();
			}
						
			// Function to clear input fields
			function clearInputFields() {
			    $('#inputTypeOfContact').val('');
			    $('#inputContactDate').val('');
			    $('#inputContactTime').val('');
			}
			
			// Event handlers that updates value of type of contact, contact date and time in contacted persons tab
			$('#selectTypeOfContact').change(function() {
			    var selectedText = $('#selectTypeOfContact').find('option:selected').text();
			    $('#inputTypeOfContact').val(selectedText);
			});
			
			$('#contact-date-sv').change(function() {
			    var contactText = $('#contact-date-sv').val();
			    $('#inputContactDate').val(contactText);
			});
			
			$('#contact-time-sv').change(function() {
			    var timeText = $('#contact-time-sv').val();
			    $('#inputContactTime').val(timeText);
			});
			
			$('#addCmntValShow').on('input', function() {
				updateCharCount();
            });
		
			//Contact Person Tab
			
			//Nav link for contact person tab
			let contactedPersons = [];
			
		    $('a.nav-link[href="#Contect_Person"]').on('click', function() {
				if(insertOrupdate.update){
				    if (selectedCommitNo !== null && selectedSequenceNo !== null) {
				        getContactedPersons(selectedCommitNo, selectedSequenceNo);    
				    	}
				   }
			    $('#userroledetails-view tbody').empty();
			});
			
			// Function to retrieve ISC flag and date
			function iscFlagAndDate() {
			    var sbiNumber = $('#sbiNumberInput').val();
			    $.ajax({
			        method: "POST",
			        url: contextPath + 'IscRequestedData',
			        contentType: 'application/json',
			        data: JSON.stringify(sbiNumber), // Ensure sbiNumber is sent as JSON string
			        success: function(response) {
			            console.log(response);
			            if (response.ISC && response.ISC.length > 0) {
			                var iscData = response.ISC[0];
			                
			                // Set ISC Approved checkbox
			                if (iscData.iscApprovedFlag === "Y") {
			                    $('#isc-approved').prop('checked', true);
			                } else {
			                    $('#isc-approved').prop('checked', false);
			                }
			                
			                // Set ISC Transfer Date
			                if (iscData.iscRequestedDateBox) {
			                    var date = new Date(iscData.iscRequestedDateBox);
			                    var formattedDate = (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
			                    $('#isc-transferDate').val(formattedDate);
			                }
			            }
			        },
			        error: function(error) {
			            console.error('Error:', error);
			            console.log(error.responseText);
			        }
			    });
			}
			
			function getContactedPersons(commitNum, contactSeqNum) {
			    $.ajax({
			        method: "POST",
			        url: contextPath + 'ContactedPersons',
			        contentType: 'application/json',
			        data: JSON.stringify({ commitNum: commitNum, contactSeqNum: contactSeqNum }),
			        success: function(response) {
			            populateRelationshipTable(response.ContactedPersons)
			        },
			        error: function(error) {
			            console.error('Error:', error);
			            console.log(error.responseText);
			        }
			    });
			}
						
			$(document).on('click', '.add-row', function(e) {
			    e.preventDefault();
			
			    let currentRow = $(this).closest('tr');
			
			    // Validate mandatory fields
			    let firstName = currentRow.find('.first-name').val().trim();
			    let lastName = currentRow.find('.last-name').val().trim();
			    let relation = currentRow.find('.relationshipwithOffender').val();
			
			    if (firstName === '' || lastName === '' || relation === '') {
			        alert('First Name, Last Name, and Relation With Offender are mandatory.');
			        return;
			    }
			
			    // Add row data to contactedPersons array
			    let newRowData = {
			        relationshipCode: relation,
			        contLname: lastName,
			        contFname: firstName,
			        contMname: currentRow.find('.middle-name').val().trim(),
			        contSname: currentRow.find('.suffix').val().trim()
			    };
			    contactedPersons.push(newRowData);
			
			    // Disable input fields and hide the add-row button
			    saveRow(currentRow);
			
			    // Add edit and remove buttons to the newly saved row
			    let actionCell = currentRow.find('td').last();
			    if (!actionCell.find('.remove-row').length) {
			        actionCell.append('<a href="#" class="btn btn-danger btn-sm p-1 ml-2 btn js-waves-off remove-row" data-toggle="tooltip" data-placement="top" data-original-title="Remove Row" data-class="nav-function-hidden"><i class="fa fa-times"></i></a>');
			    }
			    if (!actionCell.find('.edit-row').length) {
			        actionCell.append('<a href="#" class="btn btn-info btn-sm p-1 ml-2 btn js-waves-off edit-row" data-toggle="tooltip" data-placement="top" data-original-title="Edit Row" data-class="nav-function-hidden"><i class="fa fa-pencil"></i></a>');
			    }
			
			    // Update the data index for the current row
			    currentRow.data('index', contactedPersons.length - 1);
			
			    // Add a new input row
			    if (currentRow.next('.relationship-row-input').length === 0) {
			        addNewRow();
			    }
			});
			
			//Function that creates new input rows in the table
			function addNewRow() {
			    let inputRow = $('.relationship-row-input').first().clone();
			    inputRow.removeClass('data-row')
			        .find('input').val('').prop('disabled', false);
			    inputRow.find('select').val('').prop('disabled', false);
			
			    inputRow.find('.save-row').hide();
			    inputRow.find('.add-row').show();
			    inputRow.find('.btn').removeClass('btn-disabled-relationship');
			
			    inputRow.find('.edit-row').remove();
			    inputRow.find('.remove-row').remove();
			
			    if (!inputRow.find('.add-row').length) {
			        inputRow.find('td').last().append('<a href="#" class="btn btn-info btn-sm p-1 ml-2 btn js-waves-off add-row" data-toggle="tooltip" data-placement="top" data-original-title="Add Row" data-class="nav-function-hidden"><i class="fa fa-plus"></i></a>');
			    }
			
			    $('#userroledetails tbody').append(inputRow);
			}
			
			$(document).on('click', '.save-row', function(e) {
			    e.preventDefault();
			
			    let currentRow = $(this).closest('tr');
			    let rowIndex = currentRow.data('index');
			
			    let firstName = currentRow.find('.first-name').val().trim();
			    let lastName = currentRow.find('.last-name').val().trim();
			    let relation = currentRow.find('.relationshipwithOffender').val();
			
			    if (firstName === '' || lastName === '' || relation === '') {
			        alert('First Name, Last Name, and Relation With Offender are mandatory.');
			        return;
			    }
			
			    contactedPersons[rowIndex] = {
			        relationshipCode: relation,
			        contLname: lastName,
			        contFname: firstName,
			        contMname: currentRow.find('.middle-name').val().trim(),
			        contSname: currentRow.find('.suffix').val().trim()
			    };
			
			    saveRow(currentRow);
			});
			
			//Function to save the data to the table
			function saveRow(row) {
			    row.find('input, select').prop('disabled', true);
			    row.find('.save-row').hide();
			    row.find('.edit-row').show();
			    row.find('.add-row').hide();
			}
			
			$(document).on('click', '.remove-row', function(e) {
			    e.preventDefault();
			    let row = $(this).closest('tr');
			    removeRow(row);
			    console.log('Removing row:', row.index());
			});
			
			function removeRow(row) {
			    let index = row.data('index');
			    contactedPersons.splice(index, 1);
			    row.remove();
			    console.log('Contacted Persons:', contactedPersons);
			
			    if ($('#userroledetails tbody tr').length === 0) {
			        addNewRow();
			    }
			}
			
			// Event listener for editing a row
			$(document).on('click', '.edit-row', function(e) {
			    e.preventDefault();
			    let row = $(this).closest('tr');
			    editRow(row);
			    console.log('Editing row:', row.index());
			});
			
			function editRow(row) {
			    row.find('input, select').prop('disabled', false);
			
			    row.find('.save-row').remove();
			
			    let actionCell = row.find('td').last();
			    actionCell.append('<a href="#" class="btn btn-success btn-sm p-1 ml-2 btn js-waves-off save-row" data-toggle="tooltip" data-placement="top" data-original-title="Save Row" data-class="nav-function-hidden"><i class="fa fa-check"></i></a>');
			
			    row.find('.edit-row').hide();
			}
		    
			function populateRelationshipTable(caseNotes) {
			    var templateRow = $('#relationships-details').clone();
			    
			    // Remove the id from the cloned row 
			    templateRow.removeAttr('id').addClass('data-row');
			
			    // Function to populate data into a row
			    function populateRow(row, data) {
			        row.find('.relationshipwithOffender').val(data.relationshipCode).prop('disabled', true);
			        row.find('.last-name').val(data.contLname).prop('disabled', true);
			        row.find('.first-name').val(data.contFname).prop('disabled', true);
			        row.find('.middle-name').val(data.contMname).prop('disabled', true);
			        row.find('.suffix').val(data.contSname).prop('disabled', true);
			        
			        // Invalidate the tools and change their colors
			        row.find('.btn').addClass('btn-disabled-relationship');
			    }
			    
			    // Clear existing rows 
			    $('#userroledetails-view tbody').empty();
			    
			    // Clone the template row and populate for each data entry
			    for (var i = 0; i < caseNotes.length; i++) {
			        var newRow = templateRow.clone();
			        populateRow(newRow, caseNotes[i]);
			        $('#userroledetails-view tbody').append(newRow);
			    }
			}
			
			// Function to clear all data rows except the last input row
			function clearRelationshipTable() {
			    $('#userroledetails tbody tr:not(:last)').remove(); 
			    contactedPersons = []; 
			}
			
			function clearPopulateRelationshipTable() {
			    $('#userroledetails tbody').remove(); 
			}
		
		});
		
		// Define Test Data
$(document).ready(function () {
	
	if ($('#UserListValue2')) {
		  $('#UserListValue2').css('opacity', '0.5');
		}
	
    const dateInputs = document.querySelectorAll('.DateVerify');
    const today = new Date();
    const todayString = today.toISOString().split('T')[0]; // YYYY-MM-DD
    const currentYear = today.getFullYear();
	
	  dateInputs.forEach(dateInput => {
	      // Ensure the dateInput is a valid DOM element
	      if (dateInput instanceof HTMLInputElement) {
	        // Set max attribute for each input
	        dateInput.setAttribute('max', todayString);

	        // Handle manual input
	        dateInput.addEventListener('blur', () => {
	          const inputValue = dateInput.value;
	          if (!inputValue) return;

	          const inputDate = new Date(inputValue);
	          if (isNaN(inputDate.getTime())) return; // Invalid date

	          const inputYear = inputDate.getFullYear();

	          if (inputDate > today) {
	            // Replace year with current year
	            const correctedDate = new Date(inputDate);
	            correctedDate.setFullYear(currentYear);

	            // Ensure corrected date is not in future
	            if (correctedDate > today) correctedDate.setTime(today.getTime());

	            const correctedString = correctedDate.toISOString().split('T')[0];
	            dateInput.value = correctedString;
	          }
	        });
	      }
	    });
	
/////////////////////////////////////////////////////////////////////////////////////////////////////////
	  const maxLength = 4000;
	  const textarea = document.getElementById('addCmntValShow');
	  const charCount = document.getElementById('charCount');
	  let previousLength = 0;
	  // Function to update the character count
	 function updateCharCount1() {
  const currentLength = textarea.value.length;

  if (currentLength > maxLength) {
    textarea.value = textarea.value.substring(0, maxLength);
    message('CUCW',0,0);
    if (previousLength < maxLength) {
      showMaxLengthAlert();
    }
  }

  charCount.textContent = `${textarea.value.length}/4000 characters`;
  previousLength = textarea.value.length;
}
	  
	  // Add event listener to update character count on each input
	  textarea.addEventListener('input', updateCharCount1);
	
	  textarea.addEventListener('paste', function (e) {
		    let pastedText = e.clipboardData.getData('text');
		    if (pastedText.length + textarea.value.length > maxLength) {
		     console.log('textarea.value.length='+textarea.value.length);
		    	e.preventDefault(); 
		      message('CUW',"Maximum character length reached! You cannot paste more text or You cannot able to type.",0);
		    }
		  });
/////////////////////////////////////////////////////////////////////////////////////////////////////////
 const maxLength1 = 4000;
	  const textarea1 = document.getElementById('addCommentsAmendment');
	  const charCount1 = document.getElementById('AmendmentcharCount');
	  let previousLength1 = 0;
	  
	 function updateCharCount2() {
  const currentLength = textarea1.value.length;

  if (currentLength > maxLength1) {
    textarea1.value = textarea1.value.substring(0, maxLength1);
    message('CUCW',0,0);
    if (previousLength1 < maxLength1) {
      showMaxLengthAlert();
    }
  }

  charCount1.textContent = `${textarea1.value.length}/4000 characters`;
  previousLength1 = textarea1.value.length;
}
	  
	  // Add event listener to update character count on each input
	  textarea1.addEventListener('input', updateCharCount2);
	
	  textarea1.addEventListener('paste', function (e) {
		    let pastedText = e.clipboardData.getData('text');
		    if (pastedText.length + textarea1.value.length > maxLength1) {
		     console.log('textarea1.value.length='+textarea1.value.length);
		    	e.preventDefault(); // Prevent paste if the resulting length exceeds maxLength
		      message('CUW',"Maximum character length reached! You cannot paste more text or You cannot able to type.",0);
		    }
		  });
/////////////////////////////////////////////////////////////////////////////////////////////////////////
	  
	var contactTypeValuesTabledropdown = {};
	var negativeReasonValuesTabledropdown = {};
	var relationshipValuesTabledropdown = {};
	
	
	
	$('#clear-button').on('click', function () {
	
		$('#AllDataValueNotes').prop('checked', false);
		 $ ('#ContactTypeDropdown').val($('#ContactTypeDropdown option:first').val());
		 $('#RelationshipDropdown').val($('#RelationshipDropdown option:first').val());
		 $('#results-ip').val($('#results-ip option:first').val()); 
		
	 document.querySelectorAll('.CSMvalueclear').forEach(function(element) {
	        	        element.value = '';
	        	    });
	 
	 
	 tabledatacontacttype=[];
	 tabledatacontactperson=[];
	 tabledatahistory=[];

	 				 var numRecords=11;
					 var numRecordsH=5;
	 				tabledatacontacttype = Array.from({ length: numRecordsH }, () => ({
	 					checkbox: "",
	 					contactDate: "",
	 					time: "",
	 					typeContact: "",
	 					enteredDate: "",
	 					enteredtime: "",
	 					checkbox1: "",
	 					checkbox2: "",
	 					checkbox3: "t",
	 					negativereason: "",
	 					enteredlfms: "",
	 	   		        }));

	 					   tabledatacontactperson = Array.from({ length: numRecords }, () => ({
	 						id: "",
	 	                    relationOffender: "",
	 	                    lastName: "",
	 	                    firstName: "",
	 	                    mi: "",
	 	                    suffix: "",
	 						   }));


	 						   tabledatahistory = Array.from({ length: numRecordsH }, () => ({
	 							id: "",
	 	                         contactDate: "",
	 	                         contactTime: "",
	 	                         typeContact: "",
	 	                         enteredDate: "",
	 	                         enteredTime: "",
	 	                         checkbox: "",
	 	                         checkbox1: "",
	 	                         negativeReasons: "",
	 	                         enteredBy: "",
	 							   }));

								   tableContact.setData(tabledatacontacttype);
								   tablecontactperson.setData(tabledatacontactperson);
								   table.setData(tabledatahistory);
	 							//   HistoryTable(tabledatahistory);

	 							updateCharCount1();
	 							
	 							  $('.imageContainerPhoto').attr('src', "img/demo/avatars/avatar-admin-lg.png");
	 							  clearFormHeaderData();
	 							 $('#sbiNumberInput').focus();
	});
		

	function convertDateFormat(dateString) {
		// If the dateString is an array (multiple dates)
		if (Array.isArray(dateString)) {
			return dateString
				.map(date => {
					if (date.trim() === '') {
						return '';  // Return empty string for empty date entries
					}

					const parts = date.split('/');
					if (parts.length === 3) {
						const [month, day, year] = parts;
						return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
					}

					return '';  // Return empty string if format is incorrect
				})
				.join(','); // Join multiple dates with a comma if needed
		} 
		// If it's a single date (comma-separated)
		else {
			const parts = dateString.split(',');
			return parts
				.map(date => {
					if (date.trim() === '') {
						return '';  // Return empty string for empty date entries
					}

					const [month, day, year] = date.split('/');
					return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
				})
				.join(','); // Join multiple dates with a comma if needed
		}
	}
	
	$('#searchButton').on('click', function() {
		var idt_cont_from_dt="1900-01-01";
		var idt_cont_to_dt="3000-12-31";
		var ivc_relationship_code=null;
		var ivc_results=null;
		var ivc_cont_tp_cd= null;
		var sbiNumber=$('#sbiNumberInput').val();
		  var screenName = document.getElementById('screenNameHolder').textContent;
		  var screenCode = document.getElementById('screenNameHolder').dataset.name;
		  loader(1);
		  insertSBISearch(screenCode,screenName,sbiNumber);
		$.ajax({
			method: "GET",
	        url: contextPath + 'getCurrentCommitNo',
	        data: {
	        	sbiNumber:sbiNumber,  
	        },
	        success: function(response) {
	        	var selectedCommit =response;
	        	$('#SeqOFContactInformation').attr('data-commitNo-type', selectedCommit);
			
			 MainQueryvalue(selectedCommit,idt_cont_from_dt,idt_cont_to_dt,ivc_relationship_code,ivc_results,ivc_cont_tp_cd);
			 Nosc(selectedCommit);

	        },
		  error: function(error) {
	          console.error('Error:', error);
	          console.log(error.responseText);
	      }
		});
		caseNotesHistory(sbiNumber)
	});
	
	$('#SELECTValue-Main').on('click', function() {
		
	   	var Fdate=$('#dateFrom-ip').val();
	 	var FdateC=convertDateFormat(Fdate);
		var idt_cont_from_dt= FdateC || "1900-01-01";
		var TdateNew=$('#dateTo-ip').val();
		var TdateNewC=convertDateFormat(TdateNew);
		var idt_cont_to_dt=TdateNewC || "3000-12-31";
		var ivc_relationship_code=$('#RelationshipDropdown').val();
		var ivc_results=$('#ReasonMstDropdown').val();
		var ivc_cont_tp_cd=$('#ContactTypeDropdown').val();
		var selectedCommit =document.querySelector('#SeqOFContactInformation').getAttribute('data-commitNo-type');
		loader(1);
				 MainQueryvalue(selectedCommit,idt_cont_from_dt,idt_cont_to_dt,ivc_relationship_code,ivc_results,ivc_cont_tp_cd);  
			
			 
		});
	
	if (window.tablehistory) {
		tablehistory.on("rowClick", function (e, row) {
			var sbiNumber = $('#sbiNumberInput').val();
			var selectedCommit = localStorage.getItem('selectedCommitNo');
			var idt_cont_from_dt="1900-01-01";
			var idt_cont_to_dt="3000-12-31";
			var ivc_relationship_code=null;
			var ivc_results=null;
			var ivc_cont_tp_cd= null;
            console.log('valuecheck='+selectedCommit);
			document.querySelectorAll('.InmateInformation').forEach(function(element) {
    	        element.value = '';
    	    });
			$('#SeqOFContactInformation').attr('data-commitNo-type', selectedCommit);
			loader(1);
			 Nosc(selectedCommit);
			caseNotesHistory(sbiNumber);
			MainQueryvalue(selectedCommit,idt_cont_from_dt,idt_cont_to_dt,ivc_relationship_code,ivc_results,ivc_cont_tp_cd);
		});
		}
	
	 function Nosc(selectedCommit){
			$.ajax({
				method: "GET",
		        url: contextPath + 'CSMNOSC',
		        data: {
		        	ivc_commit_no:selectedCommit,  
		        },
		        success: function(response) {
		        	$.each(response, function(index, item) {
		        		
		        		if(item.ISC_REQUESTED_DATE_BOX===null){
		        			item.ISC_REQUESTED_DATE_BOX="";
				         }
		        		var Date=convertToMMDDYYYY(item.ISC_REQUESTED_DATE_BOX);
		        		$('#isc-transferDate').val(Date);
		        		
		        		if(item.ISC_APPROVED_FLAG==='Y'){
		        			$('#isc-approved').prop('checked', true);
		        		}
		        		
		        	});
		        },
			  error: function(error) {
		          console.error('Error:', error);
		          console.log(error.responseText);
		      }
			});
		}
	
	/*  function formatName(fullName) {
		    const parts = fullName.trim().split(/\s+/); // Split by any number of spaces

		    if (parts.length >= 2 && parts.length <= 4) {
		        return parts.join(",");
		    } else {
		        return "";
		    }
		} */
	 
		function MainQueryvalue(selectedCommit,idt_cont_from_dt,idt_cont_to_dt,ivc_relationship_code,ivc_results,ivc_cont_tp_cd){
			$.ajax({
				method: "GET",
		        url: contextPath + 'CaseNotesData',
		        data: {
		        	ivc_commit_no:selectedCommit,
		        	idt_cont_from_dt:idt_cont_from_dt,
		        	idt_cont_to_dt:idt_cont_to_dt,
		        	ivc_relationship_code:ivc_relationship_code,
		        	ivc_results:ivc_results,
		        	ivc_cont_tp_cd:ivc_cont_tp_cd
		        },
		        success: function(response) {
		        	
		        	if(response.length > 0){
		        		$('#AllDataValueNotes').prop('checked', true);
		        		
		        	}else{
		        		$('#AllDataValueNotes').prop('checked', false);
		        		
		        	}
		        	tabledatacontacttype=[];
		        	$.each(response, function(index, item) {
		        		
		        		var contactDate=convertToMMDDYYYY(item.CSMN_CONT_DT);
		        		var time=item.CSMN_CONT_TM;
		        		var typeContact=item.CONT_TP_DESC;
		        		var enteredDate=convertToMMDDYYYY(item.INSERTED_DATE_TIME);
		        		var enteredtime=item.INSERTED_TIME;
		        		var checkbox1=item.CSMN_CONT_SPRV_NEG_FLG;
		        		var checkbox2=item.CORRECTION_FLAG;
		        		var negativereason=item.RESN_DESC;
		        		var enteredlfms=formatName(item.USER_NAME);
		        		var CMTcontactType=item.CSMN_CONT_COMNT;
		        		var checkbox3='';
		        		var checkbox=false;
		        		var Newclass='CSMContactInformation';
		        		var SeqNo=item.CSMN_CONT_SEQ_NO;
		        		var UL=item.USER_LAST_NAME=== null ? '' : item.USER_LAST_NAME;
		        		var UF=item.USER_FIRST_NAME=== null ? '' : item.USER_FIRST_NAME;
		        		var UM=item.USER_MID_NAME=== null ? '' : item.USER_MID_NAME;
		        		var US=item.USER_SUFFIX_NAME=== null ? '' : item.USER_SUFFIX_NAME;
		        		var UserLFMS=UL+' '+UF+' '+UM+' '+US;
		        		var convertedLFMS=formatName(UserLFMS);
		        		var flagDDOC=item.CSMN_CONT_INIT_DDOC_FLG;

		        		tabledatacontacttype.push({
		        			id:SeqNo,
		        			contactDate: contactDate,
		        			time: time,
		        			typeContact: typeContact,
		        			enteredDate: enteredDate,
		        			enteredtime: enteredtime,
		        			checkbox1: checkbox1 === "Y" ? true : false,
		        			checkbox2: checkbox2 === "Y" ? true : false,
		        			checkbox3: checkbox3,
		        			negativereason: negativereason,
		        			enteredlfms: enteredlfms,
		        			CMTcontactType: CMTcontactType,
		        			checkbox: checkbox,
		        			Seqno:item.CSMN_CONT_SEQ_NO,
		        			CommitNo: item.COMMIT_NO,
		        			GetEditableRow: Newclass,
		        			flagDDOC: flagDDOC,
		        			InitiatedUserName: convertedLFMS,
		        			addClassRow: false
		        		   });
		        		
		        	});
		        	
		        	if(response.length<=5){
		        	var numRecordsTabulator=5;
		        	var Dlength=response.length;
		        	 var extraRecord=numRecordsTabulator-Dlength;
		    		var tabledatacontacttypeExtra = [];
		        	tabledatacontacttypeExtra = Array.from({ length: extraRecord }, () => ({
		            	 id: "",
				checkbox: "",
				contactDate: "",
				time: "",
				typeContact: "",
				enteredDate: "",
				enteredtime: "",
				checkbox1: "",
				checkbox2: "",
				checkbox3: "",
				negativereason: "",
				enteredlfms: "",
							   }));
		        	tabledatacontacttype=tabledatacontacttype.concat(tabledatacontacttypeExtra);
		        	}
		        	tableContact.setData(tabledatacontacttype);
		        	
		        },
		        complete: function (response){
   		        	setTimeout(function (){
   		        		loader(0);
   		        	},1500)
   		        },
			  error: function(error) {
		          console.error('Error:', error);
		          loader(0);
		          console.log(error.responseText);
		      },
			});
		}
	
		function convertToMMDDYYYY(dateString) {
			  if (dateString) {
			    const date = new Date(dateString);
			    const formattedMonth = String(date.getUTCMonth() + 1).padStart(2, '0');
			    const formattedDay = String(date.getUTCDate()).padStart(2, '0');
			    const formattedYear = date.getUTCFullYear();
			    return `${formattedMonth}/${formattedDay}/${formattedYear}`;
			  }
			  return '';
			}
	
		function convertToMMDDYYYY1(dateString) {
			if (dateString) {
			var date = new Date(dateString);
			var formattedMonth = (date.getMonth() + 1).toString().padStart(2, '0');
			var formattedDay = date.getDate().toString().padStart(2, '0');
			var formattedYear = date.getFullYear().toString();
			var formattedDate = formattedMonth + '/' + formattedDay + '/' + formattedYear;
			return formattedDate;
			}
			return '';
			}
		
	function caseNotesHistory(sbiNumber) {
	    $.ajax({
	        method: "GET",
	        url: contextPath + 'CSMNOSChistory',
//	        contentType: 'application/json',
	        data: {
	        	ivc_sbi_no:sbiNumber,  
	        },
	        success: function(response) {
	        	tabledatahistory=[];
	        //    $('#contactHistoryTable tbody').empty();
	        
	        var previousCommitNo = null; // Track the previous commit number
            var colorcode = 'EvenCommit';
	        
	            $.each(response, function(index, item) {
	            	var Idate=item["TO_CHAR(B.INSERTED_DATE_TIME,'HH24:MI')"];
	            	var Name=item["C.USER_LAST_NAME||''||C.USER_FIRST_NAME||''||C.USER_MID_NAME||''||C.USER_SUFFIX_NAME"];
	            	var Name1=formatName(Name);
	            	var CSMN=convertToMMDDYYYY1(item.CSMN_CONT_DT);
	            	var InstD=convertToMMDDYYYY(item.INSERTED_DATE_TIME);
	            	var ISCtransferDate=convertToMMDDYYYY(item.ISC_REQUESTED_DATE_BOX);
	            	 if (item.COMMIT_NO !== previousCommitNo) {
	            		 colorcode = colorcode === 'EvenCommit' ? 'OddCommit' : 'EvenCommit'; // Toggle between Y and N
	            	    }
	            	    previousCommitNo = item.COMMIT_NO;
	            	   
	            	//var bgColorClass = getYNArray(item.COMMIT_NO) ? 'OddCommit' : 'EvenCommit';
	            	if(item.RESN_DESC===null){
                		item.RESN_DESC="";
			         }
	            	if(item.CSMN_CONT_SPRV_NEG_FLG===null){
                		item.CSMN_CONT_SPRV_NEG_FLG="";
			         }
	            	if(item.USER_FIRST_NAME===null){
	            		item.USER_FIRST_NAME="";
			         }
	            	if(item.USER_LAST_NAME===null){
	            		item.USER_LAST_NAME="";
			         }
	            	if(item.USER_MID_NAME===null){
	            		item.USER_MID_NAME="";
			         }
	            	if(item.USER_SUFFIX_NAME===null){
	            		item.USER_SUFFIX_NAME="";
			         }
	            	if(item.CORRECTION_FLAG===null){
	            		item.CORRECTION_FLAG="";
			         }
	            	tabledatahistory.push({
	            		contactDate: CSMN,
	            		contactTime: item.CSMN_CONT_TM,
	            		typeContact: item.CONT_TP_DESC,
	            		enteredDate: Idate,
	            		enteredTime: InstD,
	        			checkbox: item.CSMN_CONT_SPRV_NEG_FLG === 'N' ? '' : item.CSMN_CONT_SPRV_NEG_FLG ,
	        			checkbox1: item.CORRECTION_FLAG === 'N' ? '' : item.CORRECTION_FLAG,
	        			negativeReasons: item.RESN_DESC,
	        			enteredBy: Name1,
	        			CSMN_CONT_COMNT: item.CSMN_CONT_COMNT,
	        			ddoc: item.CSMN_CONT_INIT_DDOC_FLG,
	        			iscdate: item.ISCtransferDate,
	        			iscflag: item.ISC_APPROVED_FLAG,
	        			firstname: item.USER_FIRST_NAME,
	        			lastname: item.USER_LAST_NAME,
	        			middlename: item.USER_MID_NAME,
	        			suffixname: item.USER_SUFFIX_NAME,
	        			colorcode: colorcode
	        		   });
	            });
	            
	            if(response.length<=5){
	            var numRecords=5;
	            var tabledatahistoryExtra=[];
	            var Dlength=response.length;
	        	 var extraRecord=numRecords-Dlength;
	            tabledatahistoryExtra = Array.from({ length: extraRecord }, () => ({
						id: "",
                      contactDate: "",
                      contactTime: "",
                      typeContact: "",
                      enteredDate: "",
                      enteredTime: "",
                      checkbox: "",
                      checkbox1: "",
                      negativeReasons: "",
                      enteredBy: "",
						   }));
	            tabledatahistory=tabledatahistory.concat(tabledatahistoryExtra);
	            }
	            table.setData(tabledatahistory);
	          //  HistoryTable(tabledatahistory);
	        },
	        error: function(error) {
	            console.error('Error:', error);
	            console.log(error.responseText);
	        }
	    });
	}
	
		  function getOptionByValue(value) {
			  // Get the select element by id
			  const selectElement = document.getElementById('RelationshipDropdown');
			  
			  // Loop through the options to find the matching one
			  for (let option of selectElement.options) {
			    if (option.value === value) {
			    	
			    	console.log(option.text);
			      return option.text; // Return the full option element
			    }
			  }

			  return null; // Return null if no matching option is found
			}
	
		  
	function getthecontactperson(commitno,Seqno){
	 $.ajax({
	        method: "GET",
	        url: contextPath + 'ContactPersonvalue',
//	        contentType: 'application/json',
	         data: {
	        	ivc_commit_no :commitno,
	        	inu_csmn_cont_seq_no :Seqno
	        }, 
	        success: function(response) {
	        	tabledatacontactperson=[];
	            var ContactPersonvalue=response.CSMTableCP;
	            var relationshipcode=response.CPCodeDesc;

	            
	        	$.each(ContactPersonvalue, function(index, item) {
	        		
	        		var lastName=item.CONT_LNAME;
	        		var firstName=item.CONT_FNAME;
	        		var mi=item.CONT_MNAME;
	        		var suffix=item.CONT_SNAME;//   
	        		var Relationship=item.RELATIONSHIP_CODE; 
	        		var relationOffender=getOptionByValue(Relationship);
	        		
	        		tabledatacontactperson.push({
	        			relationOffender:relationOffender,
	        			lastName: lastName,
	        			firstName: firstName,
	        			mi: mi,
	        			suffix: suffix,
	        		});
	        	});
	        	
	        	if(ContactPersonvalue.length<=11){
	        		var tabledatacontactperson2=[];
	        		var numRecords=11;
	        	    var Dlength=ContactPersonvalue.length;
		        	var extraRecord=numRecords-Dlength;
		        	console.log('ContactPersonValue='+extraRecord+' '+Dlength);
		            tabledatacontactperson2 = Array.from({ length: extraRecord }, () => ({
		            	 id: "",
	        			    relationOffender: "",
	        			    lastName: "",
	        			    firstName: "",
	        			    mi: "",
	        			    suffix: "",
							   }));
	        	 
	        	 tabledatacontactperson=tabledatacontactperson.concat(tabledatacontactperson2);
	        	}
	        	 tablecontactperson.setData(tabledatacontactperson);
	        },
	        
	 });
	}
		
		var dateEditor = function (cell, onRendered, success, cancel) {
		    var input = document.createElement("input");
		    input.type = "text";
		    input.value = cell.getValue() || "";
		    input.setAttribute("maxlength", "10");
		    input.style.padding = "4px";
		    input.style.width = "100%";

		    var CN=cell.getData().CommitNo;
		    var ID=cell.getData().id;
		    
		    console.log('Just print'+CN+' '+ID);
		    
		     if (CN != undefined && ID != undefined) {
		        input.classList.add("disable-pointer");
		        // Optional: Disable editing logic too
		        input.disabled = true;
		        return input; // Prevent adding event listeners
		      } 
		    
		    $(input).datepicker({
		        dateFormat: "mm/dd/yy",
		        changeMonth: true,
		        changeYear: true,
		        yearRange: (function() {
			        var currentYear = new Date().getFullYear(); 
			        return (currentYear - 20) + ":" + (currentYear + 20); 
			    })(),
		        onSelect: function (dateText) {
		            success(dateText);
		            $(input).datepicker("hide");
		        }
		    });

		    
		    
		    // Automatically insert slashes
		    input.addEventListener("input", function (e) {
		        let value = input.value.replace(/\D/g, ""); // Remove all non-digits
		        if (value.length > 2 && value.length <= 4) {
		            value = value.slice(0, 2) + "/" + value.slice(2);
		        } else if (value.length > 4) {
		            value = value.slice(0, 2) + "/" + value.slice(2, 4) + "/" + value.slice(4, 8);
		        }
		        input.value = value;
		    });

		    input.addEventListener("keydown", function (e) {
		        const dateText = input.value.trim();
		        const isValid = /^\d{2}\/\d{2}\/\d{4}$/.test(dateText);

		        if (e.key === "Enter" || e.key === "Tab") {
		            e.preventDefault();
		            if (isValid) {
		                success(dateText);
		            } else {
		                cancel();
		            }
		        } else if (e.key === "Escape") {
		            cancel();
		        }
		    });

		    onRendered(function () {
		        input.focus();
		        input.select();
		    });

		    return input;
		};

		
		var checkboxEditor = function(cell, onRendered, success, cancel) {
		    var input = document.createElement("input");
		    input.type = "checkbox";
		    input.checked = !!cell.getValue();
		    input.classList.add("leader-editor-checkbox");
		    console.log('Just print'+cell.getData().CommitNo);
		     if (cell.getData().CommitNo === undefined) {
		        input.classList.add("disable-pointer");
		        // Optional: Disable editing logic too
		        input.disabled = true;
		        return input; // Prevent adding event listeners
		      } 
		    
		    input.addEventListener("change", function () {
		      success(input.checked);
		    });

		    input.addEventListener("keydown", function (e) {
		      if (e.key === "Enter") {
		        e.preventDefault();
		        input.checked = !input.checked;
		        success(input.checked);
		      } else if (e.key === "Escape") {
		        cancel();
		      }
		    });

		    onRendered(function () {
		      input.focus({ preventScroll: true });
		    });

		    return input;
		  };
		  
		  var checkboxEditorfield = function(cell, onRendered, success, cancel) {
			    var input = document.createElement("input");
			    input.type = "checkbox";
			    input.checked = !!cell.getValue();
			    input.classList.add("leader-editor-checkbox");
			    
			    var CN=cell.getData().CommitNo;
			    var ID=cell.getData().id;
			    
			    console.log('Just print'+CN+' '+ID);
			    
			     if (CN != undefined && ID != undefined) {
			        input.classList.add("disable-pointer");
			        // Optional: Disable editing logic too
			        input.disabled = true;
			        return input; // Prevent adding event listeners
			      } 
			    
			    input.addEventListener("change", function () {
			      success(input.checked);
			    });

			    input.addEventListener("keydown", function (e) {
			      if (e.key === "Enter") {
			        e.preventDefault();
			        input.checked = !input.checked;
			        success(input.checked);
			      } else if (e.key === "Escape") {
			        cancel();
			      }
			    });

			    onRendered(function () {
			      input.focus({ preventScroll: true });
			    });

			    return input;
			  };
			  
				// Checkbox formatter   
		   function checkboxFormatter(cell) {
				 	const checked = !!cell.getValue();
			    return `<input  type="checkbox" ${checked ? "checked" : ""} />`; 
			  } 
			
				  var TimeEnterable = function(cell, onRendered, success, cancel) {
					    var input = document.createElement("input");
					    input.setAttribute("type", "text");
					    input.setAttribute("maxlength", "5");
					    input.style.width = "100%";
					    input.value = cell.getValue() || "";
					    input.placeholder = "HH:MM";

					    // Ensure focus and selection on rendered input
					    onRendered(function() {
					        input.focus();
					        input.select();
					    });
					    var CN=cell.getData().CommitNo;
					    var ID=cell.getData().id;
					    
					    console.log('Just print'+CN+' '+ID);
					    
					     if (CN != undefined && ID != undefined) {
					        input.classList.add("disable-pointer");
					        // Optional: Disable editing logic too
					        input.disabled = true;
					        return input; // Prevent adding event listeners
					      } 
					   /*  if (!cell.getRow().getData().isNew) {
					        input.addEventListener('keydown', e => e.preventDefault());
					        input.addEventListener('paste', e => e.preventDefault());
					    } */
					    // Enforce valid time input
					    input.addEventListener("keydown", function(e) {
					        const key = e.key;

					        // Allow control keys (Backspace, Arrow keys, etc.)
					        if (["Backspace", "ArrowLeft", "ArrowRight", "Tab", "Delete"].includes(key)) return;

					        // Only digits are allowed
					        if (!/^[0-9]$/.test(key)) {
					            e.preventDefault();
					            return;
					        }

					        // Format and validate input to ensure HH:MM format
					        const raw = input.value.replace(/[^0-9]/g, "");
					        const pos = raw.length;

					        if (pos === 0 && !/[0-2]/.test(key)) {
					            e.preventDefault();
					        } else if (pos === 1 && raw[0] === "2" && !/[0-4]/.test(key)) {
					            e.preventDefault();
					        } else if (pos === 2 && !/[0-5]/.test(key)) {
					            e.preventDefault();
					        } else if (pos === 3 && !/[0-9]/.test(key)) {
					            e.preventDefault();
					        } else if (pos >= 4) {
					            e.preventDefault();
					        }
					    });

					    // Format the input as the user types
					    input.addEventListener("input", function() {
					        let val = input.value.replace(/[^0-9]/g, "");

					        if (val.length > 2) {
					            val = val.slice(0, 2) + ":" + val.slice(2, 4);
					        }

					        input.value = val.slice(0, 5); // Max length is 5 (HH:MM)
					    });

					    // Validate input on blur or when Enter is pressed
					    function validateAndSubmit() {
					        const value = input.value;
					        const regex = /^([01]\d|2[0-3]):([0-5]\d)$/;
					        if (regex.test(value)) {
					            success(value);
					        } else {
					            cancel();
					        }
					    }

					    // Listen for blur and Enter key press to validate
					    input.addEventListener("blur", validateAndSubmit);
					    input.addEventListener("keydown", function(e) {
					        if (e.key === "Enter") {
					            validateAndSubmit();
					        }
					    });
					    input.addEventListener('mousedown', function(e) {
					        input.focus();
					        input.select();
					    });
					    // Ensure clicking the input field focuses and selects it
					    /* input.addEventListener("click", function(e) {
					        e.stopPropagation();  // Prevent row selection behavior from triggering
					        input.focus();
					        input.select();
					    }); */

					    return input;
					};

					

				


		var numRecordsTabulator=5;
		
		var tabledatacontacttype = [];

	//	CSMContactType(tabledatacontacttype)
		tabledatacontacttype = Array.from({ length: numRecordsTabulator }, () => ({
		            	 id: "",
				checkbox: "",
				contactDate: "",
				time: "",
				typeContact: "",
				enteredDate: "",
				enteredtime: "",
				checkbox1: "",
				checkbox2: "",
				checkbox3: "",
				negativereason: "",
				enteredlfms: "",
							   }));
		var tableContact
//        function CSMContactType(tabledatacontacttype){
			
			  tableContact = new Tabulator("#contacttype-table1", {
				    layout: "fitColumns",
				    data: tabledatacontacttype,
				    height: '150px',
				    index: "id",
				    printAsHtml: true,
				    printStyled: true,
				    tabNavigation: true,
				     selectable: true,
				    selectableRangeMode: "none",
		 		       selectableRange:1, 
		 		      autoResize: true,

				  
				    clipboard:true,
				    clipboardCopyStyled:false,
				    clipboardCopyConfig:{
				    rowHeaders:false,
				    columnHeaders:false,
				    },

				    /* columnDefaults:{
				    	editor:"input",
				    	},  */
				    
				    columns: [
				    	{
							title: 'ID',
							editor: "input",
							visible: false,
							field: "id",
						},
						{
							title: 'upd',
							visible: false,
							field: "upd",
						},
						{
							title: 'rowid',
							visible: false,
							field: "rowid",
						},
						{
						    title: "Add Cmnt",
						    titleFormatter: (column) => setTitleDesc(column, 'Add_Cmnt_tableContact', 'Add Cmnt'),
						    headerTooltip:"Add Cmnt",
						    headerSort: false,
						    field: "checkbox",
						    hozAlign: "center",
						    sorter: customSorter,
						    formatter: checkboxFormatter,
						    editor: checkboxEditor,
						    width: 100,
						},
				    	 {
				    	    title: "Contact Date",
				    	    titleFormatter: (column) => setTitleDesc(column, 'contactDate_tableContact', 'Contact Date'),
				    	    headerTooltip:"Contact Date",
				    	    field: "contactDate",
				    	    editor:dateEditor,
				    	    cssClass: "enteredlfms-align-left",
				    	    sorter: customSorter,
				    	    cellMouseOver: function (e, cell) {
						          const data = cell.getRow().getData();
						          if (data.contactDate) {
						              showCustomTooltip(e, cell, `${data.contactDate}`);
						            }
						        },
						        cellMouseMove: moveCustomTooltip,
						        cellMouseOut: hideCustomTooltip,
				    	 /*       editable: function(cell) {
				    	        return cell.getRow().getElement().classList.contains('CSMContactInformationValues') 
				    	    },    */
				    	    width: 120,
				    	},
			             {
				    	    title: "Contact Time",
				    	    titleFormatter: (column) => setTitleDesc(column, 'ContactTime_tableContact', 'Contact Time'),
				    	    headerTooltip:"Contact Time",
				    	    field: "time",
				    	    editor: TimeEnterable,
				    	    cssClass: "enteredlfms-align-left",
				    	    sorter: customSorter,
				    	    cellMouseOver: function (e, cell) {
						          const data = cell.getRow().getData();
						          if (data.time) {
						              showCustomTooltip(e, cell, `${data.time}`);
						            }
						        },
						        cellMouseMove: moveCustomTooltip,
						        cellMouseOut: hideCustomTooltip,
				    	    cellClick: function (e, cell) {
				    	        cell.edit(); 
				    	      } ,
				    	    width: 100,  
				    	}, 
			            {
			                title: "Type of Contact",
			                titleFormatter: (column) => setTitleDesc(column, 'Type_of_Contact_tableContact', 'Type of Contact'),
			                headerTooltip:"Type of Contact",
			                field: "typeContact",
			                editor: "list",
			                cssClass: "enteredlfms-align-left",
			                sorter: customSorter,
			                cellMouseOver: function (e, cell) {
						          const data = cell.getRow().getData();
						          if (data.typeContact) {
						              showCustomTooltip(e, cell, `${data.typeContact}`);
						            }
						        },
						        cellMouseMove: moveCustomTooltip,
						        cellMouseOut: hideCustomTooltip,
			                editable: function(cell) {
			                    return cell.getRow().getElement().classList.contains('CSMContactInformationValues');
			                }, 
			                editorParams: {
			                	autocomplete:true,
			                	allowEmpty: true,
			                    listOnEmpty: true,
			                    verticalNavigation: true,
			                    values: [],
			                },
			                sorter: customSorter
			            },
				    	{
				        title: "Entered Date",
				    	 titleFormatter: (column) => setTitleDesc(column, 'Entered_Date_tableContact', 'Entered Date'),
				    	 headerTooltip:"Entered Date",
				    	    field: "enteredDate",
				    	    cssClass: "enteredlfms-align-left",
				    	    sorter: customSorter,
				    	    cellMouseOver: function (e, cell) {
						          const data = cell.getRow().getData();
						          if (data.enteredDate) {
						              showCustomTooltip(e, cell, `${data.enteredDate}`);
						            }
						        },
						        cellMouseMove: moveCustomTooltip,
						        cellMouseOut: hideCustomTooltip,
				    	    width: 120,
				    	},
				    	{
				    	    title: "Entered Time",
				    	    titleFormatter: (column) => setTitleDesc(column, 'Entered_Time_tableContact', 'Entered Time'),
				    	    headerTooltip:"Entered Time",
				    	    field: "enteredtime",
				    	    cssClass: "enteredlfms-align-left",
				    	    sorter: customSorter,
				    	    cellMouseOver: function (e, cell) {
						          const data = cell.getRow().getData();
						          if (data.enteredtime) {
						              showCustomTooltip(e, cell, `${data.enteredtime}`);
						            }
						        },
						        cellMouseMove: moveCustomTooltip,
						        cellMouseOut: hideCustomTooltip,
				    	    width: 120,
				    	},
				    	{
							title: "Negative",
							titleFormatter: (column) => setTitleDesc(column, 'Negative_tableContact', 'Negative'),
							headerTooltip:"Negative",
							headerSort: false,
							field: "checkbox1",
							 hozAlign: "center",
	 					 	 formatter: checkboxFormatter, // custom checkbox display
							  editor: checkboxEditorfield, 
							  hozAlign: "center", 
							width: 90,
						},
						{
							title: "Corrected",
							titleFormatter: (column) => setTitleDesc(column, 'Corrected_tableContact', 'Corrected'),
							headerTooltip:"Corrected",
							headerSort: false,
							field: "checkbox2",
							 hozAlign: "center",
							 formatter: checkboxFormatter, // custom checkbox display
							  editor: checkboxEditorfield, 
							width: 100,
						},
						{
						title: "STG",
						headerSort: false,
						titleFormatter: (column) => setTitleDesc(column, 'STG_tableContact', 'STG'),
						headerTooltip:"STG",
							field: "checkbox3",
							 hozAlign: "center",
							 formatter: function(cell) {
						            const value = cell.getValue();
						            const checked = value === "Y" ? "checked" : "N";
						            return `<input type="checkbox"  class="no-toggle-checkbox" ${checked} disabled />`;
						          },
							width: 70,
						},
						 {
			                title: "Negative Reasons",
			                titleFormatter: (column) => setTitleDesc(column, 'Negative_Reasons_tableContact', 'Negative Reasons'),
			                headerTooltip:"Negative Reasons",
			                field: "negativereason",
			                editor: "list",
			                cssClass: "enteredlfms-align-left",
			                sorter: customSorter,
			                cellMouseOver: function (e, cell) {
						          const data = cell.getRow().getData();
						          if (data.negativereason) {
						              showCustomTooltip(e, cell, `${data.negativereason}`);
						            }
						        },
						        cellMouseMove: moveCustomTooltip,
						        cellMouseOut: hideCustomTooltip,
			                editable: function(cell) {
				    	        return cell.getRow().getElement().classList.contains('CSMContactInformationValues') 
				    	    },
			                editorParams: {
			                	autocomplete:true,
			                	allowEmpty: true,
			                    listOnEmpty: true,
			                    valuesLookup: true,
			                    verticalNavigation: true,
			                    values: [] 
			                }, 
			            },
			            {
				    	    title: "Negative Reasons Value",
				    	    field: "negativereasonVal",
				    	    visible: false,
				    	},
				    	{
				    	    title: "Entered By(L,F,M,S)",
				    	    titleFormatter: (column) => setTitleDesc(column, 'Entered_By(L,F,M,S)_tableContact', 'Entered By(L,F,M,S)'),
				    	    headerTooltip:"Entered By(L,F,M,S)",
				    	    field: "enteredlfms",
				    	    hozAlign: "left",
				    	    cssClass: "enteredlfms-align-left",
				    	    sorter: customSorter,
				    	    cellMouseOver: function (e, cell) {
						          const data = cell.getRow().getData();
						          if (data.enteredlfms) {
						              showCustomTooltip(e, cell, `${data.enteredlfms}`);
						            }
						        },
						        cellMouseMove: moveCustomTooltip,
						        cellMouseOut: hideCustomTooltip,
				            cellClick: function(e, cell) {
				                
				                const column = cell.getColumn().getField();
				                if (column === 'enteredlfms') {
				                    document.getElementById("addCmntValShow").focus();
				                }
				            }
				    	},
				    	{
							title: 'ContactPersonSave',
							editor: "input",
							visible: false,
							field: "contactPersonValue",
						},
						{
							title: 'ContactTypeComment',
							editor: "input",
							visible: false,
							field: "CMTcontactType",
						},
						{
							title: 'CommitNo',
							editor: "input",
							visible: false,
							field: "CommitNo",
						},
						{
							title: 'DDOCFlag',
							editor: "input",
							visible: false,
							field: "flagDDOC",
						},
						{
							title: 'InitiatedUser',
							editor: "input",
							visible: false,
							field: "InitiatedUserName",
						},
						{
							title: 'UseriD',
							editor: "input",
							visible: false,
							field: "userID",
						},
				    ] ,rowFormatter: function(row) {
					var rowData = row.getData();   
				//	var eventClass1 ='CSMContactInformation' || null;
					var commentsType=rowData.CMTcontactType|| '';
					var Typeofcontact=rowData.typeContact || null;
					var CDate=rowData.contactDate || null;
					var contactPersinConnect=rowData.contactPersonValue || null;
					var CTime=rowData.time || null;
					var Sno=rowData.Seqno || null;
					var CommitNo=rowData.CommitNo || null;
					var getClassValue=rowData.GetEditableRow;
					var rowElement = row.getElement(); 
			//		rowElement.classList.add(eventClass1);
					rowElement.classList.add(getClassValue) || '';
					rowElement.setAttribute('data-contactPerson-type', contactPersinConnect);
					rowElement.setAttribute('data-COMMENTSCT-type', commentsType); 
					rowElement.setAttribute('data-Typeofcontact-type', Typeofcontact); 
					rowElement.setAttribute('data-CDate-type', CDate); 
					rowElement.setAttribute('data-CTime-type', CTime); 
					rowElement.setAttribute('data-SEQNO-type', Sno); 
					rowElement.setAttribute('data-CommitNo-type', CommitNo); 
				} 
				    });
			  
			  tabulatorRegistry["contacttype-table1"] = {
						varName: "tableContact",
						instance: tableContact
					};
			  
			  tableContact.on("cellEdited", function(cell) {
				    const rowData = cell.getRow().getData();
				    const row = cell.getRow(); // this was missing

				    if (cell.getColumn().getField() === "checkbox") {
				        const id = rowData.id;
				        const Commit = rowData.CommitNo;
				        if (cell.getValue() === true) {
				            console.log("it's work " + Commit + ' ' + id);
				            if(Commit&&id){
				            	 $('#SeqOFContactInformation').attr('data-AmendmentSeqNo-type', id);
				            	 $('#SeqOFContactInformation').attr('data-AmendmentCommitNo-type', Commit);
				            	$('#AddCmntModal').modal('show');
				            	console.log("Commit " + Commit + ' ' + id);
				            	
				            }
				        } else {
				        	
				        	console.log("it's not work");
				        }
				    }

				    const id = rowData.id;
			        const Commit = rowData.CommitNo;
			        
			        if(Commit&&id){
		            	console.log("Commit " + Commit + ' ' + id);
		            	$('.contactPersonDisableValue').css('pointer-events','none');
						$('.contactPersonDisableValue').prop('readonly', true);
						$('.contactPersonDisableValue').prop('disabled', true);
		            }else{
		            	$('.contactPersonDisableValue').prop('disabled', false);
			        	$('.contactPersonDisableValue').prop('readonly', false);
			        	$('.contactPersonDisableValue').css('pointer-events', 'auto');
			        	console.log("it's not work");
		            }
			        
				    window.currentRow = row;
				    window.currentRowData = rowData;

				    
				    $('#addCmntValShow').val(rowData.CMTcontactType);
				    updateCharCount1();
				    console.log('HC');
				});
			  
			  function uncheckCheckboxById(id) {
				    
				    const row = tableContact.getRow(id);

				    if (row) {
				        row.update({ checkbox: false }); 
				        console.log("Checkbox unchecked for ID:", id);
				    } else {
				        console.warn("Row not found with ID:", id);
				    }
				}

$(document).on('keydown', function(e) {
    if (e.key === 'Tab') {
        // Retrieve all selected ranges
        const ranges = tableContact.getRanges();

        // Check if there are any selected ranges
        if (ranges.length > 0) {
            // Get the first range (assuming single range selection)
            const range = ranges[0];

            // Retrieve the structured cells within the range
            const structuredCells = range.getStructuredCells();

            // Iterate through each row in the structured cells
            for (let rowCells of structuredCells) {
                // Iterate through each cell in the row
                for (let cell of rowCells) {
                    // Check if the cell's column title matches the target title
                    const columnTitle = cell.getColumn().getDefinition().title;
                    const targetTitle = 'Entered By(L,F,M,S)';

                    if (columnTitle === targetTitle) {
                        // Focus on the textarea
                        console.log('Focusing on textarea1');
                        document.getElementById("addCmntValShow").focus();
                        e.preventDefault(); // Prevent default tabbing behavior
                        return; // Exit after focusing
                    }
                }
            }
        }
    }
});


////////////////////
	  	 	let selectedRowContactPerson;
	  
			tableContact.on("rowClick", function (e, row) {
			 //   document.querySelectorAll('.tabulator-row').forEach(r => r.classList.remove('hovered-row'));
			    e.preventDefault()
			    // Add 'selected-row' class to the clicked row
			  //  row.getElement().classList.add('hovered-row');
			
				var rowData = row.getData();
				if(rowData.addClassRow){
					var Typeofcontact= rowData.typeContact || '';
					var ContactDate= rowData.contactDate || '';
					var ContactTime= rowData.time || '';
					var data = rowData.CMTcontactType;
					var Contactperson = rowData.contactPersonValue;
					var SeqConnectValue=rowData.id;
					var ULFMS=rowData.InitiatedUserName;
					var flag=rowData.flagDDOC;
					var userIDTC=rowData.userID
					$('#TypeOfContactclick').val(Typeofcontact);
					$('#useridinitiated').val(userIDTC);
					$('#ContactTimeclick').val(ContactTime);
					$('#ContactDateclick').val(ContactDate);
					$('#SeqOFContactInformation').attr('data-connectingSeqSave-type', SeqConnectValue);
					console.log(' SeqConnectValue='+SeqConnectValue)
					 
					console.log('ContactDate='+ContactDate+' '+ContactTime+' '+Typeofcontact)
					if(Contactperson){
						
	//					selectedRowContactPerson = Contactperson;
						tablecontactperson.setData(Contactperson);
						console.log(' Contactperson='+JSON.stringify(Contactperson));
					}else{
						var Seq =getNextSequenceValue();
						Contactperson=[{
				            id: Seq,
				            idc: SeqConnectValue,
				            relationOffender: "",
				            lastName: "",
				            firstName: "",
				            mi: "",
				            suffix: "",
				            ClassEdit:"Editablecontactperson",
				            addClassRowCP: true
				        }];
		//				selectedRowContactPerson = Contactperson;
							  tablecontactperson.setData(Contactperson);
						console.log(' Contactperson=NoValue'+JSON.stringify(Contactperson));
					}
					rowData.contactPersonValue = Contactperson;
					$('#addCmntValShow').val(data);
					$('#initiated-firstname').val(ULFMS);
					if(flag==='Y'){
						$('#InitiatedDDOC').prop('checked', true);
					}else{
						$('#InitiatedDDOC').prop('checked', false);
					}
					
					updateCharCount1();
					console.log("It's a rowclick ");
					   window.currentRow = row;
					    window.currentRowData = rowData;
					    console.log(" disable works3");
					    $('.contactPersonDisableValue').prop('disabled', false);
				        $('.contactPersonDisableValue').prop('readonly', false);
				        $('.contactPersonDisableValue').css('pointer-events', 'auto');
					    console.log(" disable works4");
				}else{
					console.log(" disable works");
					$('.contactPersonDisableValue').css('pointer-events','none');
					$('.contactPersonDisableValue').prop('readonly', true);
					$('.contactPersonDisableValue').prop('disabled', true);
					console.log(" disable works1");
					var Comments=rowData.CMTcontactType;
					var TypeofContact=rowData.typeContact;
					var ContactDate=rowData.contactDate;
					var ContactTime=rowData.time;
					var Seqno=rowData.id;
					var commitno=rowData.CommitNo;
					var UserLFMS=rowData.InitiatedUserName || '';
					var DDOCFlag=rowData.flagDDOC;
					$('#TypeOfContactclick').val(TypeofContact);
					$('#ContactDateclick').val(ContactDate);
					$('#ContactTimeclick').val(ContactTime);
					$('#addCmntValShow').val(Comments);
					$('#initiated-firstname').val(UserLFMS);
					
					console.log('DDOCFlag='+DDOCFlag);
					
					if(DDOCFlag==='Y'){
						$('#InitiatedDDOC').prop('checked', true);
					}else{
						$('#InitiatedDDOC').prop('checked', false);
					}
					
					updateCharCount1();
					if(Seqno && commitno){
						getthecontactperson(commitno,Seqno);
					}
			//		
					console.log("It's a rowclick Old "+TypeofContact+' '+ContactDate+' '+ContactTime+' '+Seqno+' '+commitno);
				}
	});
			

		


			$('#addCmntValShow').on('input', function () {
				   var updatedValue = $(this).val();

				    // Update the CMTcontactType field in the current row data
				    if (window.currentRow) {
				        // Update the row data object
				        window.currentRowData.CMTcontactType = updatedValue;

				        if (Array.isArray(window.currentRowData.contactPersonValue)) {
				            let cpArray = window.currentRowData.contactPersonValue;
				            if (cpArray.length > 0) {
				                // Update the first contact person's CMTcontactType field
				                cpArray[0].CMTcontactType = updatedValue;
				            }
				        }
				        
				        // Now update the row in Tabulator using the updated data
				        window.currentRow.update(window.currentRowData);
				        console.log("Updated CMTcontactType to: " + updatedValue);
				    }
			}); 
	        //////////////////
	        
	     /*    $('#initiated-firstname').on('input', function () {
    var inputValue = $(this).val();

    if (window.currentRow) {
        window.currentRowData.InitiatedUserName = inputValue;
        window.currentRow.update(window.currentRowData);
        console.log("Updated CMTcontactName to: " + inputValue);
    }
});
	        $('#useridinitiated').on('input', function () {
	            var inputValue = $(this).val();

	            if (window.currentRow) {
	                window.currentRowData.userID = inputValue;
	                window.currentRow.update(window.currentRowData);
	                console.log("Updated CMTcontactName to: " + inputValue);
	            }
	        });
			    */
	        /////////////////
	            $('#InitiatedDDOC').on('click', function() {
	    	    if ($(this).is(':checked')) {
	    	    	 $('#UserListValue2').css('pointer-events', 'auto');    
	    	    	    $('#UserListValue2').css('opacity', '1');                
	    	    	    $('#UserListValue2').removeClass('disabled-icon'); 
	    	    	    if (window.currentRow) {
	    	    	    	var inputValue='Y';
	    	    	    	window.currentRowData.flagDDOC = inputValue;
	    	    	        window.currentRow.update(window.currentRowData);
	    	    	        console.log("Updated CMTcontactName to: " + inputValue);
	    	    	    }
	    	        console.log('HI');
	    	    } else {
	    	    	  $('#UserListValue2').css('pointer-events', 'none');      
	    	    	    $('#UserListValue2').css('opacity', '0.5');              
	    	    	    $('#UserListValue2').addClass('disabled-icon');
	    	    	    if (window.currentRow) {
	    	    	        var inputValue='N';
	    	    	    	window.currentRowData.flagDDOC = inputValue;
	    	    	        window.currentRow.update(window.currentRowData);
	    	    	        console.log("Updated CMTcontactName to: " + inputValue);
	    	    	    }
	    	    	console.log('Bye');
	    	    }
	    	     });
	        ////////////////
	        function getNextSequenceValue() {
		    var el = $('#SeqOFContactInformation');
		    var attrName = 'data-SequenceOfContactPerson-type';
		    var currentVal = parseInt(el.attr(attrName), 10);
		    // Increment the value
		    var newVal = currentVal + 1;
		    // Set new value back to the attribute
		    el.attr(attrName, newVal);
		    return currentVal;
		}


			function focusCell(table, rowId, field) {
			    var row = table.getRow(rowId); // Get the row by ID
			    if (row) {
			        var cell = row.getCell(field); // Get the cell from the row
			        if (cell) {
			            cell.edit(); // Open the editor for the cell
			         
			        } else {
			            console.error("Cell not found for field:", field);
			        }
			    } else {
			        console.error("Row not found for rowId:", rowId);
			    }
			}
			
			$('#add-button').on('click', function () {
				var sbiNumber=$('#sbiNumberInput').val();
				if(!sbiNumber){
	                message('CUW','Please enter ID#.',0);
				}else{
				if(document.querySelector('#contactTypeTab').classList.contains('active')){
			var rowCount = tableContact.getData().length;
			var rowCount1 = tableContact.getData().filter(row => row.addClassRow);

			var No = parseInt($('#SeqOFContactInformation').val(), 10);
			console.log('No='+No)
			var UserName = document.querySelector('#SeqOFContactInformation').getAttribute('data-nameFLMS-type');
		var rowLength=rowCount1.length
		    var SeqNo=No+rowLength;
		var currentDateTime = new Date();
		var currentDate = currentDateTime.toLocaleDateString(); 
		let currentTime = currentDateTime.getHours().toString().padStart(2, '0') + ':' + currentDateTime.getMinutes().toString().padStart(2, '0');

		console.log("Date:", currentDate);
		console.log("Time:", currentTime);
			console.log('Seq='+SeqNo+' '+UserName);
				 const newRowData = {
						     id: SeqNo,
						checkbox: "",
						contactDate: "",
						time: "",
						typeContact: "",
						enteredDate: currentDate,
						enteredtime: currentTime,
						checkbox1: "",
						checkbox2: "",
						checkbox3: "N",
						negativereason: "",
						enteredlfms: UserName,
						CMTcontactType: "",
						contactPersonValue: "",
						GetEditableRow: "CSMContactInformationValues",
						addClassRow: true
					}; // Example new row data
					
					
					
				tableContact.addData(newRowData, true); 
				 focusCell(tableContact, SeqNo, "contactDate")
				console.log('Tab 1 clicked plus icon'); 
				}
				else if(document.querySelector('#contactPersonTab').classList.contains('active')){
					 var Seqval =getNextSequenceValue();
	                 var SeqConnect = parseInt($('#SeqOFContactInformation').attr('data-connectingSeqSave-type'), 10);
					    // Increment
					 /*    var newVal = currentVal + 1;

					    // Set the new value to both jQuery's data and HTML attribute
					    $('#SeqOFContactInformation').attr('data-SequenceOfContactPerson-type', newVal); */
					console.log('Seq='+Seqval+' ');
				 	const newRowDataCP = {
		 			    id: Seqval,//Seqval
		 			    idc: SeqConnect,//SeqConnect
		 			    relationOffender: "",
		 			    lastName: "",
		 			    firstName: "",
		 			    mi: "",
		 			    suffix: "",
		 			   ClassEdit:"Editablecontactperson",
		 			   addClassRowCP: true
		 		    };  
					tablecontactperson.addData(newRowDataCP, true);
		
				}
				}
			});
		
			function saveCurrentContactPersonData() {
			    if (currentContactDiv) {
			        const currentData = tablecontactperson.getData();
			        currentContactDiv.attr('data-contactPerson-type', JSON.stringify(currentData));
			        console.log('Auto-saved contact person data:', currentData);
			    }
			}
			
	/* 	$(document).on('click', '.CSMCPINSERT', function (e) {
			tabledatacontactperson=[];
			
			tabledatacontactperson=[ {
			    id: "",
			    relationOffender: "",
			    lastName: "",
			    firstName: "",
			    mi: "",
			    suffix: "",
			   disable: "CSMcontactpersonAdd"
		    }];
			contactpersonvalues(tabledatacontactperson);
			console.log('This clcik works')
			
		}); */
		
   $(document).on('click', '.checkboxforamendment', function (e) {
	   
	   document.querySelectorAll('.CSMContactInformation').forEach((rowElement) => {
		   const checkbox = rowElement.querySelector('.checkboxforamendment');
		   if (checkbox && checkbox.checked) {
			   var SeqNo = rowElement.getAttribute('data-SEQNO-type');
			   var CommitNo = rowElement.getAttribute('data-CommitNo-type');
			   console.log(SeqNo+' '+CommitNo+'=checking the values');
			   if((SeqNo!='undefined' && CommitNo!='undefined')){
			   $('#AddCmntModal').modal('show');
			   }
		   }
	   });
	   
	    });
   
	
		
		   $(document).on('click', '#Yesuncheck', function (e) {
			   var SEQ_NO=document.querySelector('#SeqOFContactInformation').getAttribute('data-AmendmentSeqNo-type');
			   uncheckCheckboxById(SEQ_NO)
			   console.log('Exitbutton');
			 //  $('.checkboxforamendment').prop('checked', false);
		   });
		   
		   $(document).on('click', '#nobtnuncheck', function (e) {
			   var SEQ_NO=document.querySelector('#SeqOFContactInformation').getAttribute('data-AmendmentSeqNo-type');
			   uncheckCheckboxById(SEQ_NO)
			   console.log('No button');
			 //  $('.checkboxforamendment').prop('checked', false);
		   });
		   
		   $(document).on('click', '#Closethepopup', function (e) {
			   var SEQ_NO=document.querySelector('#SeqOFContactInformation').getAttribute('data-AmendmentSeqNo-type');
			   uncheckCheckboxById(SEQ_NO)
			   console.log('close button');
			 //  $('.checkboxforamendment').prop('checked', false);
		   });
		   
		   $(document).on('click', '#OkayaddCmntVal', function (e) {
			   var AmendmentUpdate=[];
			   var SeqNo = document.querySelector('#SeqOFContactInformation').getAttribute('data-AmendmentSeqNo-type');
			   var CommitNo = document.querySelector('#SeqOFContactInformation').getAttribute('data-AmendmentCommitNo-type');
			   var comment=$('#addCommentsAmendment').val();
			   AmendmentUpdate.push({
			      COMMIT_NO: CommitNo,
			     CSMN_CONT_SEQ_NO: SeqNo,
			     csmn_cont_comnt_amendment: comment
			     });
			    $.ajax({
			          url: 'CSM_Amendment_VALUES',
			          type: 'POST', 
			          contentType: 'application/json',
			          data: JSON.stringify(AmendmentUpdate),
			          success: function(response) {
			          
			            console.log('hi the procedure is executed')
			             message('S',0,0);
			            var EmptyValue='';
			            $('#addCommentsAmendment').val(EmptyValue);
			          },
			      });  
		   });
		   
		   $(document).on('click', '#addCmntValClear', function (e) {
			   var EmptyValue='';
	            $('#addCommentsAmendment').val(EmptyValue);
		   });
		   
		   $(document).on('click', '#ExitCmntVal', function (e) {
			   var EmptyValue='';
	            $('#addCommentsAmendment').val(EmptyValue);
		   });
		   
		   $(document).on('click', '#amendmentClose', function (e) {
			   var EmptyValue='';
	            $('#addCommentsAmendment').val(EmptyValue);
		   });
   
   function triggerRowClick(tableName, rowId, textareaId) {
	   let tableInstance = Tabulator.findTable(tableName)[0]; // Get the Tabulator instance
	   let row = tableInstance.getRow(rowId); // Find the row using the ID

	   if (row) {
		   console.warn("Row founded!"+tableInstance+' '+row)
		row.getElement().click(); // Simulate a real click event on the row
		let textarea = document.getElementById(textareaId);
        if (textarea) {
            textarea.focus(); // Set focus on the textarea
            console.warn("Textarea founded!");
        } else {
            console.warn("Textarea not found!");
        }
	   } else {
	       console.warn("Row not found!");
	   }
	 }
/*     document.getElementById("InitiatedDDOC").addEventListener("change", function() {
	    const link = document.getElementById("UserListValue");
	    if (this.checked) {
	    	link.removeAttribute("disabled");
	    	link.style.opacity = "1";
	    } else {
	    	 link.setAttribute("disabled", "true");  
	         link.style.opacity = "0.5";  
	    }
	});  */

/* 	const link = document.getElementById("UserListValue");
   if($('#InitiatedDDOC').prop('checked')){
	   link.style.pointerEvents = "auto";
	   link.style.opacity = "1";
	   console.log('true ')
  }else{
	  link.style.pointerEvents = "none";
	  link.style.opacity = "0.5";
	  console.log('False ')
  } */
	
   
  /*  let currentContactDiv = null;
   //     Display value of Contact Type
	 $(document).on('click', '.CSMContactInformation', function (e) {
		 if ($(e.target).is('input[type="checkbox"]')) {
		        return;
		    }
	    e.preventDefault();

	    if (currentContactDiv) {
	        const currentData = tablecontactperson.getData();
	        currentContactDiv.attr('data-contactPerson-type', JSON.stringify(currentData));
	        currentContactDiv = null;
	    }
	    var $div = $(this);
	    
      
		var Comments =$div.attr('data-COMMENTSCT-type');
		var Typecontact =$div.attr('data-Typeofcontact-type');
		var Date =$div.attr('data-CDate-type');
		var Time =$div.attr('data-CTime-type');
		var Seqno=$div.attr('data-SEQNO-type') || null;
		var commitno=$div.attr('data-CommitNo-type') || null;
		console.log();
		
		 $('#TypeOfContactclick').val(Typecontact);
		  $('#ContactDateclick').val(Date);
		 $('#ContactTimeclick').val(Time);
		
		console.log('onclickvalue'+Date+' '+Time+' '+Typecontact);
		

		
		if(Comments!='undefined'){
	    $('#addCmntValShow').val(Comments);
		}
		
	if(Seqno!='null' || commitno!='null'){
		console.log('Checking values'+commitno+' '+Seqno);
	getthecontactperson(commitno,Seqno);
	 }else{
		 tabledatacontactperson=[{
		    id: "",
		    idc: "",
		    relationOffender: "",
		    lastName: "",
		    firstName: "",
		    mi: "",
		    suffix: "",
	    },
	   ];
		 
		contactpersonvalues(tabledatacontactperson);
		 
	 }
	//  $('#addCmntValShow').data('clickedRow', $div);
	});  

	 $(document).on('click', '.CSMContactInformationValues', function (e) {
		    if ($(e.target).is('input[type="checkbox"]')) {
		        return;
		    }

		    e.preventDefault();

		    const $div = $(this);
		    var Comments =$div.attr('data-COMMENTSCT-type');
		    var SeqConnectValue=$div.attr('data-connectingTableSeq-type');
		    console.log('SeqConnectValue='+SeqConnectValue);
		    $('#SeqOFContactInformation').attr('data-connectingSeqSave-type', SeqConnectValue);

		    // 1. Save current table data to previously selected row
		    if (currentContactDiv) {
		        const currentData = tablecontactperson.getData();
		        currentContactDiv.attr('data-contactPerson-type', JSON.stringify(currentData));
		    }

		    // 2. Set new active div
		    currentContactDiv = $div;
		    console.log('cURRENTDIVClick='+JSON.stringify(currentContactDiv, null, 2));
		    // 3. Load new data into tabulator
		    let contactPersonValue = $div.attr('data-contactPerson-type');
		    let dataToLoad = [];

		    if (contactPersonValue) {
		        try {
		            dataToLoad = JSON.parse(contactPersonValue);
		        } catch (err) {
		            console.error('Invalid JSON in data-contactPerson-type');
		        }
		    }

		    // If nothing to load, initialize with blank row
		    if (!dataToLoad || !Array.isArray(dataToLoad) || dataToLoad.length === 0) {
		        var Seq =getNextSequenceValue();
		    	dataToLoad = [{
		            id: SeqConnectValue,
		            idc: Seq,
		            relationOffender: "",
		            lastName: "",
		            firstName: "",
		            mi: "",
		            suffix: "",
		            addClassRowCP: true
		        }];
		    }

		    $('#addCmntValShow').val(Comments);
		    
		    tablecontactperson.setData(dataToLoad);
		    $('#addCmntValShow').data('clickedRow', $div);
		});
   
 	 
 		 // To update the comment in the json value //
 		$(document).on('blur', '#addCmntValShow', function () {
 		   
 			var commentValue = $(this).val(); 
 		    if (commentValue.trim() === "" || !$('#addCmntValShow').data('clickedRow')) {
 		        return; 
 		    }
 		    var $div = $('#addCmntValShow').data('clickedRow');
 		   $div.attr('data-COMMENTSCT-type', commentValue);

 		console.log("Checking the comment box")
 		}); 
	 */ 
	    var tabledatacontactperson = [];
	 var numrecordCP=11;
	   tabledatacontactperson = Array.from({ length: numrecordCP }, () => ({
			id: "",
            relationOffender: "",
            lastName: "",
            firstName: "",
            mi: "",
            suffix: "",
			   }));
	     
	    var tablecontactperson
	    //Define Table
	//    contactpersonvalues(tabledatacontactperson);
	//    function contactpersonvalues(tabledatacontactperson){
	    	
	     tablecontactperson = new Tabulator("#contactperson-table", {
	    layout: "fitColumns",
	    data: tabledatacontactperson,
	    height: '300px',
	    printAsHtml: true,
	    printStyled: true,
	    rowFormatter: function(row) {
	        let rowData = row.getData();
	        if (rowData.disable) {
	            row.getElement().classList.add(rowData.disable); // Apply class from JSON
	        }
	    },
	    columns: [
	    	 {
					title: "id",
					field: "id",
					visible: false,
				},
				{
					title: 'upd',
					visible: false,
					field: "upd",
				},
				{
					title: 'rowid',
					visible: false,
					field: "rowid",
				},
	    	{

	    //	    title: "Relation With Offender",
	    	    titleFormatter: (column) => setTitleDesc(column, 'Relation_With_Offender_tablecontactperson', 'Relation With Offender'),
	    	    headerTooltip:"Relation With Offender",
	    	    field: "relationOffender",
	    	    editor: "list",
	    	    cssClass: "enteredlfms-align-left",
	    	    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.relationOffender) {
			              showCustomTooltip(e, cell, `${data.relationOffender}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
	    	    editable: function(cell) {
                    return cell.getRow().getElement().classList.contains('Editablecontactperson');
                }
	    	}, 
	    	{
			    titleFormatter: (column) => setTitleDesc(column, 'Last_Name_tablecontactperson', 'Last Name'),
			    headerTooltip:"lastName",
			    field: "lastName",
			    editor: "input",
			    cssClass: "enteredlfms-align-left",
			    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.lastName) {
			              showCustomTooltip(e, cell, `${data.lastName}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
			    editable: function(cell) {
			    	/*  var rowElement = cell.getRow().getElement();
			         var relationValue = cell.getRow().getData().relationOffender;
			         return rowElement.classList.contains('Editablecontactperson') && relationValue && relationValue.trim() !== ''; */
			         return cell.getRow().getElement().classList.contains('Editablecontactperson');
                },
	    	},
	    	{
			    titleFormatter: (column) => setTitleDesc(column, 'First_Name_name', 'First Name'),
			    headerTooltip:"First Name",
			    field: "firstName",
			    editor: "input",
			    cssClass: "enteredlfms-align-left",
			    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.firstName) {
			              showCustomTooltip(e, cell, `${data.firstName}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
			    editable: function(cell) {
			  /*   	var rowElement = cell.getRow().getElement();
			         var relationValue = cell.getRow().getData().relationOffender; */
			    	return cell.getRow().getElement().classList.contains('Editablecontactperson');
                },
	    	},
	    	{
			    titleFormatter: (column) => setTitleDesc(column, 'MI_name', 'MI Name'),
			    headerTooltip:"MI",
			    field: "mi",
			    width: 70,
			    editor: "input",
			    cssClass: "enteredlfms-align-left",
			    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.mi) {
			              showCustomTooltip(e, cell, `${data.mi}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
			    editable: function(cell) {
			    	/* var rowElement = cell.getRow().getElement();
			         var relationValue = cell.getRow().getData().relationOffender; */
			    	return cell.getRow().getElement().classList.contains('Editablecontactperson');
                },
	    	},
	    	{
			    titleFormatter: (column) => setTitleDesc(column, 'Suffix_Name_tablecontactperson', 'Suffix Name'),
			    headerTooltip:"Suffix Name",
			    field: "suffix",
			    width: 110,
			    editor: "input",
			    cssClass: "enteredlfms-align-left",
			    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.suffix) {
			              showCustomTooltip(e, cell, `${data.suffix}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
			    editable: function(cell) {
			    	var rowElement = cell.getRow().getElement();
			         var relationValue = cell.getRow().getData().relationOffender;
			    	return cell.getRow().getElement().classList.contains('Editablecontactperson');
                },
	    	},
	    	
	    ],
	    rowFormatter: function(row) {
	    	var rowData = row.getData(); 
	    	var getClassValue=rowData.ClassEdit;
	    	var rowElement = row.getElement(); 
			rowElement.classList.add(getClassValue) || ''; 
		}, 
	    dataChanged: function(data) {
	    	  console.log("🟡 Data changed in tablecontactperson");

	    	  if (window.currentRowData && window.currentRow) {
	    	    window.currentRowData.contactPersonValue = data;
	    	    window.currentRow.update(window.currentRowData);
	    	  }
	    	}
	  /*   cellEdited: function(data){
	        // data = full data after edits
	        if (window.currentRow) {
	            window.currentRowData.contactPersonValue = data;
	            window.currentRow.update(window.currentRowData);
	            console.log("Auto-updated contactPersonValue on edit:", data);
	        
	        console.log('Hi trabulator');
	    } 
	    } */
	    });
	//	}
	    
	    tabulatorRegistry["contactperson-table"] = {
				varName: "tablecontactperson",
				instance: tablecontactperson
			};
	    
/* 
         document.addEventListener('click', function(event) {
            if (event.target && event.target.id === 'addContactPerson') {
            	const cell = tablecontactperson.getCell(event.target); 
                const row = cell.getRow();

               
                const rowData = row.getData(); 
                console.log('Add Contact Person clicked!');
                console.log(rowData); 

    
                let tabledatacontactperson = [{
                    id: "",
                    relationOffender: "",
                    lastName: "",
                    firstName: "",
                    mi: "",
                    suffix: "",
                }];
                contactpersonvalues(tabledatacontactperson);
            } else if (event.target && event.target.id === 'addContactPerson10') {
                console.log('Download clicked!');
            }
        });  */

        tablecontactperson.on("cellEdited", function(cell){
            let updatedData = tablecontactperson.getData();

            if (window.currentRowData && window.currentRow) {
                // Save back to tableContact's row data
                window.currentRowData.contactPersonValue = updatedData;

                // Optional: update the parent row in tableContact to reflect changes
                window.currentRow.update(window.currentRowData);

                console.log("Updated contactPersonValue back to tableContact:");
             //   console.log(updatedData);
            }
        });

        //
  

	    var tabledatahistory = [];
	 
	    var numRecords=5;

		   tabledatahistory = Array.from({ length: numRecords }, () => ({
		 							id: "",
		 	                         contactDate: "",
		 	                         contactTime: "",
		 	                         typeContact: "",
		 	                         enteredDate: "",
		 	                         enteredTime: "",
		 	                         checkbox: "",
		 	                         checkbox1: "",
		 	                         negativeReasons: "",
		 	                         enteredBy: "",
		 							   }));


	    	
	    var table = new Tabulator("#history-table", {
	    layout: "fitColumns",
	    data: tabledatahistory,
	    height: '150px',
	    printAsHtml: true,
	    printStyled: true,
	    columns: [
	    	  {
					title: "id",
					field: "id",
					visible: false,
				},
				{
					title: 'upd',
					visible: false,
					field: "upd",
				},
				{
					title: 'rowid',
					visible: false,
					field: "rowid",
				},
	    	{
	    	    headerTooltip: "Contact Date",
	    	    titleFormatter: (column) => setTitleDesc(column, 'Contact_Date_HistorryTable', 'Contact Date'),
	    	    field: "contactDate",
	    	    cssClass: "enteredlfms-align-left",
	    	    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.contactDate) {
			              showCustomTooltip(e, cell, `${data.contactDate}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
	    	    width: 120,
	    	},
	    	{
	    	    headerTooltip: "Contact Time",
	    	    titleFormatter: (column) => setTitleDesc(column, 'Contact_Time_HistorryTable', 'Contact Time'),
	    	    field: "contactTime",
	    	    cssClass: "enteredlfms-align-left",
	    	    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.contactTime) {
			              showCustomTooltip(e, cell, `${data.contactTime}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
	    	    width: 120,
	    	},
	    	{
	    	    headerTooltip: "Type of Contact",
	    	    titleFormatter: (column) => setTitleDesc(column, 'Type_of_Contact_HistorryTable', 'Type of Contact'),
	    	    field: "typeContact",
	    	    cssClass: "enteredlfms-align-left",
	    	    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.typeContact) {
			              showCustomTooltip(e, cell, `${data.typeContact}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
	    	},
	    	{
	    	    headerTooltip: "Entered Date",
	    	    titleFormatter: (column) => setTitleDesc(column, 'Entered_Date_HistorryTable', 'Entered Date'),
	    	    field: "enteredDate",
	    	    cssClass: "enteredlfms-align-left",
	    	    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.enteredDate) {
			              showCustomTooltip(e, cell, `${data.enteredDate}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
	    	    width: 120,
	    	},
	    	{
	    		headerTooltip: "Entered Time",
	    	    titleFormatter: (column) => setTitleDesc(column, 'Entered_Time_HistorryTable', 'Entered Time'),
	    	    field: "enteredTime",
	    	    cssClass: "enteredlfms-align-left",
	    	    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.enteredTime) {
			              showCustomTooltip(e, cell, `${data.enteredTime}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
	    	    width: 120,
	    	},
	    	{
	    		headerTooltip: "Negative",
				titleFormatter: (column) => setTitleDesc(column, 'Negative_HistorryTable', 'Negative'),
				headerSort: false,
				field: "checkbox",
				formatter: (cell) => {
				const value = cell.getValue();
				if (value) {
						return `
						<input type="checkbox" ${value === 'Y' ? 'checked' : 'N'} />
						<label>${value}</label>
						`;
					}
				},
				width: 100,
			},
			{
				headerTooltip: "Corrected",
				titleFormatter: (column) => setTitleDesc(column, 'Corrected_HistorryTable', 'Corrected'),
				field: "checkbox1",
				headerSort: false,
				formatter: (cell) => {
				const value = cell.getValue();
				if (value) {
						return `
						<input type="checkbox" ${value === 'Y' ? 'checked' : ''} />
						<label>${value}</label>
						`;
					}
				},
				width: 100,
			},
			{
				headerTooltip: "Negative Reasons",
	    	    titleFormatter: (column) => setTitleDesc(column, 'Negative_Reasons_HistorryTable', 'Negative Reasons'),
	    	    field: "negativeReasons",
	    	    cssClass: "enteredlfms-align-left",
	    	    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.negativeReasons) {
			              showCustomTooltip(e, cell, `${data.negativeReasons}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
	    	},
	    	{
	    		headerTooltip: "Entered By(L,F,M,S)",
	    	    titleFormatter: (column) => setTitleDesc(column, 'Entered_By(L,F,M,S)_HistorryTable', 'Entered By(L,F,M,S)'),
	    	    field: "enteredBy",
	    	    cssClass: "enteredlfms-align-left",
	    	    sorter: customSorter,
                cellMouseOver: function (e, cell) {
			          const data = cell.getRow().getData();
			          if (data.enteredBy) {
			              showCustomTooltip(e, cell, `${data.enteredBy}`);
			            }
			        },
			    cellMouseMove: moveCustomTooltip,
			    cellMouseOut: hideCustomTooltip,
	    	},
	    ]
	    ,rowFormatter: function(row) {
		    var rowData = row.getData();   
            var eventClass ='CSMHistoryTable' ;
            var commentsType=rowData.CSMN_CONT_COMNT || '';
            var rowcolor=rowData.colorcode;
            var DDOC=rowData.ddoc || '';
            var ISCDATE=rowData.iscdate || '';
            var flag=rowData.iscflag || '';
            var Fname=rowData.firstname || '';
            var Lname=rowData.lastname  || '';
            var Mname=rowData.middlename  || '';
            var Sname=rowData.suffixname  || '';
            var rowElement = row.getElement(); 
            rowElement.classList.add(rowcolor);
            rowElement.classList.add(eventClass);
            rowElement.setAttribute('data-COMMENTS-type', commentsType); 
            rowElement.setAttribute('data-DDOC-type', DDOC);
            rowElement.setAttribute('data-ISCDATE-type', ISCDATE);
            rowElement.setAttribute('data-flag-type', flag);
            rowElement.setAttribute('data-Fname-type', Fname);
            rowElement.setAttribute('data-Lname-type', Lname);
            rowElement.setAttribute('data-Mname-type', Mname);
            rowElement.setAttribute('data-Sname-type', Sname);
        }
	    });
	    tabulatorRegistry["history-table"] = {
				varName: "table",
				instance: table
			};
	    
	
		 $(document).on('click', '.CSMHistoryTable', function (e) {
			 if ($(e.target).is('input[type="checkbox"]')) {
			        return;
			    }
		 
			    e.preventDefault();

			    var $div = $(this);
			    
	            
				var Comments =$div.attr('data-COMMENTS-type');
				var DDOC =$div.attr('data-DDOC-type');
				var ISCDATE =$div.attr('data-ISCDATE-type');
				var flag =$div.attr('data-flag-type');
				var Fname =$div.attr('data-Fname-type');
				var Lname =$div.attr('data-Lname-type');
				var Mname =$div.attr('data-Mname-type');
				var Sname =$div.attr('data-Sname-type');
	 		    $('#CommentsHistory').val(Comments);
	 	        var FullName = Lname+' '+Fname+' '+Mname+' '+Sname;
	 	        var LFMS = formatName(FullName);
	 	       $('#Fname').val(LFMS)
	 		    $('#lbl-ISCTransferDate').val(ISCDATE);
	 		   if(DDOC==='Y'){
      			$('#Ddocflag1').prop('checked', true);
      		}
	 		  if(flag==='Y'){
     			$('#ISCflag').prop('checked', true);
     		}
	 		 var ToTime=$('#time-constant').val()
	 		 console.log('Testing='+ToTime);
			});
	    
		 async function apiRequest(method, url, data = null) {
			  try {
			    const options = {
			      method: method.toUpperCase(),
			      headers: { 'Content-Type': 'application/json' },
			      ...(data && { body: typeof data === 'string' ? data : JSON.stringify(data) })
			    };

			    const res = await fetch(contextPath + url, options);
			    const contentType = res.headers.get('content-type');

			    const response = contentType && contentType.includes('application/json')
			      ? await res.json()
			      : await res.text();

			    if (!res.ok) {
			      const message = response?.message || res.statusText || 'Unknown error';
			      console.error('Fetch failed:', message);
			      return null;
			    }

				document.getElementById("commonPerloader").style.display="none";
			    return response;
			  } catch (err) {
			    console.error('Fetch failed:', err.message || err);
			    return null;
			  }
			}
	   
		 function fetchAJAXTableData(url, thisTabl, thisTablObj){
				thisTablObj.loading = true;

				return apiRequest('GET', url)
					.then(data => {
						if (thisTablObj.currPage == 0){
							thisTabl.setData(data.content);
						}else{
							thisTabl.addData(data.content);
						}
						thisTablObj.totalPages = data.totalPages;
						thisTablObj.currPage++;
						thisTablObj.loading = false;
					});
			}
		 
	    var tabledatahelpofficer = [];
	    const pageSize = 500;
	//		tabledatahelpofficerdata(tabledatahelpofficer);
			
			var selectedRowData = null;
			var tableUL;
		//	function tabledatahelpofficerdata(tabledatahelpofficer){
			 tableUL = new Tabulator("#helponofficer-table", {
			  layout: "fitColumns",
			  data: tabledatahelpofficer,
			  height: '250px',
			  printAsHtml: true,
			  printStyled: true,
			  columns: [ 
			    {
					title: "First Name",
					field: "userFirstName",
					hozAlign: "left",
					width: 120,
				},
			    {
			      title: "Last Name",
			      field: "userLastName",
			      hozAlign: "left",
			    },
			    {
			      title: "Mi",
			      field: "userMidName",
			      hozAlign: "left",
			      width: 70,
			    },
			    {
			      title: "Suffix",
			      field: "userSuffixName",
			      hozAlign: "left",
			      width: 120,
			    },
			  ],
			  
			   rowFormatter: function(row) {
				   var rowData = row.getData();  
		            var Sentbyuseridvalue = rowData.user_id; 
		            var sentbyuserClass ='Sentbyuserinput' ;
		            var rowElement = row.getElement(); 
		            rowElement.classList.add(sentbyuserClass);
		            rowElement.setAttribute('data-Sentbyuseridvalue-type', Sentbyuseridvalue); 
		        },
			});
			 
			 let user_tblObj = {currPage: 0, totalPages: 0, currSrch: "", loading: false}
			 fetchAJAXTableData('searchUsers?search='+user_tblObj.currSrch+'&page='+user_tblObj.currPage+'&size='+pageSize, tableUL, user_tblObj);
			 
	//		}
			
			 $('#namefind').on('keyup', function (e) {
					user_tblObj.currSrch = $(this).val().trim();
					if (e.keyCode == 13) {
						$('#findUser').trigger('click');
					}
				});
			 
			$("#findUser").on("click", function () {
				user_tblObj.currPage = 0;
				fetchAJAXTableData('searchUsers?search='+user_tblObj.currSrch+'&page='+user_tblObj.currPage+'&size='+pageSize, tableUL, user_tblObj);
				
			});
			
			  $(document).on('click', '#UserListValue2', function (e) {
				  console.log('Above function');
				  
				  console.log('below function');
			   });
			
			  tableUL.on("scrollVertical", function () {
					if(!user_tblObj.loading && user_tblObj.currPage < user_tblObj.totalPages){
						fetchAJAXTableData('searchUsers?search='+user_tblObj.currSrch+'&page='+user_tblObj.currPage+'&size='+pageSize, tableUL, user_tblObj);
						
					}
				});
			  
			  function nullHandler(x) {
					if (x == null) {
						x = '';
					}
					return x;
				}
			  
			tableUL.on("rowClick", function (e, row) {
					console.log('Hello');
				   var curr_fld = $('#current_fld').val();
					var userID = row.getData().userId;
					var nam = nullHandler(row.getData().userLastName) + ' ' + nullHandler(row.getData().userFirstName) + ' ';
					nam += nullHandler(row.getData().userMidName) + ' ' + nullHandler(row.getData().userSuffixName);
								console.log('clicked value='+nam+' '+userID);
								var Name1=formatName(nam);
								$('#initiated-firstname').val(Name1);
								 if (window.currentRow) {
								        window.currentRowData.InitiatedUserName = Name1;
								        window.currentRow.update(window.currentRowData);
								        console.log("Updated CMTcontactName to: " + Name1);
								    }
								$('#useridinitiated').val(userID);
								if (window.currentRow) {
					                window.currentRowData.userID = userID;
					                window.currentRow.update(window.currentRowData);
					                console.log("Updated CMTcontactUserid to: " + userID);
					            }
								document.querySelectorAll('.modal-backdrop.fade.show').forEach(el => el.remove());
								$('#initiatelfms').modal('hide');
					
				});
			
			$.ajax({
			    url: 'CSM_DROPDOWN',
			    method: 'GET', 
			    success: function(response) {
			     var Reasonmst=response.resonmstDropdown;
			     var Relationship=response.relationshipDropdown;
			     var ContactType=response.contacttypeDropdown;
			     var seqNoContactInfromation=response.Seqval;
			     var seqNoContactPerson=response.SeqvalCP;
			     var userName=response.fullName;
			     var userId=response.p_user_id;
			     $('#SeqOFContactInformation').val(seqNoContactInfromation);
			     $('#SeqOFContactInformation').attr('data-SequenceOfContactPerson-type', seqNoContactPerson);
			     $('#SeqOFContactInformation').attr('data-nameFLMS-type', userName);
			     $('#SeqOFContactInformation').attr('data-userId-type', userId);
			         $.each(Reasonmst, function(index, item) {
			            $('#ReasonMstDropdown').append(`
			                <option value="${item[0]}">${item[1]}</option>
			            `); 
			        }); 
			         
			         $.each(Relationship, function(index, item) {
				            $('#RelationshipDropdown').append(`
				                <option value="${item[0]}">${item[1]}</option>
				            `); 
				        });
			         
			         $.each(ContactType, function(index, item) {
				            $('#ContactTypeDropdown').append(`
				                <option value="${item[0]}">${item[1]}</option>
				            `); 
				        });
			         
			         contactTypeValuesTabledropdown = {};
			         negativeReasonValuesTabledropdown = {};
			         relationshipValuesTabledropdown = {};

			         $.each(ContactType, function(index, item) {
			        	 contactTypeValuesTabledropdown[item[1]] = item[1], item[0];
			         });

			         /* $.each(Reasonmst, function(index, item) {
			             negativeReasonValuesTabledropdown[item[1]] = item[1];
			         }); */
			         contactTypeValuesTabledropdown = ContactType.map(function(item) {
			             return { value: item[1], label: item[1] };
			         });
			         negativeReasonValuesTabledropdown = Reasonmst.map(function(item) {
			             return { value: item[1], label: item[1] };
			         });
			         relationshipValuesTabledropdown = Relationship.map(function(item) {
			             return { value: item[1], label: item[1] };
			         });
			         

			         if (tableContact) {
			               tableContact.getColumn("typeContact").updateDefinition({
			            	   editorParams: {
			                       autocomplete: true,
			                       allowEmpty: true,
			                       listOnEmpty: true,
			                     /*   valuesLookup: true, */
			                       values: contactTypeValuesTabledropdown
			                   }
			             });
			             tableContact.getColumn("negativereason").updateDefinition({
			            	   editorParams: {
			                       autocomplete: true,
			                       allowEmpty: true,
			                       listOnEmpty: true,
			                       valuesLookup: true,
			                       values: negativeReasonValuesTabledropdown
			                   }
			             });
			             console.log('Table 1');
			         }
			         
			          if(tablecontactperson){
			        	  tablecontactperson.getColumn("relationOffender").updateDefinition({
			            	   editorParams: {
			                       autocomplete: true,
			                       allowEmpty: true,
			                       listOnEmpty: true,
			                      /*  valuesLookup: true, */
			                       values: relationshipValuesTabledropdown
			                   }
			             });

			        	 console.log('Table 2');
			         } 
			     
			    },
			    error: function(xhr, status, error) {
			        console.error('Error:', error);
			    }
			}); 
	    
	/* 	 $(document).on('click', '.CSMHistoryTable', function (e) {
			 if ($(e.target).is('input[type="checkbox"]')) {
			        return;
			    }
		 
			    e.preventDefault();

			    var $div = $(this);
			    
	            
				var Comments =$div.attr('data-COMMENTS-type');
				var DDOC =$div.attr('data-DDOC-type');
				var ISCDATE =$div.attr('data-ISCDATE-type');
				var flag =$div.attr('data-flag-type');
				var Fname =$div.attr('data-Fname-type');
				var Lname =$div.attr('data-Lname-type');
				var Mname =$div.attr('data-Mname-type');
				var Sname =$div.attr('data-Sname-type');
	 		    $('#CommentsHistory').val(Comments);
	 		   $('#Fname').val(Fname);
	 		    $('#Lname').val(Lname);
	 		    $('#Mname').val(Mname);
	 		    $('#Sname').val(Sname);
	 		    $('#lbl-ISCTransferDate').val(ISCDATE);
	 		   if(DDOC==='Y'){
      			$('#Ddocflag1').prop('checked', true);
      		}
	 		  if(flag==='Y'){
     			$('#ISCflag').prop('checked', true);
     		}
	 		 var ToTime=$('#time-constant').val()
	 		 console.log('Testing='+ToTime);
			}); */
		 
		 function getValuesByOptions(selectField, optionTexts) {
			    const selectElement = document.getElementById(selectField);
			    const options = selectElement.options;
			    let selectedValues = [];

			    // If optionTexts is a single value, convert it to an array
			    const optionTextsArray = Array.isArray(optionTexts) ? optionTexts : optionTexts.split(',');

			    // Loop through the optionTexts array and check for corresponding options
			    for (let j = 0; j < optionTextsArray.length; j++) {
			        let matched = false;

			        // Check each option in the select element
			        for (let i = 0; i < options.length; i++) {
			            if (options[i].text.trim() === optionTextsArray[j].trim()) {
			                selectedValues.push(options[i].value); // Store matching values
			                matched = true;
			                break;
			            }
			        }

			        // If no match found for a particular text, log a warning
			        if (!matched) {
			            console.warn('No matching option found for: ' + optionTextsArray[j]);
			        }
			    }

			    return selectedValues.length > 0 ? selectedValues : '';
			}

		 
		 document.getElementById("SaveScreen").addEventListener("click", function(e) {
			 
			 function savevalueofcontactperson(seqConnect,seqcontactC,reltionshipC,nameFC,nameLC,nameMC,nameSC,COMMIT_NO){
				 var contactpersoninsert=[];
					 console.log('Inside function='+seqConnect+' '+seqcontactC+' '+reltionshipC+' '+nameFC+' '+nameLC+' '+nameMC+' '+nameSC+' '+COMMIT_NO);
					 // valueSC=seqConnect.split(',');||valueSNO=seqcontactC.split(',');
				 var valueSC=seqcontactC.split(',');
				 var valueSNO=seqConnect.split(',');
				 var valueR=reltionshipC.split(',');
				 var valueFN=nameFC.split(',');
				 var valueLN=nameLC.split(',');
				 var valueMN=nameMC.split(',');
				 var valueSN=nameSC.split(',');
				 var commitno=COMMIT_NO;
				 var Realtionseq=null;
				 
				 for (var i = 0; i < valueSC.length; i++) {
					 contactpersoninsert.push({
						 commit_no: commitno,
						 CONT_SEQ_NO: valueSC[i],
						 PRSN_SEQ_NO: valueSNO[i],
						 RELATIONSHIP_SEQ_NUM: Realtionseq,
						 cont_lname: valueLN[i],
						 cont_fname: valueFN[i],
						 cont_mname: valueMN[i],
						 cont_sname: valueSN[i],
						 RELATIONSHIP_CODE: valueR[i],
	    		   });
				   } 
				 
			 	  $.ajax({
		                url: 'CSM_Contact_Person',
		                type: 'POST', 
		                contentType: 'application/json',
		                data: JSON.stringify(contactpersoninsert),
		                success: function(response) {
		                 console.log('Procedure Executed successfully sp contact person insert');
		                },
		            });  
				 
				 }
			 
				function convertDateFormat(dateString) {
					  // If the dateString is an array (multiple dates)
					  if (Array.isArray(dateString)) {
						  return dateString
							  .map(date => {
								  if (date.trim() === '') {
									  return '';  // Return empty string for empty date entries
								  }

								  const parts = date.split('/');
								  if (parts.length === 3) {
									  const [month, day, year] = parts;
									  return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
								  }

								  return '';  // Return empty string if format is incorrect
							  })
							  .join(','); // Join multiple dates with a comma if needed
					  } 
					  // If it's a single date (comma-separated)
					  else {
						  const parts = dateString.split(',');
						  return parts
							  .map(date => {
								  if (date.trim() === '') {
									  return '';  // Return empty string for empty date entries
								  }

								  const [month, day, year] = date.split('/');
								  return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
							  })
							  .join(','); // Join multiple dates with a comma if needed
					  }
				  }  
				
			
	    
				
				  var selectedRows = tableContact.getData().filter(row => row.addClassRow);
				  var selectedid= selectedRows.map(row => row.id);
				   var selectedContactDates = selectedRows.map(row => row.contactDate);
				   var selectedtime = selectedRows.map(row => row.time);
				   var selectedtypeContact = selectedRows.map(row => row.typeContact);
				   var selectedcheckbox1 = selectedRows.map(row => row.checkbox1 === true ? "Y" : "N");
				   console.log('selectedcheckbox1='+selectedcheckbox1)
				   var selectedcheckbox2 = selectedRows.map(row => row.checkbox2 === true ? "Y" : "N");
				   var selectedNegative = selectedRows.map(row => row.negativereason);
				   var selectedenteredDate = selectedRows.map(row => row.enteredDate);
				   var selectedenteredTime = selectedRows.map(row => row.enteredtime);
				   var selectedCommentsvalues = selectedRows.map(row => row.CMTcontactType);
				   var enteredUserName = selectedRows.map(row => row.enteredlfms);
				   var DDOCFlag = selectedRows.map(row => row.flagDDOC || "N");
				   var userIDISC = selectedRows.map(row => row.userID);
				   console.log('DDOCFlag='+DDOCFlag+' '+userIDISC)
				  var allContactPersons = []; // To collect all contact person values

				   selectedRows.forEach(row => {
					  if (Array.isArray(row.contactPersonValue)) {
						  allContactPersons = allContactPersons.concat(row.contactPersonValue);
					  } else {
						  // In case contactPersonValue is not an array but exists
						  if (row.contactPersonValue) {
							  allContactPersons.push(row.contactPersonValue);
						  }
					  }
				  });

			//	  console.log('All Contact Persons:' +JSON.stringify(allContactPersons) );
			//	  withRelation = allContactPersons.filter(item => item.relationOffender?.trim());
			 	 let withRelation = allContactPersons.filter(person => {
  return !(person.relationOffender === "" &&
           person.lastName === "" &&
           person.firstName === "" &&
           person.mi === "" &&
           person.suffix === "");
});
				  console.log('Withrealation='+JSON.stringify(withRelation)); 

				  
				  var csmn_cont_comnt=selectedCommentsvalues ;
					var contactInformationInsert=[];
					
					 var COMMIT_NO=document.querySelector('#SeqOFContactInformation').getAttribute('data-commitNo-type');
					 
					 var csmn_cont_seq_no=selectedid.toString();
					 var Dateselected=selectedContactDates.toString();
					
					var csmn_cont_tm=selectedtime.toString();
					 var codecontacttype=getValuesByOptions('ContactTypeDropdown',selectedtypeContact);
					 console.log('codecontacttype='+codecontacttype);
					 var cont_tp_cd=codecontacttype.toString();
					 console.log('checkTime1='+csmn_cont_tm)
					 var csmn_cont_sprv_neg_flg=selectedcheckbox1.toString();
					 var correction_flag=selectedcheckbox2.toString();
					 var resoncode=getValuesByOptions('ReasonMstDropdown',selectedNegative);
					 var resn_cd_neg_cont=resoncode.toString();
			  
					 var inserted_date=selectedenteredDate.toString();
					 var inserted_time=selectedenteredTime.toString();
					 var entered_by_user_id=document.querySelector('#SeqOFContactInformation').getAttribute('data-userId-type');
					 var entered_by_user_name=enteredUserName.toString();
				     
					 var csmn_cont_init_ddoc_flg=DDOCFlag.toString();
					  var user_id_init=userIDISC.toString();
					  var REPORT_NUM=null;
					  var intervention_tp=null;
					  var verify_addr_flag=null;
					  var csmn_cont_dt=convertDateFormat(Dateselected);
					  var EdateInserted=convertDateFormat(inserted_date);
						 console.log('checkDate1='+csmn_cont_dt+''+EdateInserted)
					  
					  var csmn_cont_seq_no_arr = csmn_cont_seq_no.split(',');
						 var TableDate =csmn_cont_dt.split(',');
						 var Time=csmn_cont_tm.split(',');
						 var tablecontactcode=cont_tp_cd.split(',');
						 var tablereasoncode=resn_cd_neg_cont.split(',');
						 var tablecheckbox=csmn_cont_sprv_neg_flg.split(',');
						 var tablecheckbox1=correction_flag.split(',');
						 var tablecomment=csmn_cont_comnt;
						 var Edate=EdateInserted.split(',');
						 var Etime=inserted_time.split(',');
						 var tableflag=csmn_cont_init_ddoc_flg.split(',');
						 var tableUserIdinit=user_id_init.split(',');
						 var enterbyName = entered_by_user_name.split(',');
						 let ids = withRelation.map(item => item.id);
						  let idcs = withRelation.map(item => item.idc);
						  let relationship = withRelation.map(item => item.relationOffender);
						  let fn = withRelation.map(item => item.firstName);
						  let ln = withRelation.map(item => item.lastName);
						  let mn = withRelation.map(item => item.mi);
						  let sn = withRelation.map(item => item.suffix);


									   var selectedRelation=getValuesByOptions('RelationshipDropdown', relationship);
								  //	 console.log('selectedRelation='+selectedRelation); 
									   var seqConnect=ids.toString();
									   var seqcontactC=idcs.toString();
									   var reltionshipC=selectedRelation.toString();
									   var nameFC=fn.toString();
									   var nameLC=ln.toString();
									   var nameMC=mn.toString();
									   var nameSC=sn.toString();  
					  console.log("=================");
					  console.log("csmn_cont_dt="+csmn_cont_comnt);
					  console.log("=================");
					  console.log("seqConnect"+seqConnect+' '+seqcontactC);
					  

					  
						   var idt_cont_from_dt=$('#dateFrom-ip').val() || "1900-01-01";
							var idt_cont_to_dt=$('#dateTo-ip').val() || "3000-12-31";
							var ivc_relationship_code=$('#typeOfContact-ip').val();
							var ivc_results=$('#relationship-ip').val();
							var ivc_cont_tp_cd=$('#results-ip').val();
							var selectedCommit=document.querySelector('#SeqOFContactInformation').getAttribute('data-commitNo-type');
						 
							
							 var updateISC=[];
							 var tranferDateISC=$('#isc-transferDate').val();
							 var tranferDateISC1 = convertDateFormat(tranferDateISC) || null;
							 var isChecked = document.getElementById('isc-approved').checked;
							 var flagISC = isChecked ? 'Y' : 'N';
							 
					 updateISC.push({
						 COMMIT_NO: COMMIT_NO,
						 isc_requested_date_box: tranferDateISC1,
						 isc_approved_flag: flagISC
				     });
					 
					 function UpdateISC(){
						  $.ajax({
					          url: 'updateFlagDateISC',
					          type: 'POST', 
					          contentType: 'application/json',
					          data: JSON.stringify(updateISC),
					          success: function(response) {
					          
					            console.log('hi the procedure is executed')
					            
					          },
					      }); 
					 }
							
							if(selectedRows.length==0){
								console.log('No records to save');
							}
							else if(TableDate.some(tdate=>!tdate)){
						  message('CUW','Contact Date must be entered',0)
						  console.log("Hi it's empty date value "+csmn_cont_seq_no_arr+' '+TableDate);
						  
						  TableDate.forEach((date, index) => {
							  if (!date) {
								  var SeqNo= csmn_cont_seq_no_arr[index]
								  focusCell(tableContact, SeqNo, "contactDate");
								  console.log(`Empty value at index ${index}:`, `Date: '${date}', ContactSeq: ${csmn_cont_seq_no_arr[index]}`+' SeqNo='+SeqNo);
							  }
						  });
					  }
					  else if(Time.some(times=>!times)){
						  message('CUW','Contact time  must be entered',0)
						  Time.forEach((Ttime, index) => {
							  if (!Ttime) {
								  var SeqNo= csmn_cont_seq_no_arr[index]
								  focusCell(tableContact, SeqNo, "time");
							  }
						  });
					  }
					  else if(tablecontactcode.some(code=>!code)){
						  message('CUW','Contact Type must be entered, Please select from the list',0)
						  tablecontactcode.forEach((code, index) => {
							  if (!code) {
								  var SeqNo= csmn_cont_seq_no_arr[index]
								  focusCell(tableContact, SeqNo, "typeContact");
							  }
						  });
					  }
					  else if(tablecomment.some(comment=>!comment)){
						  message('CUW','Comment must be entered.',0)
						  tablecomment.forEach((code, index) => {
							  if (!code) {
								  var SeqNo= csmn_cont_seq_no_arr[index]
								  triggerRowClick(tableContact, SeqNo, 'addCmntValShow')
							  }
						  });
						  
					  }else{
						  
							for (var i = 0; i < csmn_cont_seq_no_arr.length; i++) {
							   contactInformationInsert.push({
							  commit_no: COMMIT_NO,
							  csmn_cont_seq_no: csmn_cont_seq_no_arr[i],
							  csmn_cont_dt: TableDate[i],
							  csmn_cont_tm: Time[i],
							  inserted_date: Edate[i],
							  inserted_time: Etime[i],
							  cont_tp_cd: tablecontactcode[i],
							  csmn_cont_sprv_neg_flg: tablecheckbox[i],
							  correction_flag: tablecheckbox1[i],
							  resn_cd_neg_cont: tablereasoncode[i],
							  entered_by_user_id: entered_by_user_id,
							  entered_by_user_name: enterbyName[i],
							  csmn_cont_comnt: tablecomment[i],
							  csmn_cont_init_ddoc_flg: tableflag[i],//
							  user_id_init: tableUserIdinit[i],
							  REPORT_NUM: REPORT_NUM,
							  intervention_tp: intervention_tp,
							  verify_addr_flag: verify_addr_flag
							 });
							 } 
							 console.log('Printing JSON value='+JSON.stringify(contactInformationInsert));
							 
							 if(withRelation.length> '0'){
								 console.log('Inside function='+seqConnect+' '+seqcontactC+' '+reltionshipC+' '+nameFC+' '+nameLC+' '+nameMC+' '+nameSC+' '+COMMIT_NO)
								 loader(1);  
								 $.ajax({
								  url: 'CSM_Contact_Information',
								  type: 'POST', 
								  contentType: 'application/json',
								  data: JSON.stringify(contactInformationInsert),
								  success: function(response) {
									  loader(0); 
									  message('S',0,0);
									  var NoSeqUpdate = parseInt($('#SeqOFContactInformation').val(), 10)+1;
										 $('#SeqOFContactInformation').val(NoSeqUpdate);
									   MainQueryvalue(selectedCommit,idt_cont_from_dt,idt_cont_to_dt,ivc_relationship_code,ivc_results,ivc_cont_tp_cd);
						          	 savevalueofcontactperson(seqConnect,seqcontactC,reltionshipC,nameFC,nameLC,nameMC,nameSC,COMMIT_NO);
						          	contactInformationInsert = [];
								    $('.contactPersonDisableValue').css('pointer-events', 'none');      
				    	    	    $('.contactPersonDisableValue').prop('readonly', true);
									$('.contactPersonDisableValue').prop('disabled', true);
								   console.log('Procedure Executed successfully spnew insert');
								  },
							  });     
							
								 console.log('Printing JSON value of the contact person R')
							 }else{
								 loader(1);
								 $.ajax({
								  url: 'CSM_Contact_Information',
								  type: 'POST', 
								  contentType: 'application/json',
								  data: JSON.stringify(contactInformationInsert),
								  success: function(response) {
									  loader(0);
									  message('S',0,0);
									   var NoSeqUpdate = parseInt($('#SeqOFContactInformation').val(), 10)+1;
										 $('#SeqOFContactInformation').val(NoSeqUpdate);
									   MainQueryvalue(selectedCommit,idt_cont_from_dt,idt_cont_to_dt,ivc_relationship_code,ivc_results,ivc_cont_tp_cd);
									   contactInformationInsert = [];
									   UpdateISC()
								   console.log('Procedure Executed successfully spnew insert');
									    $('.contactPersonDisableValue').css('pointer-events', 'none');      
					    	    	    $('.contactPersonDisableValue').prop('readonly', true);
										$('.contactPersonDisableValue').prop('disabled', true);
								  },
			 		   		        error: function(error) {
				 			            console.error('Error:', error);
				 			           message('CUW','error while try to insert',0)
				 			            console.log("error while try to insert");
				 			        }
							  });     
							
								 console.log('Printing JSON value')
							 }
							 //////////////////////////////////
					
					  }   
			  }); 
		
		/*  $.ajax({
			    url: 'CBI_NOTI_SentByUser',
			    method: 'GET', 
			    success: function(data) {
			    	tabledatahelpofficer=[];
			    	tabledatahelpofficer=data;
			    	tabledatahelpofficerdata(tabledatahelpofficer);
		  
			          }, 
			    
			    error: function(xhr, status, error) {
			        console.error('Error:', error);
			      }
			   }); */ 
		 
	  /*   $(tabledatacontacttypehead[0].checkbox).html("<input type='checkbox'>");
	     $(tabledatacontacttype[0].checkbox).html("<input type='checkbox'>");
	    $(tabledatahistory[0].checkbox).html("<input type='checkbox'>");  */
	    
	    function download(cell) {
	    	return `<i id="addContactPerson" class="fa fa-plus" style="position: absolute; right: 5px; top: 5px; margin-right: 5px;"></i> <i id="addContactPerson10" class="fa fa-download" style="position: absolute; right: 27px; top: 5px; margin-right: 5px;"></i>`;
	    }
	    
	    function timePickerEditor(cell, onRendered, success, cancel) {
	        const cellValue = cell.getValue();
	        const input = document.createElement("input");
	        input.type = "time";
	        input.value = cellValue || "";
	        input.style.width = "100%";

	        // Automatically focus and select the field
	        onRendered(() => {
	            input.focus();
	            input.select();
	        });

	        // Save value on change
	        input.addEventListener("change", () => {
	            success(input.value);
	        });

	        // Save or cancel on keypress
	        input.addEventListener("keydown", (e) => {
	            if (e.key === "Enter") {
	                success(input.value);
	            } else if (e.key === "Escape") {
	                cancel();
	            }
	        });

	        // Save value on blur (optional)
	        input.addEventListener("blur", () => {
	            success(input.value);
	        });

	        return input;
	    }

	});
		

 	
	document.getElementById('dateTo-ip').addEventListener('change', function() {
	    if (this.value !== "") {
	        this.classList.add('has-value');
	    } else {
	        this.classList.remove('has-value');
	    }
	});
	
	
	</script>
	<script src="js/staticjs.js"></script> 
	
	<div th:replace="~{fragments/msgBox :: msgBox}"></div>
	<script type="text/javascript">
        $('#js-page-content').smartPanel();
    </script>
</body>
	<!-- BEGIN Page Footer -->
	<!-- 	<div th:replace="~{fragments/footer :: footer}"></div> -->
	<!-- END Page Footer -->
</html>